var glMatrix={EPSILON:1e-6};glMatrix.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,glMatrix.RANDOM=Math.random,glMatrix.setMatrixArrayType=function(e){glMatrix.ARRAY_TYPE=e};var degree=Math.PI/180;glMatrix.toRadian=function(e){return e*degree},glMatrix.equals=function(e,t){return Math.abs(e-t)<=glMatrix.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))};var mat4={create:function(){var e=new glMatrix.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},clone:function(e){var t=new glMatrix.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:function(e,t,r,a,i,n,o,s,l,c,u,_,h,f,d,p){var m=new glMatrix.ARRAY_TYPE(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=a,m[4]=i,m[5]=n,m[6]=o,m[7]=s,m[8]=l,m[9]=c,m[10]=u,m[11]=_,m[12]=h,m[13]=f,m[14]=d,m[15]=p,m},set:function(e,t,r,a,i,n,o,s,l,c,u,_,h,f,d,p,m){return e[0]=t,e[1]=r,e[2]=a,e[3]=i,e[4]=n,e[5]=o,e[6]=s,e[7]=l,e[8]=c,e[9]=u,e[10]=_,e[11]=h,e[12]=f,e[13]=d,e[14]=p,e[15]=m,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){if(e===t){var r=t[1],a=t[2],i=t[3],n=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=a,e[9]=n,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8],_=t[9],h=t[10],f=t[11],d=t[12],p=t[13],m=t[14],g=t[15],y=r*s-a*o,v=r*l-i*o,S=r*c-n*o,b=a*l-i*s,E=a*c-n*s,I=i*c-n*l,x=u*p-_*d,C=u*m-h*d,T=u*g-f*d,N=_*m-h*p,A=_*g-f*p,D=h*g-f*m,M=y*D-v*A+S*N+b*T-E*C+I*x;return M?(e[0]=(s*D-l*A+c*N)*(M=1/M),e[1]=(i*A-a*D-n*N)*M,e[2]=(p*I-m*E+g*b)*M,e[3]=(h*E-_*I-f*b)*M,e[4]=(l*T-o*D-c*C)*M,e[5]=(r*D-i*T+n*C)*M,e[6]=(m*S-d*I-g*v)*M,e[7]=(u*I-h*S+f*v)*M,e[8]=(o*A-s*T+c*x)*M,e[9]=(a*T-r*A-n*x)*M,e[10]=(d*E-p*S+g*y)*M,e[11]=(_*S-u*E-f*y)*M,e[12]=(s*C-o*N-l*x)*M,e[13]=(r*N-a*C+i*x)*M,e[14]=(p*v-d*b-m*y)*M,e[15]=(u*b-_*v+h*y)*M,e):null},adjoint:function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8],_=t[9],h=t[10],f=t[11],d=t[12],p=t[13],m=t[14],g=t[15];return e[0]=s*(h*g-f*m)-_*(l*g-c*m)+p*(l*f-c*h),e[1]=-(a*(h*g-f*m)-_*(i*g-n*m)+p*(i*f-n*h)),e[2]=a*(l*g-c*m)-s*(i*g-n*m)+p*(i*c-n*l),e[3]=-(a*(l*f-c*h)-s*(i*f-n*h)+_*(i*c-n*l)),e[4]=-(o*(h*g-f*m)-u*(l*g-c*m)+d*(l*f-c*h)),e[5]=r*(h*g-f*m)-u*(i*g-n*m)+d*(i*f-n*h),e[6]=-(r*(l*g-c*m)-o*(i*g-n*m)+d*(i*c-n*l)),e[7]=r*(l*f-c*h)-o*(i*f-n*h)+u*(i*c-n*l),e[8]=o*(_*g-f*p)-u*(s*g-c*p)+d*(s*f-c*_),e[9]=-(r*(_*g-f*p)-u*(a*g-n*p)+d*(a*f-n*_)),e[10]=r*(s*g-c*p)-o*(a*g-n*p)+d*(a*c-n*s),e[11]=-(r*(s*f-c*_)-o*(a*f-n*_)+u*(a*c-n*s)),e[12]=-(o*(_*m-h*p)-u*(s*m-l*p)+d*(s*h-l*_)),e[13]=r*(_*m-h*p)-u*(a*m-i*p)+d*(a*h-i*_),e[14]=-(r*(s*m-l*p)-o*(a*m-i*p)+d*(a*l-i*s)),e[15]=r*(s*h-l*_)-o*(a*h-i*_)+u*(a*l-i*s),e},determinant:function(e){var t=e[0],r=e[1],a=e[2],i=e[3],n=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],_=e[10],h=e[11],f=e[12],d=e[13],p=e[14],m=e[15];return(t*o-r*n)*(_*m-h*p)-(t*s-a*n)*(u*m-h*d)+(t*l-i*n)*(u*p-_*d)+(r*s-a*o)*(c*m-h*f)-(r*l-i*o)*(c*p-_*f)+(a*l-i*s)*(c*d-u*f)},multiply:function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],_=t[8],h=t[9],f=t[10],d=t[11],p=t[12],m=t[13],g=t[14],y=t[15],v=r[0],S=r[1],b=r[2],E=r[3];return e[0]=v*a+S*s+b*_+E*p,e[1]=v*i+S*l+b*h+E*m,e[2]=v*n+S*c+b*f+E*g,e[3]=v*o+S*u+b*d+E*y,e[4]=(v=r[4])*a+(S=r[5])*s+(b=r[6])*_+(E=r[7])*p,e[5]=v*i+S*l+b*h+E*m,e[6]=v*n+S*c+b*f+E*g,e[7]=v*o+S*u+b*d+E*y,e[8]=(v=r[8])*a+(S=r[9])*s+(b=r[10])*_+(E=r[11])*p,e[9]=v*i+S*l+b*h+E*m,e[10]=v*n+S*c+b*f+E*g,e[11]=v*o+S*u+b*d+E*y,e[12]=(v=r[12])*a+(S=r[13])*s+(b=r[14])*_+(E=r[15])*p,e[13]=v*i+S*l+b*h+E*m,e[14]=v*n+S*c+b*f+E*g,e[15]=v*o+S*u+b*d+E*y,e}};mat4.mul=mat4.multiply,mat4.translate=function(e,t,r){var a,i,n,o,s,l,c,u,_,h,f,d,p=r[0],m=r[1],g=r[2];return t===e?(e[12]=t[0]*p+t[4]*m+t[8]*g+t[12],e[13]=t[1]*p+t[5]*m+t[9]*g+t[13],e[14]=t[2]*p+t[6]*m+t[10]*g+t[14],e[15]=t[3]*p+t[7]*m+t[11]*g+t[15]):(i=t[1],n=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],_=t[8],h=t[9],f=t[10],d=t[11],e[0]=a=t[0],e[1]=i,e[2]=n,e[3]=o,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=_,e[9]=h,e[10]=f,e[11]=d,e[12]=a*p+s*m+_*g+t[12],e[13]=i*p+l*m+h*g+t[13],e[14]=n*p+c*m+f*g+t[14],e[15]=o*p+u*m+d*g+t[15]),e},mat4.scale=function(e,t,r){var a=r[0],i=r[1],n=r[2];return e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},mat4.rotate=function(e,t,r,a){var i,n,o,s,l,c,u,_,h,f,d,p,m,g,y,v,S,b,E,I,x,C,T,N,A=a[0],D=a[1],M=a[2],P=Math.sqrt(A*A+D*D+M*M);return Math.abs(P)<glMatrix.EPSILON?null:(A*=P=1/P,D*=P,M*=P,i=Math.sin(r),n=Math.cos(r),l=t[1],c=t[2],u=t[3],h=t[5],f=t[6],d=t[7],m=t[9],g=t[10],y=t[11],E=A*D*(o=1-n)-M*i,I=D*D*o+n,x=M*D*o+A*i,C=A*M*o+D*i,T=D*M*o-A*i,N=M*M*o+n,e[0]=(s=t[0])*(v=A*A*o+n)+(_=t[4])*(S=D*A*o+M*i)+(p=t[8])*(b=M*A*o-D*i),e[1]=l*v+h*S+m*b,e[2]=c*v+f*S+g*b,e[3]=u*v+d*S+y*b,e[4]=s*E+_*I+p*x,e[5]=l*E+h*I+m*x,e[6]=c*E+f*I+g*x,e[7]=u*E+d*I+y*x,e[8]=s*C+_*T+p*N,e[9]=l*C+h*T+m*N,e[10]=c*C+f*T+g*N,e[11]=u*C+d*T+y*N,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},mat4.rotateX=function(e,t,r){var a=Math.sin(r),i=Math.cos(r),n=t[4],o=t[5],s=t[6],l=t[7],c=t[8],u=t[9],_=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*i+c*a,e[5]=o*i+u*a,e[6]=s*i+_*a,e[7]=l*i+h*a,e[8]=c*i-n*a,e[9]=u*i-o*a,e[10]=_*i-s*a,e[11]=h*i-l*a,e},mat4.rotateY=function(e,t,r){var a=Math.sin(r),i=Math.cos(r),n=t[0],o=t[1],s=t[2],l=t[3],c=t[8],u=t[9],_=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i-c*a,e[1]=o*i-u*a,e[2]=s*i-_*a,e[3]=l*i-h*a,e[8]=n*a+c*i,e[9]=o*a+u*i,e[10]=s*a+_*i,e[11]=l*a+h*i,e},mat4.rotateZ=function(e,t,r){var a=Math.sin(r),i=Math.cos(r),n=t[0],o=t[1],s=t[2],l=t[3],c=t[4],u=t[5],_=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i+c*a,e[1]=o*i+u*a,e[2]=s*i+_*a,e[3]=l*i+h*a,e[4]=c*i-n*a,e[5]=u*i-o*a,e[6]=_*i-s*a,e[7]=h*i-l*a,e},mat4.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},mat4.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.fromRotation=function(e,t,r){var a,i,n,o=r[0],s=r[1],l=r[2],c=Math.sqrt(o*o+s*s+l*l);return Math.abs(c)<glMatrix.EPSILON?null:(o*=c=1/c,s*=c,l*=c,a=Math.sin(t),i=Math.cos(t),e[0]=o*o*(n=1-i)+i,e[1]=s*o*n+l*a,e[2]=l*o*n-s*a,e[3]=0,e[4]=o*s*n-l*a,e[5]=s*s*n+i,e[6]=l*s*n+o*a,e[7]=0,e[8]=o*l*n+s*a,e[9]=s*l*n-o*a,e[10]=l*l*n+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},mat4.fromXRotation=function(e,t){var r=Math.sin(t),a=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.fromYRotation=function(e,t){var r=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.fromZRotation=function(e,t){var r=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.fromRotationTranslation=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=a+a,l=i+i,c=n+n,u=a*s,_=a*l,h=a*c,f=i*l,d=i*c,p=n*c,m=o*s,g=o*l,y=o*c;return e[0]=1-(f+p),e[1]=_+y,e[2]=h-g,e[3]=0,e[4]=_-y,e[5]=1-(u+p),e[6]=d+m,e[7]=0,e[8]=h+g,e[9]=d-m,e[10]=1-(u+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},mat4.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},mat4.getScaling=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[4],o=t[5],s=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+a*a+i*i),e[1]=Math.sqrt(n*n+o*o+s*s),e[2]=Math.sqrt(l*l+c*c+u*u),e},mat4.getRotation=function(e,t){var r=t[0]+t[5]+t[10],a=0;return r>0?(a=2*Math.sqrt(r+1),e[3]=.25*a,e[0]=(t[6]-t[9])/a,e[1]=(t[8]-t[2])/a,e[2]=(t[1]-t[4])/a):t[0]>t[5]&t[0]>t[10]?(a=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/a,e[0]=.25*a,e[1]=(t[1]+t[4])/a,e[2]=(t[8]+t[2])/a):t[5]>t[10]?(a=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/a,e[0]=(t[1]+t[4])/a,e[1]=.25*a,e[2]=(t[6]+t[9])/a):(a=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/a,e[0]=(t[8]+t[2])/a,e[1]=(t[6]+t[9])/a,e[2]=.25*a),e},mat4.fromRotationTranslationScale=function(e,t,r,a){var i=t[0],n=t[1],o=t[2],s=t[3],l=i+i,c=n+n,u=o+o,_=i*l,h=i*c,f=i*u,d=n*c,p=n*u,m=o*u,g=s*l,y=s*c,v=s*u,S=a[0],b=a[1],E=a[2];return e[0]=(1-(d+m))*S,e[1]=(h+v)*S,e[2]=(f-y)*S,e[3]=0,e[4]=(h-v)*b,e[5]=(1-(_+m))*b,e[6]=(p+g)*b,e[7]=0,e[8]=(f+y)*E,e[9]=(p-g)*E,e[10]=(1-(_+d))*E,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},mat4.fromRotationTranslationScaleOrigin=function(e,t,r,a,i){var n=t[0],o=t[1],s=t[2],l=t[3],c=n+n,u=o+o,_=s+s,h=n*c,f=n*u,d=n*_,p=o*u,m=o*_,g=s*_,y=l*c,v=l*u,S=l*_,b=a[0],E=a[1],I=a[2],x=i[0],C=i[1],T=i[2];return e[0]=(1-(p+g))*b,e[1]=(f+S)*b,e[2]=(d-v)*b,e[3]=0,e[4]=(f-S)*E,e[5]=(1-(h+g))*E,e[6]=(m+y)*E,e[7]=0,e[8]=(d+v)*I,e[9]=(m-y)*I,e[10]=(1-(h+p))*I,e[11]=0,e[12]=r[0]+x-(e[0]*x+e[4]*C+e[8]*T),e[13]=r[1]+C-(e[1]*x+e[5]*C+e[9]*T),e[14]=r[2]+T-(e[2]*x+e[6]*C+e[10]*T),e[15]=1,e},mat4.fromQuat=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=r+r,s=a+a,l=i+i,c=r*o,u=a*o,_=a*s,h=i*o,f=i*s,d=i*l,p=n*o,m=n*s,g=n*l;return e[0]=1-_-d,e[1]=u+g,e[2]=h-m,e[3]=0,e[4]=u-g,e[5]=1-c-d,e[6]=f+p,e[7]=0,e[8]=h+m,e[9]=f-p,e[10]=1-c-_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.frustum=function(e,t,r,a,i,n,o){var s=1/(r-t),l=1/(i-a),c=1/(n-o);return e[0]=2*n*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(i+a)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e},mat4.perspective=function(e,t,r,a,i){var n=1/Math.tan(t/2),o=1/(a-i);return e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+a)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*a*o,e[15]=0,e},mat4.perspectiveFromFieldOfView=function(e,t,r,a){var i=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+s),c=2/(i+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-s)*l*.5,e[9]=(i-n)*c*.5,e[10]=a/(r-a),e[11]=-1,e[12]=0,e[13]=0,e[14]=a*r/(r-a),e[15]=0,e},mat4.ortho=function(e,t,r,a,i,n,o){var s=1/(t-r),l=1/(a-i),c=1/(n-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(i+a)*l,e[14]=(o+n)*c,e[15]=1,e},mat4.lookAt=function(e,t,r,a){var i,n,o,s,l,c,u,_,h,f,d=t[0],p=t[1],m=t[2],g=a[0],y=a[1],v=a[2],S=r[0],b=r[1],E=r[2];return Math.abs(d-S)<glMatrix.EPSILON&&Math.abs(p-b)<glMatrix.EPSILON&&Math.abs(m-E)<glMatrix.EPSILON?mat4.identity(e):(u=d-S,_=p-b,h=m-E,i=y*(h*=f=1/Math.sqrt(u*u+_*_+h*h))-v*(_*=f),n=v*(u*=f)-g*h,o=g*_-y*u,(f=Math.sqrt(i*i+n*n+o*o))?(i*=f=1/f,n*=f,o*=f):(i=0,n=0,o=0),s=_*o-h*n,l=h*i-u*o,c=u*n-_*i,(f=Math.sqrt(s*s+l*l+c*c))?(s*=f=1/f,l*=f,c*=f):(s=0,l=0,c=0),e[0]=i,e[1]=s,e[2]=u,e[3]=0,e[4]=n,e[5]=l,e[6]=_,e[7]=0,e[8]=o,e[9]=c,e[10]=h,e[11]=0,e[12]=-(i*d+n*p+o*m),e[13]=-(s*d+l*p+c*m),e[14]=-(u*d+_*p+h*m),e[15]=1,e)},mat4.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},mat4.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},mat4.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},mat4.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e},mat4.sub=mat4.subtract,mat4.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},mat4.multiplyScalarAndAdd=function(e,t,r,a){return e[0]=t[0]+r[0]*a,e[1]=t[1]+r[1]*a,e[2]=t[2]+r[2]*a,e[3]=t[3]+r[3]*a,e[4]=t[4]+r[4]*a,e[5]=t[5]+r[5]*a,e[6]=t[6]+r[6]*a,e[7]=t[7]+r[7]*a,e[8]=t[8]+r[8]*a,e[9]=t[9]+r[9]*a,e[10]=t[10]+r[10]*a,e[11]=t[11]+r[11]*a,e[12]=t[12]+r[12]*a,e[13]=t[13]+r[13]*a,e[14]=t[14]+r[14]*a,e[15]=t[15]+r[15]*a,e},mat4.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},mat4.equals=function(e,t){var r=e[0],a=e[1],i=e[2],n=e[3],o=e[4],s=e[5],l=e[6],c=e[7],u=e[8],_=e[9],h=e[10],f=e[11],d=e[12],p=e[13],m=e[14],g=e[15],y=t[0],v=t[1],S=t[2],b=t[3],E=t[4],I=t[5],x=t[6],C=t[7],T=t[8],N=t[9],A=t[10],D=t[11],M=t[12],P=t[13],w=t[14],F=t[15];return Math.abs(r-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(a-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(i-S)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(n-b)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(o-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(s-I)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(l-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(c-C)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(u-T)<=glMatrix.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(_-N)<=glMatrix.EPSILON*Math.max(1,Math.abs(_),Math.abs(N))&&Math.abs(h-A)<=glMatrix.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(f-D)<=glMatrix.EPSILON*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(d-M)<=glMatrix.EPSILON*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(p-P)<=glMatrix.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-w)<=glMatrix.EPSILON*Math.max(1,Math.abs(m),Math.abs(w))&&Math.abs(g-F)<=glMatrix.EPSILON*Math.max(1,Math.abs(g),Math.abs(F))};var mat3={create:function(){var e=new glMatrix.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new glMatrix.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues:function(e,t,r,a,i,n,o,s,l){var c=new glMatrix.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=a,c[4]=i,c[5]=n,c[6]=o,c[7]=s,c[8]=l,c},set:function(e,t,r,a,i,n,o,s,l,c){return e[0]=t,e[1]=r,e[2]=a,e[3]=i,e[4]=n,e[5]=o,e[6]=s,e[7]=l,e[8]=c,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var r=t[1],a=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=a,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8],_=u*o-s*c,h=-u*n+s*l,f=c*n-o*l,d=r*_+a*h+i*f;return d?(e[0]=_*(d=1/d),e[1]=(-u*a+i*c)*d,e[2]=(s*a-i*o)*d,e[3]=h*d,e[4]=(u*r-i*l)*d,e[5]=(-s*r+i*n)*d,e[6]=f*d,e[7]=(-c*r+a*l)*d,e[8]=(o*r-a*n)*d,e):null},adjoint:function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8];return e[0]=o*u-s*c,e[1]=i*c-a*u,e[2]=a*s-i*o,e[3]=s*l-n*u,e[4]=r*u-i*l,e[5]=i*n-r*s,e[6]=n*c-o*l,e[7]=a*l-r*c,e[8]=r*o-a*n,e},determinant:function(e){var t=e[3],r=e[4],a=e[5],i=e[6],n=e[7],o=e[8];return e[0]*(o*r-a*n)+e[1]*(-o*t+a*i)+e[2]*(n*t-r*i)},multiply:function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],_=t[8],h=r[0],f=r[1],d=r[2],p=r[3],m=r[4],g=r[5],y=r[6],v=r[7],S=r[8];return e[0]=h*a+f*o+d*c,e[1]=h*i+f*s+d*u,e[2]=h*n+f*l+d*_,e[3]=p*a+m*o+g*c,e[4]=p*i+m*s+g*u,e[5]=p*n+m*l+g*_,e[6]=y*a+v*o+S*c,e[7]=y*i+v*s+S*u,e[8]=y*n+v*l+S*_,e}};mat3.mul=mat3.multiply,mat3.translate=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],_=t[8],h=r[0],f=r[1];return e[0]=a,e[1]=i,e[2]=n,e[3]=o,e[4]=s,e[5]=l,e[6]=h*a+f*o+c,e[7]=h*i+f*s+u,e[8]=h*n+f*l+_,e},mat3.rotate=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=t[4],l=t[5],c=t[6],u=t[7],_=t[8],h=Math.sin(r),f=Math.cos(r);return e[0]=f*a+h*o,e[1]=f*i+h*s,e[2]=f*n+h*l,e[3]=f*o-h*a,e[4]=f*s-h*i,e[5]=f*l-h*n,e[6]=c,e[7]=u,e[8]=_,e},mat3.scale=function(e,t,r){var a=r[0],i=r[1];return e[0]=a*t[0],e[1]=a*t[1],e[2]=a*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},mat3.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},mat3.fromRotation=function(e,t){var r=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=r,e[2]=0,e[3]=-r,e[4]=a,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},mat3.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},mat3.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},mat3.fromQuat=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=r+r,s=a+a,l=i+i,c=r*o,u=a*o,_=a*s,h=i*o,f=i*s,d=i*l,p=n*o,m=n*s,g=n*l;return e[0]=1-_-d,e[3]=u-g,e[6]=h+m,e[1]=u+g,e[4]=1-c-d,e[7]=f-p,e[2]=h-m,e[5]=f+p,e[8]=1-c-_,e},mat3.normalFromMat4=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=t[4],s=t[5],l=t[6],c=t[7],u=t[8],_=t[9],h=t[10],f=t[11],d=t[12],p=t[13],m=t[14],g=t[15],y=r*s-a*o,v=r*l-i*o,S=r*c-n*o,b=a*l-i*s,E=a*c-n*s,I=i*c-n*l,x=u*p-_*d,C=u*m-h*d,T=u*g-f*d,N=_*m-h*p,A=_*g-f*p,D=h*g-f*m,M=y*D-v*A+S*N+b*T-E*C+I*x;return M?(e[0]=(s*D-l*A+c*N)*(M=1/M),e[1]=(l*T-o*D-c*C)*M,e[2]=(o*A-s*T+c*x)*M,e[3]=(i*A-a*D-n*N)*M,e[4]=(r*D-i*T+n*C)*M,e[5]=(a*T-r*A-n*x)*M,e[6]=(p*I-m*E+g*b)*M,e[7]=(m*S-d*I-g*v)*M,e[8]=(d*E-p*S+g*y)*M,e):null},mat3.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},mat3.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},mat3.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},mat3.subtract=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e},mat3.sub=mat3.subtract,mat3.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},mat3.multiplyScalarAndAdd=function(e,t,r,a){return e[0]=t[0]+r[0]*a,e[1]=t[1]+r[1]*a,e[2]=t[2]+r[2]*a,e[3]=t[3]+r[3]*a,e[4]=t[4]+r[4]*a,e[5]=t[5]+r[5]*a,e[6]=t[6]+r[6]*a,e[7]=t[7]+r[7]*a,e[8]=t[8]+r[8]*a,e},mat3.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},mat3.equals=function(e,t){var r=e[0],a=e[1],i=e[2],n=e[3],o=e[4],s=e[5],l=e[6],c=e[7],u=e[8],_=t[0],h=t[1],f=t[2],d=t[3],p=t[4],m=t[5],g=t[6],y=t[7],v=t[8];return Math.abs(r-_)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(a-h)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(i-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-d)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(l-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))};var vec2={create:function(){var e=new glMatrix.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e},clone:function(e){var t=new glMatrix.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var r=new glMatrix.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,r){return e[0]=t,e[1]=r,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},subtract:function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}};vec2.sub=vec2.subtract,vec2.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},vec2.mul=vec2.multiply,vec2.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},vec2.div=vec2.divide,vec2.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},vec2.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},vec2.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},vec2.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},vec2.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},vec2.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},vec2.scaleAndAdd=function(e,t,r,a){return e[0]=t[0]+r[0]*a,e[1]=t[1]+r[1]*a,e},vec2.distance=function(e,t){var r=t[0]-e[0],a=t[1]-e[1];return Math.sqrt(r*r+a*a)},vec2.dist=vec2.distance,vec2.squaredDistance=function(e,t){var r=t[0]-e[0],a=t[1]-e[1];return r*r+a*a},vec2.sqrDist=vec2.squaredDistance,vec2.length=function(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)},vec2.len=vec2.length,vec2.squaredLength=function(e){var t=e[0],r=e[1];return t*t+r*r},vec2.sqrLen=vec2.squaredLength,vec2.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},vec2.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},vec2.normalize=function(e,t){var r=t[0],a=t[1],i=r*r+a*a;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},vec2.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},vec2.cross=function(e,t,r){var a=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=a,e},vec2.lerp=function(e,t,r,a){var i=t[0],n=t[1];return e[0]=i+a*(r[0]-i),e[1]=n+a*(r[1]-n),e},vec2.random=function(e,t){t=t||1;var r=2*glMatrix.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},vec2.transformMat2=function(e,t,r){var a=t[0],i=t[1];return e[0]=r[0]*a+r[2]*i,e[1]=r[1]*a+r[3]*i,e},vec2.transformMat2d=function(e,t,r){var a=t[0],i=t[1];return e[0]=r[0]*a+r[2]*i+r[4],e[1]=r[1]*a+r[3]*i+r[5],e},vec2.transformMat3=function(e,t,r){var a=t[0],i=t[1];return e[0]=r[0]*a+r[3]*i+r[6],e[1]=r[1]*a+r[4]*i+r[7],e},vec2.transformMat4=function(e,t,r){var a=t[0],i=t[1];return e[0]=r[0]*a+r[4]*i+r[12],e[1]=r[1]*a+r[5]*i+r[13],e},vec2.forEach=function(){var e=vec2.create();return function(t,r,a,i,n,o){var s,l;for(r||(r=2),a||(a=0),l=i?Math.min(i*r+a,t.length):t.length,s=a;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],n(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}(),vec2.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},vec2.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},vec2.equals=function(e,t){var r=e[0],a=e[1],i=t[0],n=t[1];return Math.abs(r-i)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(a-n)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(n))};var vec3={create:function(){var e=new glMatrix.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e},clone:function(e){var t=new glMatrix.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},fromValues:function(e,t,r){var a=new glMatrix.ARRAY_TYPE(3);return a[0]=e,a[1]=t,a[2]=r,a},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,r,a){return e[0]=t,e[1]=r,e[2]=a,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},subtract:function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}};vec3.sub=vec3.subtract,vec3.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e},vec3.mul=vec3.multiply,vec3.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},vec3.div=vec3.divide,vec3.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},vec3.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},vec3.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},vec3.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},vec3.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},vec3.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},vec3.scaleAndAdd=function(e,t,r,a){return e[0]=t[0]+r[0]*a,e[1]=t[1]+r[1]*a,e[2]=t[2]+r[2]*a,e},vec3.distance=function(e,t){var r=t[0]-e[0],a=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+a*a+i*i)},vec3.dist=vec3.distance,vec3.squaredDistance=function(e,t){var r=t[0]-e[0],a=t[1]-e[1],i=t[2]-e[2];return r*r+a*a+i*i},vec3.sqrDist=vec3.squaredDistance,vec3.length=function(e){var t=e[0],r=e[1],a=e[2];return Math.sqrt(t*t+r*r+a*a)},vec3.len=vec3.length,vec3.squaredLength=function(e){var t=e[0],r=e[1],a=e[2];return t*t+r*r+a*a},vec3.sqrLen=vec3.squaredLength,vec3.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},vec3.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},vec3.normalize=function(e,t){var r=t[0],a=t[1],i=t[2],n=r*r+a*a+i*i;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e},vec3.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},vec3.cross=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=r[0],s=r[1],l=r[2];return e[0]=i*l-n*s,e[1]=n*o-a*l,e[2]=a*s-i*o,e},vec3.lerp=function(e,t,r,a){var i=t[0],n=t[1],o=t[2];return e[0]=i+a*(r[0]-i),e[1]=n+a*(r[1]-n),e[2]=o+a*(r[2]-o),e},vec3.hermite=function(e,t,r,a,i,n){var o=n*n,s=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),u=o*(3-2*n);return e[0]=t[0]*s+r[0]*l+a[0]*c+i[0]*u,e[1]=t[1]*s+r[1]*l+a[1]*c+i[1]*u,e[2]=t[2]*s+r[2]*l+a[2]*c+i[2]*u,e},vec3.bezier=function(e,t,r,a,i,n){var o=1-n,s=o*o,l=n*n,c=s*o,u=3*n*s,_=3*l*o,h=l*n;return e[0]=t[0]*c+r[0]*u+a[0]*_+i[0]*h,e[1]=t[1]*c+r[1]*u+a[1]*_+i[1]*h,e[2]=t[2]*c+r[2]*u+a[2]*_+i[2]*h,e},vec3.random=function(e,t){t=t||1;var r=2*glMatrix.RANDOM()*Math.PI,a=2*glMatrix.RANDOM()-1,i=Math.sqrt(1-a*a)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=a*t,e},vec3.transformMat4=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=r[3]*a+r[7]*i+r[11]*n+r[15];return e[0]=(r[0]*a+r[4]*i+r[8]*n+r[12])/(o=o||1),e[1]=(r[1]*a+r[5]*i+r[9]*n+r[13])/o,e[2]=(r[2]*a+r[6]*i+r[10]*n+r[14])/o,e},vec3.transformMat3=function(e,t,r){var a=t[0],i=t[1],n=t[2];return e[0]=a*r[0]+i*r[3]+n*r[6],e[1]=a*r[1]+i*r[4]+n*r[7],e[2]=a*r[2]+i*r[5]+n*r[8],e},vec3.transformQuat=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=r[0],s=r[1],l=r[2],c=r[3],u=c*a+s*n-l*i,_=c*i+l*a-o*n,h=c*n+o*i-s*a,f=-o*a-s*i-l*n;return e[0]=u*c+f*-o+_*-l-h*-s,e[1]=_*c+f*-s+h*-o-u*-l,e[2]=h*c+f*-l+u*-s-_*-o,e},vec3.rotateX=function(e,t,r,a){var i=[],n=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],n[0]=i[0],n[1]=i[1]*Math.cos(a)-i[2]*Math.sin(a),n[2]=i[1]*Math.sin(a)+i[2]*Math.cos(a),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e},vec3.rotateY=function(e,t,r,a){var i=[],n=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],n[0]=i[2]*Math.sin(a)+i[0]*Math.cos(a),n[1]=i[1],n[2]=i[2]*Math.cos(a)-i[0]*Math.sin(a),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e},vec3.rotateZ=function(e,t,r,a){var i=[],n=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],n[0]=i[0]*Math.cos(a)-i[1]*Math.sin(a),n[1]=i[0]*Math.sin(a)+i[1]*Math.cos(a),n[2]=i[2],e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e},vec3.forEach=function(){var e=vec3.create();return function(t,r,a,i,n,o){var s,l;for(r||(r=3),a||(a=0),l=i?Math.min(i*r+a,t.length):t.length,s=a;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],n(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}(),vec3.angle=function(e,t){var r=vec3.fromValues(e[0],e[1],e[2]),a=vec3.fromValues(t[0],t[1],t[2]);vec3.normalize(r,r),vec3.normalize(a,a);var i=vec3.dot(r,a);return i>1?0:i<-1?Math.PI:Math.acos(i)},vec3.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},vec3.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},vec3.equals=function(e,t){var r=e[0],a=e[1],i=e[2],n=t[0],o=t[1],s=t[2];return Math.abs(r-n)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(a-o)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(i-s)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))};var vec4={create:function(){var e=new glMatrix.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},clone:function(e){var t=new glMatrix.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},fromValues:function(e,t,r,a){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=a,i},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},set:function(e,t,r,a,i){return e[0]=t,e[1]=r,e[2]=a,e[3]=i,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},subtract:function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}};vec4.sub=vec4.subtract,vec4.multiply=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e},vec4.mul=vec4.multiply,vec4.divide=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e},vec4.div=vec4.divide,vec4.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},vec4.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},vec4.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},vec4.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},vec4.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},vec4.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},vec4.scaleAndAdd=function(e,t,r,a){return e[0]=t[0]+r[0]*a,e[1]=t[1]+r[1]*a,e[2]=t[2]+r[2]*a,e[3]=t[3]+r[3]*a,e},vec4.distance=function(e,t){var r=t[0]-e[0],a=t[1]-e[1],i=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(r*r+a*a+i*i+n*n)},vec4.dist=vec4.distance,vec4.squaredDistance=function(e,t){var r=t[0]-e[0],a=t[1]-e[1],i=t[2]-e[2],n=t[3]-e[3];return r*r+a*a+i*i+n*n},vec4.sqrDist=vec4.squaredDistance,vec4.length=function(e){var t=e[0],r=e[1],a=e[2],i=e[3];return Math.sqrt(t*t+r*r+a*a+i*i)},vec4.len=vec4.length,vec4.squaredLength=function(e){var t=e[0],r=e[1],a=e[2],i=e[3];return t*t+r*r+a*a+i*i},vec4.sqrLen=vec4.squaredLength,vec4.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},vec4.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},vec4.normalize=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=r*r+a*a+i*i+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=a*o,e[2]=i*o,e[3]=n*o),e},vec4.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},vec4.lerp=function(e,t,r,a){var i=t[0],n=t[1],o=t[2],s=t[3];return e[0]=i+a*(r[0]-i),e[1]=n+a*(r[1]-n),e[2]=o+a*(r[2]-o),e[3]=s+a*(r[3]-s),e},vec4.random=function(e,t){return t=t||1,e[0]=glMatrix.RANDOM(),e[1]=glMatrix.RANDOM(),e[2]=glMatrix.RANDOM(),e[3]=glMatrix.RANDOM(),vec4.normalize(e,e),vec4.scale(e,e,t),e},vec4.transformMat4=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3];return e[0]=r[0]*a+r[4]*i+r[8]*n+r[12]*o,e[1]=r[1]*a+r[5]*i+r[9]*n+r[13]*o,e[2]=r[2]*a+r[6]*i+r[10]*n+r[14]*o,e[3]=r[3]*a+r[7]*i+r[11]*n+r[15]*o,e},vec4.transformQuat=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=r[0],s=r[1],l=r[2],c=r[3],u=c*a+s*n-l*i,_=c*i+l*a-o*n,h=c*n+o*i-s*a,f=-o*a-s*i-l*n;return e[0]=u*c+f*-o+_*-l-h*-s,e[1]=_*c+f*-s+h*-o-u*-l,e[2]=h*c+f*-l+u*-s-_*-o,e[3]=t[3],e},vec4.forEach=function(){var e=vec4.create();return function(t,r,a,i,n,o){var s,l;for(r||(r=4),a||(a=0),l=i?Math.min(i*r+a,t.length):t.length,s=a;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],n(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}(),vec4.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},vec4.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},vec4.equals=function(e,t){var r=e[0],a=e[1],i=e[2],n=e[3],o=t[0],s=t[1],l=t[2],c=t[3];return Math.abs(r-o)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-s)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(i-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-c)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))};var quat={};function ColorFresnel(e){var t=[[1,1,1],[1,1,1],1,0,1];5===arguments.length?t=Array.prototype.slice.call(arguments):Array.isArray(e)&&(t=e),this.isColorFresnel=!0,this.center=t[0],this.edge=t[1],this.centerBias=t[2],this.edgeBias=t[3],this.power=t[4]}function ScalarFresnel(e){var t=[1,1,1,0,1];5===arguments.length?t=Array.prototype.slice.call(arguments):Array.isArray(e)&&(t=e),this.isScalarFresnel=!0,this.center=t[0],this.edge=t[1],this.centerBias=t[2],this.edgeBias=t[3],this.power=t[4]}function unpackChapterLights(e){"use strict";var t,r={},a=0,i=0,n=Human.assets.lights.lightIds,o=Human.renderer.lights.defaultLightIds;if(e.lights.length)for(a=0;a<e.lights.length;a++)r[e.lights[a]]=!0;if(e.libraries.length)for(a=0;a<e.libraries.length;a++)if(n.hasOwnProperty(t=e.libraries[a]))for(i=0;i<n[t].length;i++)r[n[t][i]]=!0;else if("default"===t)for(i=0;i<o.length;i++)r[o[i]]=!0;return r}quat.create=function(){var e=new glMatrix.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},quat.rotationTo=function(){var e=vec3.create(),t=vec3.fromValues(1,0,0),r=vec3.fromValues(0,1,0);return function(a,i,n){var o=vec3.dot(i,n);return o<-.999999?(vec3.cross(e,t,i),vec3.length(e)<1e-6&&vec3.cross(e,r,i),vec3.normalize(e,e),quat.setAxisAngle(a,e,Math.PI),a):o>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(vec3.cross(e,i,n),a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=1+o,quat.normalize(a,a))}}(),quat.setAxes=function(){var e=mat3.create();return function(t,r,a,i){return e[0]=a[0],e[3]=a[1],e[6]=a[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],quat.normalize(t,quat.fromMat3(t,e))}}(),quat.clone=vec4.clone,quat.fromValues=vec4.fromValues,quat.copy=vec4.copy,quat.set=vec4.set,quat.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},quat.setAxisAngle=function(e,t,r){r*=.5;var a=Math.sin(r);return e[0]=a*t[0],e[1]=a*t[1],e[2]=a*t[2],e[3]=Math.cos(r),e},quat.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),a=Math.sin(r/2);return 0!=a?(e[0]=t[0]/a,e[1]=t[1]/a,e[2]=t[2]/a):(e[0]=1,e[1]=0,e[2]=0),r},quat.add=vec4.add,quat.multiply=function(e,t,r){var a=t[0],i=t[1],n=t[2],o=t[3],s=r[0],l=r[1],c=r[2],u=r[3];return e[0]=a*u+o*s+i*c-n*l,e[1]=i*u+o*l+n*s-a*c,e[2]=n*u+o*c+a*l-i*s,e[3]=o*u-a*s-i*l-n*c,e},quat.mul=quat.multiply,quat.scale=vec4.scale,quat.rotateX=function(e,t,r){r*=.5;var a=t[0],i=t[1],n=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=a*l+o*s,e[1]=i*l+n*s,e[2]=n*l-i*s,e[3]=o*l-a*s,e},quat.rotateY=function(e,t,r){r*=.5;var a=t[0],i=t[1],n=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=a*l-n*s,e[1]=i*l+o*s,e[2]=n*l+a*s,e[3]=o*l-i*s,e},quat.rotateZ=function(e,t,r){r*=.5;var a=t[0],i=t[1],n=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=a*l+i*s,e[1]=i*l-a*s,e[2]=n*l+o*s,e[3]=o*l-n*s,e},quat.calculateW=function(e,t){var r=t[0],a=t[1],i=t[2];return e[0]=r,e[1]=a,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-a*a-i*i)),e},quat.dot=vec4.dot,quat.lerp=vec4.lerp,quat.slerp=function(e,t,r,a){var i,n,o,s,l,c=t[0],u=t[1],_=t[2],h=t[3],f=r[0],d=r[1],p=r[2],m=r[3];return(n=c*f+u*d+_*p+h*m)<0&&(n=-n,f=-f,d=-d,p=-p,m=-m),1-n>1e-6?(i=Math.acos(n),o=Math.sin(i),s=Math.sin((1-a)*i)/o,l=Math.sin(a*i)/o):(s=1-a,l=a),e[0]=s*c+l*f,e[1]=s*u+l*d,e[2]=s*_+l*p,e[3]=s*h+l*m,e},quat.sqlerp=function(){var e=quat.create(),t=quat.create();return function(r,a,i,n,o,s){return quat.slerp(e,a,o,s),quat.slerp(t,i,n,s),quat.slerp(r,e,t,2*s*(1-s)),r}}(),quat.invert=function(e,t){var r=t[0],a=t[1],i=t[2],n=t[3],o=r*r+a*a+i*i+n*n,s=o?1/o:0;return e[0]=-r*s,e[1]=-a*s,e[2]=-i*s,e[3]=n*s,e},quat.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},quat.length=vec4.length,quat.len=quat.length,quat.squaredLength=vec4.squaredLength,quat.sqrLen=quat.squaredLength,quat.normalize=vec4.normalize,quat.fromMat3=function(e,t){var r,a=t[0]+t[4]+t[8];if(a>0)r=Math.sqrt(a+1),e[3]=.5*r,e[0]=(t[5]-t[7])*(r=.5/r),e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var n=(i+1)%3,o=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*n+n]-t[3*o+o]+1),e[i]=.5*r,e[3]=(t[3*n+o]-t[3*o+n])*(r=.5/r),e[n]=(t[3*n+i]+t[3*i+n])*r,e[o]=(t[3*o+i]+t[3*i+o])*r}return e},quat.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},quat.exactEquals=vec4.exactEquals,quat.equals=vec4.equals,function(){"use strict";window.SceneJS_Map=function(e,t){this.items=e||[];var r=(t||0)+1;this.addItem=function(){var e;if(2==arguments.length){var t=arguments[0];return e=arguments[1],this.items[t]&&SceneJS_error.fatalError(SceneJS.errors.ID_CLASH,"ID clash: '"+t+"'"),this.items[t]=e,t}for(;;){e=arguments[0];var a=r++;if(!this.items[a])return this.items[a]=e,a}},this.removeItem=function(e){delete this.items[e]}}}(),function(){"use strict";var e=window.SceneJS=new function(){this.VERSION="3.2",this.ENABLE_EXTENSIONS=["WEBGL_depth_texture","OES_texture_float","OES_texture_float_linear","OES_element_index_uint","OES_standard_derivatives","EXT_shader_texture_lod"],this._baseStateId=0,this._handleMap=new SceneJS_Map,this._topicSubs={},this._handleTopics={},this._topicPubs={},this._engines={},this._engineIds=new SceneJS_Map,this.timer=window.performance||window.Date,this.WEBGL_INFO=function(){var e={WEBGL:!1,SOFTWARE_RENDERER:!1},t=document.createElement("canvas");if(!t)return e;var r=t.getContext("webgl",{antialias:!0,failIfMajorPerformanceCaveat:!0})||t.getContext("experimental-webgl",{antialias:!0,failIfMajorPerformanceCaveat:!0});return r||(r=t.getContext("webgl",{antialias:!0})||t.getContext("experimental-webgl",{antialias:!0}))&&(e.SOFTWARE_RENDERER=!0),e.WEBGL=!!r,e.WEBGL?(e.ANTIALIAS=r.getContextAttributes().antialias,e.FS_MAX_FLOAT_PRECISION=r.getShaderPrecisionFormat?r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0?"highp":r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp":"mediump",e.DEPTH_BITS=r.getParameter(r.DEPTH_BITS),e.STENCIL_BITS=r.getParameter(r.STENCIL_BITS),e.MAX_TEXTURE_SIZE=r.getParameter(r.MAX_TEXTURE_SIZE),e.MAX_CUBE_MAP_SIZE=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),e.MAX_RENDERBUFFER_SIZE=r.getParameter(r.MAX_RENDERBUFFER_SIZE),e.MAX_TEXTURE_UNITS=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e.MAX_VERTEX_ATTRIBS=r.getParameter(r.MAX_VERTEX_ATTRIBS),e.MAX_VERTEX_UNIFORM_VECTORS=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),e.MAX_FRAGMENT_UNIFORM_VECTORS=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),e.MAX_VARYING_VECTORS=r.getParameter(r.MAX_VARYING_VECTORS),e.SAMPLE_BUFFERS=!!r.getParameter(r.SAMPLE_BUFFERS),e.SAMPLES=r.getParameter(r.SAMPLES),e.MAX_POINT_SIZE=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1],e.MAX_VIEWPORT_DIMS=r.getParameter(r.MAX_VIEWPORT_DIMS),e.SUPPORTED_EXTENSIONS={},r.getSupportedExtensions().forEach((function(t){e.SUPPORTED_EXTENSIONS[t]=!0})),e.depthTexturesSupported=e.SUPPORTED_EXTENSIONS.WEBGL_depth_texture||!1,e.floatTexturesSupported=e.SUPPORTED_EXTENSIONS.OES_texture_float||!1,e.linearFloatTexturesSupported=e.SUPPORTED_EXTENSIONS.OES_texture_float_linear||!1,e.drawBuffersSupported=e.SUPPORTED_EXTENSIONS.WEBGL_draw_buffers||!1,e.standardDerivativesSupported=e.SUPPORTED_EXTENSIONS.OES_standard_derivatives||!1,e.textureLODSupported=e.SUPPORTED_EXTENSIONS.EXT_shader_texture_lod||!1,e):e}(),this.DISPLAY_FLAGS={FOG_LINEAR:1,FOG_EXP:2,FOG_EXP2:3},this.TEXTURE_FLAGS={baseColor:1,specular:2,emit:4,alpha:8,normals:16,shine:32,metallic:64,roughness:128,occlusion:256,add:512,multiply:1024,over:2048,transparency:4096,conditionalAlpha:8192,swizzledNormals:16384},this.CUBEMAP_FLAGS={reflect:1,light:2},this.PROPERTY_FLAGS={PICKING:1,ENABLED:2,REFLECTIVE:4,SOLID:8,SKYBOX:16,XRAY:32,CCW:64,NO_DEPTH_MASK:128,PARTIALLY_OPAQUE:256,FORCE_TRANSPARENT:512,ROUND_POINTS:1024,PERSPECTIVE_POINTS:2048,BILLBOARD:4096,CLIPPING:8192,STOCHASTIC_ALPHA:16384},this.COLOR_MOD_FLAGS={SATURATION:1,BRIGHTNESS:2,CONTRAST:4,TINT:8},this.XFORM_FLAGS={MATRIX_DIRTY:1,COMPILING:2,DIRTY:4},this.TRANSPARENCY_FLAGS={ALPHA:1,IMPROVED_ALPHA:2,ADD_ALPHA:4,ALPHA_TO_COVERAGE:8,WEIGHTED_OIT:16},this.DEPTH_TEST_FLAGS={ENABLED:1,DISABLED:2,ALWAYS_PASS:4},this.TRANSPARENCY_FLAGS.TWO_PASS=this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA,this.TRANSPARENCY_FLAGS.ORDER_DEPENDENT=this.TRANSPARENCY_FLAGS.ALPHA|this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA,this.TRANSPARENCY_FLAGS.ALPHA_NO_DEPTH_MASK=this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA|this.TRANSPARENCY_FLAGS.ADD_ALPHA,this.TRANSPARENCY_FLAGS.ALPHA_BLEND=this.TRANSPARENCY_FLAGS.ALPHA|this.TRANSPARENCY_FLAGS.IMPROVED_ALPHA|this.TRANSPARENCY_FLAGS.ADD_ALPHA,this.KD_TREE_MAX_DEPTH=10,this.KD_TREE_MIN_TRIANGLES=20,this.setMaxPointSize=function(e){SceneJS_ProgramSourceFactory.setMaxPointSize(e)},this.publish=function(e,t,r){r||(this._topicPubs[e]=t);var a=this._topicSubs[e];if(a)for(var i in a)a.hasOwnProperty(i)&&a[i].call(this,t)},this.unpublish=function(e){var t=this._topicSubs[e];if(t)for(var r in t)t.hasOwnProperty(r)&&t[r].call(this,null);delete this._topicPubs[e]},this.on=function(e,t){var r=this._topicSubs[e];r||(this._topicSubs[e]=r={});var a=this._handleMap.addItem();r[a]=t,this._handleTopics[a]=e;var i=this._topicPubs[e];return i&&t.call(this,i),a},this.off=function(e){var t=this._handleTopics[e];if(t){delete this._handleTopics[e];var r=this._topicSubs[t];r&&delete r[e],this._handleMap.removeItem(e),"rendered"==t&&this._engine.branchDirty(this)}},this.once=function(e,t){var r=this,a=this.on(e,(function(e){r.off(a),t(e)}))},this.createScene=function(t,r){(t=t||{}).id?(this._engines[t.id]&&SceneJS_error.fatalError(e.errors.ILLEGAL_NODE_CONFIG,"Scene already exists with this ID: '"+t.id+"'"),this._engineIds.addItem(t.id,{})):t.id=this._engineIds.addItem({});var a=new SceneJS_Engine(t,r);return this._engines[t.id]=a,a.scene},this.scene=function(e){var t=this._engines[e];return t?t.scene:null},this.getScene=function(e){if(!e)for(var e in this._engines)if(this._engines.hasOwnProperty(e))return this._engines[e].scene;var t=this._engines[e];return t?t.scene:null},this.getScenes=function(){var e={};for(var t in this._engines)this._engines.hasOwnProperty(t)&&(e[t]=this._engines[t].scene);return e},this._isArray=function(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length},this._shallowClone=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},this._applyIf=function(e,t){for(var r in e)e.hasOwnProperty(r)&&(null!=t[r]&&null!=t[r]||(t[r]=e[r]));return t},this._apply=function(e,t,r){var a;if(r)for(a in t)t.hasOwnProperty(a)&&delete t[a];for(a in e)e.hasOwnProperty(a)&&null!=e[a]&&(t[a]=e[a]);return t};var t=Object.prototype.hasOwnProperty;this._isEmpty=function(e){if(null==e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;for(var r in e)if(t.call(e,r))return!1;return!0},this._isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},this._sliceArray=function(e,t,r){if(e.slice)return e.slice(t,r);for(var a=(r=r||e.length)-(t=t||0),i=new e.constructor(a),n=0;n<a;n++)i[n]=e[t+n];return i},this._loadBinary=function(e,t){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.open("GET",e),r.onload=function(){t(r.response)},r.send(null)};var r=["","MOZ_","WEBKIT_"];this.checkExtension=function(e){for(var t=0,a=r.length;t<a;t++)if(this.WEBGL_INFO.SUPPORTED_EXTENSIONS[r[t]+e])return!0;return!1},this._getExtension=function(e,t){for(var a=0,i=r.length;a<i;a++){var n=e.getExtension(r[a]+t);if(n)return n}return null},this.printGraph=function(e){!function e(t,r){var a,i="";for(a=0;a<r;a++)i+=" ";for(i+="-- ",console.log(i+t.type+" (id: "+t.id+", coreId: "+t.coreId+")"),a=0;a<t.nodes.length;a++)e(t.nodes[a],r+1)}(e,0)},this.reset=function(){var e=[];for(var t in this._engines)this._engines.hasOwnProperty(t)&&(e.push(this._engines[t]),delete this._engines[t],this._engineIds.removeItem(t));for(;e.length>0;)e.pop().destroy();SceneJS_events.fireEvent(SceneJS_events.RESET)}}}(),function(){"use strict";var e=window.SceneJS_events=new function(){this.ERROR=0,this.RESET=1,this.NODE_CREATED=2,this.SCENE_CREATED=3,this.SCENE_COMPILING=4,this.SCENE_DESTROYED=5,this.OBJECT_COMPILING=6,this.WEBGL_CONTEXT_LOST=7,this.WEBGL_CONTEXT_RESTORED=8,this.RENDER=9;var e=[];this.addListener=function(t,r,a){var i=e[t];i||(e[t]=i=[]);for(var n={command:r,priority:null==a?i.length:a},o=-1,s=0,l=i.length;s<l;s++)if(!i[s]){o=s;break}return o<0&&(i.push(n),o=i.length-1),t+"."+o},this.removeListener=function(t){var r=t.lastIndexOf("."),a=parseInt(t.substr(0,r)),i=parseInt(t.substr(r+1)),n=e[a];n&&delete n[i]},this.fireEvent=function(t,r){var a=e[t];if(a){r=r||{};for(var i=0;i<a.length;i++)a[i]&&a[i].command(r)}}};SceneJS.bind=function(t,r){switch(t){case"error":return e.addListener(e.ERROR,r);case"reset":return e.addListener(e.RESET,(function(){r()}));case"webglcontextlost":return e.addListener(e.WEBGL_CONTEXT_LOST,(function(e){r(e)}));case"webglcontextrestored":return e.addListener(e.WEBGL_CONTEXT_RESTORED,(function(e){r(e)}));default:SceneJS_error.fatalError("SceneJS.bind - this event type not supported: '"+t+"'")}},SceneJS.onEvent=SceneJS.bind,SceneJS.unEvent=function(t){return e.removeListener(t)},SceneJS.subscribe=SceneJS.addListener=SceneJS.onEvent=SceneJS.bind,SceneJS.unsubscribe=SceneJS.unEvent,SceneJS.on=SceneJS.onEvent,SceneJS.off=SceneJS.unEvent}(),function(){"use strict";var e=window.SceneJS_Canvas=function(e,t,r,a){if(!t){t="canvas-"+e;var i=document.getElementsByTagName("body")[0],n=document.createElement("div"),o=n.style;o.height="100%",o.width="100%",o.padding="0",o.margin="0",o.left="0",o.top="0",o.position="absolute",n.innerHTML+='<canvas id="'+t+'" style="width: 100%; height: 100%; margin: 0; padding: 0;"></canvas>',i.appendChild(n)}var s=document.getElementById(t);s||SceneJS_error.fatalError(SceneJS.errors.CANVAS_NOT_FOUND,"SceneJS.Scene attribute 'canvasId' does not match any elements in the page"),s.addEventListener("webglcontextcreationerror",(function(e){console.error("Unable to initialize WebGL:",e.statusMessage||"Unknown error")}),!1),this.canvasId=t,this.options=a||{},this.canvas=s,this.options.simulateWebGLContextLost&&(window.WebGLDebugUtils?this.canvas=WebGLDebugUtils.makeLostContextSimulatingCanvas(this.canvas):console.error("To simulate context loss, please include WebGLDebugUtils")),this.resolutionScaling=this.options.resolutionScaling||1,this.canvas.width=this.canvas.clientWidth*this.resolutionScaling,this.canvas.height=this.canvas.clientHeight*this.resolutionScaling,this.contextAttr=r||{},this.contextAttr.alpha=!0,this.gl=null,this.webgl2=!1,this.initWebGL()};e.prototype._WEBGL_CONTEXT_NAMES=["webgl","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"],e.prototype.initWebGL=function(){if(!0===this.options.webgl2){try{this.gl=this.canvas.getContext("webgl2",this.contextAttr)}catch(t){}this.gl?this.webgl2=!0:console.log("Failed to get a WebGL 2 context - defaulting to WebGL 1.")}if(!this.gl)for(var e=0;!this.gl&&e<this._WEBGL_CONTEXT_NAMES.length;e++)try{this.gl=this.canvas.getContext(this._WEBGL_CONTEXT_NAMES[e],this.contextAttr)}catch(t){}this.gl||SceneJS_error.fatalError(SceneJS.errors.WEBGL_NOT_SUPPORTED,"Failed to get a WebGL context")},e.prototype.loseWebGLContext=function(){this.options.simulateWebGLContextLost&&this.canvas.loseContext()},e.prototype.setResolutionScaling=function(e){this.resolutionScaling=e,this.canvas.width=this.canvas.clientWidth*e,this.canvas.height=this.canvas.clientHeight*e}}(),function(){"use strict";var e=window.SceneJS_Engine=function(e,t){t=t||{},e.type="scene",this.id=e.id,this._numPasses=e.numPasses||1,this._clearEachPass=!!e.clearEachPass,this.canvas=new SceneJS_Canvas(this.id,e.canvasId,e.contextAttr,t),this._coreFactory=new SceneJS_CoreFactory,this._nodeFactory=new SceneJS_NodeFactory,this.stats={build:{version:SceneJS.VERSION},client:{browser:navigator&&navigator.userAgent?navigator.userAgent:"n/a"},components:{},state:{programs:0},geometry:{meshes:0,vertices:0,triangles:0},textures:{},load:{sceneGraphCompilation:0,shaderCompilation:0,programCompilation:0},memory:{positions:0,colors:0,normals:0,uvs:0,indices:0,morphPositions:0,morphNormals:0,textures:0,tangents:0,pickPositions:0,pickColors:0},frame:{frameCount:0,useProgram:0,bindTexture:0,bindArray:0,drawElements:0,drawArrays:0,drawChunks:0}},this.display=new SceneJS_Display(this.stats,{canvas:this.canvas,transparent:e.transparent,autoTangents:t.autoTangents,gammaInputPhong:t.gammaInputPhong}),this.sceneDirty=!1,this._sceneBranchesDirty=!1,this._compilationPaused=!1,this._nodesToDestroy=[],this._numNodesToDestroy=0,this.destroyed=!1;for(var r=this.canvas.gl,a=SceneJS.ENABLE_EXTENSIONS,i=0,n=a.length;i<n;++i)r.getExtension(a[i]);this.cpuTimer=SceneJS.timer,this.sceneStatus={nodes:{},numTasks:0};var o=this,s=e.nodes;e.nodes=[],this.scene=this.createNode(e),s&&(e.nodes=s,this.scene.addNodes(s)),this.canvas.canvas.addEventListener("webglcontextlost",(function(e){e.preventDefault(),SceneJS_events.fireEvent(SceneJS_events.WEBGL_CONTEXT_LOST,{scene:o.scene})}),!1),this.canvas.canvas.addEventListener("webglcontextrestored",(function(e){o.canvas.initWebGL();for(var t=o.canvas.gl,r=SceneJS.ENABLE_EXTENSIONS,a=0,i=r.length;a<i;++a)t.getExtension(r[a]);o._coreFactory.webglRestored(),o.display.webglRestored(),SceneJS_events.fireEvent(SceneJS_events.WEBGL_CONTEXT_RESTORED,{scene:o.scene})}),!1)};e.prototype.setNumPasses=function(e){this._numPasses=e},e.prototype.setClearEachPass=function(e){this._clearEachPass=e},e.prototype.loseWebGLContext=function(){this.canvas.loseWebGLContext()},e.prototype.hasNodeType=function(e){return!!SceneJS_NodeFactory.nodeTypes[e]},e.prototype.createNode=function(e){this._doDestroyNodes(),e.type=e.type||"node";var t=this._coreFactory.getCore(e.type,e.coreId),r=this._nodeFactory.getNode(this,e,t),a=e.nodes;if(a){var i=SceneJS_NodeFactory.nodeTypes[r.type];if(!i||!i.prototype._fromPlugin)for(var n=0,o=a.length;n<o;n++){var s=this.createNode(a[n]);r.addNode(s)}}return r},e.prototype._doDestroyNodes=function(){for(var e;this._numNodesToDestroy>0;)--this._numNodesToDestroy,e=this._nodesToDestroy[this._numNodesToDestroy],this._nodesToDestroy[this._numNodesToDestroy]=null,e._doDestroy(),this._coreFactory.putCore(e._core),this._nodeFactory.putNode(e)},e.prototype.findNode=function(e){return this._nodeFactory.nodes.items[e]},e.prototype.findNodes=function(e){var t=new RegExp(e),r=[],a=this._nodeFactory.nodes.items;for(var i in a)a.hasOwnProperty(i)&&t.test(i)&&r.push(a[i]);return r},e.prototype.hasCore=function(e,t){return this._coreFactory.hasCore(e,t)},e.prototype.branchDirty=function(e){if(!this.sceneDirty&&e!=window){e.branchDirty=!0,e.dirty=!0;for(var t=e.parent;t&&!t.dirty&&!t.branchDirty;t=t.parent)t.dirty=!0;this._sceneBranchesDirty=!0}},e.prototype.render=function(e){var t=!1;if(this._willRender()||e&&e.force)for(var r=Date.now(),a=e&&e.force,i=e&&e.custom,n=0;n<this._numPasses;n++)this.scene.publish("rendering",{pass:n}),this.compile(),this.display.prepareScene(),this.display.render({pass:n,clear:this._clearEachPass||0==n,force:a,custom:i,opaqueOnly:e&&e.opaqueOnly}),this.scene.publish("rendered",{sceneId:this.id,time:r,pass:n}),t=!0;return t},e.prototype.pick=function(e){return this._willRender()&&this.compile(),this.display.pick({pickTriangle:!!e&&e.rayPick,pickRegion:!!e&&e.regionPick,canvasPos:e.canvasPos,origin:e.origin,direction:e.direction})},e.prototype.readPixels=function(e,t,r){return this._willRender()&&this.compile(),this.display.readPixels(e,t,r)},e.prototype._willRender=function(){return SceneJS_events.fireEvent(SceneJS_events.RENDER),this.display.imageDirty||this.display.objectListDirty||this._sceneBranchesDirty||this.sceneDirty},e.prototype.pauseCompilation=function(){this._compilationPaused=!0},e.prototype.resumeCompilation=function(){this._compilationPaused=!1},e.prototype.compile=function(){if(!this._compilationPaused){if(this._sceneBranchesDirty||this.sceneDirty){this._sceneBranchesDirty=!1,SceneJS_events.fireEvent(SceneJS_events.SCENE_COMPILING,{engine:this});var e=SceneJS.timer.now();this.scene._compileNodes(),this.stats.load.sceneGraphCompilation+=SceneJS.timer.now()-e,this.sceneDirty=!1}this._doDestroyNodes()}},e.prototype.destroyNode=function(e){this._nodesToDestroy[this._numNodesToDestroy++]=e;var t=this.sceneStatus.nodes[e.id];t&&(this.sceneStatus.numTasks-=t.numTasks,delete this.sceneStatus.nodes[e.id])},e.prototype.destroy=function(){this.destroyed=!0}}(),function(){"use strict";window.SceneJS_error=new function(){var e=void 0,t=void 0;this.setFatalErrorHandler=function(r){e=r,void 0!==t&&e(t)},this.fatalError=function(r,a){"string"==typeof r&&(a=r,r=SceneJS.errors.ERROR);var i={errorName:SceneJS.errors._getErrorName(r)||"ERROR",code:r,messageFromCaller:a,stackTrace:Human.utils.getStackTrace()};void 0!==e?e(i):t=i}},function(){SceneJS.errors={};var e=0;SceneJS.errors.ERROR=e++,SceneJS.errors.INVALID_FRAMEBUFFER=e++,SceneJS.errors.WEBGL_NOT_SUPPORTED=e++,SceneJS.errors.WEBGL_CONTEXT_LOST=e++,SceneJS.errors.NODE_CONFIG_EXPECTED=e++,SceneJS.errors.ILLEGAL_NODE_CONFIG=e++,SceneJS.errors.SHADER_COMPILATION_FAILURE=e++,SceneJS.errors.SHADER_LINK_FAILURE=e++,SceneJS.errors.CANVAS_NOT_FOUND=e++,SceneJS.errors.OUT_OF_VRAM=e++,SceneJS.errors.WEBGL_UNSUPPORTED_NODE_CONFIG=e++,SceneJS.errors.NODE_NOT_FOUND=e++,SceneJS.errors.NODE_ILLEGAL_STATE=e++,SceneJS.errors.ID_CLASH=e++}(),SceneJS.errors._getErrorName=function(e){for(var t in SceneJS.errors)if(SceneJS.errors.hasOwnProperty(t)&&SceneJS.errors[t]==e)return t;return null}}(),function(){"use strict";SceneJS.log=new function(){var e=null,t={},r=0,a="";SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(e){})),SceneJS_events.addListener(SceneJS_events.RESET,(function(){t={},e=null}),1e5),this._setIndent=function(e){r=e;for(var t=[],i=0;i<r;i++)t.push("----");a=t.join("")},this.error=function(e){this._log("error",e)},this.warn=function(e){this._log("warn",e)},this.info=function(e){this._log("info",e)},this.debug=function(e){this._log("debug",e)},this.setFuncs=function(r){if(r)for(var a in e=r,t)this._flush(a)},this._flush=function(r){var a=t[r];if(a){var i=e?e[r]:null;if(i){for(var n=0;n<a.length;n++)i(a[n]);t[r]=[]}}},this._log=function(e,t){if(SceneJS._isArray(t))for(var r=0;r<t.length;r++)this.__log(e,t[r]);else this.__log(e,t)},this.__log=function(t,r){r=a+r,e&&e[t]?e[t](r):console&&console[t]&&console[t](r)},this.getFuncs=function(){return e}}}(),function(){"use strict";mat4.create(),mat4.create(),vec2.create();var e=vec3.create(),t=vec3.create(),r=vec3.create(),a=vec3.create(),i=vec3.create(),n=vec3.create(),o=vec3.create();vec3.create(),vec4.create(),Math.log2?window.SceneJS_math_log2=Math.log2:window.SceneJS_math_log2=function(e){return Math.round(Math.log(e)*Math.LOG2E)},window.SceneJS_math_isPOT=function(e){return 0==(e&e-1)},window.SceneJS_math_cross3Vec4=function(e,t){var r=e[0],a=e[1],i=e[2],n=t[0],o=t[1],s=t[2];return[a*s-i*o,i*n-r*s,r*o-a*n,0]},window.SceneJS_math_setCellMat4=function(e,t,r,a){e[t+4*r]=a},window.SceneJS_math_LOOKAT_OBJ={eye:{x:0,y:0,z:10},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},window.SceneJS_math_LOOKAT_ARRAYS={eye:[0,0,10],look:[0,0,0],up:[0,1,0]},window.SceneJS_math_ORTHO_OBJ={left:-1,right:1,bottom:-1,near:.1,top:1,far:5e3},window.SceneJS_math_identityQuaternion=function(){return[0,0,0,1]},window.SceneJS_math_angleAxisQuaternion=function(e,t,r,a){var i=a/180*Math.PI/2,n=Math.sin(i);return[n*e,n*t,n*r,Math.cos(i)]},window.SceneJS_math_mulQuaternions=function(e,t){var r=e[0],a=e[1],i=e[2],n=e[3],o=t[0],s=t[1],l=t[2],c=t[3];return[n*o+r*c+a*l-i*s,n*s+a*c+i*o-r*l,n*l+i*c+r*s-a*o,n*c-r*o-a*s-i*l]},window.SceneJS_math_newMat4FromQuaternion=function(e){var t=e[0],r=e[1],a=e[2],i=e[3],n=2*t,o=2*r,s=2*a,l=n*i,c=o*i,u=s*i,_=n*t,h=o*t,f=s*t,d=o*r,p=s*r,m=s*a,g=mat4.create();return SceneJS_math_setCellMat4(g,0,0,1-(d+m)),SceneJS_math_setCellMat4(g,0,1,h-u),SceneJS_math_setCellMat4(g,0,2,f+c),SceneJS_math_setCellMat4(g,1,0,h+u),SceneJS_math_setCellMat4(g,1,1,1-(_+m)),SceneJS_math_setCellMat4(g,1,2,p-l),SceneJS_math_setCellMat4(g,2,0,f-c),SceneJS_math_setCellMat4(g,2,1,p+l),SceneJS_math_setCellMat4(g,2,2,1-(_+d)),g},window.SceneJS_math_normalizeQuaternion=function(e){var t=vec4.length([e[0],e[1],e[2],e[3]]);return[e[0]/t,e[1]/t,e[2]/t,e[3]/t]},window.SceneJS_math_angleAxisFromQuaternion=function(e){var t=(e=SceneJS_math_normalizeQuaternion(e))[3],r=2*Math.acos(t),a=Math.sqrt(1-t*t);return a<.001?{x:e[0],y:e[1],z:e[2],angle:57.295779579*r}:{x:e[0]/a,y:e[1]/a,z:e[2]/a,angle:57.295779579*r}},window.SceneJS_math_decompressPosition=function(e,t,r){e[0]=t[0]*r[0]+r[12],e[1]=t[1]*r[5]+r[13],e[2]=t[2]*r[10]+r[14]},window.SceneJS_math_decompressUV=function(e,t,r){e[0]=t[0]*r[0]+r[6],e[1]=t[1]*r[4]+r[7]},window.SceneJS_math_getPickPrimitives=function(e,t,r){var a,i,n=!!t;n?(i=t.length,a=r?new Uint16Array(3*i):new Float32Array(3*i)):(i=e.length/3,a=e);for(var o,s,l,c,u,_,h,f=new Uint8Array(4*i),d=0,p=0;p<i;p+=3)s=3*p,l=4*p,h=d>>24&255,_=d>>16&255,u=d>>8&255,c=255&d,n&&(a[s]=e[o=3*t[p]],a[s+1]=e[o+1],a[s+2]=e[o+2]),f[l]=c,f[l+1]=u,f[l+2]=_,f[l+3]=h,n&&(a[s+3]=e[o=3*t[p+1]],a[s+4]=e[o+1],a[s+5]=e[o+2]),f[l+4]=c,f[l+5]=u,f[l+6]=_,f[l+7]=h,n&&(a[s+6]=e[o=3*t[p+2]],a[s+7]=e[o+1],a[s+8]=e[o+2]),f[l+8]=c,f[l+9]=u,f[l+10]=_,f[l+11]=h,d++;return{positions:a,colors:f}},window.SceneJS_math_getPickPositions=function(e,t){for(var r,a,i=t.length,n=new Float32Array(3*i),o=0;o<i;o++)n[r=3*o]=e[a=3*t[o]],n[r+1]=e[a+1],n[r+2]=e[a+2];return n},window.SceneJS_math_getPickColors=function(e){for(var t,r,a,i,n,o=e.length,s=new Uint8Array(4*o),l=0,c=0;c<o;c+=3)n=l>>24&255,i=l>>16&255,a=l>>8&255,s[t=4*c]=r=255&l,s[t+1]=a,s[t+2]=i,s[t+3]=n,s[t+4]=r,s[t+5]=a,s[t+6]=i,s[t+7]=n,s[t+8]=r,s[t+9]=a,s[t+10]=i,s[t+11]=n,l++;return s},window.SceneJS_math_rayPlaneIntersect=function(i,n,o,s,l,c){c=c||vec3.create(),n=vec3.normalize(e,n);var u=vec3.subtract(t,s,o),_=vec3.subtract(r,l,o),h=vec3.cross(a,u,_);vec3.normalize(h,h);var f=-vec3.dot(o,h),d=-(vec3.dot(i,h)+f)/vec3.dot(n,h);return c[0]=i[0]+d*n[0],c[1]=i[1]+d*n[1],c[2]=i[2]+d*n[2],c},window.SceneJS_math_cartesianToBarycentric=function(a,i,n,o,s){var l=vec3.subtract(e,o,i),c=vec3.subtract(t,n,i),u=vec3.subtract(r,a,i),_=vec3.dot(l,l),h=vec3.dot(l,c),f=vec3.dot(l,u),d=vec3.dot(c,c),p=vec3.dot(c,u),m=_*d-h*h;if(0===m)return null;var g=1/m,y=(d*f-h*p)*g,v=(_*p-h*f)*g;return s[0]=1-y-v,s[1]=v,s[2]=y,s},window.SceneJS_math_barycentricToCartesian=function(e,t,r,a,i){var n=e[0],o=e[1],s=e[2];return i[0]=t[0]*n+r[0]*o+a[0]*s,i[1]=t[1]*n+r[1]*o+a[1]*s,i[2]=t[2]*n+r[2]*o+a[2]*s,i},window.SceneJS_math_barycentricToCartesian=function(e,t,r,a,i){i=i||vec3.create();var n=e[0],o=e[1],s=e[2];return i[0]=t[0]*n+r[0]*o+a[0]*s,i[1]=t[1]*n+r[1]*o+a[1]*s,i[2]=t[2]*n+r[2]*o+a[2]*s,i},window.SceneJS_math_buildTangents=function(s,l,c,u,_){for(var h=new Float32Array(s.length),f=vec3.create(),d=vec3.create(),p=vec3.create(),m=vec2.create(),g=vec2.create(),y=vec2.create(),v=l?l.length:s.length/3,S=0;S<v;S+=3){var b=l?l[S]:S;f.set(s.subarray(3*b,3*b+3)),m.set(c.subarray(2*b,2*b+2)),d.set(s.subarray(3*(b=l?l[S+1]:S+1),3*b+3)),g.set(c.subarray(2*b,2*b+2)),p.set(s.subarray(3*(b=l?l[S+2]:S+2),3*b+3)),y.set(c.subarray(2*b,2*b+2)),u&&(SceneJS_math_decompressPosition(f,f,u),SceneJS_math_decompressPosition(d,d,u),SceneJS_math_decompressPosition(p,p,u)),_&&(SceneJS_math_decompressUV(m,m,_),SceneJS_math_decompressUV(g,g,_),SceneJS_math_decompressUV(y,y,_));var E=vec3.subtract(e,d,f),I=vec3.subtract(t,p,f),x=vec2.subtract(r,g,m),C=vec2.subtract(a,y,m),T=x[0]*C[1]-x[1]*C[0];0===T&&(T=.001);for(var N=1/T,A=vec3.scale(n,vec3.subtract(o,vec3.scale(i,E,C[1]),vec3.scale(n,I,x[1])),N),D=0;D<3;D++){var M=l?3*l[S+D]:3*(S+D);h[M]+=A[0],h[M+1]+=A[1],h[M+2]+=A[2]}}return h},window.SceneJS_math_octDecodeVec2=function(e,t){var r=e[0],a=e[1];r=(2*r+1)/255,a=(2*a+1)/255;var i=1-Math.abs(r)-Math.abs(a);i<0&&(r=(1-Math.abs(a))*(r>=0?1:-1),a=(1-Math.abs(r))*(a>=0?1:-1));var n=Math.sqrt(r*r+a*a+i*i);return t[0]=r/n,t[1]=a/n,t[2]=i/n,t}}(),function(){"use strict";SceneJS._webgl={enumMap:{funcAdd:"FUNC_ADD",funcSubtract:"FUNC_SUBTRACT",funcReverseSubtract:"FUNC_REVERSE_SUBTRACT",zero:"ZERO",one:"ONE",srcColor:"SRC_COLOR",oneMinusSrcColor:"ONE_MINUS_SRC_COLOR",dstColor:"DST_COLOR",oneMinusDstColor:"ONE_MINUS_DST_COLOR",srcAlpha:"SRC_ALPHA",oneMinusSrcAlpha:"ONE_MINUS_SRC_ALPHA",dstAlpha:"DST_ALPHA",oneMinusDstAlpha:"ONE_MINUS_DST_ALPHA",contantColor:"CONSTANT_COLOR",oneMinusConstantColor:"ONE_MINUS_CONSTANT_COLOR",constantAlpha:"CONSTANT_ALPHA",oneMinusConstantAlpha:"ONE_MINUS_CONSTANT_ALPHA",srcAlphaSaturate:"SRC_ALPHA_SATURATE",front:"FRONT",back:"BACK",frontAndBack:"FRONT_AND_BACK",never:"NEVER",less:"LESS",equal:"EQUAL",lequal:"LEQUAL",greater:"GREATER",notequal:"NOTEQUAL",gequal:"GEQUAL",always:"ALWAYS",cw:"CW",ccw:"CCW",linear:"LINEAR",nearest:"NEAREST",linearMipMapNearest:"LINEAR_MIPMAP_NEAREST",nearestMipMapNearest:"NEAREST_MIPMAP_NEAREST",nearestMipMapLinear:"NEAREST_MIPMAP_LINEAR",linearMipMapLinear:"LINEAR_MIPMAP_LINEAR",repeat:"REPEAT",clampToEdge:"CLAMP_TO_EDGE",mirroredRepeat:"MIRRORED_REPEAT",alpha:"ALPHA",rgb:"RGB",rgba:"RGBA",luminance:"LUMINANCE",luminanceAlpha:"LUMINANCE_ALPHA",textureBinding2D:"TEXTURE_BINDING_2D",textureBindingCubeMap:"TEXTURE_BINDING_CUBE_MAP",compareRToTexture:"COMPARE_R_TO_TEXTURE",unsignedByte:"UNSIGNED_BYTE"}}}(),function(){"use strict";SceneJS._webgl.ArrayBuffer=function(e,t,r,a,i,n,o){switch(this.allocated=!1,r.constructor){case Uint8Array:this.itemType=e.UNSIGNED_BYTE,this.itemByteSize=1;break;case Int8Array:this.itemType=e.BYTE,this.itemByteSize=1;break;case Uint16Array:this.itemType=e.UNSIGNED_SHORT,this.itemByteSize=2;break;case Int16Array:this.itemType=e.SHORT,this.itemByteSize=2;break;case Uint32Array:this.itemType=e.UNSIGNED_INT,this.itemByteSize=4;break;case Int32Array:this.itemType=e.INT,this.itemByteSize=4;break;default:this.itemType=e.FLOAT,this.itemByteSize=4}this.gl=e,this.type=t,this.numItems=a,this.itemSize=i,this.usage=n,this.normalize=!!o,this._allocate(r,a)},SceneJS._webgl.ArrayBuffer.prototype._allocate=function(e,t){this.allocated=!1,this.handle=this.gl.createBuffer(),this.handle||SceneJS_error.fatalError(SceneJS.errors.OUT_OF_VRAM,"Failed to allocate WebGL ArrayBuffer"),this.handle&&(this.gl.bindBuffer(this.type,this.handle),this.gl.bufferData(this.type,e,this.usage),this.gl.bindBuffer(this.type,null),this.numItems=t,this.length=e.length,this.allocated=!0)},SceneJS._webgl.ArrayBuffer.prototype.setData=function(e){this.allocated&&(this.gl.bindBuffer(this.type,this.handle),e.length>this.length?(this.gl.bufferData(this.type,e,this.usage),this.length=e.length):this.gl.bufferSubData(this.type,0,e),this.gl.bindBuffer(this.type,null),this.numItems=e.length)},SceneJS._webgl.ArrayBuffer.prototype.unbind=function(){this.allocated&&this.gl.bindBuffer(this.type,null)},SceneJS._webgl.ArrayBuffer.prototype.destroy=function(){this.allocated&&(this.gl.deleteBuffer(this.handle),this.handle=null,this.allocated=!1)},SceneJS._webgl.ArrayBuffer.prototype.bind=function(){this.allocated&&this.gl.bindBuffer(this.type,this.handle)}}(),function(){"use strict";SceneJS._webgl.Attribute=function(e,t){this.gl=e,this.location=t},SceneJS._webgl.Attribute.prototype.bindArrayBuffer=function(e){e&&(e.bind(),this.gl.enableVertexAttribArray(this.location),this.gl.vertexAttribPointer(this.location,e.itemSize,e.itemType,e.normalize,0,0))}}(),function(){"use strict";SceneJS._webgl.Framebuffer=function(e){this.allocated=!1,this.canvas=e.canvas,this.gl=e.canvas.gl,this.canvasWidth=0,this.canvasHeight=0,this.sizeRatio=e.sizeRatio||1,"number"==typeof e.colorAttachments&&(e.colorAttachments=new Array(e.colorAttachments));var t=e.colorAttachments||new Array(1);this.numColorAttachments=t.length,this.colorAttachments=new Array(this.numColorAttachments);for(var r=0;r<this.numColorAttachments;++r){var a=t[r]||{};this.colorAttachments[r]={format:void 0!==a.format?this.gl[a.format]:this.gl.RGBA,type:void 0!==a.type?this.gl[a.type]:this.gl.UNSIGNED_BYTE,minFilter:void 0!==a.minFilter?this.gl[a.minFilter]:this.gl.LINEAR,magFilter:void 0!==a.magFilter?this.gl[a.magFilter]:this.gl.LINEAR,wrapS:void 0!==a.wrapS?this.gl[a.wrapS]:this.gl.CLAMP_TO_EDGE,wrapT:void 0!==a.wrapT?this.gl[a.wrapT]:this.gl.CLAMP_TO_EDGE}}this.sharedDepthBuffer=e.sharedDepthBuffer||null,this.hasDepthAttachment=!1!==e.depthAttachment,this.useDepthTextures=SceneJS.WEBGL_INFO.depthTexturesSupported,this.drawBuffers=this.gl.getExtension("WEBGL_draw_buffers"),window.localContentOnly&&(this.useDepthTextures=!1),this.buf=null,this.bound=!1},SceneJS._webgl.Framebuffer.prototype.webglRestored=function(e){this.gl=e,this.buf=null,this.allocated=!1,this.bound=!1},SceneJS._webgl.Framebuffer.prototype.bind=function(){this._touch(),this.bound||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buf.framebuf),this.gl.viewport(0,0,this.buf.width,this.buf.height),this.bound=!0)},SceneJS._webgl.Framebuffer.prototype._touch=function(){var e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;if(this.buf){if(this.canvasWidth==e&&this.canvasHeight==t)return;for(var r=0;r<this.numColorAttachments;++r)this.gl.deleteTexture(this.buf.colorTargets[r]);this.sharedDepthBuffer||(this.useDepthTextures?this.gl.deleteTexture(this.buf.depthTarget):this.gl.deleteRenderbuffer(this.buf.depthTarget)),this.gl.deleteFramebuffer(this.buf.framebuf)}this.canvasWidth=e,this.canvasHeight=t;var a=Math.floor(e*this.sizeRatio),i=Math.floor(t*this.sizeRatio);for(this.buf={framebuf:this.gl.createFramebuffer(),colorTargets:new Array(this.numColorAttachments),width:a,height:i},this.buf.depthTarget=this.sharedDepthBuffer?this.sharedDepthBuffer.getDepthTarget().texture():this.useDepthTextures?this.gl.createTexture():this.gl.createRenderbuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buf.framebuf),r=0;r<this.numColorAttachments;++r)this.buf.colorTargets[r]=this.gl.createTexture(),this._setTexture(this.buf.colorTargets[r],a,i,this.colorAttachments[r]),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0+r,this.gl.TEXTURE_2D,this.buf.colorTargets[r],0);if(this.drawBuffers){var n=new Array(this.numColorAttachments);for(r=0;r<this.numColorAttachments;++r)n[r]=this.gl.COLOR_ATTACHMENT0+r;this.drawBuffers.drawBuffersWEBGL(n)}this.hasDepthAttachment&&(this.useDepthTextures?(this.sharedDepthBuffer||this._setTexture(this.buf.depthTarget,a,i,{format:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.buf.depthTarget,0)):(this.sharedDepthBuffer||(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.buf.depthTarget),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,a,i)),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.buf.depthTarget),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null))),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buf.framebuf),this.gl.isFramebuffer(this.buf.framebuf)||SceneJS_error.fatalError(SceneJS.errors.INVALID_FRAMEBUFFER,"Invalid framebuffer");var o=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);switch(o){case this.gl.FRAMEBUFFER_COMPLETE:break;case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this.gl.FRAMEBUFFER_UNSUPPORTED:SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: "+o)}this.bound=!1},SceneJS._webgl.Framebuffer.prototype._setTexture=function(e,t,r,a){var i=void 0!==a.format?a.format:this.gl.RGBA,n=void 0!==a.type?a.type:this.gl.UNSIGNED_BYTE,o=void 0!==a.minFilter?a.minFilter:this.gl.LINEAR,s=void 0!==a.magFilter?a.magFilter:this.gl.LINEAR,l=void 0!==a.wrapS?a.wrapS:this.gl.CLAMP_TO_EDGE,c=void 0!==a.wrapT?a.wrapT:this.gl.CLAMP_TO_EDGE;this.gl.bindTexture(this.gl.TEXTURE_2D,e);try{this.gl.texImage2D(this.gl.TEXTURE_2D,0,i,t,r,0,i,n,null)}catch(_){var u=new WebGLUnsignedByteArray(t*r*3);this.gl.texImage2D(this.gl.TEXTURE_2D,0,i,t,r,0,i,n,u)}this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,o),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,s),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,l),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,c)},SceneJS._webgl.Framebuffer.prototype.clear=function(){if(!this.bound)throw"Render buffer not bound";this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.disable(this.gl.BLEND)},SceneJS._webgl.Framebuffer.prototype.read=function(e,t){var r=e,a=this.canvas.canvas.height-t,i=new Uint8Array(4);return this.gl.readPixels(r,a,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i),i},SceneJS._webgl.Framebuffer.prototype.unbind=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.bound=!1},SceneJS._webgl.Framebuffer.prototype.getColorTarget=function(e){var t=this;return e=e||0,{bind:function(r){return!(!t.buf||!t.buf.colorTargets[e]||(t.gl.activeTexture(t.gl.TEXTURE0+r),t.gl.bindTexture(t.gl.TEXTURE_2D,t.buf.colorTargets[e]),0))},unbind:function(r){t.buf&&t.buf.colorTargets[e]&&(t.gl.activeTexture(t.gl.TEXTURE0+r),t.gl.bindTexture(t.gl.TEXTURE_2D,null))},texture:function(){return t.buf.colorTargets[e]}}},SceneJS._webgl.Framebuffer.prototype.getDepthTarget=function(){var e=this;return this.sharedDepthBuffer?this.sharedDepthBuffer.getDepthTarget():{bind:function(t){return!(!e.buf||!e.buf.depthTarget||(e.gl.activeTexture(e.gl.TEXTURE0+t),e.gl.bindTexture(e.gl.TEXTURE_2D,e.buf.depthTarget),0))},unbind:function(t){e.buf&&e.buf.depthTarget&&(e.gl.activeTexture(e.gl.TEXTURE0+t),e.gl.bindTexture(e.gl.TEXTURE_2D,null))},texture:function(){return e.buf.depthTarget}}},SceneJS._webgl.Framebuffer.prototype.destroy=function(){if(this.buf){for(var e=0;e<this.numColorAttachments;++e)this.gl.deleteTexture(this.buf.colorTargets[e]);this.gl.deleteFramebuffer(this.buf.framebuf),this.sharedDepthBuffer||(this.useDepthTextures?this.gl.deleteTexture(this.buf.depthTarget):this.gl.deleteRenderbuffer(this.buf.depthTarget)),this.buf=null,this.bound=!1}}}(),function(){"use strict";SceneJS._webgl.Program=function(e,t,r,a,i){this.stats=e,this.hash=r,this.useCount=0,this.allocated=!1,this.gl=null,this._uniforms={},this._samplers={},this._attributes={},this.vertexSource=a,this.fragmentSource=i,this._vertexShader=null,this._fragmentShader=null,this.build(t)},SceneJS._webgl.Program.prototype.build=function(e){var t,r,a,i,n,o=SceneJS.timer.now(),s=this.stats;if(this.gl=e,this._vertexShader=new SceneJS._webgl.Shader(s,e,e.VERTEX_SHADER,this.vertexSource),this._fragmentShader=new SceneJS._webgl.Shader(s,e,e.FRAGMENT_SHADER,this.fragmentSource),this.handle=e.createProgram(),this.handle){e.attachShader(this.handle,this._vertexShader.handle),e.attachShader(this.handle,this._fragmentShader.handle),e.linkProgram(this.handle),e.getProgramParameter(this.handle,e.LINK_STATUS)||SceneJS.log.error("Shader program failed to link: "+e.getProgramInfoLog(this.handle));var l=e.getProgramParameter(this.handle,e.ACTIVE_UNIFORMS);for(r=0;r<l;++r)(a=e.getActiveUniform(this.handle,r))&&("\0"==(i=a.name)[i.length-1]&&(i=i.substr(0,i.length-1)),n=e.getUniformLocation(this.handle,i),a.type==e.SAMPLER_2D||a.type==e.SAMPLER_CUBE||35682==a.type?this._samplers[i]=n:this._uniforms[i]=new SceneJS._webgl.Uniform(e,a.type,a.size,n));var c=e.getProgramParameter(this.handle,e.ACTIVE_ATTRIBUTES);for(r=0;r<c;r++)(t=e.getActiveAttrib(this.handle,r))&&(n=e.getAttribLocation(this.handle,t.name),this._attributes[t.name]=new SceneJS._webgl.Attribute(e,n));s.load.programCompilation+=SceneJS.timer.now()-o,this.allocated=!0}},SceneJS._webgl.Program.prototype.bind=function(){this.allocated&&this.gl.useProgram(this.handle)},SceneJS._webgl.Program.prototype.getUniformLocation=function(e){if(this.allocated){var t=this._uniforms[e];return t?t.getLocation():void 0}},SceneJS._webgl.Program.prototype.getUniform=function(e){if(this.allocated)return this._uniforms[e]||void 0},SceneJS._webgl.Program.prototype.getAttribute=function(e){if(this.allocated)return this._attributes[e]||void 0},SceneJS._webgl.Program.prototype.bindArrayBuffer=function(e,t){if(this.allocated){var r=this._attributes[e];r&&r.bindArrayBuffer(t)}},SceneJS._webgl.Program.prototype.bindTexture=function(e,t,r){if(!this.allocated)return!1;var a=this._samplers[e];return!!a&&!!t.bind(r)&&(this.gl.uniform1i(a,r),!0)},SceneJS._webgl.Program.prototype.destroy=function(){this.allocated&&(this.gl.deleteProgram(this.handle),this.gl.deleteShader(this._vertexShader.handle),this.gl.deleteShader(this._fragmentShader.handle),this.handle=null,this._attributes=null,this._uniforms=null,this._samplers=null,this.allocated=!1)},SceneJS._webgl.Program.prototype.setUniform=function(e,t){if(this.allocated){var r=this._uniforms[e];r&&r.setValue(t)}}}(),function(){"use strict";SceneJS._webgl.Shader=function(e,t,r,a){this.allocated=!1;var i=SceneJS.timer.now();if(this.handle=t.createShader(r),this.handle||SceneJS_error.fatalError(SceneJS.errors.OUT_OF_VRAM,"Failed to create WebGL shader"),t.shaderSource(this.handle,a),t.compileShader(this.handle),this.valid=0!=t.getShaderParameter(this.handle,t.COMPILE_STATUS),!this.valid&&!t.isContextLost()){SceneJS.log.error("Shader program failed to compile: "+t.getShaderInfoLog(this.handle)),SceneJS.log.error("Shader source:");for(var n=a.split("\n"),o=0;o<n.length;o++)SceneJS.log.error(o+1+": "+n[o]);SceneJS_error.fatalError(SceneJS.errors.SHADER_COMPILATION_FAILURE,"Shader program failed to compile")}e.load.shaderCompilation+=SceneJS.timer.now()-i,this.allocated=!0}}(),function(){"use strict";SceneJS._webgl.Texture2D=function(e,t){try{this._init(e,t)}catch(r){SceneJS_error.fatalError(SceneJS.errors.OUT_OF_VRAM,"Failed to create texture: "+r.message||r)}},SceneJS._webgl.Texture2D.prototype._init=function(e,t){this.allocated=!1,this.gl=e,this.target=t.target||e.TEXTURE_2D,this.minFilter=t.minFilter,this.magFilter=t.magFilter,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.update=t.update,this.texture=t.texture,this.compressed=!!t.compressed,this.format=e.RGBA,this.isDepth=!1,this.depthMode=0,this.depthCompareMode=0,this.depthCompareFunc=0,e.bindTexture(this.target,this.texture),t.minFilter&&e.texParameteri(this.target,e.TEXTURE_MIN_FILTER,t.minFilter),t.magFilter&&e.texParameteri(this.target,e.TEXTURE_MAG_FILTER,t.magFilter),t.wrapS&&e.texParameteri(this.target,e.TEXTURE_WRAP_S,t.wrapS),t.wrapT&&e.texParameteri(this.target,e.TEXTURE_WRAP_T,t.wrapT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1!==t.flipY),this.compressed||this.minFilter!=e.NEAREST_MIPMAP_NEAREST&&this.minFilter!=e.LINEAR_MIPMAP_NEAREST&&this.minFilter!=e.NEAREST_MIPMAP_LINEAR&&this.minFilter!=e.LINEAR_MIPMAP_LINEAR||e.generateMipmap(this.target),e.bindTexture(this.target,null),this.allocated=!0},SceneJS._webgl.Texture2D.prototype.bind=function(e){if(this.allocated){var t=this.gl;return!!this.texture&&(t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,this.texture),this.update&&this.update(t),!0)}},SceneJS._webgl.Texture2D.prototype.unbind=function(e){if(this.allocated){var t=this.gl;this.texture&&(t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,null))}},SceneJS._webgl.Texture2D.prototype.destroy=function(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}}(),function(){"use strict";var e,t,r,a=(e={},(r=(t=document.createElement("canvas")).getContext("webgl")||t.getContext("experimental-webgl"))?(e[r.BOOL]=function(e){var t,r,a=!0;if(1===this.length)this.value[0]!==e&&(a=!1);else for(t=0,r=this.length;t<r;++t)if(this.value[t]!==e[t]){a=!1;break}if(!a){if(1===this.length)this.value[0]=e;else for(;t<r;)this.value[t]=e[t],++t;this.gl.uniform1fv(this.location,this.value)}},e[r.BOOL_VEC2]=function(e){var t,r,a=!0;for(t=0,r=this.length;t<r;++t)if(this.value[t]!==e[t]){a=!1;break}if(!a){for(;t<r;)this.value[t]=e[t],++t;this.gl.uniform2iv(this.location,e)}},e[r.BOOL_VEC3]=function(e){var t,r,a=!0;for(t=0,r=this.length;t<r;++t)if(this.value[t]!==e[t]){a=!1;break}if(!a){for(;t<r;)this.value[t]=e[t],++t;this.gl.uniform3iv(this.location,e)}},e[r.BOOL_VEC4]=function(e){var t,r,a=!0;for(t=0,r=this.length;t<r;++t)if(this.value[t]!==e[t]){a=!1;break}if(!a){for(;t<r;)this.value[t]=e[t],++t;this.gl.uniform4iv(this.location,e)}},e[r.INT_VEC2]=function(e){for(var t=!0,r=0,a=this.length;r<a;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniform2iv(this.location,e))},e[r.INT_VEC3]=function(e){for(var t=!0,r=0,a=this.length;r<a;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniform3iv(this.location,e))},e[r.INT_VEC4]=function(e){for(var t=!0,r=0,a=this.length;r<a;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniform4iv(this.location,e))},e[r.FLOAT]=function(e){var t=!0;if(1===this.length)this.value[0]!==e&&(t=!1);else for(var r=0,a=this.length;r<a;++r)if(this.value[r]!==e[r]){t=!1;break}t||(1===this.length?this.value[0]=e:this.value.set(e),this.gl.uniform1fv(this.location,this.value))},e[r.FLOAT_VEC2]=function(e){for(var t=!0,r=0,a=this.length;r<a;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniform2fv(this.location,e))},e[r.FLOAT_VEC3]=function(e){for(var t=!0,r=0,a=this.length;r<a;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniform3fv(this.location,e))},e[r.FLOAT_VEC4]=function(e){for(var t=!0,r=0,a=this.length;r<a;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniform4fv(this.location,e))},e[r.FLOAT_MAT2]=function(e){for(var t=!0,r=0,a=this.length;r<a;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniformMatrix2fv(this.location,!1,e))},e[r.FLOAT_MAT3]=function(e){for(var t=!0,r=0,a=this.length;r<a;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniformMatrix3fv(this.location,!1,e))},e[r.FLOAT_MAT4]=function(e){for(var t=!0,r=0,a=this.length;r<a;++r)if(this.value[r]!==e[r]){t=!1;break}t||(this.value.set(e),this.gl.uniformMatrix4fv(this.location,!1,e))},e):e);SceneJS._webgl.Uniform=function(e,t,r,i){this.gl=e,this.location=i,this.value=function(e,t,r){if(t===e.BOOL)return new Array(r);if(t===e.BOOL_VEC2)return new Array(2*r);if(t===e.BOOL_VEC3)return new Array(3*r);if(t===e.BOOL_VEC4)return new Array(4*r);if(t===e.INT)return new Uint32Array(r);if(t===e.INT_VEC2)return new Uint32Array(2*r);if(t===e.INT_VEC3)return new Uint32Array(3*r);if(t===e.INT_VEC4)return new Uint32Array(4*r);if(t===e.FLOAT)return new Float32Array(r);if(t===e.FLOAT_VEC2)return new Float32Array(2*r);if(t===e.FLOAT_VEC3)return new Float32Array(3*r);if(t===e.FLOAT_VEC4)return new Float32Array(4*r);if(t===e.FLOAT_MAT2)return new Float32Array(4*r);if(t===e.FLOAT_MAT3)return new Float32Array(9*r);if(t===e.FLOAT_MAT4)return new Float32Array(16*r);throw"Unsupported shader uniform type: "+t}(e,t,r),this.length=this.value.length,this.setValue=a[t]},SceneJS._webgl.Uniform.prototype.getLocation=function(){return this.location}}(),function(){"use strict";window.SceneJS_Core=function(e){this.type=e,this.coreId=null,this.stateId=null,this.useCount=0}}(),ColorFresnel.prototype.isEqual=function(e,t){var r=e.center.reduce((function(e,r,a){return e&&r===t.center[a]}),!0),a=e.edge.reduce((function(e,r,a){return e&&r===t.edge[a]}),!0);return r&&a&&e.edgeBias===t.edgeBias&&e.centerBias===t.centerBias&&e.power===t.power},ScalarFresnel.prototype.isEqual=function(e,t){return e.center===t.center&&e.edge==t.edge&&e.edgeBias===t.edgeBias&&e.centerBias===t.centerBias&&e.power===t.power},function(){"use strict";var e=SceneJS.KD_TREE_MAX_DEPTH,t=SceneJS.KD_TREE_MIN_TRIANGLES,r=window.SceneJS_GeometryCore=function(){this.type="xform",this.coreId=null,this.stateId=null,this.kdTree=null,this.kdTreeDirty=!0};function a(e){var t,r,a,i=e._engine.canvas.gl;e.arrays.positions?(r=(t=SceneJS_math_getPickPrimitives(e.arrays.positions,e.arrays.indices,e.compressedPositions)).positions,a=t.colors,e.pickPositionsBuf=new SceneJS._webgl.ArrayBuffer(i,i.ARRAY_BUFFER,r,r.length,3,i.STATIC_DRAW),e._engine.stats.memory.pickPositions+=r.length*r.constructor.BYTES_PER_ELEMENT,e._engine.stats.memory.pickColors+=a.length*a.constructor.BYTES_PER_ELEMENT):(a=SceneJS_math_getPickColors(e.arrays.indices),e._engine.stats.memory.pickColors+=a.length*a.constructor.BYTES_PER_ELEMENT),e.pickColorsBuf=new SceneJS._webgl.ArrayBuffer(i,i.ARRAY_BUFFER,a,a.length,4,i.STATIC_DRAW,!0)}r.prototype.getTangents=function(e){if(this.tangentBufs||(this.tangentBufs=[]),this.tangentBufs[e])return this.tangentBufs[e];var t=this.arrays,r=this.arrays.tangents[e],a=this._engine.canvas.gl;return r||t.positions&&t.uvs&&t.uvs[e]&&(r=SceneJS_math_buildTangents(t.positions,t.indices,t.uvs[e],this.positionDecodeMat,this.compressedUVs&&this.uvDecodeMats[e]),this._engine.stats.memory.tangents+=r.length*r.constructor.BYTES_PER_ELEMENT),r?(this.tangentBufs[e]=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,r,r.length,3,a.STATIC_DRAW),this.arrays.tangents[e]=!0,this.tangentBufs[e]):null},r.prototype.getPickPositions=function(){return this.pickPositionsBuf||a(this),this.pickPositionsBuf},r.prototype.getPickColors=function(){return this.pickColorsBuf||a(this),this.pickColorsBuf},r.prototype.getKdTree=function(){return this.kdTree||this.buildKdTree(),this.kdTree},r.prototype.buildKdTree=function(){if(this.kdTreeDirty){var r=this.arrays.positions,a=this.arrays.indices;if(r){var n;n=a?a.length/3:r.length/9;for(var o=new Array(n),s=0;s<n;++s)o[s]=s;this.kdTree=function r(a,n,o,s,l,c){var u,_,h=vec3.create(),f=vec3.create(),d={triangles:null,left:null,right:null,bb:{min:h,max:f}};for(h[0]=h[1]=h[2]=Number.POSITIVE_INFINITY,f[0]=f[1]=f[2]=Number.NEGATIVE_INFINITY,u=0,_=a.length;u<_;++u)for(var p=3*a[u],m=0;m<3;++m){var g;i[0]=o[g=n?3*n[p+m]:3*(p+m)],i[1]=o[g+1],i[2]=o[g+2],s&&SceneJS_math_decompressPosition(i,i,s),i[0]<h[0]&&(h[0]=i[0]),i[0]>f[0]&&(f[0]=i[0]),i[1]<h[1]&&(h[1]=i[1]),i[1]>f[1]&&(f[1]=i[1]),i[2]<h[2]&&(h[2]=i[2]),i[2]>f[2]&&(f[2]=i[2])}if(c>e)return d.triangles=a,d;var y=(h[l]+f[l])/2,v=new Array(a.length),S=0,b=new Array(a.length),E=0;for(u=0,_=a.length;u<_;++u){var I,x,C;p=3*a[u],n?(I=n[p],x=n[p+1],C=n[p+2]):(I=p,x=p+1,C=p+2);var T=o[3*I+l],N=o[3*x+l],A=o[3*C+l];if(s){var D=s[5*l],M=s[l+12];T=T*D+M,N=N*D+M,A=A*D+M}T<=y||N<=y||A<=y?v[S++]=a[u]:b[E++]=a[u]}return S<t||E<t?(d.triangles=a,d):(v.length=S,b.length=E,d.left=r(v,n,o,s,(l+1)%3,c+1),d.right=r(b,n,o,s,(l+1)%3,c+1),d)}(o,a,r,this.positionDecodeMat,0,0),this.kdTreeDirty=!1}}};var i=vec3.create()}(),function(){"use strict";var e=SceneJS.PROPERTY_FLAGS,t=SceneJS.DEPTH_TEST_FLAGS,r=window.SceneJS_PropertiesCore=function(){this.type="properties",this.coreId=null,this.stateId=null,this.useCount=0,this.xrayParams=new Float32Array([.4,.8]),this.solidColor=new Float32Array([1,1,1]),this.colorModifiers=[],this.colorModRange=!1,this.opacityModifiers=[],this.opacityModRange=!1,this.name=null,this.flags=e.PICKING|e.ENABLED|e.REFLECTIVE|e.CCW|e.CLIPPING,this.transparent=!1,this.partiallyOpaque=!1,this.stochasticAlpha=!1,this.blend=!1,this.fragmentShaderHeader=null,this.fragmentShaderFooter=null,this.depthTest=t.ENABLED,this.hash="refl;;;;;;;"};r.prototype.getFlag=function(e){return!!(this.flags&e)},r.prototype.setFlag=function(e,t){this.flags=t?this.flags|e:this.flags&~e},r.prototype.resetTransparency=function(){var t=this.opacityModifiers,r=!1,a=!1,i=0;for(i=0;i<t.length;i++)if(t[i].value<1){r=!0;break}for(i=0;i<t.length;i++)if(t[i].range){a=!0;break}this.stochasticAlpha=this.getFlag(e.STOCHASTIC_ALPHA),this.transparent=this.getFlag(e.FORCE_TRANSPARENT)||!this.stochasticAlpha&&(r||this.getFlag(e.XRAY)),this.partiallyOpaque=this.getFlag(e.PARTIALLY_OPAQUE)||r&&a&&!this.getFlag(e.XRAY)}}(),function(){"use strict";var e=window.SceneJS_CoreFactory=function(){this._stateMap=new SceneJS_Map(null,SceneJS._baseStateId),this._cores={}};e.coreConstructors={geometry:SceneJS_GeometryCore,properties:SceneJS_PropertiesCore,default:SceneJS_Core},e.prototype.getCore=function(t,r){var a,i=this._cores[t];return i||(i=this._cores[t]={}),r&&(a=i[r])?(a.useCount++,a):((a=new(e.coreConstructors[t]||e.coreConstructors.default)(t)).useCount=1,a.stateId=this._stateMap.addItem(a),a.coreId=null!=r&&null!=r?r:a.stateId,i[a.coreId]=a,a)},e.prototype.hasCore=function(e,t){var r=this._cores[e];return r&&r[t]},e.prototype.putCore=function(e){0!=e.useCount&&--e.useCount<=0&&(delete this._cores[e.type][e.coreId],this._stateMap.removeItem(e.stateId))},e.prototype.webglRestored=function(){var e,t;for(var r in this._cores)if(this._cores.hasOwnProperty(r)&&(e=this._cores[r]))for(var a in e)e.hasOwnProperty(a)&&(t=e[a])&&t.webglRestored&&t.webglRestored()}}(),function(){"use strict";SceneJS.Node=function(){},SceneJS.Node.prototype.constructor=SceneJS.Node,SceneJS.Node.prototype._construct=function(e,t,r,a){this._engine=e,this._core=t,this.coreId=t.coreId,this.id=r.id||r.nodeId||a,this.type=r.type||"node",this.data=r.data,this.parent=null,this.nodes=[],this.dirty=!1,this.disabled=!1,this.branchDirty=!1,this._init&&this._init(r)},SceneJS.Node.prototype.disable=function(){this.disabled||(this.disabled=!0,this._engine.branchDirty(this))},SceneJS.Node.prototype.enable=function(){this.disabled&&(this.disabled=!1,this._engine.branchDirty(this))},SceneJS.Node.prototype.log=function(){var e,t;switch(1==arguments.length?(e="info",t=arguments[0]):2==arguments.length&&(e=arguments[0],t=arguments[1]),e){case"warn":t="WARN;  [SceneJS.Node type="+this.type+", id="+this.id+"] : "+t;break;case"error":t="ERROR; [SceneJS.Node type="+this.type+", id="+this.id+"] : "+t;break;default:t="INFO;  [SceneJS.Node type="+this.type+", id="+this.id+"] : "+t}console[e]?console[e](t):console.log(t)},SceneJS.Node.prototype.getScene=function(){return this._engine.scene},SceneJS.Node.prototype.getCoreId=function(){return this._core.coreId},SceneJS.Node.prototype.getID=function(){return this.id},SceneJS.Node.prototype.getId=function(){return this.id},SceneJS.Node.prototype.getNodeId=function(){return this.id},SceneJS.Node.prototype.getType=function(){return this.type},SceneJS.Node.prototype.getData=function(){return this.data},SceneJS.Node.prototype.setData=function(e){return this.data=e,this},SceneJS.Node.prototype.getNumNodes=function(){return this.nodes.length},SceneJS.Node.prototype.getNodes=function(){return this.nodes.slice(0)},SceneJS.Node.prototype.getNodeAt=function(e){return e<0||e>=this.nodes.length?null:this.nodes[e]},SceneJS.Node.prototype.getFirstNode=function(){return 0==this.nodes.length?null:this.nodes[0]},SceneJS.Node.prototype.getLastNode=function(){return 0==this.nodes.length?null:this.nodes[this.nodes.length-1]},SceneJS.Node.prototype.getNode=function(e){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t].id==e)return this.nodes[t];return null},SceneJS.Node.prototype.disconnectNodeAt=function(e){var t=this.nodes.splice(e,1);return t.length>0?(t[0]._disconnectFromScene(),t[0].parent=null,this._engine.branchDirty(this),t[0]):null},SceneJS.Node.prototype.disconnect=function(){if(this.parent){for(var e=0;e<this.parent.nodes.length;e++)if(this.parent.nodes[e]===this){var t=this.parent.disconnectNodeAt(e);return this._disconnectFromScene(),this.parent=null,t}this._disconnectFromScene(),this.parent=null}return null},SceneJS.Node.prototype._connectToScene=function(){for(var e=0,t=this.nodes.length;e<t;e++)this.nodes[e]._connectToScene()},SceneJS.Node.prototype._disconnectFromScene=function(){for(var e=0,t=this.nodes.length;e<t;e++)this.nodes[e]._disconnectFromScene()},SceneJS.Node.prototype.removeNodeAt=function(e){var t=this.disconnectNodeAt(e);t&&t.destroy()},SceneJS.Node.prototype.removeNode=function(e){if(e||SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#removeNode - node argument undefined"),!e._compile&&"string"==typeof e){var t=this._engine.findNode(e);t||SceneJS_error.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - node not found anywhere: '"+e+"'"),e=t}if(e._compile)for(var r=0;r<this.nodes.length;r++)if(this.nodes[r]===e)return this.removeNodeAt(r);SceneJS_error.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - child node not found: "+(e._compile?": "+e.id:e))},SceneJS.Node.prototype.disconnectNodes=function(){for(var e=this.nodes.length,t=0;t<e;t++)this.nodes[t]._disconnectFromScene(),this.nodes[t].parent=null;var r=this.nodes;return this.nodes=[],this._engine.branchDirty(this),r},SceneJS.Node.prototype.removeNodes=function(){for(var e=this.disconnectNodes(),t=0;t<e.length;t++)e[t].destroy()},SceneJS.Node.prototype.splice=function(){var e,t;if(null==this.parent)return null;var r=this.parent,a=this.disconnectNodes();for(e=0,t=a.length;e<t;e++)a[e].parent=this.parent,a[e]._connectToScene();for(e=0,t=r.nodes.length;e<t;e++)if(r.nodes[e]===this)return r.nodes.splice.apply(r.nodes,[e,1].concat(a)),this.nodes=[],this._disconnectFromScene(),this.parent=null,this.destroy(),this._engine.branchDirty(r),r},SceneJS.Node.prototype.addNodes=function(e){if(!e)return null;for(var t=e.length-1;t>=0;t--)this.addNode(e[t])},SceneJS.Node.prototype.addNode=function(e,t){if((e=e||{})._compile)return null!=e.parent&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is still attached to another parent"),this.nodes.push(e),e.parent=this,e._connectToScene(),this._engine.branchDirty(e),t&&t(e),e;if("string"==typeof e){var r=this._engine.findNode(e);return r||SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node not found: '"+e+"'"),null!=(e=r).parent&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is still attached to another parent"),this.nodes.push(e),e.parent=this,e._connectToScene(),this._engine.branchDirty(e),t&&t(e),e}if(e.type=e.type||"node","node"==e.type||this._engine.hasNodeType(e.type))return e=this._engine.createNode(e),this.nodes.push(e),e.parent=this,e._connectToScene(),this._engine.branchDirty(e),t&&t(e),e;var a=this;return this._engine.createNode(e,(function(e){a.nodes.push(e),e.parent=a,e._connectToScene(),a._engine.branchDirty(e),t&&t(e)})),null},SceneJS.Node.prototype.insertNode=function(e,t){return e||SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is undefined"),e._compile||(e=this._engine.createNode(e)),e._compile||SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is not a SceneJS.Node"),null!=e.parent&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is still attached to another parent"),null==t?(e.addNodes(this.disconnectNodes()),this.addNode(e)):t<0?SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node index out of range: -1"):t>=this.nodes.length?this.nodes.push(e):this.nodes.splice(t,0,e),e.parent=this,e._connectToScene(),e},SceneJS.Node.prototype.mapNodes=function(e){if(e(this))return this;for(var t,r=0;r<this.nodes.length;r++)if(t=this.nodes[r].mapNodes(e))return t;return null},SceneJS.Node.prototype.getParent=function(e){return this.parent},SceneJS.Node.prototype.getParentOfType=function(e){for(var t=this.parent;t&&t.type!=e;)t=t.parent;return t},SceneJS.Node.prototype.eachParent=function(e){if(!e)throw"SceneJS.Node.eachParent param 'fn' is null or undefined";for(var t=0,r=this;r.parent;){if(!0===e.call(r.parent,t++))return r.parent;r=r.parent}return null},SceneJS.Node.prototype.hasNode=function(e){if(null==e)throw"SceneJS.Node.hasNode param 'node' is null or undefined";var t,r=typeof e;if("number"==r)t=this.getNodeAt(e);else{if("string"!=r)throw"SceneJS.Node.hasNode param 'node' should be either an index number or an ID string";t=this.getNode(e)}return null!=t&&null!=t},SceneJS.Node.prototype.node=function(e){if(null==e)throw"SceneJS.Node.node param 'node' is null or undefined";var t,r=typeof e;if("number"==r)t=this.getNodeAt(e);else{if("string"!=r)throw"SceneJS.Node.node param 'node' should be either an index number or an ID string";t=this.getNode(e)}if(!t)throw"SceneJS.Node.node - node not found: '"+e+"'";return t},SceneJS.Node.prototype.eachNode=function(e,t){if(!e)throw"SceneJS.Node.eachNode param 'fn' is null or undefined";if("function"!=typeof e)throw"SceneJS.Node.eachNode param 'fn' should be a function";var r,a=0;return(t=t||{}).andSelf&&!0===e.call(this,a++)?this:(t.depthFirst||t.breadthFirst?t.depthFirst&&(r=this._iterateEachNodeDepthFirst(e,this,a,!1)):r=this._iterateEachNode(e,this,a),r||void 0)},SceneJS.Node.prototype.numNodes=function(){return this.nodes.length},SceneJS.Node.prototype._iterateEachNode=function(e,t,r){for(var a,i=t.nodes.length,n=0;n<i;n++)if(!0===e.call(a=t.nodes[n],r++))return a;return null},SceneJS.Node.prototype._iterateEachNodeDepthFirst=function(e,t,r,a){if(a&&!0===e.call(t,r++))return t;a=!0;for(var i,n=t.nodes.length,o=0;o<n;o++)if(i=this._iterateEachNodeDepthFirst(e,t.nodes[o],r,a))return i;return null},SceneJS.Node.prototype.findNodesByType=function(e,t){return this._findNodesByType(e,[],t)},SceneJS.Node.prototype._findNodesByType=function(e,t,r){var a;for(a=0;a<this.nodes.length;a++){var i=this.nodes[a];i.type==e&&t.push(i)}if(r)for(a=0;a<this.nodes.length;a++)this.nodes[a]._findNodesByType(e,t,r);return t},SceneJS.Node.prototype.findParentByType=function(e){for(var t=this.parent;t&&t.type!=e;)t=t.parent;return t},SceneJS.Node.prototype.getJSON=function(){return this},SceneJS.Node.prototype._compile=function(e){this.preCompile&&this.preCompile(),this._compileNodes(e),this.postCompile&&this.postCompile()},SceneJS.Node.prototype._compileNodes=function(e){for(var t,r=0,a=this.nodes.length;r<a;r++)(t=this.nodes[r]).branchDirty=t.branchDirty||this.branchDirty,(t.dirty||t.branchDirty||this._engine.sceneDirty)&&(t.disabled?t._compileNodes(e):t._compile(e),t.dirty=!1,t.branchDirty=!1)},SceneJS.Node.prototype.destroy=function(){if(!this.destroyed){if(this.parent)for(var e=this.parent.nodes,t=e.length,r=0;r<t;r++)if(e[r].id===this.id){e.splice(r,1);break}this._engine.scene.unpublish("nodes/"+this.id),this._destroyTree(),this._engine.display.objectListDirty=!0}return this},SceneJS.Node.prototype._destroyTree=function(){var e;this.destroyed=!0,this._engine.destroyNode(this);for(var t=0,r=this.nodes.length;t<r;t++)this._engine.scene.unpublish("nodes/"+(e=this.nodes[t]).id),e._destroyTree()},SceneJS.Node.prototype._doDestroy=function(){return this._destroy&&this._destroy(),this}}(),function(){"use strict";var e=window.SceneJS_NodeFactory=function(){this.nodes=new SceneJS_Map({})};e.nodeTypes={},e.createNodeType=function(t){if(e.nodeTypes[t])throw"Node type already defined: "+t;var r=function(){SceneJS.Node.apply(this,arguments),this.type=t};return(r.prototype=new SceneJS.Node).constructor=r,e.nodeTypes[t]=r,r},e.prototype.getNode=function(t,r,a){var i;r.type=r.type||"node","node"===r.type?i=SceneJS.Node:(i=e.nodeTypes[r.type])||(console.error("Unknown node type: "+r.type+" - can't create - making a SceneJS.Node by default"),i=SceneJS.Node);var n=new i,o=r.id||r.nodeId;return o?this.nodes.addItem(o,n):o=this.nodes.addItem(n),n._construct(t,a,r,o),n},e.prototype.putNode=function(e){this.nodes.removeItem(e.id)}}(),function(){"use strict";var e=SceneJS.PROPERTY_FLAGS,t=SceneJS.COLOR_MOD_FLAGS,r=SceneJS.DEPTH_TEST_FLAGS,a={saturation:t.SATURATION,brightness:t.BRIGHTNESS,contrast:t.CONTRAST,tintColor:t.TINT},i={enabled:r.ENABLED,disabled:r.DISABLED,alwaysPass:r.ALWAYS_PASS},n={};for(var o in i)n[i[o]]=o;var s=new SceneJS_PropertiesCore;s.stateId=SceneJS._baseStateId++;var l=[],c=0;function u(r){return(r.getFlag(e.REFLECTIVE)?"refl":"")+";"+(r.getFlag(e.SKYBOX)?"sky":"")+";"+(r.getFlag(e.SOLID)?"s":"")+";"+(r.getFlag(e.ROUND_POINTS)?"rpt":"")+";"+(r.getFlag(e.PERSPECTIVE_POINTS)?"ppt":"")+";"+(r.getFlag(e.BILLBOARD)?"b":"")+";"+(r.getFlag(e.STOCHASTIC_ALPHA)?"sa":"")+";"+function(e){var r="",a=0,i=e.colorModifiers.length;for(a=0;a<i;a++){var n=e.colorModifiers[a],o=n.applyTo,s=n.value;o===t.BRIGHTNESS?r+="b":o===t.CONTRAST?r+="c":o===t.SATURATION?r+="s":o===t.TINT&&(r+="t"),n.range&&(r+="r"),r+=s.isScalarFresnel?"sf":s.isColorFresnel?"cf":"nv"}return r}(r)+";"+function(e){var t="",r=0,a=e.opacityModifiers.length;for(r=0;r<a;r++){var i=e.opacityModifiers[r];t+=i.range?"r":"o",t+=i.value.isScalarFresnel?"sf":"nv"}return t}(r)+";"+(r.fragmentShaderHeader||"")+";"+(r.fragmentShaderFooter||"")+";"}SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(e){e.engine.display.properties=s,c=0})),SceneJS.Properties=SceneJS_NodeFactory.createNodeType("properties"),SceneJS.Properties.prototype._init=function(e){1==this._core.useCount&&e.properties&&this.setProperties(e.properties)},SceneJS.Properties.prototype.setProperties=function(r){var n=this._core;if(null!=r.picking&&(n.setFlag(e.PICKING,r.picking),this._engine.display.imageDirty=!0),null!=r.solidColor){var o=s.solidColor,l=r.solidColor;n.solidColor[0]=null!=l.r?l.r:o[0],n.solidColor[1]=null!=l.g?l.g:o[1],n.solidColor[2]=null!=l.b?l.b:o[2],this._engine.display.imageDirty=!0}if(null!=r.clipping&&(n.setFlag(e.CLIPPING,r.clipping),this._engine.branchDirty(this)),null!=r.enabled&&(n.setFlag(e.ENABLED,r.enabled),this._engine.display.objectListDirty=!0),null!=r.frontface&&(n.setFlag(e.CCW,"ccw"===r.frontface),this._engine.display.imageDirty=!0),null!=r.reflective&&(n.setFlag(e.REFLECTIVE,r.reflective),this._engine.branchDirty(this)),null!=r.solid&&(n.setFlag(e.SOLID,r.solid),this._engine.branchDirty(this)),null!=r.skybox&&(n.setFlag(e.SKYBOX,r.skybox),this._engine.branchDirty(this)),null!=r.billboard&&(n.setFlag(e.BILLBOARD,r.billboard),this._engine.branchDirty(this)),r.colorModifiers){var c;n.colorModifiers.length=r.colorModifiers.length,n.colorModRange=!1;for(var _=0,h=r.colorModifiers.length;_<h;_++){var f=r.colorModifiers[_];c=a[f.applyTo]||f.applyTo,(p=f.value).isScalarFresnel||p.isColorFresnel||c!==t.CONTRAST||f.normalized||(p=f.value+1),n.colorModifiers[_]={applyTo:c,value:p,range:null},c===t.CONTRAST&&(n.colorModifiers[_].normalized=!0),f.range&&(n.colorModRange=!0,n.colorModifiers[_].range={center:new Float32Array(f.range.center),radius:new Float32Array([f.range.minRadius,f.range.maxRadius-f.range.minRadius])})}}if(null!=r.name&&(n.name=r.name),null!=r.xray){var d=n.transparent;n.setFlag(e.XRAY,r.xray),n.resetTransparency(),n.transparent!==d&&(this._engine.display.objectListDirty=!0),this._engine.display.imageDirty=!0}if(null!=r.glassFactor&&(n.xrayParams[0]=r.glassFactor,this._engine.display.imageDirty=!0),null!=r.murkiness&&(n.xrayParams[1]=r.murkiness,this._engine.display.imageDirty=!0),r.opacityModifiers){d=n.transparent;var p,m,g=r.opacityModifiers.length;n.opacityModifiers.length=g,n.opacityModRange=!1;for(var y=0;y<g;++y)n.opacityModifiers[y]={value:p=(m=r.opacityModifiers[y]).value,range:null},m.range&&(n.opacityModRange=!0,n.opacityModifiers[y].range={center:new Float32Array(m.range.center),radius:new Float32Array([m.range.minRadius,m.range.maxRadius-m.range.minRadius])});n.resetTransparency(),n.transparent!==d&&(this._engine.display.objectListDirty=!0),this._engine.display.imageDirty=!0}if(null!=r.noDepthMask&&(n.setFlag(e.NO_DEPTH_MASK,r.noDepthMask),this._engine.display.imageDirty=!0),null!=r.partiallyOpaque){var v=n.partiallyOpaque;n.setFlag(e.PARTIALLY_OPAQUE,r.partiallyOpaque),n.resetTransparency(),n.partiallyOpaque!==v&&this._engine.branchDirty(this),this._engine.display.imageDirty=!0}null!=r.forceTransparent&&(d=n.transparent,n.setFlag(e.FORCE_TRANSPARENT,r.forceTransparent),n.resetTransparency(),n.transparent!==d&&(this._engine.display.objectListDirty=!0),this._engine.display.imageDirty=!0),null!=r.stochasticAlpha&&(d=n.transparent,n.setFlag(e.STOCHASTIC_ALPHA,r.stochasticAlpha),n.resetTransparency(),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),null!=r.roundPoints&&(n.setFlag(e.ROUND_POINTS,r.roundPoints),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),null!=r.perspectivePoints&&(n.setFlag(e.PERSPECTIVE_POINTS,r.perspectivePoints),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),null!=r.fragmentShaderHeader&&(n.fragmentShaderHeader=r.fragmentShaderHeader,this._engine.branchDirty(this),this._engine.display.imageDirty=!0),null!=r.fragmentShaderFooter&&(n.fragmentShaderFooter=r.fragmentShaderFooter,this._engine.branchDirty(this),this._engine.display.imageDirty=!0),null!=r.depthTest&&(n.depthTest=i[r.depthTest]||r.depthTest,this._engine.display.imageDirty=!0);var S=n.hash;return n.hash=u(n),n.hash!==S&&this._engine.branchDirty(this),this._engine.display.imageDirty=!0,this},SceneJS.Properties.prototype.getProperties=function(){var t=this._core;return{picking:t.getFlag(e.PICKING),clipping:t.getFlag(e.CLIPPING),enabled:t.getFlag(e.ENABLED),frontface:t.getFlag(e.CCW)?"ccw":"cw",reflective:t.getFlag(e.REFLECTIVE),solid:t.getFlag(e.SOLID),solidColor:t.solidColor,skybox:t.getFlag(e.SKYBOX),billboard:t.getFlag(e.BILLBOARD),fullyTransparent:t.getFlag(e.FULLY_TRANSPARENT),roundPoints:t.getFlag(e.ROUND_POINTS),perspectivePoints:t.getFlag(e.PERSPECTIVE_POINTS),xray:t.getFlag(e.XRAY),glassFactor:t.xrayParams[0],murkiness:t.xrayParams[1],colorModifiers:t.colorModifiers,opacityModifier:t.opacityModifiers,pointPerspectiveDistance:t.pointPerspectiveDistance,fragmentShaderHeader:t.fragmentShaderHeader,fragmentShaderFooter:t.fragmentShaderFooter,depthTest:n[t.depthTest]||"enabled"}},SceneJS.Properties.prototype.setPicking=function(t){return t=!!t,this._core.getFlag(e.PICKING)!==t&&(this._core.setFlag(e.PICKING,t),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getPicking=function(){return this._core.getFlag(e.PICKING)},SceneJS.Properties.prototype.setClipping=function(e){return this.setProperties({clipping:e}),this},SceneJS.Properties.prototype.getClipping=function(){return!!this.solidColor[3]},SceneJS.Properties.prototype.setEnabled=function(e){return this.setProperties({enabled:e})},SceneJS.Properties.prototype.getEnabled=function(){return this._core.getFlag(e.ENABLED)},SceneJS.Properties.prototype.setFrontface=function(t){var r="ccw"===t;return this._core.getFlag(e.CCW)!==r&&(this._core.setFlag(e.CCW,r),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getFrontface=function(){return this._core.getFlag(e.CCW)?"ccw":"cw"},SceneJS.Properties.prototype.setReflective=function(t){return t=!!t,this._core.getFlag(e.REFLECTIVE)!=t&&(this._core.setFlag(e.REFLECTIVE,t),this._core.hash=u(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getReflective=function(){return this._core.getFlag(e.REFLECTIVE)},SceneJS.Properties.prototype.setSolid=function(t){return t=!!t,this._core.getFlag(e.SOLID)!=t&&(this._core.setFlag(e.SOLID,t),this._core.hash=u(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getSolid=function(){return this._core.getFlag(e.SOLID)},SceneJS.Properties.prototype.setSolidColor=function(e){return this.setProperties({solidColor:e}),this},SceneJS.Properties.prototype.getSolidColor=function(){return{r:this._core.solidColor[0],g:this._core.solidColor[1],b:this._core.solidColor[2]}},SceneJS.Properties.prototype.setSkybox=function(t){return t=!!t,this._core.getFlag(e.SKYBOX)!=t&&(this._core.setFlag(e.SKYBOX,t),this._core.hash=u(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getSkybox=function(){return this._core.getFlag(e.SKYBOX)},SceneJS.Properties.prototype.setName=function(e){this._core.name=e},SceneJS.Properties.prototype.getName=function(){return this._core.name},SceneJS.Properties.prototype.setFullyTransparent=function(t){return t=!!t,this._core.getFlag(e.FULLY_TRANSPARENT)!==t&&(this._core.setFlag(e.FULLY_TRANSPARENT,t),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getFullyTransparent=function(){return this._core.getFlag(e.FULLY_TRANSPARENT)},SceneJS.Properties.prototype.setRoundPoints=function(t){return t=!!t,this._core.getFlag(e.ROUND_POINTS)!=t&&(this._core.setFlag(e.ROUND_POINTS,t),this._core.hash=u(this._core),this._engine.branchDirty(this),this._engine.display.imageDirty=!0),this},SceneJS.Properties.prototype.getRoundPoints=function(){return this._core.getFlag(e.ROUND_POINTS)},SceneJS.Properties.prototype._compile=function(e){this._engine.display.properties=l[c++]=this._core,this._compileNodes(e),this._engine.display.properties=--c>0?l[c-1]:s,l[c]=null}}(),function(){"use strict";SceneJS.Geometry=SceneJS_NodeFactory.createNodeType("geometry"),SceneJS.Geometry.prototype._init=function(e){1==this._core.useCount&&(this._initNodeCore(e,{origin:e.origin,scale:e.scale,autoNormals:"auto"==e.normals}),this._buildNodeCore(this._engine.canvas.gl,this._core),this._boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this._boundaryDirty=!0,this.backfaces=!1!==e.backfaces,this.addBlend=!0===e.addBlend,this.layer=e.layer||0,this.onObjectCreate=e.onObjectCreate||null,this._core.webglRestored=function(e){return function(){e._core.tangentBufs=null,e._core.pickPositionsBuf=null,e._core.arrays.tangents&&(e._core.arrays.tangents=[]),e._buildNodeCore(e._engine.canvas.gl,e._core)}}(this),this._engine.stats.geometry.meshes++)},SceneJS.Geometry.prototype._initNodeCore=function(e,t){t=t||{};var r,a,i=e.primitive||"triangles",n=this._core,o=SceneJS.WEBGL_INFO.SUPPORTED_EXTENSIONS.OES_element_index_uint?Uint32Array:Uint16Array;if(n._engine=this._engine,n.primitive=this._getPrimitiveType(i),n.primitiveName=i,n.pointSize=e.pointSize||1,n.pointUVScale=e.pointUVScale||new Float32Array([1,1]),n.compressedPositions=!1,n.compressedNormals=!1,n.compressedUVs=!1,e.normals&&"triangles"==i&&("auto"!==e.normals&&!0!==e.normals||e.positions&&e.indices&&this._buildNormals(e)),n.arrays={},e.positions&&(e.positionDecodeMat?(n.arrays.positions=e.positions,n.positionDecodeMat=e.positionDecodeMat,n.compressedPositions=!0):(e.positions.constructor!=Float32Array&&(e.positions=new Float32Array(e.positions)),(t.scale||t.origin)&&this._applyOptions(e.positions,t),n.arrays.positions=e.positions),this._engine.stats.geometry.vertices+=e.positions.length/3,this._engine.stats.memory.positions+=e.positions.length*e.positions.constructor.BYTES_PER_ELEMENT),e.normals&&(e.normals.constructor==Int8Array?(n.arrays.normals=e.normals,n.compressedNormals=!0):(e.normals.constructor!=Float32Array&&(e.normals=new Float32Array(e.normals)),n.arrays.normals=e.normals),this._engine.stats.memory.normals+=e.normals.length*e.normals.constructor.BYTES_PER_ELEMENT),e.uvDecodeMats){for(var s=0,l=(r=e.uvs).length;s<l;s++)(a=r[s]).constructor!=Uint16Array&&(r[s]=new Uint16Array(r[s])),this._engine.stats.memory.uvs+=a.length*a.constructor.BYTES_PER_ELEMENT;n.arrays.uvs=r,n.uvDecodeMats=e.uvDecodeMats,n.compressedUVs=!0}else if(e.uvs){for(s=0,l=(r=e.uvs).length;s<l;s++)(a=r[s]).constructor!=Float32Array&&(r[s]=new Float32Array(r[s])),this._engine.stats.memory.uvs+=a.length*a.constructor.BYTES_PER_ELEMENT;n.arrays.uvs=r}e.uv&&(e.uv.constructor!=Float32Array&&(e.uv=new Float32Array(e.uv)),n.arrays.uvs||(n.arrays.uvs=[]),n.arrays.uvs[0]=e.uv,this._engine.stats.memory.uvs+=e.uv.length*e.uv.constructor.BYTES_PER_ELEMENT),e.uv1&&(e.uv1.constructor!=Float32Array&&(e.uv1=new Float32Array(e.uv1)),n.arrays.uvs||(n.arrays.uvs=[]),n.arrays.uvs[1]=e.uv1,this._engine.stats.memory.uvs+=e.uv1.length*e.uv1.constructor.BYTES_PER_ELEMENT),e.uv2&&(e.uv2.constructor!=Float32Array&&(e.uv2=new Float32Array(e.uv2)),n.arrays.uvs||(n.arrays.uvs=[]),n.arrays.uvs[2]=e.uv2,this._engine.stats.memory.uvs+=e.uv2.length*e.uv2.constructor.BYTES_PER_ELEMENT),e.uv3&&(e.uv3.constructor!=Float32Array&&(e.uv3=new Float32Array(e.uv3)),n.arrays.uvs||(n.arrays.uvs=[]),n.arrays.uvs[3]=e.uv3,this._engine.stats.memory.uvs+=e.uv3.length*e.uv3.constructor.BYTES_PER_ELEMENT),n.arrays.normals&&n.arrays.uvs&&(n.arrays.tangents=[]),e.colors&&(e.colors.constructor!=Uint8Array&&(e.colors=new Uint8Array(e.colors)),n.arrays.colors=e.colors,this._engine.stats.memory.colors+=e.colors.length*e.colors.constructor.BYTES_PER_ELEMENT),e.indices&&(e.indices.constructor!=Uint8Array&&e.indices.constructor!=Uint16Array&&e.indices.constructor!=Uint32Array&&(e.indices=new o(e.indices)),n.arrays.indices=e.indices,this._engine.stats.geometry.triangles+=e.indices.length/3,this._engine.stats.memory.indices+=e.indices.length*e.indices.constructor.BYTES_PER_ELEMENT),e.pointScaleRotations&&(e.pointScaleRotations.constructor!=Float32Array&&(e.pointScaleRotations=new Float32Array(e.pointScaleRotations)),n.arrays.pointScaleRotations=e.pointScaleRotations,this._engine.stats.memory.pointScaleRotations+=e.pointScaleRotations.length*e.pointScaleRotations.constructor.BYTES_PER_ELEMENT),e.pointUVTranslates&&(e.pointUVTranslates.constructor!=Float32Array&&(e.pointUVTranslates=new Float32Array(e.pointUVTranslates)),n.arrays.pointUVTranslates=e.pointUVTranslates,this._engine.stats.memory.pointUVTranslates+=e.pointUVTranslates.length*e.pointUVTranslates.constructor.BYTES_PER_ELEMENT)},SceneJS.Geometry.prototype._getPrimitiveType=function(e){var t=this._engine.canvas.gl;switch(e){case"points":return t.POINTS;case"lines":return t.LINES;case"line-loop":return t.LINE_LOOP;case"line-strip":return t.LINE_STRIP;case"triangles":return t.TRIANGLES;case"triangle-strip":return t.TRIANGLE_STRIP;case"triangle-fan":return t.TRIANGLE_FAN;default:SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"geometry primitive unsupported: '"+e+"' - supported types are: 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'")}},SceneJS.Geometry.prototype._applyOptions=function(e,t){if(t.scale)for(var r=null!=t.scale.x?t.scale.x:1,a=null!=t.scale.y?t.scale.y:1,i=null!=t.scale.z?t.scale.z:1,n=0,o=e.length;n<o;n+=3)e[n]*=r,e[n+1]*=a,e[n+2]*=i;if(t.origin){var s=null!=t.origin.x?t.origin.x:0,l=null!=t.origin.y?t.origin.y:0,c=null!=t.origin.z?t.origin.z:0;for(n=0,o=e.length;n<o;n+=3)e[n]-=s,e[n+1]-=l,e[n+2]-=c}return e};var e=function(e){if(e.vertexBuf&&(e.vertexBuf.destroy(),e.vertexBuf=null),e.normalBuf&&(e.normalBuf.destroy(),e.normalBuf=null),e.uvBufs){for(var t,r=e.uvBufs,a=0,i=r.length;a<i;a++)(t=r[a])&&t.destroy();e.uvBufs=null}if(e.colorBuf&&(e.colorBuf.destroy(),e.colorBuf=null),e.pointScaleRotationBuf&&(e.pointScaleRotationBuf.destroy(),e.pointScaleRotationBuf=null),e.pointUVTranslateBuf&&(e.pointUVTranslateBuf.destroy(),e.pointUVTranslateBuf=null),e.tangentBufs){for(var n,o=e.tangentBufs,s=0,l=o.length;s<l;s++)(n=o[s])&&n.destroy();e.tangentBufs=null}e.indexBuf&&(e.indexBuf.destroy(),e.indexBuf=null)};SceneJS.Geometry.prototype._buildNodeCore=function(t,r){try{!function(e,t){var r=e.STATIC_DRAW,a=t.arrays;if(t.transparent=!!a.colors,a.positions&&(t.vertexBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,a.positions,a.positions.length,3,r)),t.compressedNormals?t.normalBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,a.normals,a.normals.length,2,r,!0):a.normals&&(t.normalBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,a.normals,a.normals.length,3,r)),a.uvs){var i,n,o,s=a.uvs;for(t.uvBufs=[],i=0,n=s.length;i<n;i++)(o=a.uvs[i]).length>0&&t.uvBufs.push(new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,o,o.length,2,r))}a.colors&&(t.colorBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,a.colors,a.colors.length,4,r,!0)),a.indices&&(t.indexBuf=new SceneJS._webgl.ArrayBuffer(e,e.ELEMENT_ARRAY_BUFFER,a.indices,a.indices.length,1,r)),a.pointScaleRotations&&(t.pointScaleRotationBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,a.pointScaleRotations,a.pointScaleRotations.length,2,r,!0)),a.pointUVTranslates&&(t.pointUVTranslateBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,a.pointUVTranslates,a.pointUVTranslates.length,2,r,!0))}(t,r)}catch(a){e(r),SceneJS_error.fatalError(SceneJS.errors.ERROR,"Failed to allocate geometry: "+a)}},SceneJS.Geometry.prototype._updateArray=function(e,t,r){var a=e.length,i=t.length;i+r>a&&(i-=i+r-a);for(var n=r,o=0;o<i;n++,o++)e[n]=t[o]},SceneJS.Geometry.prototype._buildNormals=function(e){for(var t,r,a,i,n,o,s=e.positions,l=e.indices,c=new Array(s.length/3),u=0,_=l.length-3;u<_;u+=3){i=[s[3*(t=l[u+0])+0],s[3*t+1],s[3*t+2]],n=[s[3*(r=l[u+1])+0],s[3*r+1],s[3*r+2]],o=[s[3*(a=l[u+2])+0],s[3*a+1],s[3*a+2]],n=vec4.subtract(vec4.create(),n,i),o=vec4.subtract(vec4.create(),o,i);var h=vec4.normalize(vec4.create(),SceneJS_math_cross3Vec4(n,o,[0,0,0,0]));c[t]||(c[t]=[]),c[r]||(c[r]=[]),c[a]||(c[a]=[]),c[t].push(h),c[r].push(h),c[a].push(h)}var f=new Float32Array(s.length);for(u=0,_=c.length;u<_;u++){var d=c[u];if(d){for(var p=d.length,m=0,g=0,y=0,v=0;v<p;v++)m+=d[v][0],g+=d[v][1],y+=d[v][2];f[3*u+0]=m/p,f[3*u+1]=g/p,f[3*u+2]=y/p}}e.normals=f,this._engine.stats.memory.normals+=f.length/3},SceneJS.Geometry.prototype.setSource=function(e){this._sourceConfigs=e;var t=this._source;t&&t.configure&&t.configure(e)},SceneJS.Geometry.prototype.getSource=function(){return this._sourceConfigs||{}},SceneJS.Geometry.prototype.getBackfaces=function(){return this.backfaces},SceneJS.Geometry.prototype.setBackfaces=function(e){this.backfaces=e;var t=this.getObject();t&&(t.backfaces=e),this._engine.display.imageDirty=!0},SceneJS.Geometry.prototype.getAddBlend=function(){return this.addBlend},SceneJS.Geometry.prototype.setAddBlend=function(e){this.addBlend=e;var t=this.getObject();t&&(t.addBlend=e),this._engine.display.imageDirty=!0},SceneJS.Geometry.prototype.getLayer=function(){return this.layer},SceneJS.Geometry.prototype.setLayer=function(e){this.layer=e;var t=this.getObject();t&&(t.layer=e),this._engine.display.objectListDirty=!0},SceneJS.Geometry.prototype.setPositions=function(e){if(e&&this._core.vertexBuf){this._boundaryDirty=!0;var t=this._core;t.vertexBuf.bind(),t.vertexBuf.setData(e),t.arrays.positions.set(e),t.kdTreeDirty=!0,this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getPositions=function(){return this._core.arrays?this._core.arrays.positions:null},SceneJS.Geometry.prototype.getPositionDecodeMat=function(){return this._core.positionDecodeMat||null},SceneJS.Geometry.prototype.setNormals=function(e){if(e&&this._core.normalBuf){var t=this._core;t.normalBuf.bind(),t.normalBuf.setData(e),t.arrays.normals.set(e),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getNormals=function(){return this._core.arrays?this._core.arrays.normals:null},SceneJS.Geometry.prototype.setColors=function(e){if(e&&this._core.colorBuf){var t=this._core;t.colorBuf.bind(),t.colorBuf.setData(e),t.arrays.colors.set(e),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getColors=function(){return this._core.arrays?this._core.arrays.colors:null},SceneJS.Geometry.prototype.setIndices=function(e){if(e&&this._core.indexBuf){this._boundaryDirty=!0;var t=this._core;t.indexBuf.bind(),e.constructor!=t.arrays.indices.constructor&&(e=new t.arrays.indices.constructor(e)),t.indexBuf.setData(e),t.arrays.indices.set(e),t.kdTreeDirty=!0,this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getIndices=function(){return this._core.arrays?this._core.arrays.indices:null},SceneJS.Geometry.prototype.getUVs=function(){return this._core.arrays?this._core.arrays.uvs:null},SceneJS.Geometry.prototype.getUV=function(){return this._core.arrays?this._core.arrays.uvs[0]:null},SceneJS.Geometry.prototype.getUVDecodeMat=function(e){return this._core.uvDecodeMats[e||0]||null},SceneJS.Geometry.prototype.getUV2=function(){return this._core.arrays?this._core.arrays.uvs[1]:null},SceneJS.Geometry.prototype.getUV2=function(){return this._core.arrays?this._core.arrays.uvs[2]:null},SceneJS.Geometry.prototype.getUv3=function(){return this._core.arrays?this._core.arrays.uvs[3]:null},SceneJS.Geometry.prototype.setUV=function(e,t){if(t&&this._core.uvBufs&&this._core.uvBufs[e]){var r=this._core;r.uvBufs[e].bind(),r.uvBufs[e].setData(t),r.arrays.uvs[e].set(t),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.hasCompressedPositions=function(){return!!this._core.compressedPositions},SceneJS.Geometry.prototype.hasCompressedNormals=function(){return!!this._core.compressedNormals},SceneJS.Geometry.prototype.hasCompressedUVs=function(){return!!this._core.compressedUVs},SceneJS.Geometry.prototype.getPrimitive=function(){return this.primitive},SceneJS.Geometry.prototype.getPointSize=function(){return this._core.pointSize},SceneJS.Geometry.prototype.setPointSize=function(e){e&&this._core.pointSize!==e&&(this._core.pointSize=e,this._engine.display.imageDirty=!0)},SceneJS.Geometry.prototype.getPointUVScale=function(){return this._core.pointUVScale},SceneJS.Geometry.prototype.setPointUVScale=function(e){e&&this._core.pointUVScale!==e&&(this._core.pointUVScale=e,this._engine.display.imageDirty=!0)},SceneJS.Geometry.prototype.setPointScaleRotations=function(e){if(e&&this._core.pointScaleRotationBuf){var t=this._core;t.pointScaleRotationBuf.bind(),t.pointScaleRotationBuf.setData(e),t.arrays.pointScaleRotations.set(e),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getPointScaleRotations=function(){return this._core.arrays?this._core.arrays.pointScaleRotations:null},SceneJS.Geometry.prototype.setPointUVTranslates=function(e){if(e&&this._core.pointUVTranslateBuf){var t=this._core;t.pointUVTranslateBuf.bind(),t.pointUVTranslateBuf.setData(e),t.arrays.pointUVTranslates.set(e),this._engine.display.imageDirty=!0}},SceneJS.Geometry.prototype.getPointUVTranslates=function(){return this._core.arrays?this._core.arrays.pointUVTranslates:null},SceneJS.Geometry.prototype.getKdTree=function(){var e=this.getObject();return e?e.getKdTree():this._core.getKdTree()},SceneJS.Geometry.prototype.getObject=function(){return this._engine.display._objects[this.id]||null},SceneJS.Geometry.prototype.getBoundary=function(){if(!this._boundaryDirty)return this._boundary;var e=this._core.arrays;if(!e)return null;var t,r,a,i=e.positions;if(!i)return null;this._boundary.xmin=Number.POSITIVE_INFINITY,this._boundary.ymin=Number.POSITIVE_INFINITY,this._boundary.zmin=Number.POSITIVE_INFINITY,this._boundary.xmax=Number.NEGATIVE_INFINITY,this._boundary.ymax=Number.NEGATIVE_INFINITY,this._boundary.zmax=Number.NEGATIVE_INFINITY;for(var n=0,o=i.length-2;n<o;n+=3)r=i[n+1],a=i[n+2],(t=i[n])<this._boundary.xmin&&(this._boundary.xmin=t),r<this._boundary.ymin&&(this._boundary.ymin=r),a<this._boundary.zmin&&(this._boundary.zmin=a),t>this._boundary.xmax&&(this._boundary.xmax=t),r>this._boundary.ymax&&(this._boundary.ymax=r),a>this._boundary.zmax&&(this._boundary.zmax=a);return this._boundaryDirty=!1,this._boundary},SceneJS.Geometry.prototype._compile=function(e){if(this._core._loading)this._compileNodes(e);else{var t=this._core,r=[t.normalBuf?"t":"f",t.arrays&&t.arrays.tangents?"t":"f",t.colorBuf?"t":"f",t.primitive,t.compressedPositions?"t":"f",t.compressedNormals?"t":"f",t.compressedUVs?"t":"f",t.pointScaleRotationBuf?"t":"f",t.pointUVTranslateBuf?"t":"f"];r.push(";uvs");var a=t.uvBufs;if(a)for(var i=0,n=a.length;i<n;i++)r.push(a[i]?"t":"f");t.hash=r.join(""),t.stateId=this._core.stateId,t.type="geometry",this._engine.display.geometry=t,SceneJS_events.fireEvent(SceneJS_events.OBJECT_COMPILING,{display:this._engine.display}),this._engine.display.buildObject(this.id,{backfaces:this.backfaces,addBlend:this.addBlend,layer:this.layer}),this.onObjectCreate&&this.onObjectCreate(this.getObject()),this._compileNodes(e)}},SceneJS.Geometry.prototype._destroy=function(){this._engine.display.removeObject(this.id),1==this._core.useCount&&(this._destroyNodeCore(),this._source&&this._source.destroy&&this._source.destroy(),this._engine.stats.geometry.meshes--)},SceneJS.Geometry.prototype._disconnectFromScene=function(){this._engine.display.removeObject(this.id)},SceneJS.Geometry.prototype._destroyNodeCore=function(){document.getElementById(this._engine.canvas.canvasId)&&e(this._core);var t=this._core.arrays;t.positions&&(this._engine.stats.memory.positions-=t.positions.length/3),t.normals&&(this._engine.stats.memory.normals-=t.normals.length/3),t.colors&&(this._engine.stats.memory.colors-=t.colors.length/3),t.uvs&&t.uvs.length>0&&(this._engine.stats.memory.uvs-=t.uvs.length*(t.uvs[0].length/2)),t.indices&&(this._engine.stats.memory.indices-=t.indices.length),t.pointScaleRotations&&(this._engine.stats.memory.pointScaleRotations-=t.pointScaleRotations.length/2),t.pointUVTranslates&&(this._engine.stats.memory.pointUVTranslates-=t.pointUVTranslates.length/2)}}(),function(){"use strict";SceneJS.Library=SceneJS_NodeFactory.createNodeType("library"),SceneJS.Library.prototype._compile=function(e){}}(),function(){"use strict";SceneJS.Material=SceneJS_NodeFactory.createNodeType("material"),SceneJS.Material.PHONG=0,SceneJS.Material.METALLIC=1;var e={type:"material",stateId:SceneJS._baseStateId++,workflow:SceneJS.Material.PHONG,baseColor:new Float32Array([1,1,1,1]),specularColor:new Float32Array([1,1,1,1]),emitColor:new Float32Array([1,1,1,0]),shine:70,metalRoughspecularf0:new Float32Array([1,1,.1,0]),hash:""},t=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(t){t.engine.display.material=e,r=0})),SceneJS.Material.prototype._init=function(t){1==this._core.useCount&&(this._core.baseColor=new Float32Array(e.baseColor),this._core.specularColor=new Float32Array(e.specularColor),this._core.emitColor=new Float32Array(e.emitColor),this._core.shine=e.shine,this._core.metalRoughspecularf0=new Float32Array(e.metalRoughspecularf0),(t.color||t.baseColor)&&this.setBaseColor(t.color||t.baseColor),t.specularColor&&this.setSpecularColor(t.specularColor),t.emitColor&&this.setEmitColor(t.emitColor),null!=t.specular&&this.setSpecular(t.specular),null!=t.shine&&this.setShine(t.shine),null!=t.emit&&this.setEmit(t.emit),null!=t.alpha&&this.setAlpha(t.alpha),null!=t.metallic&&this.setMetallic(t.metallic),null!=t.roughness&&this.setRoughness(t.roughness),null!=t.specularf0&&this.setspecularf0(t.specularf0),this.setWorkflow(t.workflow))},SceneJS.Material.prototype.setWorkflow=function(e){return"phong"===(e=e||"phong")?this._core.workflow=SceneJS.Material.PHONG:"metallic"===e?this._core.workflow=SceneJS.Material.METALLIC:(console.error("Unsupported SceneJS material workflow: "+e),this._core.workflow=SceneJS.Material.PHONG),this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getWorkflow=function(){switch(this._core.workflow){case SceneJS.Material.PHONG:return"phong";case SceneJS.Material.METALLIC:return"metallic"}},SceneJS.Material.prototype.setBaseColor=function(t){var r=e.baseColor;return this._core.baseColor[0]=null!=t.r?t.r:r[0],this._core.baseColor[1]=null!=t.g?t.g:r[1],this._core.baseColor[2]=null!=t.b?t.b:r[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.setColor=SceneJS.Material.prototype.setBaseColor,SceneJS.Material.prototype.getBaseColor=function(){return{r:this._core.baseColor[0],g:this._core.baseColor[1],b:this._core.baseColor[2]}},SceneJS.Material.prototype.getColor=SceneJS.Material.prototype.getBaseColor,SceneJS.Material.prototype.setSpecularColor=function(t){var r=e.specularColor;return this._core.specularColor[0]=null!=t.r?t.r:r[0],this._core.specularColor[1]=null!=t.g?t.g:r[1],this._core.specularColor[2]=null!=t.b?t.b:r[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getSpecularColor=function(){return{r:this._core.specularColor[0],g:this._core.specularColor[1],b:this._core.specularColor[2]}},SceneJS.Material.prototype.setEmitColor=function(t){var r=e.emitColor;return this._core.emitColor[0]=null!=t.r?t.r:r[0],this._core.emitColor[1]=null!=t.g?t.g:r[1],this._core.emitColor[2]=null!=t.b?t.b:r[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getEmitColor=function(){return{r:this._core.emitColor[0],g:this._core.emitColor[1],b:this._core.emitColor[2]}},SceneJS.Material.prototype.setSpecular=function(t){return this._core.specularColor[3]=null!=t&&null!=t?t:e.specularColor[3],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getSpecular=function(){return this._core.specularColor[3]},SceneJS.Material.prototype.setShine=function(t){return this._core.shine=null!=t?t:e.shine,this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getShine=function(){return this._core.shine},SceneJS.Material.prototype.setEmit=function(t){return this._core.emitColor[3]=null!=t?t:e.emitColor[3],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getEmit=function(){return this._core.emitColor[3]},SceneJS.Material.prototype.setAlpha=function(t){var r=this._core.baseColor[3]<1;return this._core.baseColor[3]=null!=t?t:e.baseColor[3],this._core.transparent=this._core.baseColor[3]<1,this._engine.display.imageDirty=!0,r!==this._core.transparent&&(this._engine.display.objectListDirty=!0),this},SceneJS.Material.prototype.getAlpha=function(){return this._core.baseColor[3]},SceneJS.Material.prototype.setMetallic=function(t){return this._core.metalRoughspecularf0[0]=null!=t?t:e.metalRoughspecularf0[0],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getMetallic=function(){return this._core.metalRoughspecularf0[0]},SceneJS.Material.prototype.setRoughness=function(t){return this._core.metalRoughspecularf0[1]=null!=t?t:e.metalRoughspecularf0[1],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getRoughness=function(){return this._core.metalRoughspecularf0[1]},SceneJS.Material.prototype.setspecularf0=function(t){return this._core.metalRoughspecularf0[2]=null!=t?t:e.metalRoughspecularf0[2],this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getspecularf0=function(){return this._core.metalRoughspecularf0[2]},SceneJS.Material.prototype._compile=function(a){this._makeHash(this._core),this._engine.display.material=t[r++]=this._core,this._compileNodes(a),this._engine.display.material=--r>0?t[r-1]:e,t[r]=null},SceneJS.Material.prototype._makeHash=function(e){e.hash=e.workflow.toString()}}(),function(){"use strict";var e=SceneJS.KD_TREE_MAX_DEPTH,t=SceneJS.KD_TREE_MIN_TRIANGLES,r={type:"morphGeometry",stateId:SceneJS._baseStateId++,hash:"",morph:null},a=[],i=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(e){e.engine.display.morphGeometry=r,i=0})),SceneJS.MorphGeometry=SceneJS_NodeFactory.createNodeType("morphGeometry"),SceneJS.MorphGeometry.prototype._init=function(e){if(1==this._core.useCount){this._pickPositionsDirty=!0,this._buildNodeCore(e),this._core.webglRestored=function(){};var t=this;this._core.getPickPositions=function(e,r){return t._pickPositionsDirty&&t._buildPickPositions(r),t._core.targets[e].pickPositionsBuf},this._core.getTangents=function(e,r,a,i,n){var o=t._core.targets[e];if(o.tangentBuf)return o.tangentBuf;var s=o.positions;if(i=o.positionDecodeMat||i,a=o.uv||a,s&&r&&a){var l=t._engine.canvas.gl,c=SceneJS_math_buildTangents(s,r,a,i,n);return o.tangents=c,o.tangentBuf=new SceneJS._webgl.ArrayBuffer(l,l.ARRAY_BUFFER,c,c.length,3,l.STATIC_DRAW),o.tangentBuf}},this.setFactor(e.factor)}this._core.factor=e.factor||0,this._core.clamp=!!e.clamp},SceneJS.MorphGeometry.prototype._buildNodeCore=function(r){try{!function(r,a){var i=a.targets||[];i.length<2&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node should have at least two targets");var o=a.keys||[];o.length!=i.length&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node mismatch in number of keys and targets");var s,l,c,u,_,h,f,d=r._core,p=r._engine.canvas.gl,m=p.STATIC_DRAW;d.keys=o,d.targets=[],d.key1=0,d.key2=1;for(var g=0,y=i.length;g<y;g++)_=i[g],!s&&_.positions&&(s=_.positions),!l&&_.normals&&(l=_.normals),!c&&_.uv&&(c=_.uv),!u&&_.uv2&&(u=_.uv2);for(g=0,y=i.length;g<y;g++)h={},(f=(_=i[g]).positions||s)&&(_.positionDecodeMat?(h.positions=f,h.positionDecodeMat=_.positionDecodeMat,d.compressedPositions=!0):h.positions=f.constructor==Float32Array?f:new Float32Array(f),h.vertexBuf=new SceneJS._webgl.ArrayBuffer(p,p.ARRAY_BUFFER,h.positions,f.length,3,m),s=f,r._engine.stats.memory.morphPositions+=h.positions.length*h.positions.constructor.BYTES_PER_ELEMENT),(f=_.normals||l)&&(f.constructor==Int8Array?(h.normals=f,d.compressedNormals=!0,h.normalBuf=new SceneJS._webgl.ArrayBuffer(p,p.ARRAY_BUFFER,h.normals,f.length,2,m,!0)):(h.normals=f.constructor==Float32Array?f:new Float32Array(f),h.normalBuf=new SceneJS._webgl.ArrayBuffer(p,p.ARRAY_BUFFER,h.normals,f.length,3,m)),l=f,r._engine.stats.memory.morphNormals+=h.normals.length*h.normals.constructor.BYTES_PER_ELEMENT),(f=_.uv||c)&&(h.uv=f.constructor==Float32Array?f:new Float32Array(f),h.uvBuf=new SceneJS._webgl.ArrayBuffer(p,p.ARRAY_BUFFER,h.uv,f.length,2,m),c=f),(f=_.uv2||u)&&(h.uv2=f.constructor==Float32Array?f:new Float32Array(f),h.uvBuf2=new SceneJS._webgl.ArrayBuffer(p,p.ARRAY_BUFFER,h.uv2,f.length,2,m),u=f),d.targets.push(h);d.kdTree=null,d.kdTreeDirty=!0,d.getKdTree=function(r){if(!this.kdTreeDirty)return this.kdTree;for(var a=r.length/3,i=new Array(a),o=0;o<a;++o)i[o]=o;return this.kdTree=function r(a,i,o,s,l){var c,u,_=vec3.create(),h=vec3.create(),f={triangles:null,left:null,right:null,bb:{min:_,max:h}};_[0]=_[1]=_[2]=Number.POSITIVE_INFINITY,h[0]=h[1]=h[2]=Number.NEGATIVE_INFINITY;var d=o.length;for(c=0,u=a.length;c<u;++c)for(var p=3*a[c],m=0;m<3;++m)for(var g=3*i[p+m],y=0;y<d;++y){var v=o[y].positionDecodeMat;n[0]=(D=o[y].positions)[g],n[1]=D[g+1],n[2]=D[g+2],v&&SceneJS_math_decompressPosition(n,n,v),n[0]<_[0]&&(_[0]=n[0]),n[0]>h[0]&&(h[0]=n[0]),n[1]<_[1]&&(_[1]=n[1]),n[1]>h[1]&&(h[1]=n[1]),n[2]<_[2]&&(_[2]=n[2]),n[2]>h[2]&&(h[2]=n[2])}if(l>e)return f.triangles=a,f;var S=(_[s]+h[s])/2,b=new Array(a.length),E=0,I=new Array(a.length),x=0;for(c=0,u=a.length;c<u;++c){var C=3*i[p=3*a[c]],T=3*i[p+1],N=3*i[p+2],A=!0;for(y=0;y<d;++y){var D,M=(D=o[y].positions)[C+s],P=D[T+s],w=D[N+s];if(v=o[y].positionDecodeMat){var F=v[5*s],R=v[s+12];M=M*F+R,P=P*F+R,w=w*F+R}if(M<S||P<S||w<S){A=!1;break}}A?I[x++]=a[c]:b[E++]=a[c]}return E<t||x<t?(f.triangles=a,f):(b.length=E,I.length=x,f.left=r(b,i,o,(s+1)%3,l+1),f.right=r(I,i,o,(s+1)%3,l+1),f)}(i,r,this.targets,0,0),this.kdTreeDirty=!1,this.kdTree},r._pickPositionsDirty=!0}(this,r)}catch(o){for(var a=0,i=this._core.targets.length;a<i;a++)target=core.targets[a],target.vertexBuf&&target.vertexBuf.destroy(),target.normalBuf&&target.normalBuf.destroy(),target.uvBuf&&target.uvBuf.destroy(),target.uvBuf2&&target.uvBuf2.destroy();SceneJS_error.fatalError(SceneJS.errors.ERROR,"Failed to allocate VBO(s) for morphGeometry: "+o)}},SceneJS.MorphGeometry.prototype._buildPickPositions=function(e){for(var t,r=this._core,a=null,i=this._engine.canvas.gl,n=i.STATIC_DRAW,o=0,s=r.targets.length;o<s;o++)(a=r.targets[o]).positions&&(a.pickPositionsBuf&&(a.pickPositionsBuf.destroy(),a.pickPositionsBuf=null),t=SceneJS_math_getPickPositions(a.positions,e),a.pickPositionsBuf=new SceneJS._webgl.ArrayBuffer(i,i.ARRAY_BUFFER,t,t.length,3,n));this._pickPositionsDirty=!1},SceneJS.MorphGeometry.prototype.setFactor=function(e){var t=this._core,r=t.keys,a=t.key1,i=t.key2,n=t.factor;if((e=e||0)<r[0])a=0,i=1;else if(e>r[r.length-1])i=1+(a=r.length-2);else{for(;r[a]>e;)a--,i--;for(;r[i]<e;)a++,i++}var o=a!=t.key1;t.factor=(e-r[a])/(r[i]-r[a]),this._factor=e;var s=o||n!=t.factor;if(t.key1=a,t.key2=i,s){var l=this.getCurrentFrame();this.onUpdate&&this.onUpdate(l),o&&this.onFrameUpdate&&this.onFrameUpdate(l)}this._engine.display.imageDirty=!0},SceneJS.MorphGeometry.prototype.getFactor=function(){return this._factor},SceneJS.MorphGeometry.prototype.getKeys=function(){return this._core.keys},SceneJS.MorphGeometry.prototype.getTargets=function(){return this._core.targets},SceneJS.MorphGeometry.prototype.getCurrentFrame=function(){var e=this._core,t=e.key1,r=e.key2;return{key1:t,key2:r,factor:e.factor,target1:e.targets[t],target2:e.targets[r]}},SceneJS.MorphGeometry.prototype._compile=function(e){this._core.hash||this._makeHash(),this._engine.display.morphGeometry=a[i++]=this._core,this._compileNodes(e),this._engine.display.morphGeometry=--i>0?a[i-1]:r,a[i]=null},SceneJS.MorphGeometry.prototype._makeHash=function(){var e=this._core;if(e.targets.length>0){var t=e.targets[0],r="t",a="f";e.hash=[t.vertexBuf?r:a,t.normalBuf?r:a,t.uvBuf?r:a,t.uvBuf2?r:a].join("")}else e.hash=""},SceneJS.MorphGeometry.prototype._destroy=function(){if(1==this._core.useCount&&document.getElementById(this._engine.canvas.canvasId))for(var e,t=this._core,r=0,a=t.targets.length;r<a;r++)(e=t.targets[r]).vertexBuf&&e.vertexBuf.destroy(),e.pickPositionsBuf&&e.pickPositionsBuf.destroy(),e.normalBuf&&e.normalBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.uvBuf2&&e.uvBuf2.destroy()},vec3.create(),vec3.create();var n=vec3.create()}(),function(){"use strict";SceneJS.Scene=SceneJS_NodeFactory.createNodeType("scene"),SceneJS.Scene.prototype._init=function(e){this.transparent=!0===e.transparent,this.stats=this._engine.stats,this._handleMap=new SceneJS_Map,this._topicSubs={},this._handleTopics={},this._topicPubs={}},SceneJS.Scene.prototype.loseWebGLContext=function(){this._engine.loseWebGLContext()},SceneJS.Scene.prototype.getCanvas=function(){return this._engine.canvas.canvas},SceneJS.Scene.prototype.setTransparencyMode=function(e){this._engine.display.setTransparencyMode(e),this._engine.branchDirty(this)},SceneJS.Scene.prototype.setDepthSort=function(e){this._engine.display.depthSort=e,this._engine.display.objectListDirty=!0},SceneJS.Scene.prototype.getGL=function(){return this._engine.canvas.gl},SceneJS.Scene.prototype.getWebGL2Supported=function(){return this._engine.canvas.webgl2},SceneJS.Scene.prototype.getZBufferDepth=function(){var e=this._engine.canvas.gl;return e.getParameter(e.DEPTH_BITS)},SceneJS.Scene.prototype.setResolutionScaling=function(e){return this._engine.canvas.setResolutionScaling(e)},SceneJS.Scene.prototype.setProjection=function(e){var t=this._engine.display,r=e.type;r||t.projection&&(r=t.projection.type),"ortho"==(r=r||"perspective")?t.projection=SceneJS._applyIf(SceneJS_math_ORTHO_OBJ,{type:r,left:e.left,bottom:e.bottom,near:e.near,right:e.right,top:e.top,far:e.far}):"frustum"==r?t.projection={type:r,left:e.left||-1,bottom:e.bottom||-1,near:e.near||.1,right:e.right||1,top:e.top||1,far:e.far||1e4}:"perspective"==r&&(null!=e.fovy&&(e.fov=e.fovy),t.projection={type:r,fov:e.fov||60,aspect:null==e.aspect?1:e.aspect,near:e.near||.1,far:e.far||1e4}),t.projection.pan=e.pan,t.buildProjectionMatrix(),t.imageDirty=!0},SceneJS.Scene.prototype.getProjection=function(){return this._engine.display.projection},SceneJS.Scene.prototype.setCamera=function(e){var t=this._engine.display;e.eye&&t.camera.eye.set(e.eye),e.look&&t.camera.look.set(e.look),e.up&&t.camera.up.set(e.up),e.deviceMatrix&&(t.hasDeviceMatrix=!0,t.deviceMatrix.set(e.deviceMatrix)),t.buildViewMatrix(),t.imageDirty=!0},SceneJS.Scene.prototype.setLights=function(e){var t=this._engine.display;t.lights.length=(e=e||[]).length;var r="";t._ambientColor[0]=0,t._ambientColor[1]=0,t._ambientColor[2]=0;for(var a=0,i=0,n=e.length;i<n;++i){t.lights[a]=t.lights[a]||{};var o=t.lights[a],s=e[i],l=s.mode||"dir";"dir"!=l&&"point"!=l&&"ambient"!=l&&"spot"!=l&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Light mode not supported - should be 'dir' or 'point' or 'spot' or 'ambient'");var c=s.pos,u=s.dir,_=s.color;o.color=new Float32Array([null!=_.r?_.r:1,null!=_.g?_.g:1,null!=_.b?_.b:1]),"ambient"!==l?(o.mode=l,o.diffuse="ambient"==l||null==s.diffuse||s.diffuse,o.specular="ambient"!=l&&(null==s.specular||s.specular),o.pos=new Float32Array(s.pos?[c.x||0,c.y||0,c.z||0]:[0,0,0]),o.dir=new Float32Array(s.dir?[u.x||0,u.y||0,u.z||0]:[0,0,1]),o.innerCone=null!=s.innerCone?s.innerCone:.25,o.outerCone=null!=s.outerCone?s.outerCone:0,o.attenuation=new Float32Array([null!=s.constantAttenuation?s.constantAttenuation:0,s.linearAttenuation||0,s.quadraticAttenuation||0]),o.space=s.space||"world",++a,r+=o.mode,o.specular&&(r+="s"),o.diffuse&&(r+="d"),r+="world"===o.space?"w":"v",i<n-1&&(r+="/")):(t._ambientColor[0]=o.color[0],t._ambientColor[1]=o.color[1],t._ambientColor[2]=o.color[2])}t.lights.length=a,t.lightHash!==r?(t.lightHash=r,this._engine.branchDirty(this)):t.imageDirty=!0},SceneJS.Scene.prototype.setClips=function(e){var t=this._engine.display,r=t.clips,a="";r.clips.length=e.length,r.enabled=!1;for(var i=0,n=e.length;i<n;++i){var o=e[i],s=r.clips[i]||(r.clips[i]={normalAndDist:vec4.create(),fade:!1,fadeDistance:0}),l=o.n;vec3.normalize(l,l);var c=0;o.d?c=o.d:o.p&&(c=-vec3.dot(l,o.p)),s.normalAndDist.set(l),s.normalAndDist[3]=c,s.fade=!!o.fade,s.fadeDistance=0,s.fade?(r.clipFade=!0,s.fadeDistance=o.fadeDistance):r.clipDiscard=!0,a+=s.fade?"f":"c"}a===t.clipsHash?t.imageDirty=!0:(this._engine.branchDirty(this),t.clipsHash=a)},SceneJS.Scene.prototype.createReflection=function(e,t){var r=this._engine.display.reflections,a=r.reflections[e];a?console.error("Reflection already exists: "+e):(a=new SceneJS.GlobalCubemap(this,e,t),r.reflections[e]=a)},SceneJS.Scene.prototype.activateReflection=function(e){var t=this._engine.display.reflections,r=t.reflections[e];r?(t.activeReflection=r,this._updateReflectionsHash()):console.error("Reflection not found: "+e)},SceneJS.Scene.prototype._updateReflectionsHash=function(){var e=this._engine.display,t=e.reflections.activeReflection?e.reflections.activeReflection.hash:";";t===e.reflectionsHash?e.imageDirty=!0:(this._engine.branchDirty(this),e.reflectionsHash=t)},SceneJS.Scene.prototype.deactivateReflection=function(){var e=this._engine.display.reflections;e.activeReflection&&(e.activeReflection=null,this._updateReflectionsHash())},SceneJS.Scene.prototype.destroyReflection=function(e){var t=this._engine.display.reflections,r=t.reflections[e];r?(t.activeReflection&&t.activeReflection.id===r.id&&this.deactivateReflection(),r.destroy(),delete t.reflections[e]):console.error("Reflection not found: "+e)},SceneJS.Scene.prototype.destroyAllReflections=function(){for(var e=Object.keys(this._engine.display.reflections.reflections),t=0,r=e.length;t<r;t++)this.destroyReflection(e[t])},SceneJS.Scene.prototype.createLightmap=function(e,t){var r=this._engine.display.lightmaps,a=r.lightmaps[e];a?console.error("Lightmap already exists: "+e):(a=new SceneJS.GlobalCubemap(this,e,t),r.lightmaps[e]=a)},SceneJS.Scene.prototype.activateLightmap=function(e){var t=this._engine.display.lightmaps,r=t.lightmaps[e];r?(t.activeLightmap=r,this._updateLightmapsHash()):console.error("Lightmap not found: "+e)},SceneJS.Scene.prototype._updateLightmapsHash=function(){var e=this._engine.display,t=e.lightmaps.activeLightmap?e.lightmaps.activeLightmap.hash:";";t===e.lightmapsHash?e.imageDirty=!0:(this._engine.branchDirty(this),e.lightmapsHash=t)},SceneJS.Scene.prototype.deactivateLightmap=function(){var e=this._engine.display.lightmaps;e.activeLightmap&&(e.activeLightmap=null,this._updateLightmapsHash())},SceneJS.Scene.prototype.destroyLightmap=function(e){var t=this._engine.display.lightmaps,r=t.lightmaps[e];r?(t.activeLightmap&&t.activeLightmap.id===r.id&&this.deactivateLightmap(),r.destroy(),delete t.lightmaps[e]):console.error("Lightmap not found: "+e)},SceneJS.Scene.prototype.destroyAllLightmaps=function(){for(var e=Object.keys(this._engine.display.lightmaps.lightmaps),t=0,r=e.length;t<r;t++)this.destroyLightmap(e[t])},SceneJS.Scene.prototype.setDeviceMatrix=function(e){var t=this._engine.display;t.hasDeviceMatrix=!!e,e&&t.deviceMatrix.set(e),t.imageDirty=!0},SceneJS.Scene.prototype.getCamera=function(){return this._engine.display.camera},SceneJS.Scene.prototype.getViewMatrix=function(){return this._engine.display.viewMatrix},SceneJS.Scene.prototype.getProjectionMatrix=function(){return this._engine.display.projectionMatrix},SceneJS.Scene.prototype.setFogDensity=function(e){this._engine.display.fogDensity=e,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogStart=function(e){this._engine.display.fogParams[0]=e,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogEnd=function(e){this._engine.display.fogParams[1]=e,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogMin=function(e){this._engine.display.fogParams[2]=e,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogMax=function(e){this._engine.display.fogParams[3]=e,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogColor=function(e,t,r){this._engine.display.fogColor[0]=e,this._engine.display.fogColor[1]=t,this._engine.display.fogColor[2]=r,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogDensity=function(e){this._engine.display.fogColor[3]=e,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogMode=function(e){this._engine.display.fogMode=e,this._engine.branchDirty(this),this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setFogEnabled=function(e){this._engine.display.fogEnabled=e,this._engine.branchDirty(this),this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.setXrayColor=function(e,t,r){this._engine.display.xrayColor[0]=e,this._engine.display.xrayColor[1]=t,this._engine.display.xrayColor[2]=r,this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.mainFramebufferParams=function(e){this._engine.display.mainFramebufferParams=e||null},SceneJS.Scene.prototype.createFramebuffer=function(e,t){this._engine.display.createFramebuffer(e,t)},SceneJS.Scene.prototype.destroyFramebuffer=function(e){this._engine.display.destroyFramebuffer(e)},SceneJS.Scene.prototype.getPostProcessStage=function(e){return this._engine.display.getPostProcessStage(e)},SceneJS.Scene.prototype.createPostProcessType=function(e,t,r){this._engine.display.createPostProcessType(e,t,r)},SceneJS.Scene.prototype.postProcessOpaque=function(e){this._engine.display.postProcessOpaque(e)},SceneJS.Scene.prototype.postProcessFinal=function(e){this._engine.display.postProcessFinal(e)},SceneJS.Scene.prototype.setNumPasses=function(e){this._engine.setNumPasses(e)},SceneJS.Scene.prototype.setClearEachPass=function(e){this._engine.setClearEachPass(e)},SceneJS.Scene.prototype.setViewport=function(e,t,r,a){this._engine.display.setViewport(e,t,r,a)},SceneJS.Scene.prototype.render=function(e){return this._engine.render(e)},SceneJS.Scene.prototype.pauseCompilation=function(){return this._engine.pauseCompilation()},SceneJS.Scene.prototype.resumeCompilation=function(){return this._engine.resumeCompilation()},SceneJS.Scene.prototype.compile=function(){return this._engine.compile()},SceneJS.Scene.prototype.needFrame=function(){this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.start=function(e){this._engine.start(e)},SceneJS.Scene.prototype.pick=function(){var e;if(SceneJS._isNumeric(arguments[0])){var t=arguments[0],r=arguments[1];(e=arguments[2]||{}).canvasPos=new Float32Array([t,r])}else e=arguments[0]||{};var a=this._engine.pick(e);if(this.render({force:!0}),a)return this.publish("pick",a),a;this.publish("nopick")},SceneJS.Scene.prototype.readPixels=function(e,t,r){return this._engine.readPixels(e,t,r)},SceneJS.Scene.prototype._destroy=function(){this.destroyed||(delete SceneJS._engines[this.id],SceneJS._engineIds.removeItem(this.id),this.destroyed=!0)},SceneJS.Scene.prototype.isActive=function(){return!this._engine.destroyed},SceneJS.Scene.prototype.stop=function(){this._engine.stop()},SceneJS.Scene.prototype.containsNode=function(e){return!!this._engine.findNode(e)},SceneJS.Scene.prototype.findNodes=function(e){return this._engine.findNodes(e)},SceneJS.Scene.prototype.findNode=function(e){return this.getNode(e)},SceneJS.Scene.prototype.getNode=function(e){return this._engine.findNode(e)},SceneJS.Scene.prototype.hasCore=function(e,t){return this._engine.hasCore(e,t)},SceneJS.Scene.prototype.publish=function(e,t,r){if(r||(this._topicPubs[e]=t),this._topicSubs[e]){var a=this._topicSubs[e];for(var i in a)a.hasOwnProperty(i)&&a[i].call(this,t)}},SceneJS.Scene.prototype.unpublish=function(e){var t=this._topicSubs[e];if(t)for(var r in t)t.hasOwnProperty(r)&&t[r].call(this,null);delete this._topicPubs[e]},SceneJS.Scene.prototype.on=function(e,t){var r=this._topicSubs[e];r||(this._topicSubs[e]=r={});var a=this._handleMap.addItem();r[a]=t,this._handleTopics[a]=e;var i=this._topicPubs[e];return i&&t.call(this,i),"rendered"==e&&this._engine.branchDirty(this),a},SceneJS.Scene.prototype.off=function(e){var t=this._handleTopics[e];if(t){delete this._handleTopics[e];var r=this._topicSubs[t];r&&delete r[e],this._handleMap.removeItem(e),"rendered"==t&&this._engine.branchDirty(this)}},SceneJS.Scene.prototype.once=function(e,t){var r=this,a=this.on(e,(function(e){r.off(a),t(e)}))}}(),function(){"use strict";var e={type:"texture",stateId:SceneJS._baseStateId++,empty:!0,hash:""};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(t){t.engine.display.texture=e,r=0}));var t=[],r=0,a=null,i=null,n=null,o=null,s=SceneJS.TEXTURE_FLAGS;function l(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function c(e,t){return(e=Math.max(e,16))*(t=Math.max(t,8))/4}function u(e,t){return(e=Math.max(e,8))*(t=Math.max(t,8))/2}function _(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8}function h(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16}SceneJS.TextureMap=SceneJS_NodeFactory.createNodeType("texture"),SceneJS.TextureMap.prototype._init=function(e){if(1==this._core.useCount){var t=e.applyFrom||"uv";"uv"!==t.substring(0,2)&&SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value is unsupported - should be 'uv<index>'");var r=0;if("uv"!==t&&(r=parseInt(t.substring(2)),isNaN(r)&&SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value invalid - should be 'uv<index>'")),e.applyTo){var a=e.applyTo;"baseColor"!=a&&"color"!=a&&"occlusion"!=a&&"specular"!=a&&"emit"!=a&&"alpha"!=a&&"normals"!=a&&"shine"!=a&&"transparency"!=a&&"metallic"!=a&&"roughness"!=a&&"metallicRoughness"!=a&&SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyTo value is unsupported: "+a)}e.blendMode&&"add"!=e.blendMode&&"multiply"!=e.blendMode&&"over"!=e.blendMode&&"conditionalAlpha"!=e.blendMode&&SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer blendMode value is unsupported - should be either 'add' or 'multiply'"),"color"==e.applyTo&&(e.applyTo="baseColor");var i=s[e.applyTo||"baseColor"]|s[e.blendMode||"multiply"];if(e.swizzledNormals&&(i|=s.swizzledNormals),SceneJS._apply({waitForLoad:null==e.waitForLoad||e.waitForLoad,texture:null,minFilter:e.minFilter,magFilter:e.magFilter,wrapS:e.wrapS,wrapT:e.wrapT,flipY:e.flipY,uvLayerIdx:r,isNormalMap:"normals"===e.applyTo,isAlphaMap:"alpha"===e.applyTo,isTransparencyMap:"transparency"===e.applyTo,flags:i,blendFactor:null!=e.blendFactor&&null!=e.blendFactor?e.blendFactor:1},this._core),this._initTexture(e.preloadColor),e.compressedImage)this.setCompressedImage(e.compressedImage,e.containerFormat,e.compressedSrc);else if(e.compressedSrc){var n;this._core.compressedSrc=e.compressedSrc,"dds"===e.containerFormat?n=this._parseDDS:"pvr"===e.containerFormat?n=this._parsePVR:"ktx"===e.containerFormat?n=this._parseKTX:SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"Compressed textures require containerFormat parameter to be 'dds' or 'pvr'"),SceneJS._loadBinary(e.compressedSrc,n.bind(this))}else e.image?this._setTextureImage(e.image):e.src&&(this._core.src=e.src,this._loadTexture(e.src,e.preloadSrc));this._core.mipMapLevels=0,this._core.drawTexture=e.drawTexture||!1,this._core.webglRestored=function(e,t,r,a){return function(){var i;t.compressedSrc?(e._initTexture(r),"dds"===a?i=e._parseDDS:"pvr"===a&&(i=e._parsePVR),SceneJS._loadBinary(t.compressedSrc,i.bind(this))):t.image?(e._initTexture(r),e._setTextureImage(t.image)):t.src&&(e._initTexture(r),e._loadTexture(t.src))}}(this,this._core,e.preloadColor,e.containerFormat)}},SceneJS.TextureMap.prototype._initTexture=function(e){var t=this._engine.canvas.gl;(e=e||{r:.57735,g:.57735,b:.57735}).a=void 0===e.a?1:e.a,e=new Uint8Array([Math.floor(255*e.r),Math.floor(255*e.g),Math.floor(255*e.b),Math.floor(255*e.a)]),this._core.width=1,this._core.height=1;var r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,e),this._setCoreTexture(r)},SceneJS.TextureMap.prototype._loadTexture=function(e,t){var r=this,a=new Image,i=!1;if(t){var n=new Image;n.onload=function(){i||(r._setTextureImage(n),r._engine.display.imageDirty=!0)},n.src=t}a.onload=function(){r._setTextureImage(a),i=!0,r._engine.display.imageDirty=!0},a.src=e},SceneJS.TextureMap.prototype._setTextureImage=function(e){var t=this._engine.canvas.gl,r=this._core,a=r.texture&&r.texture.texture?r.texture.texture:t.createTexture();t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),r.width=e.width,r.height=e.height,this._setCoreTexture(a),this._gatherStats(e.width,e.height,e.width*e.height*4)},SceneJS.TextureMap.prototype._setCompressedTextureImage=function(e,t,r,i,n,o,s){var l=this._engine.canvas.gl,c=this._core,u=c.texture&&c.texture.texture?c.texture.texture:l.createTexture();SceneJS._getExtension(l,t)||SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Compressed texture format "+t+"not available."),l.bindTexture(l.TEXTURE_2D,u);var _=0;this._core.width=i,this._core.height=n,this._core.mipMapLevels=o,this._core.compressed=!0;for(var h=a.SIZE_FUNCTIONS[r],f=i,d=n,p=0;p<o;++p){var m=0;s?(m=e[_]+(e[_+1]<<8)+(e[_+2]<<16)+(e[_+3]<<24),_+=4):m=h(f,d);var g=new Uint8Array(e.buffer,e.byteOffset+_,m);l.compressedTexImage2D(l.TEXTURE_2D,p,r,f,d,0,g),f/=2,d/=2,_+=m}this._setCoreTexture(u),this._gatherStats(i,n,e.byteLength)},SceneJS.TextureMap.prototype._gatherStats=function(e,t,r){this._engine.stats.memory.textures+=r;var a=this._engine.stats.textures,i=e+"x"+t,n=this._getTextureTarget(),o=a[n]=a[n]||{};o[i]=(o[i]||0)+1,o.memory=(o.memory||0)+r},SceneJS.TextureMap.prototype._setCoreTexture=function(e){var t=this._engine.canvas.gl,r=SceneJS_math_isPOT(this._core.width)&SceneJS_math_isPOT(this._core.height),a=r?t.REPEAT:t.CLAMP_TO_EDGE;this._core.texture=new SceneJS._webgl.Texture2D(t,{texture:e,minFilter:this._getGLOption("minFilter",1!==this._core.mipMapLevels&&r?t.LINEAR_MIPMAP_NEAREST:t.LINEAR),magFilter:this._getGLOption("magFilter",t.LINEAR),wrapS:this._getGLOption("wrapS",a),wrapT:this._getGLOption("wrapT",a),compressed:this._core.compressed,flipY:this._core.flipY,update:null}),this.destroyed&&this._core.texture.destroy(),this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype._getTextureTarget=function(){var e=this._core.flags;return e&s.baseColor?"baseColor":e&s.occlusion?"occlusion":e&s.normals?"normals":e&s.alpha?"alpha":e&s.specular?"specular":e&s.emit?"emit":e&s.shine?"shine":e&s.transparency?"transparency":e&s.metallic?"metallic":e&s.roughness?"roughness":e&s.metallicRoughness?"metallicRoughness":void 0},SceneJS.TextureMap.prototype._getGLOption=function(e,t){var r=this._engine.canvas.gl,a=this._core[e];if(null==a)return t;var i=SceneJS._webgl.enumMap[a];return null==i&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Unrecognised value for texture node property '"+e+"' value: '"+a+"'"),r[i]},SceneJS.TextureMap.prototype._getOption=function(e,t){return null==e?t:e},SceneJS.TextureMap.prototype.setSrc=function(e){this._core.image=null,this._core.src=e,this._core.target=null,this._loadTexture(e)},SceneJS.TextureMap.prototype.setImage=function(e){this._core.src=null,this._core.target=null,this._setTextureImage(e)},SceneJS.TextureMap.prototype.setCompressedImage=function(e,t,r){this._core.src=null,this._core.image=null,this._core.target=null,this._core.compressedSrc=r,"dds"===t?this._parseDDS(e):"pvr"===t?this._parsePVR(e):this._parseKTX(e)},SceneJS.TextureMap.prototype.setTarget=function(e){"colorTarget"==e.type||"depthTarget"==e.type?(delete this._core.src,this._core.target=e,this._core.src=null,this._core.image=null,this._core.texture=e._core.renderBuf.getTexture(),this._core.texture.bufType=e._core.bufType,this._engine.display.imageDirty=!0):console.log("Target node type not compatible: "+e.type)},SceneJS.TextureMap.prototype.setBlendFactor=function(e){this._core.blendFactor=e,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getBlendFactor=function(){return this._core.blendFactor},SceneJS.TextureMap.prototype.setTranslate=function(e){this._core.translate||(this._core.translate={x:0,y:0}),this._core.translate.x=e.x,this._core.translate.y=e.y,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getTranslate=function(){return this._core.translate},SceneJS.TextureMap.prototype.setScale=function(e){this._core.scale||(this._core.scale={x:0,y:0}),this._core.scale.x=e.x,this._core.scale.y=e.y,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getScale=function(){return this._core.scale},SceneJS.TextureMap.prototype.setRotate=function(e){this._core.rotate=e,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getRotate=function(){return this._core.rotate},SceneJS.TextureMap.prototype.getMatrix=function(){return this._core._matrixDirty&&this._core.buildMatrix.call(this.core)(),this.core.matrix},SceneJS.TextureMap.prototype._compile=function(a){this.__core||(this.__core=this._engine._coreFactory.getCore("texture"),this.__core.transparent=!1,this.__core.drawLayer=-1);var i=this._engine.display.texture;this._core.empty||(this.__core.layers=i&&i.layers?i.layers.concat([this._core]):[this._core],this.__core.transparent=this._core.isAlphaMap||this._core.isTransparencyMap||i.transparent,this._core.drawTexture&&(this.__core.drawLayerIndex=this.__core.layers.length-1)),this._makeHash(this.__core),t[r++]=this.__core,this._engine.display.texture=this.__core,this._compileNodes(a),this._engine.display.texture=--r>0?t[r-1]:e,t[r]=null},SceneJS.TextureMap.prototype._makeHash=function(e){var t=[];if(e.layers&&e.layers.length>0)for(var r,a=e.layers,i=0,n=a.length;i<n;i++)r=a[i],t.push("/"),t.push(r.uvLayerIdx),t.push("/"),t.push(r.flags),r.matrix&&t.push("/anim"),r.compressed&&t.push("/comp"),"normals"===r.applyTo&&SceneJS.WEBGL_INFO.standardDerivativesSupported&&t.push("/gt");var o=t.join("");e.hash!=o&&(e.hash=o)},SceneJS.TextureMap.prototype._destroy=function(){1==this._core.useCount&&(this._core.texture&&!this._core.target&&(this._core.texture.destroy(),this._core.texture=null),this._engine.stats.memory.textures--)},SceneJS.TextureMap.prototype._parseDDS=function(e){i||SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"DXT compressed textures not supported on this platform.");var t=new Uint32Array(e,0,i.HEADER_LENGTH);t[i.MAGIC_NUMBER_INDEX]!=i.MAGIC_NUMBER&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid DDS File: Magic number invalid."),t[i.PIXEL_FORMAT_FLAGS_INDEX]&0===i.PIXEL_FORMAT_FOURCC_FLAG&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid DDS File: FourCC required.");var r=i.FOURCC_MAP[t[i.PIXEL_FORMAT_FOURCC_INDEX]],a=i.EXTENSION_MAP[t[i.PIXEL_FORMAT_FOURCC_INDEX]],n=1;t[i.FLAGS_INDEX]&i.MIPMAPCOUNT_FLAG&&(n=t[i.MIPMAPCOUNT_INDEX]);var o=t[i.WIDTH_INDEX],s=t[i.HEIGHT_INDEX],l=new Uint8Array(e,i.DATA_OFFSET);this._setCompressedTextureImage(l,a,r,o,s,n)},SceneJS.TextureMap.prototype._parsePVR=function(e){var t=new Uint32Array(e,0,n.HEADER_LENGTH);t[n.MAGIC_NUMBER_INDEX]!=n.MAGIC_NUMBER&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid PVR File: Magic number invalid.");var r=t[n.PIXEL_FORMAT_INDEX],a=n.EXTENSION_MAP[r],i=n.FORMAT_MAP[r],o=t[n.MIPMAPCOUNT_INDEX],s=t[n.WIDTH_INDEX],l=t[n.HEIGHT_INDEX],c=new Uint8Array(e,n.HEADER_SIZE+t[n.METADATA_SIZE_INDEX]);this._setCompressedTextureImage(c,a,i,s,l,o)},SceneJS.TextureMap.prototype._parseKTX=function(e){for(var t=new Uint32Array(e,0,o.HEADER_LENGTH),r=0;r<o.IDENTIFIER_LENGTH;++r)t[r]!=o.IDENTIFIER[r]&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid KTX File: Identifier invalid.");var a=t[o.INTERNAL_FORMAT_INDEX],i=o.EXTENSION_MAP[a],n=t[o.MIPMAPCOUNT_INDEX],s=t[o.WIDTH_INDEX],l=t[o.HEIGHT_INDEX],c=new Uint8Array(e,o.HEADER_SIZE+t[o.KEY_VALUE_SIZE_INDEX]);this._setCompressedTextureImage(c,i,a,s,l,n,!0)},function(){var e,t=document.createElement("canvas");if(t){var r=t.getContext("webgl")||t.getContext("experimental-webgl");r&&(a=function(e){var t=SceneJS._getExtension(e,"WEBGL_compressed_texture_pvrtc"),r=SceneJS._getExtension(e,"WEBGL_compressed_texture_etc1"),a=SceneJS._getExtension(e,"WEBGL_compressed_texture_s3tc"),i={PVRTC_SUPPORTED:!!t,ETC1_SUPPORTED:!!r,DXT_SUPPORTED:!!a,FORMAT_ENUMS:{},SIZE_FUNCTIONS:{}};return i.PVRTC_SUPPORTED&&(i.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,i.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,i.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,i.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,i.SIZE_FUNCTIONS[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=c,i.SIZE_FUNCTIONS[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=c,i.SIZE_FUNCTIONS[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=u,i.SIZE_FUNCTIONS[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=u),i.ETC1_SUPPORTED&&(i.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL=r.COMPRESSED_RGB_ETC1_WEBGL,i.SIZE_FUNCTIONS[r.COMPRESSED_RGB_ETC1_WEBGL]=_),i.DXT_SUPPORTED&&(i.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT=a.COMPRESSED_RGB_S3TC_DXT1_EXT,i.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT=a.COMPRESSED_RGBA_S3TC_DXT3_EXT,i.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT=a.COMPRESSED_RGBA_S3TC_DXT5_EXT,i.SIZE_FUNCTIONS[a.COMPRESSED_RGB_S3TC_DXT1_EXT]=_,i.SIZE_FUNCTIONS[a.COMPRESSED_RGBA_S3TC_DXT3_EXT]=h,i.SIZE_FUNCTIONS[a.COMPRESSED_RGBA_S3TC_DXT5_EXT]=h),i}(r),i=function(){var e={MAGIC_NUMBER:542327876,MIPMAPCOUNT_FLAG:131072,PIXEL_FORMAT_FOURCC_FLAG:4,HEADER_LENGTH:31,MAGIC_NUMBER_INDEX:0,SIZE_INDEX:1,FLAGS_INDEX:2,HEIGHT_INDEX:3,WIDTH_INDEX:4,MIPMAPCOUNT_INDEX:7,PIXEL_FORMAT_FLAGS_INDEX:20,PIXEL_FORMAT_FOURCC_INDEX:21,DATA_OFFSET:128,FOURCC_MAP:{},EXTENSION_MAP:{}};if(a.DXT_SUPPORTED){var t=l("DXT1"),r=l("DXT3"),i=l("DXT5");e.FOURCC_MAP[t]=a.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT,e.FOURCC_MAP[r]=a.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT,e.FOURCC_MAP[i]=a.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT,e.EXTENSION_MAP[t]="WEBGL_compressed_texture_s3tc",e.EXTENSION_MAP[r]="WEBGL_compressed_texture_s3tc",e.EXTENSION_MAP[i]="WEBGL_compressed_texture_s3tc"}if(a.ETC1_SUPPORTED){var n=l("ETC1");e.FOURCC_MAP[n]=a.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL,e.EXTENSION_MAP[n]="WEBGL_compressed_texture_etc1"}return e}(),e={MAGIC_NUMBER:55727696,HEADER_LENGTH:13,HEADER_SIZE:52,MAGIC_NUMBER_INDEX:0,PIXEL_FORMAT_INDEX:2,HEIGHT_INDEX:6,WIDTH_INDEX:7,MIPMAPCOUNT_INDEX:11,METADATA_SIZE_INDEX:12,EXTENSION_MAP:{0:"WEBGL_compressed_texture_pvrtc",1:"WEBGL_compressed_texture_pvrtc",2:"WEBGL_compressed_texture_pvrtc",3:"WEBGL_compressed_texture_pvrtc",6:"WEBGL_compressed_texture_etc1",7:"WEBGL_compressed_texture_s3tc",9:"WEBGL_compressed_texture_s3tc",11:"WEBGL_compressed_texture_s3tc"},FORMAT_MAP:{}},a.PVRTC_SUPPORTED&&(e.FORMAT_MAP[0]=a.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,e.FORMAT_MAP[1]=a.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,e.FORMAT_MAP[2]=a.FORMAT_ENUMS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,e.FORMAT_MAP[3]=a.FORMAT_ENUMS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG),a.ETC1_SUPPORTED&&(e.FORMAT_MAP[6]=a.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL),a.DXT_SUPPORTED&&(e.FORMAT_MAP[7]=a.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT,e.FORMAT_MAP[9]=a.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT,e.FORMAT_MAP[11]=a.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT),n=e,o=function(){var e=new Uint8Array([171,75,84,88,32,49,49,187,13,10,26,10]),t={IDENTIFIER:new Uint32Array(e.buffer),IDENTIFIER_LENGTH:3,HEADER_LENGTH:16,HEADER_SIZE:64,INTERNAL_FORMAT_INDEX:7,WIDTH_INDEX:9,HEIGHT_INDEX:10,MIPMAPCOUNT_INDEX:14,KEY_VALUE_SIZE_INDEX:15,EXTENSION_MAP:{}};return a.DXT_SUPPORTED&&(t.EXTENSION_MAP[a.FORMAT_ENUMS.COMPRESSED_RGB_S3TC_DXT1_EXT]="WEBGL_compressed_texture_s3tc",t.EXTENSION_MAP[a.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT3_EXT]="WEBGL_compressed_texture_s3tc",t.EXTENSION_MAP[a.FORMAT_ENUMS.COMPRESSED_RGBA_S3TC_DXT5_EXT]="WEBGL_compressed_texture_s3tc"),a.ETC1_SUPPORTED&&(t.EXTENSION_MAP[a.FORMAT_ENUMS.COMPRESSED_RGB_ETC1_WEBGL]="WEBGL_compressed_texture_etc1"),t}())}}()}(),function(){"use strict";var e=SceneJS.TEXTURE_FLAGS,t={type:"fresnel",stateId:SceneJS._baseStateId++,power:1,centerColor:new Float32Array([1,1,1,1]),edgeColor:new Float32Array([0,0,0,0]),blendFactor:1,blendMode:e.multiply,empty:!0,hash:""};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(e){e.engine.display.fresnel=t,a=0}));var r=[],a=0;SceneJS.Fresnel=SceneJS_NodeFactory.createNodeType("fresnel"),SceneJS.Fresnel.prototype._init=function(r){1==this._core.useCount&&(r.applyTo&&"color"!=r.applyTo&&"specular"!=r.applyTo&&"alpha"!=r.applyTo&&"reflect"!=r.applyTo&&"emit"!=r.applyTo&&"fragment"!=r.applyTo&&"transparency"!=r.applyTo&&SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"fresnel applyTo value is unsupported - should be either 'color', 'specular', 'alpha', 'reflect', 'emit' or 'fragment'"),this._core.applyTo=r.applyTo,r.blendMode&&"add"!=r.blendMode&&"multiply"!=r.blendMode&&SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer blendMode value is unsupported - should be either 'add' or 'multiply'"),this._core.blendMode=e[r.blendMode||"multiply"],this._core.centerColor=new Float32Array(t.centerColor),this._core.edgeColor=new Float32Array(t.edgeColor),this._core.power=t.power,null!=r.centerBias&&this.setCenterBias(r.centerBias),null!=r.edgeBias&&this.setEdgeBias(r.edgeBias),null!=r.power&&this.setPower(r.power),null!=r.centerColor&&this.setCenterColor(r.centerColor),null!=r.edgeColor&&this.setEdgeColor(r.edgeColor))},SceneJS.Fresnel.prototype.getApplyTo=function(){return this._core.applyTo},SceneJS.Fresnel.prototype.setCenterBias=function(e){this._core.centerColor[3]=void 0!==e?e:t.centerColor[3],this._engine.display.imageDirty=!0},SceneJS.Fresnel.prototype.getCenterBias=function(){return this._core.centerColor[3]},SceneJS.Fresnel.prototype.setEdgeBias=function(e){this._core.edgeColor[3]=void 0!==e?e:t.edgeColor[3],this._engine.display.imageDirty=!0},SceneJS.Fresnel.prototype.getEdgeBias=function(){return this._core.edgeColor[3]},SceneJS.Fresnel.prototype.setPower=function(e){this._core.power=void 0!==e?e:t.power,this._engine.display.imageDirty=!0},SceneJS.Fresnel.prototype.getPower=function(){return this._core.power},SceneJS.Fresnel.prototype.setCenterColor=function(e){var r=t.centerColor;return this._core.centerColor[0]=null!=e.r?e.r:r[0],this._core.centerColor[1]=null!=e.g?e.g:r[1],this._core.centerColor[2]=null!=e.b?e.b:r[2],this._engine.display.imageDirty=!0,this},SceneJS.Fresnel.prototype.getCenterColor=function(){return{r:this._core.centerColor[0],g:this._core.centerColor[1],b:this._core.centerColor[2]}},SceneJS.Fresnel.prototype.setEdgeColor=function(e){var r=t.edgeColor;return this._core.edgeColor[0]=null!=e.r?e.r:r[0],this._core.edgeColor[1]=null!=e.g?e.g:r[1],this._core.edgeColor[2]=null!=e.b?e.b:r[2],this._engine.display.imageDirty=!0,this},SceneJS.Fresnel.prototype.getEdgeColor=function(){return{r:this._core.edgeColor[0],g:this._core.edgeColor[1],b:this._core.edgeColor[2]}},SceneJS.Fresnel.prototype._compile=function(e){this.__core||(this.__core=this._engine._coreFactory.getCore("fresnel"),this.__core.transparent=!1,this.__core.partiallyOpaque=!1);var i=this._engine.display.fresnel;this._core.empty||(this.__core.diffuse="color"==this._core.applyTo?this._core:i.diffuse,this.__core.specular="specular"==this._core.applyTo?this._core:i.specular,this.__core.alpha="alpha"==this._core.applyTo?this._core:i.alpha,this.__core.reflect="reflect"==this._core.applyTo?this._core:i.reflect,this.__core.emit="emit"==this._core.applyTo?this._core:i.emit,this.__core.fragment="fragment"==this._core.applyTo?this._core:i.fragment,this.__core.transparency="transparency"==this._core.applyTo?this._core:i.transparency,this.__core.transparent=i.transparent,this.__core.partiallyOpaque=i.partiallyOpaque,"alpha"!=this._core.applyTo&&"transparency"!=this._core.applyTo||(this.__core.transparent=!0,(this._core.centerColor[0]>=1||this._core.edgeColor[0]>=1)&&(this.__core.partiallyOpaque=!0))),this._makeHash(this.__core),r[a++]=this.__core,this._engine.display.fresnel=this.__core,this._compileNodes(e),this._engine.display.fresnel=--a>0?r[a-1]:t,r[a]=null},SceneJS.Fresnel.prototype._makeHash=function(e){var t=[];e.diffuse&&t.push("d"+e.diffuse.blendMode+";"),e.specular&&t.push("s"+e.specular.blendMode+";"),e.alpha&&t.push("a"+e.alpha.blendMode+";"),e.reflect&&t.push("r"+e.reflect.blendMode+";"),e.emit&&t.push("e"+e.emit.blendMode+";"),e.fragment&&t.push("f"+e.fragment.blendMode+";"),e.transparency&&t.push("t"+e.transparency.blendMode+";"),t.push(e.blendMode+";"),t=t.join(""),e.hash!=t&&(e.hash=t)},SceneJS.Fresnel.prototype._destroy=function(){}}(),function(){"use strict";var e={type:"cubemap",stateId:SceneJS._baseStateId++,empty:!0,texture:null,space:"world",hash:""},t=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(t){t.engine.display.cubemap=e,r=0})),SceneJS.Cubemap=SceneJS_NodeFactory.createNodeType("cubemap"),SceneJS.Cubemap.prototype._init=function(e){if(1===this._core.useCount){this._core.hash="y",e.blendMode&&"add"!==e.blendMode&&"multiply"!==e.blendMode&&SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"cubemap blendMode value is unsupported - should be either 'add' or 'multiply'");var t=e.applyTo||"reflect";"reflect"!==t&&"light"!==t&&SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"cubemap applyTo value is unsupported - should be either 'reflect' or 'light'"),this._core.blendMode=e.blendMode||"multiply",this._core.intensity=null!=e.intensity&&null!=e.intensity?e.intensity:1,this._core.applyTo=SceneJS.CUBEMAP_FLAGS[t];var r=e.space||"world";"view"!==r&&"world"!==r&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"cubemap 'space' value is unsupported: '"+r+"' - should be 'view' or 'world'"),"view"===r&&"reflect"===t&&(r="world;"),this._core.space=r;for(var a=this,i=this._engine.canvas.gl,n=i.createTexture(),o=[i.TEXTURE_CUBE_MAP_POSITIVE_X,i.TEXTURE_CUBE_MAP_NEGATIVE_X,i.TEXTURE_CUBE_MAP_POSITIVE_Y,i.TEXTURE_CUBE_MAP_NEGATIVE_Y,i.TEXTURE_CUBE_MAP_POSITIVE_Z,i.TEXTURE_CUBE_MAP_NEGATIVE_Z],s=new Array(6),l=!1,c=6,u=0;u<o.length;u++){var _=new Image;_.onload=function(e){var t=_;return function(){if(!l&&(s[e]=t,0==--c)){i.bindTexture(i.TEXTURE_CUBE_MAP,n),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1);for(var r=0,u=s.length;r<u;r++)i.texImage2D(o[r],0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,s[r]);a._core.texture=new SceneJS._webgl.Texture2D(i,{texture:n,target:i.TEXTURE_CUBE_MAP,minFilter:i.LINEAR_MIPMAP_LINEAR,magFilter:i.LINEAR,wrapS:i.CLAMP_TO_EDGE,wrapT:i.CLAMP_TO_EDGE});var _=Math.min(t.width,t.height);a._core.mipLevels=SceneJS_math_log2(_),a._engine.display.imageDirty=!0}}}(u),_.onerror=function(){l=!0},_.src=e.src[u]}}},SceneJS.Cubemap.prototype._compile=function(a){this.__core||(this.__core=this._engine._coreFactory.getCore("cubemap"));var i=this._engine.display.cubemap;this._core.empty||(this.__core.layers=i&&i.layers?i.layers.concat([this._core]):[this._core]),this._makeHash(this.__core),t[r++]=this.__core,this._engine.display.cubemap=this.__core,this._compileNodes(a),this._engine.display.cubemap=--r>0?t[r-1]:e,t[r]=null},SceneJS.Cubemap.prototype._makeHash=function(e){var t;if(e.layers&&e.layers.length>0){for(var r,a=e.layers,i=[],n=0,o=a.length;n<o;n++)r=a[n],i.push("/"),i.push(r.applyTo),i.push("/"),i.push(r.space),i.push("/"),i.push(r.blendMode);t=i.join("")}else t="";e.hash!=t&&(e.hash=t)},SceneJS.Cubemap.prototype._destroy=function(){1==this._core.useCount&&this._core.texture&&(this._core.texture.destroy(),this._core.texture=null)}}(),function(){"use strict";var e={type:"regionMap",stateId:SceneJS._baseStateId++,empty:!0,texture:null,regionColor:[-1,-1,-1],highlightFactor:[1.5,1.5,0],hideAlpha:0,regionData:[],mode:"info",hash:""};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(t){t.engine.display.regionMap=e}));var t={info:!0,highlight:!0,hide:!0,isolate:!0};SceneJS.RegionMap=SceneJS_NodeFactory.createNodeType("regionMap"),SceneJS.RegionMap.prototype._init=function(e){var t=this;if(1==this._core.useCount){SceneJS._apply({regionMap:null},this._core);var r=e.applyFrom||"uv";"uv"!==r.substring(0,2)&&SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value is unsupported - should be 'uv<index>'");var a=0;"uv"!==r&&(a=r.substring(2),isNaN(a)&&SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value invalid - should be 'uv<index>'")),this._core.uvLayerIdx=a,e.src?(this._initTexture(),this._core.src=e.src,this._loadTexture(e.src)):e.image&&(this._initTexture(e.preloadColor),this._core.image=e.image,this._setTextureImage(e.image)),this._core.webglRestored=function(){t._core.image?(t._initTexture(),t._setTextureImage(t._core.image)):t._core.src&&(t._initTexture(),t._loadTexture(t._core.src))},this.setRegionColor(e.regionColor),this.setHighlightFactor(e.highlightFactor),this.setHideAlpha(e.hideAlpha),this.setRegionData(e.regionData),this.setMode(e.mode)}},SceneJS.RegionMap.prototype._initTexture=function(){var e=this._engine.canvas.gl,t={r:.57735,g:.57735,b:.57735};t.a=void 0===t.a?1:t.a,t=new Uint8Array([Math.floor(255*t.r),Math.floor(255*t.g),Math.floor(255*t.b),Math.floor(255*t.a)]);var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,t),this._setCoreTexture(r)},SceneJS.RegionMap.prototype._loadTexture=function(e){var t=this,r=new Image;r.onload=function(){t._setTextureImage(r),t._engine.display.imageDirty=!0},this._fetchImage(r,e)},SceneJS.RegionMap.prototype._fetchImage=function(e,t){0==t.indexOf("data")||(e.crossOrigin="Anonymous"),e.src=t},SceneJS.RegionMap.prototype._setTextureImage=function(e){var t=this._engine.canvas.gl,r=this._core.texture?this._core.texture.texture:t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),this._core.image=e,this._setCoreTexture(r)},SceneJS.RegionMap.prototype._setCoreTexture=function(e){var t=this._engine.canvas.gl;this._core.texture=new SceneJS._webgl.Texture2D(t,{texture:e,minFilter:this._getGLOption("minFilter",t.NEAREST_MIPMAP_NEAREST),magFilter:this._getGLOption("magFilter",t.NEAREST),wrapS:this._getGLOption("wrapS",t.REPEAT),wrapT:this._getGLOption("wrapT",t.REPEAT),isDepth:this._getOption(this._core.isDepth,!1),depthMode:this._getGLOption("depthMode",t.LUMINANCE),depthCompareMode:this._getGLOption("depthCompareMode",t.COMPARE_R_TO_TEXTURE),depthCompareFunc:this._getGLOption("depthCompareFunc",t.LEQUAL),flipY:this._getOption(this._core.flipY,!0),width:this._getOption(this._core.width,1),height:this._getOption(this._core.height,1),internalFormat:this._getGLOption("internalFormat",t.ALPHA),sourceFormat:this._getGLOption("sourceFormat",t.ALPHA),sourceType:this._getGLOption("sourceType",t.UNSIGNED_BYTE),update:null}),this.destroyed&&this._core.texture.destroy(),this._engine.display.imageDirty=!0},SceneJS.RegionMap.prototype._getGLOption=function(e,t){var r=this._engine.canvas.gl,a=this._core[e];if(null==a)return t;var i=SceneJS._webgl.enumMap[a];return null==i&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Unrecognised value for texture node property '"+e+"' value: '"+a+"'"),r[i]},SceneJS.RegionMap.prototype._getOption=function(e,t){return null==e?t:e},SceneJS.RegionMap.prototype.setSrc=function(e){this._core.image=null,this._core.src=e,this._core.target=null,this._loadTexture(e)},SceneJS.RegionMap.prototype.setImage=function(e){this._core.image=e,this._core.src=null,this._core.target=null,this._setTextureImage(e)},SceneJS.RegionMap.prototype.setTarget=function(e){"colorTarget"==e.type||"depthTarget"==e.type?(delete this._core.src,this._core.target=e,this._core.src=null,this._core.image=null,this._core.texture=e._core.renderBuf.getTexture(),this._core.texture.bufType=e._core.bufType,this._engine.display.imageDirty=!0):console.log("Target node type not compatible: "+e.type)},SceneJS.RegionMap.prototype.setRegionColor=function(t){var r=e.regionColor;return this._core.regionColor=t?[null!=t.r&&null!=t.r?t.r:r[0],null!=t.g&&null!=t.g?t.g:r[1],null!=t.b&&null!=t.b?t.b:r[2]]:e.regionColor,this._engine.display.imageDirty=!0,this},SceneJS.RegionMap.prototype.setHighlightFactor=function(t){var r=e.highlightFactor;return this._core.highlightFactor=t?[null!=t.r&&null!=t.r?t.r:r[0],null!=t.g&&null!=t.g?t.g:r[1],null!=t.b&&null!=t.b?t.b:r[2]]:e.highlightFactor,this._engine.display.imageDirty=!0,this},SceneJS.RegionMap.prototype.setHideAlpha=function(t){return this._core.hideAlpha=null!=t?t:e.hideAlpha,this._engine.display.imageDirty=!0,this},SceneJS.RegionMap.prototype.setMode=function(r){var a=!!this._core.transparent;return this._core.mode=r&&t[r]?r:e.mode,this._core.transparent="hide"===this._core.mode||"isolate"===this._core.mode,a!==this._core.transparent&&(this._engine.display.objectListDirty=!0),this._engine.branchDirty(this),this._engine.display.imageDirty=!0,this._core.hash="reg-"+r,this},SceneJS.RegionMap.prototype.setRegionData=function(t){return this._core.regionData=t||e.regionData,this},SceneJS.RegionMap.prototype._compile=function(e){var t=this._engine.display.regionMap;this._engine.display.regionMap=this._core,this._compileNodes(e),this._engine.display.regionMap=t},SceneJS.RegionMap.prototype._destroy=function(){1==this._core.useCount&&this._core.texture&&!this._core.target&&(this._core.texture.destroy(),this._core.texture=null)}}(),function(){"use strict";SceneJS.GlobalCubemap=function(e,t,r){this.scene=e,this.id=t,this.intensity=null!=r.intensity?r.intensity:1;var a=r.space||"world";"view"!==a&&"world"!==a&&(console.error("cubemap 'space' value is unsupported: '"+a+"' - should be 'view' or 'world' - defaulting to 'world'"),a="world"),this.space=a,this.hash=[this.space].join("");for(var i=this,n=e._engine.canvas.gl,o=n.createTexture(),s=[n.TEXTURE_CUBE_MAP_POSITIVE_X,n.TEXTURE_CUBE_MAP_NEGATIVE_X,n.TEXTURE_CUBE_MAP_POSITIVE_Y,n.TEXTURE_CUBE_MAP_NEGATIVE_Y,n.TEXTURE_CUBE_MAP_POSITIVE_Z,n.TEXTURE_CUBE_MAP_NEGATIVE_Z],l=new Array(6),c=!1,u=6,_=0;_<s.length;_++){var h=new Image;h.onload=function(t){var r=h;return function(){if(!c&&(l[t]=r,0==--u)){n.bindTexture(n.TEXTURE_CUBE_MAP,o),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);for(var a=0,_=l.length;a<_;a++)n.texImage2D(s[a],0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,l[a]);i.texture=new SceneJS._webgl.Texture2D(n,{texture:o,target:n.TEXTURE_CUBE_MAP,minFilter:n.LINEAR_MIPMAP_LINEAR,magFilter:n.LINEAR,wrapS:n.CLAMP_TO_EDGE,wrapT:n.CLAMP_TO_EDGE});var h=Math.min(r.width,r.height);i.mipLevels=SceneJS_math_log2(h),e._engine.display.imageDirty=!0}}}(_),h.onerror=function(){c=!0},h.src=r.src[_]}},SceneJS.GlobalCubemap.prototype.destroy=function(){this.texture&&(this.texture.destroy(),this.texture=null)}}(),function(){"use strict";var e=[],t=0,r={type:"xform",stateId:SceneJS._baseStateId++,matrix:mat4.create(),normalMatrix:mat4.create()};SceneJS.XForm=SceneJS_NodeFactory.createNodeType("xform"),SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,(function(e){e.engine.display.modelTransform=r,t=0})),SceneJS.XForm.prototype._init=function(e){1==this._core.useCount&&(this._core.matrix=mat4.create(),this._core.normalMatrix=mat4.create(),e.elements&&this.setElements(e.elements))},SceneJS.XForm.prototype.getMatrix=function(){return this._core.matrix},SceneJS.XForm.prototype.setElements=function(e){16!=e.length&&SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.XForm elements should number 16");var t=this._core;return t.matrix.set(e),mat4.invert(t.normalMatrix,t.matrix),mat4.transpose(t.normalMatrix,t.normalMatrix),this._engine.display.imageDirty=!0,this},SceneJS.XForm.prototype.getElements=function(){return this._core.matrix},SceneJS.XForm.prototype._compile=function(a){this._engine.display.modelTransform=e[t++]=this._core,this._compileNodes(a),this._engine.display.modelTransform=--t>0?e[t-1]:r,e[t]=null}}(),function(){"use strict";SceneJS.Types=new function(){this.addType=function(e,t){var r,a=SceneJS_NodeFactory.createNodeType(e);for(var i in t)if(t.hasOwnProperty(i))switch(r=t[i],i){case"init":case"construct":!function(){var e=t[i];a.prototype._init=function(t){e.call(this,t)},a.prototype._fromPlugin=!0}();break;case"destroy":case"destruct":a.prototype._destroy=r;break;default:a.prototype[i]=r}},this.hasType=function(e){return!!SceneJS_NodeFactory.nodeTypes[e]}}}(),function(){"use strict";var e,t,r,a,i,n,o,s,l,c,u=window.SceneJS_Display=function(e,t){this.stats=e||{},this._canvas=t.canvas,this._programFactory=new SceneJS_ProgramFactory(this.stats,{canvas:t.canvas}),this._chunkFactory=new SceneJS_ChunkFactory,this.transparent=!0===t.transparent,this.depthSort=!0===t.depthSort,this.autoTangents=!0===t.autoTangents,this.gammaInputPhong=!0===t.gammaInputPhong,this.properties=null,this.material=null,this.texture=null,this.fresnel=null,this.cubemap=null,this.modelTransform=null,this.regionMap=null,this.morphGeometry=null,this.geometry=null,this._objects={},this._ambientColor=[.7,.7,.8],this.projection={type:"perspective",fov:60,aspect:1,near:.1,far:500,pan:0},this.projectionMatrix=mat4.create(),this.buildProjectionMatrix(),this.camera={eye:new Float32Array([0,0,10]),look:new Float32Array([0,0,0]),up:new Float32Array([0,1,0])},this.viewMatrix=mat4.create(),this.hasDeviceMatrix=!1,this.deviceMatrix=mat4.create(),this.buildViewMatrix(),this.lights=[{mode:"dir",color:new Float32Array([1,1,1]),diffuse:!0,specular:!0,dir:new Float32Array([-.5,-.5,-1]),space:"view"},{mode:"dir",color:new Float32Array([1,1,1]),diffuse:!1,specular:!0,dir:new Float32Array([1,-.9,-.7]),space:"view"}],this.lightHash="dirsdv/dirsv/",this.clips={clips:[],clipFade:!1,clipDiscard:!1,enabled:!1},this.clipsHash="",this.reflections={reflections:{},activeReflection:null},this.reflectionsHash="",this.lightmaps={lightmaps:{},activeLightmap:null},this.lightmapsHash="",this.highlightColor=new Float32Array([1.5,1.5,.5]),this.desatParams=new Float32Array([.9,.3]),this.fogParams=new Float32Array([0,1e3,0,1]),this.fogColor=new Float32Array([1,1,1,.01]),this.fogEnabled=!1,this.xrayColor=new Float32Array([0,0,.1]),this.fogMode=SceneJS.DISPLAY_FLAGS.FOG_LINEAR,this.viewport=new Float32Array([0,0,this._canvas.canvas.width,this._canvas.canvas.height]),this._opaqueObjects=[],this._numOpaqueObjects=0,this._transparentObjects=[],this._numTransparentObjects=0,this._pickLookup=[],this._frameCtx={regionData:[],canvas:this._canvas,VAO:null},this.objectListDirty=!0,this.imageDirty=!0,this._nextProgramId=0,this.postProcessPipelineOpaque=[],this.postProcessPipelineTransparent=[],this.postProcessPipelineFinal=[],this._postProcessTypes={},this._postProcesses={},this.framebuffers={},this.mainFramebuffer=null,this.mainFramebufferParams=null,this.oitAccumulateFramebuffer=null,this.oitPostprocessType=null,this.oitPostprocess=null,this.blitPostprocessType=null,this.blitPostprocess=null,this.transparencyMode=SceneJS.TRANSPARENCY_FLAGS.ALPHA,this.depthSort=!1,this.postProcessInitialized=!1,this.oitInitialized=!1};function _(e,t){return e.sortKey-t.sortKey}function h(e,t){return e.layer-t.layer||e.properties.stateId-t.properties.stateId||e.sortTieBreaker-t.sortTieBreaker}function f(e,t){return e.layer-t.layer||t.getDepth()-e.getDepth()}u.prototype.initPostProcess=function(){this.postProcessInitialized||(this.mainFramebuffer=this.createFramebuffer("__MAIN",this.mainFramebufferParams),this.blitPostprocessType=this.createPostProcessType("__BLIT",["precision highp float;","varying vec2 vUV;","uniform sampler2D uTexture;","void main() {","    gl_FragColor = texture2D(uTexture, vUV);","}"].join("\n")),this.blitPostprocess=new SceneJS_PostProcessStage(this,{type:"__BLIT",textures:{uTexture:{framebuffer:"__MAIN",target:"color"}}}),this.postProcessInitialized=!0)},u.prototype.initOIT=function(){this.oitInitialized||(this.initPostProcess(),this.oitAccumulateFramebuffer=this.createFramebuffer("__OIT_ACCUMULATE",{colorAttachments:[{type:"FLOAT"}],sharedDepthBuffer:this.mainFramebuffer}),this.oitDepthBuffer=this.createFramebuffer("__OIT_DEPTH",{colorAttachments:0}),this.oitPostprocessType=this.createPostProcessType("__OIT",["precision highp float;","varying vec2 vUV;","uniform vec2 uTexelOffset;","uniform sampler2D uAccumulate;","#define THRESH 0.1176","float edgeFilter(vec2 center, vec2 a0, vec2 a1, vec2 a2, vec2 a3){","    vec4 luminance = vec4(a0.x, a1.x , a2.x, a3.x);","    vec4 w = 1.0 - step(THRESH, abs(luminance - center.x));","    float W = w.x + w.y + w.z + w.w;","    w.x = W == 0.0 ? 1.0 : w.x;","    W = W == 0.0 ? 1.0 : W;","    return (w.x * a0.y + w.y * a1.y + w.z * a2.y + w.w * a3.y) / W;","}","void main() {","    vec4 accum = texture2D(uAccumulate, vUV);","    vec4 a0 = texture2D(uAccumulate, vUV + vec2(uTexelOffset.x, 0.0));","    vec4 a1 = texture2D(uAccumulate, vUV - vec2(uTexelOffset.x, 0.0));","    vec4 a2 = texture2D(uAccumulate, vUV + vec2(0.0, uTexelOffset.y));","    vec4 a3 = texture2D(uAccumulate, vUV - vec2(0.0, uTexelOffset.y));","    accum.rg /= max(accum.b, 0.001);","    a0.rg /= max(a0.b, 0.001);","    a1.rg /= max(a1.b, 0.001);","    a2.rg /= max(a2.b, 0.001);","    a3.rg /= max(a3.b, 0.001);","    vec3 ycocg = vec3(accum.rg, edgeFilter(accum.rg, a0.rg, a1.rg, a2.rg, a3.rg));","    bool checkerboard = mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0);","    ycocg.gb = checkerboard ? ycocg.gb : ycocg.bg;","    vec3 rgb = vec3(ycocg.r + ycocg.g - ycocg.b, ycocg.r + ycocg.b, ycocg.r - ycocg.g - ycocg.b);","    float a = 1.0 - accum.a;","    gl_FragColor = vec4(a * rgb, a);","}"].join("\n")),this.oitPostprocess=new SceneJS_PostProcessStage(this,{type:"__OIT",uniforms:{uTexelOffset:new Float32Array([1/window.innerWidth,1/window.innerHeight])},textures:{uAccumulate:{framebuffer:"__OIT_ACCUMULATE",target:"color"}}}),this.oitInitialized=!0)},u.prototype.setTransparencyMode=function(e){this.transparencyMode=e,e===SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this.initOIT(),this.objectListDirty=!0},u.prototype.createFramebuffer=function(e,t){return this.framebuffers[e]&&this.framebuffers[e].destroy(),(t=t||{}).canvas=this._canvas,this.framebuffers[e]=new SceneJS._webgl.Framebuffer(t),this.framebuffers[e]},u.prototype.destroyFramebuffer=function(e){this.framebuffers[e]&&this.framebuffers[e].destroy(),delete this.framebuffers[e]},u.prototype.getPostProcessStage=function(e){return this._postProcesses[e]},u.prototype.createPostProcessType=function(e,t,r){return this._postProcessTypes[e]=new SceneJS_PostProcess(this.stats,this._canvas.gl,t,r),this._postProcessTypes[e]},u.prototype.postProcessOpaque=function(e){var t,r;for((e=e||[]).length>0&&this.initPostProcess(),t=0,r=this.postProcessPipelineOpaque.length;t<r;++t){var a=this.postProcessPipelineOpaque[t];delete this._postProcesses[a.id],a.destroy()}for(this.postProcessPipelineOpaque.length=0,t=0,r=e.length;t<r;++t){var i=e[t],n=i.id;this._postProcesses[n]=new SceneJS_PostProcessStage(this,i),this.postProcessPipelineOpaque.push(this._postProcesses[n])}this.imageDirty=!0},u.prototype.postProcessFinal=function(e){var t,r;for((e=e||[]).length>0&&this.initPostProcess(),t=0,r=this.postProcessPipelineFinal.length;t<r;++t){var a=this.postProcessPipelineFinal[t];delete this._postProcesses[a.id],a.destroy()}for(this.postProcessPipelineFinal.length=0,t=0,r=e.length;t<r;++t){var i=e[t],n=i.id;this._postProcesses[n]=new SceneJS_PostProcessStage(this,i),this.postProcessPipelineFinal.push(this._postProcesses[n])}this.imageDirty=!0},u.prototype.webglRestored=function(){this._programFactory.webglRestored(),this._chunkFactory.webglRestored();var e=this._canvas.gl;for(var t in this.pickBuf&&this.pickBuf.webglRestored(e),this.framebuffers)this.framebuffers[t].webglRestored(e);for(var r in this._postProcessTypes)this._postProcessTypes[r].webglRestored(e);this.imageDirty=!0},u.prototype.setViewport=function(e,t,r,a){this.viewport[0]=e,this.viewport[1]=t,this.viewport[2]=r,this.viewport[3]=a,this.imageDirty=!0},u.prototype.buildProjectionMatrix=function(){var e=this.projection,t=this.projectionMatrix;if("ortho"==e.type)mat4.ortho(t,e.left,e.right,e.bottom,e.top,e.near,e.far);else if("frustum"==e.type)mat4.frustum(t,e.left,e.right,e.bottom,e.top,e.near,e.far);else if("perspective"==e.type){var r=e.fov;r=Math.min(r,120),mat4.perspective(t,r*Math.PI/180,e.aspect,e.near,e.far)}if(e.pan){var a=e.pan,i=mat4.fromTranslation(mat4.create(),[a.x||0,a.y||0,a.z||0]);mat4.multiply(t,i,t)}},u.prototype.buildViewMatrix=function(){var e=this.camera,t=this.viewMatrix;if(mat4.lookAt(t,e.eye,e.look,e.up),this.hasDeviceMatrix){var r=mat4.create();mat4.multiply(r,this.deviceMatrix,t),t.set(r)}},u.prototype.buildObject=function(e,t){var r=this._objects[e];r||(r=this._objects[e]=new SceneJS_Object(e)),r.modelTransform=this.modelTransform,r.viewMatrix=this.viewMatrix,r.projectionMatrix=this.projectionMatrix,r.texture=this.texture,r.cubemap=this.cubemap,r.geometry=this.geometry,r.morphGeometry=this.morphGeometry,r.properties=this.properties,r.material=this.material,r.fresnel=this.fresnel,r.regionMap=this.regionMap,r.backfaces=t.backfaces,r.addBlend=t.addBlend,r.layer=t.layer;var a=[this.geometry.hash,this.morphGeometry.hash,this.material.hash,this.texture.hash,this.fresnel.hash,this.cubemap.hash,this.lightHash,this.clipsHash,this.reflectionsHash,this.lightmapsHash,this.properties.hash,this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.TWO_PASS&&r.isPartiallyOpaque()?"pt":"",this.regionMap.hash,this.fogEnabled?"f"+this.fogMode:""].join(";");if(!r.program||a!=r.hash){r.program&&(this._programFactory.putProgram(r.program.draw),this._programFactory.putProgram(r.program.xray),this._programFactory.putProgram(r.program.pick),this._programFactory.putProgram(r.program.pickTriangle),this._programFactory.putProgram(r.program.depth),this._programFactory.putProgram(r.program.drawTexture),SceneJS_ProgramSourceFactory.putSource(r.hash));var i=SceneJS_ProgramSourceFactory.getSource(a,this,r);r.program={draw:this._programFactory.getProgram(a+"-draw",i.drawVertexSrc,i.drawFragmentSrc),xray:this._programFactory.getProgram(a+"-xray",i.xrayVertexSrc,i.xrayFragmentSrc),pick:this._programFactory.getProgram(a+"-pick",i.pickVertexSrc,i.pickFragmentSrc),pickTriangle:this._programFactory.getProgram(a+"-pickTriangle",i.pickTriangleVertexSrc,i.pickTriangleFragmentSrc),depth:this._programFactory.getProgram(a+"-depth",i.depthVertexSrc,i.depthFragmentSrc),drawTexture:this._programFactory.getProgram(a+"-drawTexture",i.drawTextureVertexSrc,i.drawTextureFragmentSrc),id:this._nextProgramId++,gl:this._canvas.gl},r.hash=a,r.sortKey=1e5*(r.program.id+1)+r.texture.stateId}this._setChunk(r,"draw",0,"program"),this._setChunk(r,"draw",1,"object",[this.properties,this.modelTransform]),this._setChunk(r,"draw",2,"material",[this.material,this.texture,this.fresnel,this.cubemap]),this._setChunk(r,"draw",3,"regionMap",[this.regionMap]),this._setChunk(r,"draw",4,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(r,"draw",5,"draw",[this.geometry]),this._setChunk(r,"xray",0,"program"),this._setChunk(r,"xray",1,"object",[this.properties,this.modelTransform]),this._setChunk(r,"xray",2,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(r,"xray",3,"draw",[this.geometry]),this._setChunk(r,"pick",0,"program"),this._setChunk(r,"pick",1,"object",[this.properties,this.modelTransform]),this._setChunk(r,"pick",2,"regionMap",[this.regionMap]),this._setChunk(r,"pick",3,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(r,"pick",4,"draw",[this.geometry]),this._setChunk(r,"pickTriangle",0,"program"),this._setChunk(r,"pickTriangle",1,"object",[this.properties,this.modelTransform]),this._setChunk(r,"pickTriangle",2,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(r,"pickTriangle",3,"draw",[this.geometry]),this._setChunk(r,"depth",0,"program"),this._setChunk(r,"depth",1,"object",[this.properties,this.modelTransform]),this._setChunk(r,"depth",2,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(r,"depth",3,"draw",[this.geometry]),this._setChunk(r,"drawTexture",0,"program"),this._setChunk(r,"drawTexture",1,"object",[this.properties,this.modelTransform]),this._setChunk(r,"drawTexture",2,"material",[this.material,this.texture,this.fresnel,this.cubemap]),this._setChunk(r,"drawTexture",3,"geometry",[this.morphGeometry,this.geometry]),this._setChunk(r,"drawTexture",4,"draw",[this.geometry]),this.objectListDirty=!0},u.prototype._setChunk=function(e,t,r,a,i,n){var o;void 0===e.chunkSets[t]&&(e.chunkSets[t]=[]);var s=e.chunkSets[t];if(i){for(var l,c=!0,u=0,_=i.length;u<_;++u)if(!i[u].empty){c=!1;break}if(c)return(l=s[r])&&this._chunkFactory.putChunk(l),void(s[r]=null);for(o="p"+e.program.id,u=0,_=i.length;u<_;++u)o+="_"+i[u].stateId}else o="p"+e.program.id;if(o=r+"__"+o,l=s[r]){if(l.id==o)return;this._chunkFactory.putChunk(l)}s[r]=this._chunkFactory.getChunk(o,a,e.program,i)},u.prototype.removeObject=function(e){var t=this._objects[e];if(t){for(var r in this._programFactory.putProgram(t.program),t.program=null,t.hash=null,t.chunkSets)for(var a,i=t.chunkSets[r],n=0,o=i.length;n<o;n++)(a=i[n])&&this._chunkFactory.putChunk(a);delete this._objects[e],this.objectListDirty=!0}},u.prototype.prepareScene=function(){this.objectListDirty&&(this._buildObjectList(),this.objectListDirty=!1,this.imageDirty=!0)},u.prototype.render=function(e){e=e||{},0!=this._canvas.canvas.width&&0!=this._canvas.canvas.height&&(this.imageDirty||e.force)&&(this._doDrawList({clear:!1!==e.clear,opaqueOnly:e.opaqueOnly,pass:e.pass,custom:e.custom}),this.imageDirty=!1,this.pickBufDirty=!0)},u.prototype._buildObjectList=function(){var e,t=SceneJS.PROPERTY_FLAGS.ENABLED,r=!!(this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.TWO_PASS);for(e in this._numOpaqueObjects=0,this._numTransparentObjects=0,this._objects){var a=this._objects[e];a.properties.flags&t&&(a.isTransparent()?(this._transparentObjects[this._numTransparentObjects++]=a,r&&a.isPartiallyOpaque()&&(this._opaqueObjects[this._numOpaqueObjects++]=a)):this._opaqueObjects[this._numOpaqueObjects++]=a)}this._opaqueObjects.length=this._numOpaqueObjects,this._opaqueObjects.sort(_),this._transparentObjects.length=this._numTransparentObjects,this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.ORDER_DEPENDENT?this._transparentObjects.sort(h):this._transparentObjects.sort(_)},e=vec3.create(),t=vec3.create(),r=mat4.create(),a=mat4.frustum(mat4.create(),-1,1,-1,1,.1,1e4),i=vec3.create(),n=vec3.create(),o=vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),mat4.create(),mat4.create(),vec4.create(),vec4.create(),s=vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec2.create(),vec2.create(),vec2.create(),vec2.create(),l=function(){var e=mat4.create(),t=mat4.create(),r=mat4.create(),a=vec4.create(),i=vec4.create();return function(n,o,s,l,c){var u=o.projectionMatrix;mat4.multiply(e,o.viewMatrix,o.modelTransform.matrix),mat4.multiply(t,u,e),mat4.invert(r,t);var _=n.width,h=n.height,f=(s[0]-_/2)/(_/2),d=-(s[1]-h/2)/(h/2);vec4.transformMat4(a,[f,d,-1,1],r),vec3.scale(a,a,1/a[3]),vec4.transformMat4(i,[f,d,1,1],r),vec3.scale(i,i,1/i[3]),l[0]=a[0],l[1]=a[1],l[2]=a[2],vec3.subtract(c,i,a),vec3.normalize(c,c)}}(),c=function(){var e=mat4.create(),t=vec4.create(),r=vec4.create();return function(a,i,n,o,s){mat4.invert(e,a.modelTransform.matrix),t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=1,vec4.transformMat4(r,t,e),o[0]=r[0],o[1]=r[1],o[2]=r[2],vec3.transformMat4(s,n,e)}}(),u.prototype.pick=function(u){if(u.canvasPos||!u.rayPick||u.origin&&u.direction){if(0!=this._canvas.canvas.width&&0!=this._canvas.canvas.height){var _=this._canvas.canvas,h=this._canvas.resolutionScaling,f=u.canvasPos;f&&(f=new Float32Array([f[0]*h,f[1]*h]));var d,p,m,g=this.pickBuf,y=null;g||(g=this.pickBuf=new SceneJS._webgl.Framebuffer({canvas:this._canvas}));var v,S,b,E,I=!u.canvasPos;if(I){v=u.origin||new Float32Array([0,0,0]),S=u.direction||new Float32Array([0,0,1]);var x=vec3.add(s,v,S),C=new Float32Array([0,1,0]);mat4.lookAt(r,v,x,C),b=.5*_.clientWidth,E=.5*_.clientHeight}else b=f[0],E=f[1];this.prepareScene(),this.render(),g.bind(),g.clear(),this._doDrawList({pickObject:!0,clear:!0,pickViewMatrix:I?r:null,pickProjMatrix:I?a:null}),this._canvas.gl.finish();var T=g.read(b,E),N=this._pickLookup[T[0]+256*T[1]+256*T[2]*256+256*T[3]*256*256-1];if(N>=0){y={canvasPos:f,objectId:(d=N<this._numOpaqueObjects?this._opaqueObjects[N]:this._transparentObjects[N-this._numOpaqueObjects]).id};var A=d.properties;A&&(y.name=A.name,y.nodeId=A.nodeId)}if(u.pickRegion&&(g.clear(),this._doDrawList({pickRegion:!0,object:d,pickViewMatrix:I?r:null,pickProjMatrix:I?a:null,clear:!0}),0!==(T=g.read(b,E))[0]||0!==T[1]||0!==T[2]||0!==T[3])){y=y||{canvasPos:f};var D,M={r:T[0]/255,g:T[1]/255,b:T[2]/255,a:T[3]/255},P=this._frameCtx.regionData,w={};for(p=0,m=P.length;p<m;p++)if(D=P[p].color,M&&P[p].data&&Math.max(Math.abs(M.r-D.r),Math.abs(M.g-D.g),Math.abs(M.b-D.b),Math.abs(M.a-(void 0===D.a?M.a:D.a)))<.01){w=P[p].data;break}y.color=M,y.regionData=w}if(u.pickTriangle&&d){g.clear(),this._doDrawList({pickTriangle:!0,object:d,pickViewMatrix:I?r:null,pickProjMatrix:I?a:null,clear:!0});var F=(T=g.read(b,E))[0]+256*T[1]+256*T[2]*256+256*T[3]*256*256;y.primitiveIndex=F*=3,"triangles"===d.geometry.primitiveName&&(y.primitive="triangle",I?c(d,v,S,e,t):l(_,d,f,e,t),y.indices=vec3.create(),d.getTriangleIndices(F,y.indices),d.getTrianglePositionOnSurface(F,i,n,o),y.position=vec3.create(),SceneJS_math_rayPlaneIntersect(e,t,i,n,o,y.position),y.barycentric=vec3.create(),d.cartesianToBarycentric(F,y.position,y.barycentric),y.normal=vec3.create(),d.normalFromBarycentric(F,y.barycentric,y.normal),y.worldPos=vec3.create(),d.getPointInWorldSpace(y.position,y.worldPos),y.uvs=[],d.uvFromBarycentric(F,y.barycentric,y.uvs),y.uvs.length>0&&(y.uv=y.uvs[0]))}return g.unbind(),y}}else console.warn("Incomplete pick parameters")},u.prototype._doDrawList=function(){var e={},t=new Float32Array(2);function r(t){e[t]||(e[t]=new Int32Array(8));for(var r=e[t],a=0,i=r.length;a<i;++a)r[a]=-1}function a(t,r,a){var i,n=t.gl,o=r.chunkSets[a],s=e[a];t.backfaces!=r.backfaces&&(r.backfaces?n.disable(n.CULL_FACE):n.enable(n.CULL_FACE),t.backfaces=r.backfaces),t.addBlend!=r.addBlend&&(n.blendFunc(n.ONE,r.addBlend?n.ONE:n.ONE_MINUS_SRC_ALPHA),t.addBlend=r.addBlend);for(var l=0,c=o.length;l<c;l++)(i=o[l])&&(i.unique||s[l]!==i.numericId)&&(i.draw(a,t),s[l]=i.numericId)}return function(e){var i=this._canvas.gl,n=this._frameCtx;n.gl=i,n.pass=e.pass||0,n.targetIndex=0,n.viewMatrix=this.viewMatrix,n.cameraEye=this.camera.eye,n.modelMat=null,n.cameraMat=null,n.projectionMatrix=this.projectionMatrix,n.lights=this.lights,n.clips=this.clips,n.reflection=this.reflections.activeReflection,n.lightmap=this.lightmaps.activeLightmap,n.highlightColor=this.highlightColor,n.desatParams=this.desatParams,n.fogParams=this.fogParams,n.fogColor=this.fogColor,n.fogMode=this.fogMode,n.fogEnabled=this.fogEnabled,n.xrayColor=this.xrayColor,n.scissorTestEnabled=!1,n.depthTest=SceneJS.DEPTH_TEST_FLAGS.ENABLED,n.backfaces=!0,n.frontface=SceneJS.PROPERTY_FLAGS.CCW,n.picking=!!e.pickObject||!!e.pickTriangle||!!e.pickRegion,n.pickObject=!!e.pickObject,n.pickTriangle=!!e.pickTriangle,n.pickRegion=!!e.pickRegion,n.pickIndex=1,n.textureUnit=0,n.lineWidth=1,n.transparent=0,n.ambientColor=this._ambientColor,n.canvasResolution=n.canvasResolution||new Float32Array(2),n.canvasResolution[0]=this._canvas.canvas.width,n.canvasResolution[1]=this._canvas.canvas.height,n.aspect=this._canvas.canvas.width/this._canvas.canvas.height,n.texture=null,n.hasNormalMap=!1,n.regionMapUVLayerIdx=-1,n.drawElements=0,n.drawArrays=0,n.useProgram=0,n.bindTexture=0,n.bindArray=0,n.pickViewMatrix=e.pickViewMatrix,n.pickProjMatrix=e.pickProjMatrix,n.discardOpaque=!1,n.outputFormat=0,n.depthBuffer=null,n.addBlend=!1;var o=i.getExtension("OES_vertex_array_object");if(n.VAO=o||null,SceneJS.WEBGL_INFO.SUPPORTED_EXTENSIONS.OES_standard_derivatives&&i.getExtension("OES_standard_derivatives"),i.viewport(this.viewport[0],this.viewport[1],n.canvasResolution[0],n.canvasResolution[1]),i.enable(i.DEPTH_TEST),i.frontFace(i.CCW),i.disable(i.CULL_FACE),i.depthMask(!0),this.transparent||n.picking?i.clearColor(0,0,0,0):i.clearColor(this._ambientColor[0],this._ambientColor[1],this._ambientColor[2],1),e.custom){var s=e.custom.renderMode,l=e.custom.objects;for(r(s),_=0;_<l.length;_++)a(n,m=l[_],s)}else if(e.pickObject){r("pick");var c=0;for(e.clear&&i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT),_=0,h=this._numOpaqueObjects;_<h;_++)(m=this._opaqueObjects[_]).properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[c++]=_,a(n,m,"pick"));for(_=0,h=this._numTransparentObjects;_<h;_++)(m=this._transparentObjects[_]).properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[c++]=this._numOpaqueObjects+_,a(n,m,"pick"))}else if(e.pickTriangle&&e.object)e.clear&&i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT),r("pickTriangle"),a(n,e.object,"pickTriangle");else if(e.pickRegion){if(r("pick"),e.clear&&i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT),e.object)a(n,e.object,"pick");else if(c=0,e.pickRegion){for(_=0,h=this._numOpaqueObjects;_<h;_++)(m=this._opaqueObjects[_]).properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[c++]=_,a(n,m,"pick"));for(_=0,h=this._numTransparentObjects;_<h;_++)(m=this._transparentObjects[_]).properties.getFlag(SceneJS.PROPERTY_FLAGS.PICKING)&&(this._pickLookup[c++]=this._numOpaqueObjects+_,a(n,m,"pick"))}}else{r("draw"),r("xray"),Date.now();var u=this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this._numTransparentObjects>0||this.postProcessPipelineOpaque.length>0||this.postProcessPipelineFinal.length>0;for(u&&this.mainFramebuffer.bind(),e.clear&&i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT),_=0,h=this._numOpaqueObjects;_<h;_++)(m=this._opaqueObjects[_]).properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?a(n,m,"xray"):a(n,m,"draw");u&&this.mainFramebuffer.unbind(),this.postProcessPipelineOpaque.length>0&&(i.disable(i.DEPTH_TEST),i.frontFace(i.CCW),i.disable(i.CULL_FACE));for(var _=0,h=this.postProcessPipelineOpaque.length;_<h;++_)(y=this.postProcessPipelineOpaque[_]).framebuffer&&y.framebuffer.bind(),y.draw(n),y.framebuffer&&y.framebuffer.unbind();if(this.postProcessPipelineOpaque.length>0&&(i.enable(i.DEPTH_TEST),i.frontFace(i.CCW),i.disable(i.CULL_FACE),n.depthTest=SceneJS.DEPTH_TEST_FLAGS.ENABLED,n.backfaces=SceneJS.PROPERTY_FLAGS.BACKFACES,n.frontface=SceneJS.PROPERTY_FLAGS.CCW,n.addBlend=!1),this._numTransparentObjects>0){if(r("draw"),r("xray"),u&&this.transparencyMode!==SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this.mainFramebuffer.bind(),this.depthSort&&this._transparentObjects.sort(f),n.discardOpaque=!0,this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.ALPHA_BLEND){var d=!!(this.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.ALPHA_NO_DEPTH_MASK);i.enable(i.BLEND),this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.ADD_ALPHA?i.blendFunc(i.ONE,i.ONE):i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA);var p=SceneJS.PROPERTY_FLAGS.NO_DEPTH_MASK;for(d&&i.depthMask(!1),_=0;_<this._numTransparentObjects;_++){var m=this._transparentObjects[_],g=!d&&m.properties.flags&p;g&&i.depthMask(!1),m.properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?a(n,m,"xray"):a(n,m,"draw"),g&&i.depthMask(!0)}i.disable(i.BLEND),i.depthMask(!0)}else if(this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT){for(r("depth"),t[0]=1/n.canvasResolution[0],t[1]=1/n.canvasResolution[1],this.oitDepthBuffer.bind(),i.clear(i.DEPTH_BUFFER_BIT),i.colorMask(!1,!1,!1,!1),_=0;_<this._numTransparentObjects;_++)a(n,this._transparentObjects[_],"depth");for(i.colorMask(!0,!0,!0,!0),this.oitDepthBuffer.unbind(),i.clearColor(0,0,0,1),i.enable(i.BLEND),i.blendFuncSeparate(i.ONE,i.ONE,i.ZERO,i.ONE_MINUS_SRC_ALPHA),i.depthMask(!1),this.oitAccumulateFramebuffer.bind(),i.clear(i.COLOR_BUFFER_BIT),n.outputFormat=1,n.depthBuffer=this.oitDepthBuffer.getDepthTarget(),_=0;_<this._numTransparentObjects;_++)(m=this._transparentObjects[_]).properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?a(n,m,"xray"):a(n,m,"draw");this.oitAccumulateFramebuffer.unbind(),i.disable(i.DEPTH_TEST),i.frontFace(i.CCW),i.disable(i.CULL_FACE),this.mainFramebuffer.bind(),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),this.oitPostprocess.setUniform("uTexelOffset",t),this.oitPostprocess.draw(n),this.mainFramebuffer.unbind(),i.disable(i.BLEND),i.depthMask(!0)}else if(this.transparencyMode===SceneJS.TRANSPARENCY_FLAGS.ALPHA_TO_COVERAGE){for(i.enable(i.SAMPLE_ALPHA_TO_COVERAGE),_=0;_<this._numTransparentObjects;_++)(m=this._transparentObjects[_]).properties.flags&SceneJS.PROPERTY_FLAGS.XRAY?a(n,m,"xray"):a(n,m,"draw");i.disable(i.SAMPLE_ALPHA_TO_COVERAGE)}u&&this.transparencyMode!==SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT&&this.mainFramebuffer.unbind()}if(u)if(i.disable(i.DEPTH_TEST),i.frontFace(i.CCW),i.disable(i.CULL_FACE),this.postProcessPipelineFinal.length>0)for(_=0,h=this.postProcessPipelineFinal.length;_<h;++_){var y;(y=this.postProcessPipelineFinal[_]).framebuffer&&y.framebuffer.bind(),y.draw(n),y.framebuffer&&y.framebuffer.unbind()}else this.blitPostprocess.draw(n);Date.now(),this.stats.frame.drawElements=n.drawElements,this.stats.frame.drawArrays=n.drawArrays,this.stats.frame.useProgram=n.useProgram,this.stats.frame.bindTexture=n.bindTexture,this.stats.frame.bindArray=n.bindArray,this.stats.frame.drawChunks=this._drawListLen}if(n.VAO)for(n.VAO.bindVertexArrayOES(null),_=0;_<10;_++)i.disableVertexAttribArray(_)}}(),u.prototype.readPixels=function(e,t,r){if(0!=this._canvas.canvas.width&&0!=this._canvas.canvas.height){var a,i;this._readPixelBuf||(this._readPixelBuf=new SceneJS._webgl.Framebuffer({canvas:this._canvas})),this._readPixelBuf.bind(),this._readPixelBuf.clear(),this.prepareScene(),this.render({force:!0,opaqueOnly:r});for(var n=0;n<t;n++)a=e[n]||(e[n]={}),i=this._readPixelBuf.read(a.x,a.y),a.r=i[0],a.g=i[1],a.b=i[2],a.a=i[3];this._readPixelBuf.unbind()}},u.prototype.destroy=function(){this._programFactory.destroy()}}(),function(){"use strict";var e=SceneJS.DISPLAY_FLAGS,t=SceneJS.TEXTURE_FLAGS,r=SceneJS.CUBEMAP_FLAGS,a=SceneJS.PROPERTY_FLAGS,i=SceneJS.COLOR_MOD_FLAGS,n="highp"===SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION,o=SceneJS.WEBGL_INFO.textureLODSupported;window.SceneJS_ProgramSourceFactory=new function(){var s,l,c,u,_,h,f,d,p,m,g,y,v,S,b,E,I,x,C,T,N,A,D,M,P,w,F,R,L,O,H,J,B,U,k,V,j,G,z,X,Y,W,q,Q={},K=Math.floor(SceneJS.WEBGL_INFO.MAX_POINT_SIZE).toFixed(1),Z="";function $(e){return le(),ce("attribute vec4 SCENEJS_aVertex;"),e&&(ce("attribute vec4 SCENEJS_aTriColor;"),ce("varying vec4 SCENEJS_vTriColor;")),ce("uniform mat4 SCENEJS_uMMatrix;"),ce("uniform mat4 SCENEJS_uVMatrix;"),ce("uniform mat4 SCENEJS_uPMatrix;"),A&&(ce("uniform float SCENEJS_uPointSize;"),P&&ce("attribute vec2 SCENEJS_aPointScaleRotation;")),F&&ce("uniform mat4 SCENEJS_uDecodePositionMatrix;"),ce("varying vec4 SCENEJS_vWorldVertex;"),T&&(ce("attribute vec2 SCENEJS_aRegionMapUV;"),ce("varying vec2 SCENEJS_vRegionMapUV;")),C&&(ce("uniform float SCENEJS_uMorphFactor;"),s.morphGeometry.targets[0].vertexBuf&&ce("attribute vec4 SCENEJS_aMorphVertex;"),F&&ce("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),ce("void main(void) {"),ce(F?"    vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"    vec4 modelVertex = SCENEJS_aVertex;"),C&&s.morphGeometry.targets[0].vertexBuf&&ce(F?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),ce("  SCENEJS_vWorldVertex = SCENEJS_uMMatrix * modelVertex; "),ce("mat4 vPosMatrix = SCENEJS_uVMatrix;"),v&&ce("vPosMatrix[3].xyz = vec3(0.0);"),ce("  vec4 viewVertex =  vPosMatrix * SCENEJS_vWorldVertex;"),ce("  gl_Position =  SCENEJS_uPMatrix * viewVertex;"),T&&ce("SCENEJS_vRegionMapUV = SCENEJS_aRegionMapUV;"),e&&ce("SCENEJS_vTriColor = SCENEJS_aTriColor;"),A&&(ce("gl_PointSize = SCENEJS_uPointSize;"),M&&ce("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),P&&ce("gl_PointSize *= SCENEJS_aPointScaleRotation.x;"),ce("gl_PointSize = min(gl_PointSize, "+K+");")),ce("}"),ue()}function ee(e){if(le(),ce("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),ce("varying vec4 SCENEJS_vWorldVertex;"),e?ce("varying vec4  SCENEJS_vTriColor;"):(ce("uniform float  SCENEJS_uPickMode;"),ce("uniform vec4  SCENEJS_uPickColor;")),x)for(var t=0;t<s.clips.clips.length;t++)ce("uniform vec4  SCENEJS_uClipNormalAndDist"+t+";"),s.clips.clips[t].fade&&ce("uniform float SCENEJS_uClipFadeDistance"+t+";");if(T&&(ce("varying vec2 SCENEJS_vRegionMapUV;"),ce("uniform sampler2D SCENEJS_uRegionMapSampler;")),ce("void main(void) {"),x){for(s.clips.clipDiscard&&ce("float distOff = 0.0;"),s.clips.clipFade&&ce("float distAlpha = 0.0;"),t=0;t<s.clips.clips.length;t++)ce(s.clips.clips[t].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+t+".xyz) + SCENEJS_uClipNormalAndDist"+t+".w) / SCENEJS_uClipFadeDistance"+t+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+t+".xyz) + SCENEJS_uClipNormalAndDist"+t+".w);");s.clips.clipDiscard&&ce("if (distOff > 0.0) { discard; }"),s.clips.clipFade&&ce("if (distAlpha > 1.0) { discard; }")}return e?ce("gl_FragColor = SCENEJS_vTriColor;  "):(ce("    if  (SCENEJS_uPickMode == 0.0) {"),ce("          gl_FragColor = SCENEJS_uPickColor;  "),ce("    } else {"),ce(T?"          gl_FragColor = texture2D(SCENEJS_uRegionMapSampler, vec2(SCENEJS_vRegionMapUV.s, SCENEJS_vRegionMapUV.t));":"          gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);"),ce("    }")),ce("}"),ue()}function te(){le(),ce("attribute vec4 SCENEJS_aVertex;"),ce("uniform mat4 SCENEJS_uMMatrix;"),ce("uniform mat4 SCENEJS_uVMatrix;"),ce("uniform mat4 SCENEJS_uPMatrix;"),F&&ce("uniform mat4 SCENEJS_uDecodePositionMatrix;");var e=0,t=null,r=null;return h&&((r=s.texture.layers[s.texture.drawLayerIndex])&&(e=r.uvLayerIdx||0),s.geometry.uvBufs&&(t=s.geometry.uvBufs[e]),t&&(ce("varying vec2 SCENEJS_vUVCoord"+e+";"),ce("attribute vec2 SCENEJS_aUVCoord"+e+";"),L&&ce("uniform mat3 SCENEJS_uDecodeUVMatrix"+e+";"))),ce("varying vec4 SCENEJS_vWorldVertex;"),C&&(ce("uniform float SCENEJS_uMorphFactor;"),s.morphGeometry.targets[0].vertexBuf&&ce("attribute vec4 SCENEJS_aMorphVertex;"),F&&ce("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),ce("void main(void) {"),ce(F?"    vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"    vec4 modelVertex = SCENEJS_aVertex;"),C&&s.morphGeometry.targets[0].vertexBuf&&ce(F?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),ce("  SCENEJS_vWorldVertex = SCENEJS_uMMatrix * modelVertex; "),ce("mat4 vPosMatrix = SCENEJS_uVMatrix;"),ce("  vec4 viewVertex =  vPosMatrix * SCENEJS_vWorldVertex;"),ce("  gl_Position =  SCENEJS_uPMatrix * viewVertex;"),h&&t&&ce(L?"SCENEJS_vUVCoord"+e+" = (SCENEJS_uDecodeUVMatrix"+e+" * vec3(SCENEJS_aUVCoord"+e+", 1.0)).xy;":"SCENEJS_vUVCoord"+e+" = SCENEJS_aUVCoord"+e+";"),ce("}"),ue()}function re(){le(),ce("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;");var e=0,t=null,r=null;return h&&((r=s.texture.layers[s.texture.drawLayerIndex])&&(e=r.uvLayerIdx||0),s.geometry.uvBufs&&(t=s.geometry.uvBufs[e]),t&&(ce("uniform sampler2D SCENEJS_uDrawSampler;"),ce("varying vec2 SCENEJS_vUVCoord"+e+";"))),ce("void main(void) {"),ce("vec4 color = vec4(0.0);"),h&&t&&r&&(ce("vec2 textureCoord;"),ce("textureCoord = SCENEJS_vUVCoord"+e+";"),r.compressed&&ce("   textureCoord.y = 1.0 - textureCoord.y;"),ce("if(textureCoord.x != -1.0) {"),ce("   color = texture2D(SCENEJS_uDrawSampler, textureCoord);"),ce("}")),ce("gl_FragColor = color;"),ce("}"),ue()}function ae(){return"points"===s.geometry.primitiveName||!!s.geometry.uvBufs||!(!s.morphGeometry.targets||!s.morphGeometry.targets[0].uvBuf&&!s.morphGeometry.targets[0].uvBuf2)}function ie(){var e;if(le(),ce("uniform mat4 SCENEJS_uMMatrix;"),ce(n?"uniform mat4 SCENEJS_uVMatrix;":"uniform mediump mat4 SCENEJS_uVMatrix;"),ce("uniform mat4 SCENEJS_uPMatrix;"),ce("attribute vec4 SCENEJS_aVertex;"),ce(n?"uniform vec3 SCENEJS_uWorldEye;":"uniform mediump vec3 SCENEJS_uWorldEye;"),ce("varying vec3 SCENEJS_vViewEyeVec;"),A&&(ce("uniform float SCENEJS_uPointSize;"),P&&(ce("attribute vec2 SCENEJS_aPointScaleRotation;"),ce("varying float SCENEJS_vPointRotation;")),w&&(ce("attribute vec2 SCENEJS_aPointUVTranslate;"),ce("varying vec2 SCENEJS_vPointUVTranslate;"))),F&&ce("uniform mat4 SCENEJS_uDecodePositionMatrix;"),g&&(ce("attribute vec3 SCENEJS_aNormal;"),ce("uniform   mat4 SCENEJS_uMNMatrix;"),ce("varying   vec3 SCENEJS_vViewNormal;"),(f||d||p||m)&&ce("varying   vec3 SCENEJS_vWorldNormal;"),b&&!I&&(ce("attribute vec3 SCENEJS_aTangent;"),ce("varying   vec3 SCENEJS_vTangent;"))),h&&(e=s.geometry.uvBufs))for(var t=0,r=e.length;t<r;t++)e[t]&&(ce("attribute vec2 SCENEJS_aUVCoord"+t+";"),L&&ce("uniform mat3 SCENEJS_uDecodeUVMatrix"+t+";"));if(s.geometry.colorBuf&&(ce("attribute vec4 SCENEJS_aVertexColor;"),ce("varying vec4 SCENEJS_vColor;")),(x||g||J||G)&&ce("varying vec4 SCENEJS_vWorldVertex;"),Y&&ce("varying vec4 SceneJS_vModelVertex;"),ce("varying vec4 SCENEJS_vViewVertex;"),h&&(e=s.geometry.uvBufs))for(t=0,r=e.length;t<r;t++)e[t]&&ce("varying vec2 SCENEJS_vUVCoord"+t+";");if(N&&(ce("attribute vec2 SCENEJS_aRegionMapUV;"),ce("varying vec2 SCENEJS_vRegionMapUV;")),C&&(ce("uniform float SCENEJS_uMorphFactor;"),s.morphGeometry.targets[0].vertexBuf&&ce("attribute vec4 SCENEJS_aMorphVertex;"),g&&s.morphGeometry.targets[0].normalBuf&&ce("attribute vec3 SCENEJS_aMorphNormal;"),b&&!I&&ce("attribute vec3 SCENEJS_aMorphTangent;"),F&&ce("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),S&&(ce("void billboard(inout mat4 mat) {"),ce("   mat[0].xyz = vec3(1.0, 0.0, 0.0);"),ce("   mat[1].xyz = vec3(0.0, 1.0, 0.0);"),ce("   mat[2].xyz = vec3(0.0, 0.0, 1.0);"),ce("}")),R&&(ce("vec3 octDecode(vec2 oct) {"),ce("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),ce("    if (v.z < 0.0) {"),ce("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),ce("    }"),ce("    return normalize(v);"),ce("}")),ce("void main(void) {"),b&&!I&&ce("vec3 modelTangent = SCENEJS_aTangent;"),ce(F?"  vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"  vec4 modelVertex = SCENEJS_aVertex; "),R?ce("  vec4 modelNormal = vec4(octDecode(SCENEJS_aNormal.xy), 0.0); "):g&&ce("  vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); "),C&&(s.morphGeometry.targets[0].vertexBuf&&ce(F?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),g&&s.morphGeometry.targets[0].normalBuf&&ce(R?"  modelNormal = vec4( mix(modelNormal.xyz, octDecode(SCENEJS_aMorphNormal.xy), SCENEJS_uMorphFactor), 0.0); ":"  modelNormal = vec4( mix(modelNormal.xyz, SCENEJS_aMorphNormal, SCENEJS_uMorphFactor), 0.0); "),b&&!I&&ce("  modelTangent = mix(modelTangent, SCENEJS_aMorphTangent, SCENEJS_uMorphFactor); ")),Y&&ce("SceneJS_vModelVertex = modelVertex;;"),ce("mat4 modelMatrix = SCENEJS_uMMatrix;"),ce("mat4 viewMatrix = SCENEJS_uVMatrix;"),g&&ce("mat4 modelNormalMatrix = SCENEJS_uMNMatrix;"),ce("vec4 worldVertex;"),ce("vec4 viewVertex;"),v&&ce("viewMatrix[3].xyz = vec3(0.0);"),S?(ce("   mat4 modelViewMatrix =  viewMatrix * modelMatrix;"),ce("   billboard(modelMatrix);"),ce("   billboard(viewMatrix);"),ce("   billboard(modelViewMatrix);"),g&&ce("   billboard(modelNormalMatrix);"),ce("   worldVertex = modelMatrix * modelVertex;"),ce("   viewVertex = modelViewMatrix * modelVertex;")):(ce("  worldVertex = modelMatrix * modelVertex;"),ce("  viewVertex  = viewMatrix * worldVertex; ")),g&&(ce("  vec3 worldNormal = (modelNormalMatrix * modelNormal).xyz; "),ce("  SCENEJS_vViewNormal = (viewMatrix * vec4(worldNormal, 0.0)).xyz;"),(f||d||p||m)&&ce("SCENEJS_vWorldNormal = worldNormal;")),(x||g||J||G)&&ce("  SCENEJS_vWorldVertex = worldVertex;"),ce("  SCENEJS_vViewVertex = viewVertex;"),ce("  gl_Position = SCENEJS_uPMatrix * viewVertex;"),b&&!I&&ce("SCENEJS_vTangent = modelTangent;"),ce("SCENEJS_vViewEyeVec = ((viewMatrix * vec4(SCENEJS_uWorldEye, 1.0)).xyz  - viewVertex.xyz);"),h&&(e=s.geometry.uvBufs))for(t=0,r=e.length;t<r;t++)e[t]&&ce(L?"SCENEJS_vUVCoord"+t+" = (SCENEJS_uDecodeUVMatrix"+t+" * vec3(SCENEJS_aUVCoord"+t+", 1.0)).xy;":"SCENEJS_vUVCoord"+t+" = SCENEJS_aUVCoord"+t+";");return s.geometry.colorBuf&&ce("SCENEJS_vColor = SCENEJS_aVertexColor;"),N&&ce("SCENEJS_vRegionMapUV = SCENEJS_aRegionMapUV;"),A&&(ce("gl_PointSize = SCENEJS_uPointSize;"),M&&ce("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),P&&(ce("SCENEJS_vPointRotation = SCENEJS_aPointScaleRotation.y;"),ce("gl_PointSize *= SCENEJS_aPointScaleRotation.x;")),w&&ce("SCENEJS_vPointUVTranslate = SCENEJS_aPointUVTranslate;"),ce("gl_PointSize = min(gl_PointSize, "+K+");")),ce("}"),ue()}function ne(){var r=s.fresnel.diffuse,a=s.fresnel.specular,n=s.fresnel.alpha,l=s.fresnel.transparency,v=s.fresnel.reflect,S=s.fresnel.emit,C=s.fresnel.fragment,T=u;if(le(),(b&&I||Y)&&ce("#extension GL_OES_standard_derivatives : enable"),o&&ce("#extension GL_EXT_shader_texture_lod : enable"),W&&ce(W),ce("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),ce("uniform sampler2D SCENEJS_uDepthBuffer;"),ce("uniform vec2 SCENEJS_uCanvasRes;"),(u||_)&&(ce("vec4 sRGBToLinear( in vec4 value ) {"),ce("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),ce("}")),X&&ce("uniform bool SCENEJS_uDiscardOpaque;"),Y&&(ce("float hash(vec2 v) {"),ce("    return fract(1.0e4 * sin(17.0 * v.x + 0.1 * v.y) * (0.1 + abs(sin(13.0 * v.y + v.x))));"),ce("}"),ce("float hash3D(vec3 v) {"),ce("    return hash(vec2(hash(v.xy), v.z));"),ce("}")),u&&(ce("#define PI 3.14159265359"),ce("#define RECIPROCAL_PI 0.31830988618"),ce("#define RECIPROCAL_PI2 0.15915494"),ce("#define EPSILON 1e-6"),ce("#define saturate(a) clamp( a, 0.0, 1.0 )"),ce("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),ce("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),ce("}"),ce("struct IncidentLight {"),ce("   vec3 color;"),ce("   vec3 direction;"),ce("};"),ce("struct ReflectedLight {"),ce("   vec3 diffuse;"),ce("   vec3 specular;"),ce("};"),ce("struct Geometry {"),ce("   vec3 position;"),ce("   vec3 viewNormal;"),ce("   vec3 worldNormal;"),ce("   vec3 viewEyeDir;"),ce("};"),ce("struct Material {"),ce("   vec3    diffuseColor;"),ce("   float   specularRoughness;"),ce("   vec3    specularColor;"),ce("   float   shine;"),ce("};"),m&&(ce("void computePBRLightMapping(const in samplerCube lightMap, const in float intensity, const in vec3 normal, const in Material material, inout ReflectedLight reflectedLight) {"),ce("   reflectedLight.diffuse += (sRGBToLinear(textureCube(lightMap, normal)).rgb * PI) * (RECIPROCAL_PI * material.diffuseColor) * intensity;"),ce("}")),p&&(ce("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),ce("   float r = ggxRoughness + 0.0001;"),ce("   return (2.0 / (r * r) - 2.0);"),ce("}"),ce("float getSpecularMIPLevel(const in float blinnShininessExponent, float maxMipLevels) {"),ce("   float desiredMIPLevel = maxMipLevels - 0.79248 - 0.5 * log2( (blinnShininessExponent * blinnShininessExponent) + 1.0 );"),ce("   return clamp( desiredMIPLevel, 0.0, maxMipLevels );"),ce("}"),ce("vec3 getLightProbeIndirectRadiance(const in samplerCube reflectMap, const in vec3 reflectVec, const in float blinnShininessExponent, float maxMipLevels) {"),ce("   float mipLevel = getSpecularMIPLevel(blinnShininessExponent, maxMipLevels);"),ce(o?"   vec3 envMapColor = sRGBToLinear(textureCubeLodEXT(reflectMap, reflectVec, mipLevel)).rgb;":"   vec3 envMapColor = sRGBToLinear(textureCube(reflectMap, reflectVec, mipLevel)).rgb;"),ce("   return envMapColor;"),ce("}"),ce("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),ce("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),ce("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),ce("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),ce("   vec4 r = roughness * c0 + c1;"),ce("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),ce("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),ce("   return specularColor * AB.x + AB.y;"),ce("}"),ce("void computePBRReflectionMapping(const in samplerCube reflectMap, const in float intensity, const in mat4 viewMatrix, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight, float maxMipLevel) {"),ce("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),ce("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),ce("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),ce("   vec3 radiance               = getLightProbeIndirectRadiance(reflectMap, reflectVec, blinnExpFromRoughness, maxMipLevel);"),ce("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),ce("   reflectedLight.specular     += radiance * specularBRDFContrib * intensity;"),ce("}")),ce("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),ce("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),ce("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),ce("}"),ce("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),ce("   float a2 = alpha * alpha;"),ce("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),ce("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),ce("   return 1.0 / ( gl * gv );"),ce("}"),ce("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),ce("   float a2 = ( alpha * alpha );"),ce("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),ce("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),ce("   return 0.5 / max( gv + gl, EPSILON );"),ce("}"),ce("float D_GGX(const in float alpha, const in float dotNH) {"),ce("   float a2 = ( alpha * alpha );"),ce("   float denom = ( dotNH * dotNH ) * ( a2 - 1.0 ) + 1.0;"),ce("   return RECIPROCAL_PI * a2 / ( denom * denom );"),ce("}"),ce("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),ce("   float alpha = ( roughness * roughness );"),ce("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),ce("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),ce("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),ce("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),ce("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),ce("   vec3  F = F_Schlick( specularColor, dotLH );"),ce("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),ce("   float D = D_GGX( alpha, dotNH );"),ce("   return F * (G * D);"),ce("}"),ce("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),ce("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),ce("   vec3 irradiance = dotNL * incidentLight.color * PI;"),ce("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),ce("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),ce("}")),(x||g||J||G)&&ce("varying vec4 SCENEJS_vWorldVertex;"),Y&&ce("varying vec4 SceneJS_vModelVertex;"),ce("varying vec4 SCENEJS_vViewVertex;"),s.geometry.colorBuf&&ce("varying vec4 SCENEJS_vColor;"),h&&(b&&(I?(ce("vec3 perturbNormal2Arb( sampler2D sampler, vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),ce("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),ce("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),ce("      vec2 st0 = dFdx( uv.st );"),ce("      vec2 st1 = dFdy( uv.st );"),ce("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),ce("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),ce("      vec3 N = normalize( surf_norm );"),ce("      vec3 mapN = texture2D( sampler, uv ).xyz * 2.0 - 1.0;"),ce("      mat3 tsn = mat3( S, T, N );"),ce("      return normalize( tsn * mapN );"),ce("}"),E&&(ce("vec3 perturbNormal2ArbSwz( sampler2D sampler, vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),ce("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),ce("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),ce("      vec2 st0 = dFdx( uv.st );"),ce("      vec2 st1 = dFdy( uv.st );"),ce("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),ce("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),ce("      vec3 N = normalize( surf_norm );"),ce("      vec3 v_norm = vec3(texture2D(sampler, uv).ag * 2.0 - 1.0, 0.0);"),ce("      v_norm.z = sqrt(max(1.0 - dot(v_norm.xy, v_norm.xy), 0.0));"),ce("      mat3 tsn = mat3( S, T, N );"),ce("      return normalize( tsn * v_norm );"),ce("}"))):(ce("varying vec3 SCENEJS_vTangent;"),E&&(ce("vec4 swizzledNormalMap;"),ce("vec3 vNormal;")))),fe=s.geometry.uvBufs))for(var M=0,F=fe.length;M<F;M++)fe[M]&&ce("varying vec2 SCENEJS_vUVCoord"+M+";");if(ce("uniform mat4 SCENEJS_uVMatrix;"),ce("uniform mat4 SCENEJS_uMMatrix;"),ce("uniform vec3 SCENEJS_uWorldEye;"),ce("varying vec3 SCENEJS_vViewEyeVec;"),ce("uniform vec4  SCENEJS_uMaterialColor;"),ce("uniform vec4  SCENEJS_uMaterialEmitColor;"),h)for(M=0,F=s.texture.layers.length;M<F;M++){var R=s.texture.layers[M];ce("uniform sampler2D SCENEJS_uSampler"+M+";"),R.matrix&&ce("uniform mat4 SCENEJS_uLayer"+M+"Matrix;"),ce("uniform float SCENEJS_uLayer"+M+"BlendFactor;")}if((r||a||n||l||S||C||v||k||V||j)&&(Z.push("float fresnel(vec3 eyeDir, vec3 normal, float edgeBias, float centerBias, float power) {"),Z.push("    float fr = abs(dot(eyeDir, normal));"),Z.push("    float finalFr = clamp((fr - edgeBias) / (centerBias - edgeBias), 0.0, 1.0);"),Z.push("    return pow(finalFr, power);"),Z.push("}"),r&&(ce("uniform vec4 SCENEJS_uDiffuseFresnelCenterColor;"),ce("uniform vec4 SCENEJS_uDiffuseFresnelEdgeColor;"),ce("uniform float SCENEJS_uDiffuseFresnelPower;")),a&&(ce("uniform vec4 SCENEJS_uSpecularFresnelCenterColor;"),ce("uniform vec4 SCENEJS_uSpecularFresnelEdgeColor;"),ce("uniform float SCENEJS_uSpecularFresnelPower;")),n&&(ce("uniform vec4 SCENEJS_uAlphaFresnelCenterColor;"),ce("uniform vec4 SCENEJS_uAlphaFresnelEdgeColor;"),ce("uniform float SCENEJS_uAlphaFresnelPower;")),l&&(ce("uniform vec4 SCENEJS_uTransparencyFresnelCenterColor;"),ce("uniform vec4 SCENEJS_uTransparencyFresnelEdgeColor;"),ce("uniform float SCENEJS_uTransparencyFresnelPower;")),v&&(ce("uniform vec4 SCENEJS_uReflectFresnelCenterColor;"),ce("uniform vec4 SCENEJS_uReflectFresnelEdgeColor;"),ce("uniform float SCENEJS_uReflectFresnelPower;")),S&&(ce("uniform vec4 SCENEJS_uEmitFresnelCenterColor;"),ce("uniform vec4 SCENEJS_uEmitFresnelEdgeColor;"),ce("uniform float SCENEJS_uEmitFresnelPower;")),C&&(ce("uniform vec4 SCENEJS_uFragmentFresnelCenterColor;"),ce("uniform vec4 SCENEJS_uFragmentFresnelEdgeColor;"),ce("uniform float SCENEJS_uFragmentFresnelPower;"))),c&&(ce("uniform vec3  SCENEJS_uAmbientColor;"),ce("uniform vec4  SCENEJS_uMaterialSpecularColor;"),ce("uniform float SCENEJS_uMaterialShine;")),u&&ce("uniform vec4 SCENEJS_uMetalRoughSpecularf0;"),g){if(ce("uniform vec2  SCENEJS_uXrayParams;"),f||d)for(M=0,F=s.cubemap.layers.length;M<F;M++)R=s.cubemap.layers[M],ce("uniform samplerCube SCENEJS_uCubeMapSampler"+M+";"),ce("uniform float SCENEJS_uCubeMapIntensity"+M+";"),ce("uniform float SCENEJS_uCubeMapMipLevels"+M+";");for(p&&(ce("uniform samplerCube SCENEJS_uPBRReflectionMapSampler;"),ce("uniform float SCENEJS_uPBRReflectionMapIntensity;"),ce("uniform float SCENEJS_uPBRReflectionMapMipLevels;")),m&&(ce("uniform samplerCube SCENEJS_uPBRLightMapSampler;"),ce("uniform float SCENEJS_uPBRLightMapIntensity;"),ce("uniform float SCENEJS_uPBRLightMapMipLevels;")),ce("varying vec3 SCENEJS_vViewNormal;"),(f||d||p||m)&&ce("varying vec3 SCENEJS_vWorldNormal;"),M=0;M<s.lights.length;M++){var L=s.lights[M];ce("uniform vec3  SCENEJS_uLightColor"+M+";"),"dir"==L.mode&&ce("uniform vec3 SCENEJS_uLightDir"+M+";"),"point"==L.mode&&(ce("uniform vec3  SCENEJS_uLightAttenuation"+M+";"),ce("uniform vec3 SCENEJS_uLightPos"+M+";")),"spot"==L.mode&&(ce("uniform vec3  SCENEJS_uLightAttenuation"+M+";"),ce("uniform vec3 SCENEJS_uLightPos"+M+";"),ce("uniform vec3 SCENEJS_uLightDir"+M+";"),ce("uniform float SCENEJS_uInnerCone"+M+";"),ce("uniform float SCENEJS_uOuterCone"+M+";"))}}if(B){var Q=0,K=s.properties.colorModifiers;for(F=K.length,Q=0;Q<F;Q++)(Se=K[Q]).value.isColorFresnel||Se.value.isScalarFresnel?(ce("uniform vec4 SCENEJS_uColorModFresnelEdge"+Q+";"),ce("uniform vec4 SCENEJS_uColorModFresnelCenter"+Q+";"),ce("uniform float SCENEJS_uColorModFresnelPower"+Q+";")):ce(Se.applyTo===i.TINT?"uniform vec3 SCENEJS_uColorModification"+Q+";":"uniform float SCENEJS_uColorModification"+Q+";"),Se.range&&(ce("uniform vec3 SCENEJS_uColorModCenter"+Q+";"),ce("uniform vec2 SCENEJS_uColorModRadius"+Q+";"))}if(z){var $,ee=0;for(F=(ge=s.properties.opacityModifiers).length,ee=0;ee<F;ee++)($=ge[ee]).value.isScalarFresnel?(ce("uniform vec4 SCENEJS_uOpacityModFresnelEdge"+ee+";"),ce("uniform vec4 SCENEJS_uOpacityModFresnelCenter"+ee+";"),ce("uniform float SCENEJS_uOpacityModFresnelPower"+ee+";")):ce("uniform float SCENEJS_uOpacityModification"+ee+";"),$.range&&(ce("uniform vec3 SCENEJS_uOpacityModCenter"+ee+";"),ce("uniform vec2 SCENEJS_uOpacityModRadius"+ee+";"))}if(O&&(ce("uniform vec4   SCENEJS_uFogParams;"),ce("uniform vec4   SCENEJS_uFogColor;")),N&&(ce("varying vec2 SCENEJS_vRegionMapUV;"),ce("uniform sampler2D SCENEJS_uRegionMapSampler;"),ce("uniform vec3 SCENEJS_uRegionMapRegionColor;"),ce("uniform vec3 SCENEJS_uRegionMapHighlightFactor;"),ce("uniform float SCENEJS_uRegionMapHideAlpha;")),x)for(y&&ce("uniform vec3  SCENEJS_uSolidColor;"),M=0;M<s.clips.clips.length;M++)ce("uniform vec4  SCENEJS_uClipNormalAndDist"+M+";"),s.clips.clips[M].fade&&ce("uniform float SCENEJS_uClipFadeDistance"+M+";");if(ce("uniform float SCENEJS_uOutputFormat;"),ce("#define RGB_YCOCG mat3(0.25, 0.5, -0.25, 0.5, 0.0, 0.5, 0.25, -0.5, -0.25)"),A&&(P&&ce("varying float SCENEJS_vPointRotation;"),w&&(ce("uniform vec2 SCENEJS_uPointUVScale;"),ce("varying vec2 SCENEJS_vPointUVTranslate;"))),T&&(Z.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),Z.push("    return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),Z.push("}")),ce("void main(void) {"),x){for(s.clips.clipDiscard&&ce("float distOff = 0.0;"),s.clips.clipFade&&ce("float distAlpha = 0.0;"),M=0;M<s.clips.clips.length;M++)ce(s.clips.clips[M].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+M+".xyz) + SCENEJS_uClipNormalAndDist"+M+".w) / SCENEJS_uClipFadeDistance"+M+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+M+".xyz) + SCENEJS_uClipNormalAndDist"+M+".w);");s.clips.clipDiscard&&ce("if (distOff > 0.0) { discard; }"),s.clips.clipFade&&ce("if (distAlpha > 1.0) { discard; }"),y&&(ce("if (gl_FrontFacing == false) {"),ce("   gl_FragColor = vec4(SCENEJS_uSolidColor, 1.0);"),ce("   return;"),ce("}"))}if(A&&D&&(ce("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),ce("float r = dot(cxy, cxy);"),ce("if (r > 1.0) {"),ce("   discard;"),ce("}")),g&&ce("vec3 worldEyeVec = normalize(SCENEJS_uWorldEye - SCENEJS_vWorldVertex.xyz);"),s.geometry.colorBuf?(ce("  vec3  color   = SCENEJS_vColor.rgb;"),ce("  float colorAlpha  = SCENEJS_vColor.a;")):ce("  vec3  color   = SCENEJS_uMaterialColor.rgb;"),ce("  float alpha = SCENEJS_uMaterialColor.a;"),ce("  float emit          = SCENEJS_uMaterialEmitColor.a;"),ce("  vec3  emitColor     = SCENEJS_uMaterialEmitColor.rgb;"),ce("  float occlusion     = 1.0;"),s.geometry.colorBuf&&ce("alpha *= colorAlpha;"),ce("float transparency  = 1.0 - alpha;"),c&&(ce("  vec3  ambientColor  = SCENEJS_uAmbientColor;"),ce("  float specular      = SCENEJS_uMaterialSpecularColor.a;"),ce("  vec3  specularColor = SCENEJS_uMaterialSpecularColor.rgb;"),ce("  float shine         = SCENEJS_uMaterialShine;")),u&&(ce("  vec3  ambientColor  = vec3(0.2, 0.2, 0.2);"),ce("  float metallic      = SCENEJS_uMetalRoughSpecularf0.r;"),ce("  float roughness     = SCENEJS_uMetalRoughSpecularf0.g;"),ce("  float specularF0    = SCENEJS_uMetalRoughSpecularf0.b;")),g&&(ce("float attenuation = 1.0;"),ce(b?"vec3 viewNormalVec = vec3(0.0, 0.0, 0.0);":"vec3 viewNormalVec = normalize(SCENEJS_vViewNormal);"),ce("vec3 viewEyeVec = normalize(SCENEJS_vViewEyeVec);"),ce("  float glassfactor = SCENEJS_uXrayParams.x;"),ce("  float murkiness = SCENEJS_uXrayParams.y;"),ce("if (transparency > 0.0) {"),ce("  alpha = 1.0 - transparency;"),ce("  float gf = (glassfactor  * (murkiness - abs(dot(SCENEJS_vViewNormal, vec3(0.0, 0.0, -1.0)))));"),ce("  alpha = max(alpha, gf);"),ce("  transparency = 1.0 - alpha;"),ce("}")),g&&b&&!I&&(ce("mat3 mat =  mat3(SCENEJS_uVMatrix * SCENEJS_uMMatrix);"),ce("vec3 n = normalize(SCENEJS_vViewNormal);"),ce("vec3 t = normalize(mat * SCENEJS_vTangent);"),ce("vec3 b = normalize(cross(SCENEJS_vViewNormal, mat * SCENEJS_vTangent));"),ce("mat3 TBN = mat3(t, b, n);")),h){ce("vec2 textureCoord;");var te=!0,re=!0,ae=!0,ie=!0,ne=!0,oe=!0,se=!0,_e=!0,he=!0;for(A&&(ce("vec2 pointCoord = vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y);"),ce("vec2 centerCoord = vec2(0.5);"),w&&(ce("centerCoord = SCENEJS_vPointUVTranslate + SCENEJS_uPointUVScale * 0.5;"),ce("pointCoord = pointCoord * SCENEJS_uPointUVScale + SCENEJS_vPointUVTranslate;")),P&&(ce("vec2 pivot = pointCoord - centerCoord;"),ce("float c = cos(SCENEJS_vPointRotation);"),ce("float s = sin(SCENEJS_vPointRotation);"),ce("pointCoord.x = c * pivot.x + s * pivot.y + centerCoord.x;"),ce("pointCoord.y = c * pivot.y - s * pivot.x + centerCoord.y;"))),M=0,F=s.texture.layers.length;M<F;M++){var fe,de=(R=s.texture.layers[M]).uvLayerIdx||0;if((fe=s.geometry.uvBufs)&&fe[de])ce("textureCoord = SCENEJS_vUVCoord"+de+";");else{if(!A){SceneJS.log.warn("Texture layer applyTo='uv' but geometry has no UV coordinates for layer "+de);continue}ce("textureCoord = pointCoord;")}if(R.matrix&&ce("textureCoord=(SCENEJS_uLayer"+M+"Matrix * vec4(textureCoord, 1.0, 1.0)).xy;"),R.compressed&&ce("textureCoord.y = 1.0 - textureCoord.y;"),R.flags&t.alpha&&(te?(ce("transparency = mix(transparency, 1.0 - texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);"),te=!1):R.flags&t.multiply?(ce("alpha = 1.0 - transparency;"),ce("alpha *= 1.0 - SCENEJS_uLayer"+M+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+M+", textureCoord).r);"),ce("transparency = 1.0 - alpha;")):R.flags&t.add?(ce("alpha = 1.0 - transparency;"),ce("alpha += SCENEJS_uLayer"+M+"BlendFactor * (texture2D(SCENEJS_uSampler"+M+", textureCoord).r);"),ce("transparency = 1.0 - alpha;")):R.flags&t.over&&(ce("alpha = 1.0 - transparency;"),ce("alpha = mix(alpha, texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);"),ce("transparency = 1.0 - alpha;"))),R.flags&t.transparency&&(te?(ce("transparency = mix(transparency, texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);"),te=!1):R.flags&t.multiply?ce("transparency *= 1.0 - SCENEJS_uLayer"+M+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+M+", textureCoord).r);"):R.flags&t.add?ce("transparency += SCENEJS_uLayer"+M+"BlendFactor * (texture2D(SCENEJS_uSampler"+M+", textureCoord).r);"):R.flags&t.over&&ce("transparency = mix(transparency, texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);")),R.flags&t.occlusion&&(ae?(ce("occlusion = mix(occlusion, texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);"),ae=!1):R.flags&t.multiply?ce("occlusion *= 1.0 - SCENEJS_uLayer"+M+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+M+", textureCoord).r);"):R.flags&t.add?ce("occlusion += SCENEJS_uLayer"+M+"BlendFactor * texture2D(SCENEJS_uSampler"+M+", textureCoord).r;"):R.flags&t.over&&ce("occlusion = mix(occlusion, texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);")),c&&(_?(R.flags&t.baseColor&&(re?(ce("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb, SCENEJS_uLayer"+M+"BlendFactor);"),re=!1):R.flags&t.multiply?ce("color *= 1.0 - SCENEJS_uLayer"+M+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb);"):R.flags&t.add?ce("color += SCENEJS_uLayer"+M+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb;"):R.flags&t.over&&ce("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb, SCENEJS_uLayer"+M+"BlendFactor);")),R.flags&t.emit&&(ie?(ce("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb, SCENEJS_uLayer"+M+"BlendFactor);"),ie=!1):R.flags&t.multiply?ce("emitColor *= 1.0 - SCENEJS_uLayer"+M+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb);"):R.flags&t.add?ce("emitColor += SCENEJS_uLayer"+M+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb;"):R.flags&t.over&&ce("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb, SCENEJS_uLayer"+M+"BlendFactor);"))):(R.flags&t.baseColor&&(re?(R.flags&t.conditionalAlpha?(ce("if(textureCoord.x != -1.0) {"),ce("   vec4 color"+M+" = texture2D(SCENEJS_uSampler"+M+", textureCoord);"),ce("   color = mix(color, color"+M+".rgb, color"+M+".a * SCENEJS_uLayer"+M+"BlendFactor);"),ce("}")):ce("color = mix(color, texture2D(SCENEJS_uSampler"+M+", textureCoord).rgb, SCENEJS_uLayer"+M+"BlendFactor);"),re=!1):R.flags&t.multiply?ce("color *= 1.0 - SCENEJS_uLayer"+M+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+M+", textureCoord).rgb);"):R.flags&t.add?ce("color += SCENEJS_uLayer"+M+"BlendFactor * texture2D(SCENEJS_uSampler"+M+", textureCoord).rgb;"):R.flags&t.over?ce("color = mix(color, texture2D(SCENEJS_uSampler"+M+", textureCoord).rgb, SCENEJS_uLayer"+M+"BlendFactor);"):R.flags&t.conditionalAlpha&&(ce("if(textureCoord.x != -1.0) {"),ce("vec4 color"+M+" = texture2D(SCENEJS_uSampler"+M+", textureCoord);"),ce("color = mix(color, color"+M+".rgb, color"+M+".a * SCENEJS_uLayer"+M+"BlendFactor);"),ce("}"))),R.flags&t.emit&&(ie?(ce("emitColor = mix(emitColor, texture2D(SCENEJS_uSampler"+M+", textureCoord).rgb, SCENEJS_uLayer"+M+"BlendFactor);"),ie=!1):R.flags&t.multiply?ce("emitColor *= 1.0 - SCENEJS_uLayer"+M+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+M+", textureCoord).rgb);"):R.flags&t.add?ce("emitColor += SCENEJS_uLayer"+M+"BlendFactor * texture2D(SCENEJS_uSampler"+M+", textureCoord).rgb;"):R.flags&t.over&&ce("emitColor = mix(emitColor, texture2D(SCENEJS_uSampler"+M+", textureCoord).rgb, SCENEJS_uLayer"+M+"BlendFactor);"))),R.flags&t.specular&&g&&(ne?(ce("specular = mix(specular, texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);"),ne=!1):R.flags&t.multiply?ce("specular *= 1.0 - SCENEJS_uLayer"+M+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+M+", textureCoord).r);"):R.flags&t.add?ce("specular += SCENEJS_uLayer"+M+"BlendFactor * texture2D(SCENEJS_uSampler"+M+", textureCoord).r;"):R.flags&t.over&&ce("specular = mix(specular, texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);")),R.flags&t.shine&&(oe?(ce("shine = mix((shine, texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);"),oe=!1):R.flags&t.multiply?ce("shine *= 1.0 - SCENEJS_uLayer"+M+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+M+", textureCoord).r);"):R.flags&t.add?ce("shine += SCENEJS_uLayer"+M+"BlendFactor * texture2D(SCENEJS_uSampler"+M+", textureCoord).r;"):R.flags&t.over&&ce("shine = mix((shine, texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);"))),u&&(R.flags&t.baseColor&&(re?(ce("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb, SCENEJS_uLayer"+M+"BlendFactor);"),re=!1):R.flags&t.multiply?ce("color *= 1.0 - SCENEJS_uLayer"+M+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb);"):R.flags&t.add?ce("color += SCENEJS_uLayer"+M+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb;"):R.flags&t.over&&ce("color = mix(color, sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb, SCENEJS_uLayer"+M+"BlendFactor);")),R.flags&t.emit&&(ie?(ce("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb, SCENEJS_uLayer"+M+"BlendFactor);"),ie=!1):R.flags&t.multiply?ce("emitColor *= 1.0 - SCENEJS_uLayer"+M+"BlendFactor * (1.0 - sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb);"):R.flags&t.add?ce("emitColor += SCENEJS_uLayer"+M+"BlendFactor * sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb;"):R.flags&t.over&&ce("emitColor = mix(emitColor, sRGBToLinear(texture2D(SCENEJS_uSampler"+M+", textureCoord)).rgb, SCENEJS_uLayer"+M+"BlendFactor);")),R.flags&t.metallic&&(se?(ce("metallic = mix(metallic, texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);"),se=!1):R.flags&t.multiply?ce("metallic *= 1.0 - SCENEJS_uLayer"+M+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+M+", textureCoord).r);"):R.flags&t.add?ce("metallic += SCENEJS_uLayer"+M+"BlendFactor * texture2D(SCENEJS_uSampler"+M+", textureCoord).r;"):R.flags&t.over&&ce("metallic = mix(metallic, texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);")),R.flags&t.roughness&&(_e?(ce("roughness = mix(roughness, texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);"),_e=!1):R.flags&t.multiply?ce("roughness *= 1.0 - SCENEJS_uLayer"+M+"BlendFactor * (1.0 - texture2D(SCENEJS_uSampler"+M+", textureCoord).r);"):R.flags&t.add?ce("roughness += SCENEJS_uLayer"+M+"BlendFactor * texture2D(SCENEJS_uSampler"+M+", textureCoord).r;"):R.flags&t.over&&ce("roughness = mix(roughness, texture2D(SCENEJS_uSampler"+M+", textureCoord).r, SCENEJS_uLayer"+M+"BlendFactor);"))),R.flags&t.normals&&g){var pe,me=R.flags&t.swizzledNormals;R.flags&t.add?(pe=he?"=":"+=",I?ce(me?R.compressed?"viewNormalVec "+pe+" perturbNormal2ArbSwz( SCENEJS_uSampler"+M+", SCENEJS_vViewVertex.xyz, SCENEJS_vViewNormal, textureCoord ) * SCENEJS_uLayer"+M+"BlendFactor;":"viewNormalVec "+pe+" perturbNormal2ArbSwz( SCENEJS_uSampler"+M+", SCENEJS_vViewVertex.xyz, SCENEJS_vViewNormal, vec2(textureCoord.x, 1.0 - textureCoord.y) ) * SCENEJS_uLayer"+M+"BlendFactor;":"viewNormalVec "+pe+" perturbNormal2Arb( SCENEJS_uSampler"+M+", SCENEJS_vViewVertex.xyz, SCENEJS_vViewNormal, textureCoord ) * SCENEJS_uLayer"+M+"BlendFactor;"):me?(ce(R.compressed?"swizzledNormalMap = texture2D(SCENEJS_uSampler"+M+", textureCoord);":"swizzledNormalMap = texture2D(SCENEJS_uSampler"+M+", vec2(textureCoord.x, 1.0 - textureCoord.y));"),ce("vNormal = vec3(swizzledNormalMap.ag * 2.0 - 1.0, 0.0);"),ce("vNormal.z = sqrt(max(1.0 - dot(vNormal.xy, vNormal.xy), 0.0));"),ce("viewNormalVec "+pe+" (TBN * normalize(vNormal)) * SCENEJS_uLayer"+M+"BlendFactor;")):ce("viewNormalVec "+pe+" (TBN * normalize(texture2D(SCENEJS_uSampler"+M+", textureCoord).xyz * 2.0 - 1.0)) * SCENEJS_uLayer"+M+"BlendFactor;")):I?ce(me?R.compressed?"viewNormalVec "+pe+" perturbNormal2ArbSwz( SCENEJS_uSampler"+M+", SCENEJS_vViewVertex.xyz, SCENEJS_vViewNormal, textureCoord ) * SCENEJS_uLayer"+M+"BlendFactor;":"viewNormalVec "+pe+" perturbNormal2ArbSwz( SCENEJS_uSampler"+M+", SCENEJS_vViewVertex.xyz, SCENEJS_vViewNormal, vec2(textureCoord.x, 1.0 - textureCoord.y) ) * SCENEJS_uLayer"+M+"BlendFactor;":"viewNormalVec = mix(viewNormalVec, (perturbNormal2Arb(SCENEJS_uSampler"+M+", SCENEJS_vViewVertex.xyz, SCENEJS_vViewNormal, textureCoord).xyz), SCENEJS_uLayer"+M+"BlendFactor);"):me?(ce(R.compressed?"swizzledNormalMap = texture2D(SCENEJS_uSampler"+M+", textureCoord);":"swizzledNormalMap = texture2D(SCENEJS_uSampler"+M+", vec2(textureCoord.x, 1.0 - textureCoord.y));"),ce("vNormal = vec3(swizzledNormalMap.ag * 2.0 - 1.0, 0.0);"),ce("vNormal.z = sqrt(max(1.0 - dot(vNormal.xy, vNormal.xy), 0.0));"),ce("viewNormalVec = mix(viewNormalVec, TBN * normalize(vNormal), SCENEJS_uLayer"+M+"BlendFactor);")):ce("viewNormalVec = mix(viewNormalVec, TBN * normalize(texture2D(SCENEJS_uSampler"+M+", textureCoord).xyz * 2.0 - 1.0), SCENEJS_uLayer"+M+"BlendFactor);"),he=!1}}b&&ce("viewNormalVec = normalize(viewNormalVec);")}if(ce("vec4 fragColor;"),g){if(ce("vec3 viewLightDir;"),c){if(ce("vec3 lightValue = vec3(0.0, 0.0, 0.0);"),ce("vec3 specularValue  = vec3(0.0, 0.0, 0.0);"),ce("vec3 viewLightVec;"),ce("float dotN;"),ce("float spotDirRatio;"),ce("float lightDist;"),f)for(ce("float reflectFactor = 1.0;"),v&&(ce("float reflectFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uReflectFresnelEdgeColor.a,  SCENEJS_uReflectFresnelCenterColor.a, SCENEJS_uReflectFresnelPower);"),v.blendMode&t.multiply?ce("reflectFactor *= mix(SCENEJS_uReflectFresnelEdgeColor.b, SCENEJS_uReflectFresnelCenterColor.b, reflectFresnel);"):v.blendMode&t.add&&ce("reflectFactor += mix(SCENEJS_uReflectFresnelEdgeColor.b, SCENEJS_uReflectFresnelCenterColor.b, reflectFresnel);")),ce("vec3 envLookup = reflect(-viewEyeVec, viewNormalVec);"),ce("vec4 envColor;"),M=0,F=s.cubemap.layers.length;M<F;M++)(R=s.cubemap.layers[M]).applyTo===SceneJS.CUBEMAP_FLAGS.reflect&&(ce("envColor = textureCube(SCENEJS_uCubeMapSampler"+M+", envLookup);"),ce("color = mix(color, envColor.rgb, reflectFactor * specular * SCENEJS_uCubeMapIntensity"+M+");"));for(M=0,F=s.lights.length;M<F;M++)"ambient"!=(L=s.lights[M]).mode&&("point"==L.mode&&("world"==L.space?(ce("viewLightVec = SCENEJS_uLightPos"+M+" - SCENEJS_vWorldVertex.xyz;"),ce("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):ce("viewLightVec = SCENEJS_uLightPos"+M+".xyz - SCENEJS_vViewVertex.xyz;"),ce("dotN = max(dot(viewNormalVec, normalize(viewLightVec)), 0.0);"),ce("lightDist = length( SCENEJS_uLightPos"+M+" - SCENEJS_vWorldVertex.xyz);"),ce("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+M+".x +   SCENEJS_uLightAttenuation"+M+".y * lightDist +   SCENEJS_uLightAttenuation"+M+".z * lightDist * lightDist);"),L.diffuse&&ce("      lightValue += dotN * SCENEJS_uLightColor"+M+" * attenuation;"),L.specular&&ce("    specularValue += specularColor * SCENEJS_uLightColor"+M+" * specular * pow(max(dot(reflect(normalize(-viewLightVec), -viewNormalVec), normalize(-SCENEJS_vViewVertex.xyz)), 0.0), shine) * attenuation;")),"spot"==L.mode&&(ce("viewLightDir = SCENEJS_uLightDir"+M+";"),"world"==L.space?(ce("viewLightVec = SCENEJS_uLightPos"+M+" - SCENEJS_vWorldVertex.xyz;"),ce("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;"),ce("viewLightDir = vec3(SCENEJS_uVMatrix * vec4(viewLightDir, 0.0)).xyz;")):ce("viewLightVec = SCENEJS_uLightPos"+M+".xyz - SCENEJS_vViewVertex.xyz;"),ce("dotN = max(dot(viewNormalVec, normalize(viewLightVec)), 0.0);"),ce("spotDirRatio = 1.0 - max(dot(normalize(viewLightDir), normalize(-viewLightVec)), 0.0);"),ce("lightDist = length( SCENEJS_uLightPos"+M+" - SCENEJS_vWorldVertex.xyz);"),ce("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+M+".x +   SCENEJS_uLightAttenuation"+M+".y * lightDist +   SCENEJS_uLightAttenuation"+M+".z * lightDist * lightDist);"),ce("attenuation *= 1.0 - clamp((spotDirRatio - SCENEJS_uInnerCone"+M+") / max(SCENEJS_uOuterCone"+M+" - SCENEJS_uInnerCone"+M+", 0.0001), 0.0, 1.0);"),L.diffuse&&ce("      lightValue += dotN * SCENEJS_uLightColor"+M+" * attenuation;"),L.specular&&ce("    specularValue += specularColor * SCENEJS_uLightColor"+M+" * specular * pow(max(dot(reflect(normalize(-viewLightVec), -viewNormalVec), normalize(-SCENEJS_vViewVertex.xyz)), 0.0), shine) * attenuation;")),"dir"==L.mode&&("world"==L.space?(ce("viewLightVec = normalize(SCENEJS_uLightDir"+M+");"),ce("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):ce("viewLightVec = normalize(SCENEJS_uLightDir"+M+");"),ce("viewLightVec = -viewLightVec;"),ce("dotN = max(dot(viewNormalVec, normalize(viewLightVec)), 0.0);"),L.diffuse&&ce("lightValue += dotN * SCENEJS_uLightColor"+M+";"),L.specular&&ce("specularValue += specularColor * SCENEJS_uLightColor"+M+" * specular * pow(max(dot(reflect(normalize(-viewLightVec), -viewNormalVec), normalize(-SCENEJS_vViewVertex.xyz)), 0.0), shine);")));r&&(ce("float diffuseFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uDiffuseFresnelEdgeColor.a, SCENEJS_uDiffuseFresnelCenterColor.a, SCENEJS_uDiffuseFresnelPower);"),r.blendMode&t.multiply?ce("color.rgb *= mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);"):r.blendMode&t.add&&ce("color.rgb += mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);")),a&&(ce("float specFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uSpecularFresnelEdgeColor.a, SCENEJS_uSpecularFresnelCenterColor.a, SCENEJS_uSpecularFresnelPower);"),a.blendMode&t.multiply?ce("specularValue.rgb *= mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);"):a.blendMode&t.add&&ce("specularValue.rgb += mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);")),n&&(ce("float alphaFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uAlphaFresnelEdgeColor.a, SCENEJS_uAlphaFresnelCenterColor.a, SCENEJS_uAlphaFresnelPower);"),ce("alpha = 1.0 - transparency;"),n.blendMode&t.multiply?ce("alpha *= mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"):n.blendMode&t.add&&ce("alpha += mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"),ce("transparency = 1.0 -alpha;")),l&&(ce("float transparencyFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uTransparencyFresnelEdgeColor.a, SCENEJS_uTransparencyFresnelCenterColor.a, SCENEJS_uTransparencyFresnelPower);"),l.blendMode&t.multiply?ce("transparency *= mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);"):l.blendMode&t.add&&ce("transparency += mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);")),S&&(ce("float emitFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uEmitFresnelEdgeColor.a, SCENEJS_uEmitFresnelCenterColor.a, SCENEJS_uEmitFresnelPower);"),S.blendMode&t.multiply?ce("emitColor.rgb *= mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);"):S.blendMode&t.add&&ce("emitColor.rgb += mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);")),ce("alpha = 1.0 - transparency;"),ce("fragColor = vec4((specularValue.rgb + color.rgb * (lightValue.rgb + ambientColor.rgb)) + (emit * emitColor.rgb), alpha);")}if(u){for(ce("IncidentLight  light;"),ce("Material       material;"),ce("Geometry       geometry;"),ce("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),ce("float dielectricSpecular   = 0.16 * specularF0 * specularF0;"),ce("material.diffuseColor      = color * (1.0 - dielectricSpecular) * (1.0 - metallic);"),ce("float realRoughness = sqrt(roughness);"),ce("material.specularRoughness = clamp(realRoughness, 0.04, 1.0);"),ce("material.specularColor     = mix(vec3(dielectricSpecular), color, metallic);"),ce("geometry.position = SCENEJS_vViewVertex.xyz;"),d&&ce("geometry.worldNormal = normalize(SCENEJS_vWorldNormal);"),ce("geometry.viewNormal = viewNormalVec;"),ce("geometry.viewEyeDir = -normalize(SCENEJS_vViewVertex.xyz);"),p&&ce("computePBRReflectionMapping(SCENEJS_uPBRReflectionMapSampler, SCENEJS_uPBRReflectionMapIntensity, SCENEJS_uVMatrix, geometry, material, reflectedLight, SCENEJS_uPBRReflectionMapMipLevels);"),m&&ce("world"===s.lightmaps.activeLightmap.space?"computePBRLightMapping(SCENEJS_uPBRLightMapSampler, SCENEJS_uPBRLightMapIntensity, geometry.worldNormal, material, reflectedLight);":"computePBRLightMapping(SCENEJS_uPBRLightMapSampler, SCENEJS_uPBRLightMapIntensity, geometry.viewNormal, material, reflectedLight);"),ce("vec3 lightValue = vec3(0.0, 0.0, 0.0);"),ce("vec3 specularValue  = vec3(0.0, 0.0, 0.0);"),ce("vec3 viewLightVec;"),ce("float dotN;"),ce("float spotDirRatio;"),ce("float lightDist;"),M=0,F=s.lights.length;M<F;M++)"ambient"!=(L=s.lights[M]).mode&&("dir"==L.mode&&("world"==L.space?(ce("viewLightVec = normalize(SCENEJS_uLightDir"+M+");"),ce("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):ce("viewLightVec = normalize(SCENEJS_uLightDir"+M+");"),ce("viewLightVec = -viewLightVec;"),ce("light.direction = viewLightVec;"),ce("light.color = SCENEJS_uLightColor"+M+";"),ce("computePBRLighting(light, geometry, material, reflectedLight);")),"point"==L.mode&&("world"==L.space?(ce("viewLightVec = SCENEJS_uLightPos"+M+" - SCENEJS_vWorldVertex.xyz;"),ce("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;")):ce("viewLightVec = SCENEJS_uLightPos"+M+".xyz - SCENEJS_vViewVertex.xyz;"),ce("lightDist = length(viewLightVec);"),ce("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+M+".x +   SCENEJS_uLightAttenuation"+M+".y * lightDist +   SCENEJS_uLightAttenuation"+M+".z * lightDist * lightDist);"),ce("light.direction = normalize(viewLightVec);"),ce("light.color = SCENEJS_uLightColor"+M+" * attenuation;"),ce("computePBRLighting(light, geometry, material, reflectedLight);")),"spot"==L.mode&&(ce("viewLightDir = SCENEJS_uLightDir"+M+";"),"world"==L.space?(ce("viewLightVec = SCENEJS_uLightPos"+M+" - SCENEJS_vWorldVertex.xyz;"),ce("viewLightVec = vec3(SCENEJS_uVMatrix * vec4(viewLightVec, 0.0)).xyz;"),ce("viewLightDir = vec3(SCENEJS_uVMatrix * vec4(viewLightDir, 0.0)).xyz;")):ce("viewLightVec = SCENEJS_uLightPos"+M+".xyz - SCENEJS_vViewVertex.xyz;"),ce("spotDirRatio = 1.0 - max(dot(normalize(viewLightDir), normalize(-viewLightVec)), 0.0);"),ce("lightDist = length(SCENEJS_uLightPos"+M+" - SCENEJS_vWorldVertex.xyz);"),ce("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+M+".x +   SCENEJS_uLightAttenuation"+M+".y * lightDist +   SCENEJS_uLightAttenuation"+M+".z * lightDist * lightDist);"),ce("attenuation *= 1.0 - clamp((spotDirRatio - SCENEJS_uInnerCone"+M+") / max(SCENEJS_uOuterCone"+M+" - SCENEJS_uInnerCone"+M+", 0.0001), 0.0, 1.0);"),ce("light.direction = normalize(viewLightVec);"),ce("light.color = SCENEJS_uLightColor"+M+" * attenuation;"),ce("computePBRLighting(light, geometry, material, reflectedLight);")));r&&(ce("float diffuseFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uDiffuseFresnelEdgeColor.a, SCENEJS_uDiffuseFresnelCenterColor.a, SCENEJS_uDiffuseFresnelPower);"),r.blendMode&t.multiply?ce("reflectedLight.diffuse *= mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);"):r.blendMode&t.add&&ce("reflectedLight.diffuse += mix(SCENEJS_uDiffuseFresnelEdgeColor.rgb, SCENEJS_uDiffuseFresnelCenterColor.rgb, diffuseFresnel);")),a&&(ce("float specFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uSpecularFresnelEdgeColor.a, SCENEJS_uSpecularFresnelCenterColor.a, SCENEJS_uSpecularFresnelPower);"),a.blendMode&t.multiply?ce("reflectedLight.specular *= mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);"):a.blendMode&t.add&&ce("reflectedLight.specular += mix(SCENEJS_uSpecularFresnelEdgeColor.rgb, SCENEJS_uSpecularFresnelCenterColor.rgb, specFresnel);")),n&&(ce("float alphaFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uAlphaFresnelEdgeColor.a, SCENEJS_uAlphaFresnelCenterColor.a, SCENEJS_uAlphaFresnelPower);"),ce("alpha = 1.0 - transparency;"),n.blendMode&t.multiply?ce("alpha *= mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"):n.blendMode&t.add&&ce("alpha += mix(SCENEJS_uAlphaFresnelEdgeColor.r, SCENEJS_uAlphaFresnelCenterColor.r, alphaFresnel);"),ce("transparency = 1.0 - alpha;")),l&&(ce("float transparencyFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uTransparencyFresnelEdgeColor.a, SCENEJS_uTransparencyFresnelCenterColor.a, SCENEJS_uTransparencyFresnelPower);"),l.blendMode&t.multiply?ce("transparency *= mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);"):l.blendMode&t.add&&ce("transparency += mix(SCENEJS_uTransparencyFresnelEdgeColor.r, SCENEJS_uTransparencyFresnelCenterColor.r, transparencyFresnel);")),S&&(ce("float emitFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uEmitFresnelEdgeColor.a, SCENEJS_uEmitFresnelCenterColor.a, SCENEJS_uEmitFresnelPower);"),S.blendMode&t.multiply?ce("emitColor.rgb *= mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);"):S.blendMode&t.add&&ce("emitColor.rgb += mix(SCENEJS_uEmitFresnelEdgeColor.rgb, SCENEJS_uEmitFresnelCenterColor.rgb, emitFresnel);")),ce("vec3 outgoingLight = (occlusion * reflectedLight.diffuse) + (occlusion * reflectedLight.specular) + (emit * emitColor);"),ce("alpha = 1.0 - transparency;"),ce("fragColor = vec4(outgoingLight, alpha);")}}else ce("alpha = 1.0 - transparency;"),ce("fragColor = vec4((color.rgb + (emit * color.rgb)) *  (vec3(1.0, 1.0, 1.0) + ambientColor.rgb), alpha);");if(z){ee=0,F=(ge=s.properties.opacityModifiers).length;var ge,ye=!1,ve=!1;for(ce("float opacity;"),ee=0;ee<F;ee++)($=ge[ee]).value.isScalarFresnel?(ye||(ce("float opacityModFresnel;"),ye=!0),ce("opacityModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uOpacityModFresnelEdge"+ee+".a, SCENEJS_uOpacityModFresnelCenter"+ee+".a, SCENEJS_uOpacityModFresnelPower"+ee+");"),ce("opacity = mix(SCENEJS_uOpacityModFresnelEdge"+ee+".r, SCENEJS_uOpacityModFresnelCenter"+ee+".r, opacityModFresnel);")):ce("opacity =  SCENEJS_uOpacityModification"+ee+";"),$.range&&(ve||(ce("float opacityModFactor;"),ve=!0),ce("opacityModFactor = 1.0 - clamp((length(SCENEJS_vWorldVertex.xyz - SCENEJS_uOpacityModCenter"+ee+") - SCENEJS_uOpacityModRadius"+ee+".x) / SCENEJS_uOpacityModRadius"+ee+".y, 0.0, 1.0);"),ce("opacity = mix(1.0, opacity, opacityModFactor);")),ce("fragColor.a *= opacity;")}if(x&&s.clips.clipFade&&ce("fragColor.a *= 1.0 - max(distAlpha, 0.0);"),N&&(ce("vec3 regionColor = texture2D(SCENEJS_uRegionMapSampler, vec2(SCENEJS_vRegionMapUV.s, SCENEJS_vRegionMapUV.t)).rgb;"),ce("float tolerance = 0.01;"),ce("vec3 colorDelta = abs(SCENEJS_uRegionMapRegionColor - regionColor);"),"highlight"===s.regionMap.mode||"hide"===s.regionMap.mode?(ce("if (max(colorDelta.x, max(colorDelta.y, colorDelta.z)) < tolerance) {"),ce("highlight"===s.regionMap.mode?"  fragColor.rgb *= SCENEJS_uRegionMapHighlightFactor;":"  fragColor.a = SCENEJS_uRegionMapHideAlpha;"),ce("}")):(ce("if (max(colorDelta.x, max(colorDelta.y, colorDelta.z)) > tolerance) {"),ce("  fragColor.a = SCENEJS_uRegionMapHideAlpha;"),ce("}"))),X&&(ce("if (SCENEJS_uDiscardOpaque && fragColor.a >= 1.0) { discard; }"),ce("if (!SCENEJS_uDiscardOpaque && fragColor.a < 1.0) { discard; }")),Y&&(ce("{"),ce("    float maxDeriv = max(length(dFdx(SceneJS_vModelVertex.xy)), length(dFdy(SceneJS_vModelVertex.xy)));"),ce("    float pixScale = 1.0 / maxDeriv;"),ce("    vec2 pixScales = vec2( exp2(floor(log2(pixScale))), exp2(ceil(log2(pixScale))) );"),ce("    vec2 alpha = vec2(hash3D(floor(pixScales.x * SceneJS_vModelVertex.xyz)), hash3D(floor(pixScales.y * SceneJS_vModelVertex.xyz)));"),ce("    float lerpFactor = fract(log2(pixScale));"),ce("    float x = (1.0 - lerpFactor) * alpha.x + lerpFactor * alpha.y;"),ce("    float a = min(lerpFactor, 1.0 - lerpFactor);"),ce("    vec3 cases = vec3("),ce("        x * x / (2.0 * a * (1.0 - a)), "),ce("        (x - 0.5 * a)/(1.0 - a), "),ce("        1.0 - ((1.0 - x) * (1.0 - x) / (2.0 * a * (1.0 - a)))"),ce("    );"),ce("    float aThresh = (x < (1.0 - a)) ? ((x < a) ? cases.x : cases.y) : cases.z;"),ce("    aThresh = clamp(aThresh, 1.0e-6, 1.0);"),ce("    if (fragColor.a < aThresh) {"),ce("        discard;"),ce("    } else {"),ce("        fragColor.a = 1.0;"),ce("    }"),ce("}")),U.length>0){ce("float colorModFresnel;"),ce("float saturation;"),ce("float contrast;"),ce("float brightness;"),ce("float colorModFactor;"),ce("vec3 tintColor;");var Se,be=!1;for(Q=0,F=U.length,Q=0;Q<F;Q++)(Se=U[Q]).range&&ce("colorModFactor = 1.0 - clamp((length(SCENEJS_vWorldVertex.xyz - SCENEJS_uColorModCenter"+Q+") - SCENEJS_uColorModRadius"+Q+".x) / SCENEJS_uColorModRadius"+Q+".y, 0.0, 1.0);"),Se.applyTo===i.SATURATION?(be||(ce("float L = dot(vec3(0.3, 0.59, 0.11), fragColor.rgb);"),be=!0),Se.value.isScalarFresnel?(ce("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+Q+".a, SCENEJS_uColorModFresnelCenter"+Q+".a, SCENEJS_uColorModFresnelPower"+Q+");"),ce("saturation = mix(SCENEJS_uColorModFresnelEdge"+Q+".r, SCENEJS_uColorModFresnelCenter"+Q+".r, colorModFresnel);")):ce("saturation = SCENEJS_uColorModification"+Q+";"),Se.range&&ce("saturation *= colorModFactor;"),ce("fragColor.rgb -= saturation * (L - fragColor.rgb);")):Se.applyTo===i.CONTRAST?(Se.value.isScalarFresnel?(ce("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+Q+".a, SCENEJS_uColorModFresnelCenter"+Q+".a, SCENEJS_uColorModFresnelPower"+Q+");"),ce("contrast = mix(SCENEJS_uColorModFresnelEdge"+Q+".r, SCENEJS_uColorModFresnelCenter"+Q+".r, colorModFresnel);")):ce("contrast = SCENEJS_uColorModification"+Q+";"),Se.range&&ce("contrast = mix(1.0, contrast, colorModFactor);"),ce("fragColor.rgb = (fragColor.rgb - 0.5) * contrast + 0.5;")):Se.applyTo===i.BRIGHTNESS?(Se.value.isScalarFresnel?(ce("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+Q+".a, SCENEJS_uColorModFresnelCenter"+Q+".a, SCENEJS_uColorModFresnelPower"+Q+");"),ce("brightness = mix(SCENEJS_uColorModFresnelEdge"+Q+".r, SCENEJS_uColorModFresnelCenter"+Q+".r, colorModFresnel);")):ce("brightness = SCENEJS_uColorModification"+Q+";"),Se.range&&ce("brightness *= colorModFactor;"),ce("fragColor.rgb += brightness;")):Se.applyTo===i.TINT&&(Se.value.isColorFresnel?(ce("colorModFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uColorModFresnelEdge"+Q+".a, SCENEJS_uColorModFresnelCenter"+Q+".a, SCENEJS_uColorModFresnelPower"+Q+");"),ce("tintColor = mix(SCENEJS_uColorModFresnelEdge"+Q+".rgb, SCENEJS_uColorModFresnelCenter"+Q+".rgb, colorModFresnel);"),Se.range&&ce("tintColor = mix(vec3(1.0), tintColor, colorModFactor);")):(ce("tintColor = SCENEJS_uColorModification"+Q+";"),Se.range&&ce("tintColor = mix(vec3(1.0), tintColor, colorModFactor);")),ce("fragColor.rgb *= tintColor;"))}return O&&(ce("vec3 fogColor = SCENEJS_uFogColor.rgb;"),ce("float fogDensity = SCENEJS_uFogColor.a;"),ce("float fogStart = SCENEJS_uFogParams.x;"),ce("float fogEnd = SCENEJS_uFogParams.y;"),ce("float fogMin = SCENEJS_uFogParams.z;"),ce("float fogMax = SCENEJS_uFogParams.w;"),H===e.FOG_LINEAR?ce("float fog = (length(SCENEJS_vViewVertex.xyz) - fogStart) / (fogEnd - fogStart);"):(ce("float fogAttenuation = fogDensity * max(length(SCENEJS_vViewVertex.xyz) - fogStart, 0.0);"),H===e.FOG_EXP2&&ce("fogAttenuation = fogAttenuation * fogAttenuation;"),ce("float fog = 1.0 - exp(-fogAttenuation);")),ce("fog = clamp(fog, fogMin, fogMax);"),ce("fragColor.rgb = mix(fragColor.rgb, fogColor, fog);")),C&&(ce("float fragmentFresnel = fresnel(viewEyeVec, viewNormalVec, SCENEJS_uFragmentFresnelEdgeColor.a, SCENEJS_uFragmentFresnelCenterColor.a, SCENEJS_uFragmentFresnelPower);"),C.blendMode&t.multiply?ce("fragColor.rgb *= mix(SCENEJS_uFragmentFresnelEdgeColor.rgb, SCENEJS_uFragmentFresnelCenterColor.rgb, fragmentFresnel);"):C.blendMode&t.add&&ce("fragColor.rgb += mix(SCENEJS_uFragmentFresnelEdgeColor.rgb, SCENEJS_uFragmentFresnelCenterColor.rgb, fragmentFresnel);")),T&&Z.push("fragColor = linearToGamma(fragColor, 2.2);"),Y||ce("fragColor.rgb *= fragColor.a;"),ce("fragColor = clamp(fragColor, 0.0, 1.0);"),ce("fragColor.a = max(max(fragColor.r, fragColor.g), max(fragColor.b, fragColor.a));"),q?ce(q):(ce("if (SCENEJS_uOutputFormat == 0.0) {"),ce("    gl_FragColor = fragColor;"),ce("} else if (SCENEJS_uOutputFormat == 1.0) {"),ce("    vec2 uv = gl_FragCoord.xy / SCENEJS_uCanvasRes;"),ce("    float fragZ = gl_FragCoord.z - texture2D(SCENEJS_uDepthBuffer, uv).r;"),ce("    float d = 1.0 - fragZ * 0.99;"),ce("    float d4 = d * d * d * d;"),ce("    float d16 = d4 * d4 * d4 * d4;"),ce("    float a2 = fragColor.a * fragColor.a;"),ce("    float a4 = a2 * a2;"),ce("    float depthWeight = 256.0 * d4 * a2 + 4096.0 * d16 * d16 * a4;"),ce("    float w = clamp(depthWeight, 0.0001, 1e4);"),ce("    vec3 ycocg = RGB_YCOCG * (fragColor.rgb * w);"),ce("    bool checkerboard = mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0);"),ce("    gl_FragColor = vec4(ycocg.r, checkerboard ? ycocg.g : ycocg.b, fragColor.a * w, fragColor.a);"),ce("}")),ce("}"),ue()}function oe(){if(le(),Y&&ce("#extension GL_OES_standard_derivatives : enable"),W&&ce(W),ce("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),ce("#define EDGE_ALPHA 0.9"),ce("#define CENTER_ALPHA 0.0"),ce("#define EDGE_BIAS 0.0"),ce("#define CENTER_BIAS 0.6"),ce("uniform sampler2D SCENEJS_uDepthBuffer;"),ce("uniform vec2 SCENEJS_uCanvasRes;"),ce("varying vec4 SCENEJS_vViewVertex;"),x){ce("varying vec4 SCENEJS_vWorldVertex;"),y&&ce("uniform vec3 SCENEJS_uSolidColor;");for(var t=0;t<s.clips.clips.length;t++)ce("uniform vec4  SCENEJS_uClipNormalAndDist"+t+";"),s.clips.clips[t].fade&&ce("uniform float SCENEJS_uClipFadeDistance"+t+";")}if(Y&&ce("varying vec4 SceneJS_vModelVertex;"),g&&(ce("uniform vec3 SCENEJS_uXrayColor;"),ce("varying vec3 SCENEJS_vViewNormal;")),O&&(ce("uniform vec4   SCENEJS_uFogParams;"),ce("uniform vec4   SCENEJS_uFogColor;")),ce("uniform float SCENEJS_uOutputFormat;"),ce("#define RGB_YCOCG mat3(0.25, 0.5, -0.25, 0.5, 0.0, 0.5, 0.25, -0.5, -0.25)"),X&&ce("uniform bool SCENEJS_uDiscardOpaque;"),Y&&(ce("float hash(vec2 v) {"),ce("    return fract(1.0e4 * sin(17.0 * v.x + 0.1 * v.y) * (0.1 + abs(sin(13.0 * v.y + v.x))));"),ce("}"),ce("float hash3D(vec3 v) {"),ce("    return hash(vec2(hash(v.xy), v.z));"),ce("}")),ce("void main(void) {"),ce("vec4 fragColor = vec4(1.0);"),x){for(s.clips.clipDiscard&&ce("float distOff = 0.0;"),s.clips.clipFade&&ce("float distAlpha = 0.0;"),t=0;t<s.clips.clips.length;t++)ce(s.clips.clips[t].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+t+".xyz) + SCENEJS_uClipNormalAndDist"+t+".w) / SCENEJS_uClipFadeDistance"+t+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+t+".xyz) + SCENEJS_uClipNormalAndDist"+t+".w);");s.clips.clipDiscard&&ce("if (distOff > 0.0) { discard; }"),s.clips.clipFade&&ce("if (distAlpha > 1.0) { discard; }")}return A&&D&&(ce("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),ce("float r = dot(cxy, cxy);"),ce("if (r > 1.0) {"),ce("   discard;"),ce("}")),g&&(ce("float fr = abs(dot(normalize(-SCENEJS_vViewVertex.xyz), normalize(SCENEJS_vViewNormal)));"),ce("float fresnelFactor = clamp((fr - EDGE_BIAS) / (CENTER_BIAS - EDGE_BIAS), 0.0, 1.0);"),ce("fragColor.rgb = SCENEJS_uXrayColor;"),ce("fragColor.a = mix(EDGE_ALPHA, CENTER_ALPHA, fresnelFactor);")),x&&s.clips.clipFade&&ce("fragColor.a *= (1.0 - distAlpha);"),X&&(ce("if (SCENEJS_uDiscardOpaque && fragColor.a >= 1.0) { discard; }"),ce("if (!SCENEJS_uDiscardOpaque && fragColor.a < 1.0) { discard; }")),Y&&(ce("{"),ce("    float maxDeriv = max(length(dFdx(SceneJS_vModelVertex.xy)), length(dFdy(SceneJS_vModelVertex.xy)));"),ce("    float pixScale = 1.0 / maxDeriv;"),ce("    vec2 pixScales = vec2( exp2(floor(log2(pixScale))), exp2(ceil(log2(pixScale))) );"),ce("    vec2 alpha = vec2(hash3D(floor(pixScales.x * SceneJS_vModelVertex.xyz)), hash3D(floor(pixScales.y * SceneJS_vModelVertex.xyz)));"),ce("    float lerpFactor = fract(log2(pixScale));"),ce("    float x = (1.0 - lerpFactor) * alpha.x + lerpFactor * alpha.y;"),ce("    float a = min(lerpFactor, 1.0 - lerpFactor);"),ce("    vec3 cases = vec3("),ce("        x * x / (2.0 * a * (1.0 - a)), "),ce("        (x - 0.5 * a)/(1.0 - a), "),ce("        1.0 - ((1.0 - x) * (1.0 - x) / (2.0 * a * (1.0 - a)))"),ce("    );"),ce("    float aThresh = (x < (1.0 - a)) ? ((x < a) ? cases.x : cases.y) : cases.z;"),ce("    aThresh = clamp(aThresh, 1.0e-6, 1.0);"),ce("    if (fragColor.a < aThresh) {"),ce("        discard;"),ce("    } else {"),ce("        fragColor.a = 1.0;"),ce("    }"),ce("}")),O&&(ce("vec3 fogColor = SCENEJS_uFogColor.rgb;"),ce("float fogDensity = SCENEJS_uFogColor.a;"),ce("float fogStart = SCENEJS_uFogParams.x;"),ce("float fogEnd = SCENEJS_uFogParams.y;"),ce("float fogMin = SCENEJS_uFogParams.z;"),ce("float fogMax = SCENEJS_uFogParams.w;"),H===e.FOG_LINEAR?ce("float fog = (length(SCENEJS_vViewVertex.xyz) - fogStart) / (fogEnd - fogStart);"):(ce("float fogAttenuation = fogDensity * max(length(SCENEJS_vViewVertex.xyz) - fogStart, 0.0);"),H===e.FOG_EXP2&&ce("fogAttenuation = fogAttenuation * fogAttenuation;"),ce("float fog = 1.0 - exp(-fogAttenuation);")),ce("fog = clamp(fog, fogMin, fogMax);"),ce("fragColor.rgb = mix(fragColor.rgb, fogColor, fog);")),ce("fragColor.rgb *= fragColor.a;"),ce("fragColor = clamp(fragColor, 0.0, 1.0);"),ce("fragColor.a = max(max(fragColor.r, fragColor.g), max(fragColor.b, fragColor.a));"),q?ce(q):(ce("if (SCENEJS_uOutputFormat == 0.0) {"),ce("    gl_FragColor = fragColor;"),ce("} else if (SCENEJS_uOutputFormat == 1.0) {"),ce("    vec2 uv = gl_FragCoord.xy / SCENEJS_uCanvasRes;"),ce("    float fragZ = gl_FragCoord.z - texture2D(SCENEJS_uDepthBuffer, uv).r;"),ce("    float d = 1.0 - fragZ * 0.99;"),ce("    float d4 = d * d * d * d;"),ce("    float d16 = d4 * d4 * d4 * d4;"),ce("    float a2 = fragColor.a * fragColor.a;"),ce("    float a4 = a2 * a2;"),ce("    float depthWeight = 256.0 * d4 * a2 + 4096.0 * d16 * d16 * a4;"),ce("    float w = clamp(depthWeight, 0.0001, 1e4);"),ce("    vec3 ycocg = RGB_YCOCG * (fragColor.rgb * w);"),ce("    bool checkerboard = mod(gl_FragCoord.x, 2.0) == mod(gl_FragCoord.y, 2.0);"),ce("    gl_FragColor = vec4(ycocg.r, checkerboard ? ycocg.g : ycocg.b, fragColor.a * w, fragColor.a);"),ce("}")),ce("}"),ue()}function se(){if(le(),ce("precision "+SceneJS.WEBGL_INFO.FS_MAX_FLOAT_PRECISION+" float;"),ce("varying vec4 SCENEJS_vWorldVertex;"),x)for(var e=0;e<s.clips.clips.length;e++)ce("uniform vec4  SCENEJS_uClipNormalAndDist"+e+";"),s.clips.clips[e].fade&&ce("uniform float SCENEJS_uClipFadeDistance"+e+";");if(ce("void main(void) {"),x){for(s.clips.clipDiscard&&ce("float distOff = 0.0;"),s.clips.clipFade&&ce("float distAlpha = 0.0;"),e=0;e<s.clips.clips.length;e++)ce(s.clips.clips[e].fade?"distAlpha = max(distAlpha, (dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+e+".xyz) + SCENEJS_uClipNormalAndDist"+e+".w) / SCENEJS_uClipFadeDistance"+e+");":"distOff = max(distOff, dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+e+".xyz) + SCENEJS_uClipNormalAndDist"+e+".w);");s.clips.clipDiscard&&ce("if (distOff > 0.0) { discard; }"),s.clips.clipFade&&ce("if (distAlpha > 1.0) { discard; }")}return ce("   gl_FragColor = vec4(gl_FragCoord.zzz, 1.0);"),ce("}"),ue()}function le(){Z=[]}function ce(e){Z.push(e||"")}function ue(){return Z.join("\n")}this.setMaxPointSize=function(e){e=Math.min(e,SceneJS.WEBGL_INFO.MAX_POINT_SIZE),K=Math.floor(e).toFixed(1)},this.getSource=function(e,i,o){var Z=Q[e];return Z?(Z.useCount++,Z):(l=o,c=(s=i).material.workflow===SceneJS.Material.PHONG,u=s.material.workflow===SceneJS.Material.METALLIC,_=i.gammaInputPhong,h=!!(s.texture.layers&&s.texture.layers.length>0)&&ae(),f=function(e){if(!e.properties.getFlag(a.REFLECTIVE))return!1;if(!e.geometry.normalBuf)return!1;if(!e.cubemap.layers)return!1;for(var t=0,i=e.cubemap.layers.length;t<i;t++)if(e.cubemap.layers[t].applyTo===r.reflect)return!0;return!1}(s),d=function(e){if(!e.geometry.normalBuf)return!1;if(!e.cubemap.layers)return!1;for(var t=0,a=e.cubemap.layers.length;t<a;t++)if(e.cubemap.layers[t].applyTo===r.light)return!0;return!1}(s),p=function(e){return e.material.workflow===SceneJS.Material.METALLIC&&!!e.properties.getFlag(a.REFLECTIVE)&&!!e.geometry.normalBuf&&!!e.reflections.activeReflection}(s),m=function(e){return e.material.workflow===SceneJS.Material.METALLIC&&!!e.geometry.normalBuf&&!!e.lightmaps.activeLightmap}(s),g=function(e){return!!e.geometry.normalBuf||!(!e.morphGeometry.targets||!e.morphGeometry.targets[0].normalBuf)}(s),y=(x=s.clips.clips.length>0&&!!(s.properties.flags&a.CLIPPING))&&!!(s.properties.flags&a.SOLID),v=!!(s.properties.flags&a.SKYBOX),S=!!(s.properties.flags&a.BILLBOARD),b=function(e){if(e.texture){var r=e.texture.layers;if(!r)return!1;for(var a=0,i=r.length;a<i;a++)if(r[a].flags&t.normals)return!0}return!1}(s),E=function(e){if(e.texture){var r=e.texture.layers;if(!r)return!1;for(var a=0,i=r.length;a<i;a++)if(r[a].flags&t.swizzledNormals)return!0}return!1}(s),I=b&&i.autoTangents&&SceneJS.WEBGL_INFO.standardDerivativesSupported,C=!!s.morphGeometry.targets,T=!s.regionMap.empty&&ae(),N=T&&"info"!==s.regionMap.mode,A="points"===s.geometry.primitiveName,M=!!(s.properties.flags&a.PERSPECTIVE_POINTS),P=!!s.geometry.pointScaleRotationBuf,w=!!s.geometry.pointUVTranslateBuf,D=!!(s.properties.flags&a.ROUND_POINTS),F=!(!s.geometry.compressedPositions&&!s.morphGeometry.compressedPositions),R=!(!s.geometry.compressedNormals&&!s.morphGeometry.compressedNormals),L=!(!s.geometry.compressedUVs&&!s.morphGeometry.compressedUVs),O=s.fogEnabled,H=s.fogMode,J=s.properties.colorModRange,B=s.properties.colorModifiers.length>0,U=s.properties.colorModifiers,k=function(){for(var e=s.properties.colorModifiers,t=0,r=e.length;t<r;t++)if(e[t].value.isScalarFresnel)return!0;return!1}(),V=function(){for(var e=s.properties.colorModifiers,t=0,r=e.length;t<r;t++)if(e[t].value.isColorFresnel)return!0;return!1}(),j=function(){for(var e=s.properties.opacityModifiers,t=0,r=e.length;t<r;t++)if(e[t].value.isScalarFresnel)return!0;return!1}(),G=s.properties.opacityModRange,z=s.properties.opacityModifiers.length>0,X=s.transparencyMode&SceneJS.TRANSPARENCY_FLAGS.TWO_PASS&&l.isPartiallyOpaque(),Y=!!(s.properties.flags&a.STOCHASTIC_ALPHA),W=s.properties.fragmentShaderHeader||null,q=s.properties.fragmentShaderFooter||null,Z={hash:e,pickVertexSrc:$(),pickFragmentSrc:ee(),pickTriangleVertexSrc:$(!0),pickTriangleFragmentSrc:ee(!0),drawVertexSrc:ie(),drawFragmentSrc:ne(),xrayVertexSrc:(le(),ce("uniform mat4 SCENEJS_uMMatrix;"),n?(ce("uniform mat4 SCENEJS_uVMatrix;"),ce("uniform vec3 SCENEJS_uWorldEye;")):(ce("uniform mediump mat4 SCENEJS_uVMatrix;"),ce("uniform mediump vec3 SCENEJS_uWorldEye;")),ce("uniform mat4 SCENEJS_uPMatrix;"),ce("attribute vec4 SCENEJS_aVertex;"),A&&(ce("uniform float SCENEJS_uPointSize;"),P&&ce("attribute vec2 SCENEJS_aPointScaleRotation;")),F&&ce("uniform mat4 SCENEJS_uDecodePositionMatrix;"),ce("varying vec4 SCENEJS_vViewVertex;"),g&&(ce("attribute vec3 SCENEJS_aNormal;"),ce("uniform   mat4 SCENEJS_uMNMatrix;"),ce("varying   vec3 SCENEJS_vViewNormal;")),x&&ce("varying vec4 SCENEJS_vWorldVertex;"),Y&&ce("varying vec4 SceneJS_vModelVertex;"),C&&(ce("uniform float SCENEJS_uMorphFactor;"),s.morphGeometry.targets[0].vertexBuf&&ce("attribute vec4 SCENEJS_aMorphVertex;"),g&&s.morphGeometry.targets[0].normalBuf&&ce("attribute vec3 SCENEJS_aMorphNormal;"),F&&ce("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),S&&(ce("void billboard(inout mat4 mat) {"),ce("   mat[0].xyz = vec3(1.0, 0.0, 0.0);"),ce("   mat[1].xyz = vec3(0.0, 1.0, 0.0);"),ce("   mat[2].xyz = vec3(0.0, 0.0, 1.0);"),ce("}")),R&&(ce("vec3 octDecode(vec2 oct) {"),ce("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),ce("    if (v.z < 0.0) {"),ce("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),ce("    }"),ce("    return normalize(v);"),ce("}")),ce("void main(void) {"),ce(F?"vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"vec4 modelVertex = SCENEJS_aVertex; "),R?ce("vec4 modelNormal = vec4(octDecode(SCENEJS_aNormal.xy), 0.0); "):g&&ce("vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); "),C&&(s.morphGeometry.targets[0].vertexBuf&&ce(F?"modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),g&&s.morphGeometry.targets[0].normalBuf&&ce(R?"modelNormal = vec4( mix(modelNormal.xyz, octDecode(SCENEJS_aMorphNormal.xy), SCENEJS_uMorphFactor), 0.0); ":"modelNormal = vec4( mix(modelNormal.xyz, SCENEJS_aMorphNormal, SCENEJS_uMorphFactor), 0.0); ")),Y&&ce("SceneJS_vModelVertex = modelVertex;"),ce("mat4 modelMatrix = SCENEJS_uMMatrix;"),ce("mat4 viewMatrix = SCENEJS_uVMatrix;"),g&&ce("mat4 modelNormalMatrix = SCENEJS_uMNMatrix;"),ce("vec4 worldVertex;"),ce("vec4 viewVertex;"),v&&ce("viewMatrix[3].xyz = vec3(0.0);"),S?(ce("mat4 modelViewMatrix =  viewMatrix * modelMatrix;"),ce("billboard(modelMatrix);"),ce("billboard(viewMatrix);"),ce("billboard(modelViewMatrix);"),g&&ce("billboard(modelNormalMatrix);"),ce("worldVertex = modelMatrix * modelVertex;"),ce("viewVertex = modelViewMatrix * modelVertex;")):(ce("worldVertex = modelMatrix * modelVertex;"),ce("viewVertex  = viewMatrix * worldVertex; ")),ce("SCENEJS_vViewVertex = viewVertex;"),g&&(ce("vec3 worldNormal = (modelNormalMatrix * modelNormal).xyz; "),ce("SCENEJS_vViewNormal = (viewMatrix * vec4(worldNormal, 0.0)).xyz;")),x&&ce("SCENEJS_vWorldVertex = worldVertex;"),ce("gl_Position = SCENEJS_uPMatrix * viewVertex;"),A&&(ce("gl_PointSize = SCENEJS_uPointSize;"),M&&ce("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),P&&ce("gl_PointSize *= SCENEJS_aPointScaleRotation.x;"),ce("gl_PointSize = min(gl_PointSize, "+K+");")),ce("}"),ue()),xrayFragmentSrc:oe(),depthVertexSrc:(le(),ce("attribute vec4 SCENEJS_aVertex;"),ce("uniform mat4 SCENEJS_uMMatrix;"),ce("uniform mat4 SCENEJS_uVMatrix;"),ce("uniform mat4 SCENEJS_uPMatrix;"),A&&(ce("uniform float SCENEJS_uPointSize;"),P&&ce("attribute vec2 SCENEJS_aPointScaleRotation;")),F&&ce("uniform mat4 SCENEJS_uDecodePositionMatrix;"),ce("varying vec4 SCENEJS_vWorldVertex;"),C&&(ce("uniform float SCENEJS_uMorphFactor;"),s.morphGeometry.targets[0].vertexBuf&&ce("attribute vec4 SCENEJS_aMorphVertex;"),F&&ce("uniform mat4 SCENEJS_uDecodeMorphPosMatrix;")),ce("void main(void) {"),ce(F?"    vec4 modelVertex = SCENEJS_uDecodePositionMatrix * SCENEJS_aVertex;":"    vec4 modelVertex = SCENEJS_aVertex;"),C&&s.morphGeometry.targets[0].vertexBuf&&ce(F?"  modelVertex = mix(modelVertex, SCENEJS_uDecodeMorphPosMatrix * SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); ":"  modelVertex = mix(modelVertex, SCENEJS_aMorphVertex, SCENEJS_uMorphFactor); "),ce("  SCENEJS_vWorldVertex = SCENEJS_uMMatrix * modelVertex; "),ce("mat4 vPosMatrix = SCENEJS_uVMatrix;"),v&&ce("vPosMatrix[3].xyz = vec3(0.0);"),ce("  vec4 viewVertex =  vPosMatrix * SCENEJS_vWorldVertex;"),ce("  gl_Position =  SCENEJS_uPMatrix * viewVertex;"),A&&(ce("gl_PointSize = SCENEJS_uPointSize;"),M&&ce("gl_PointSize *= 20.0 / length(viewVertex.xyz);"),P&&ce("gl_PointSize *= SCENEJS_aPointScaleRotation.x;"),ce("gl_PointSize = min(gl_PointSize, "+K+");")),ce("}"),ue()),depthFragmentSrc:se(),drawTextureVertexSrc:te(),drawTextureFragmentSrc:re(),useCount:0},Q[e]=Z,Z)},this.putSource=function(e){var t=Q[e];t&&0==--t.useCount&&(Q[t.hash]=null)}}}(),function(){"use strict";var e=window.SceneJS_ProgramFactory=function(e,t){this.stats=e,this._canvas=t.canvas,this._programs={}};e.prototype.getProgram=function(e,t,r){var a=this._programs[e];return a||(a=new SceneJS._webgl.Program(this.stats,this._canvas.gl,e,t,r),this._programs[e]=a,this.stats.state.programs++),a.useCount++,a},e.prototype.putProgram=function(e){--e.useCount<=0&&(e.destroy(),delete this._programs[e.hash],this.stats.state.programs--)},e.prototype.webglRestored=function(){var e=this._canvas.gl;for(var t in this._programs)this._programs.hasOwnProperty(t)&&this._programs[t].build(e)},e.prototype.destroy=function(){}}(),function(){"use strict";var e=window.SceneJS_Object=function(e){this.id=e,this.hash=null,this.sortKey=0,this.sortTieBreaker=0,this.chunkSets={},this.chunksLen=0,this.program=null,this.layer=null,this.texture=null,this.properties=null,this.centroid=null},t=new vec3.create,r=vec2.create(),a=vec2.create(),i=(vec2.create(),vec3.create()),n=vec3.create(),o=vec3.create(),s=vec3.create(),l=vec3.create(),c=vec3.create(),u=vec3.create(),_=vec3.create(),h=vec3.create(),f=vec4.create();function d(e,t,r){var a=e.arrays.positions,i=e.positionDecodeMat,n=3*t;r[0]=a[n],r[1]=a[n+1],r[2]=a[n+2],i&&SceneJS_math_decompressPosition(r,r,i)}function p(e,t,r,a,i,n,o,s){var l=2*r,c=2*a,u=2*i,_=e.arrays.uvs[t];if(n[0]=_[l],n[1]=_[l+1],o[0]=_[c],o[1]=_[c+1],s[0]=_[u],s[1]=_[u+1],e.compressedUVs){var h=e.uvDecodeMats[t];SceneJS_math_decompressUV(n,n,h),SceneJS_math_decompressUV(o,o,h),SceneJS_math_decompressUV(s,s,h)}}vec4.create(),vec4.create(),e.prototype.getDepth=function(){this.centroid||(this.centroid=this._calculateCentroid(this));var e=this.viewMatrix,r=vec3.transformMat4(t,this.centroid,this.modelTransform.matrix);return-(e[2]*r[0]+e[6]*r[1]+e[10]*r[2]+e[14])},e.prototype.isTransparent=function(){return!this.properties.stochasticAlpha&&!!(this.properties.transparent||this.properties.opacityModifiers.length>0||this.texture.transparent||this.geometry.transparent||this.fresnel.transparent||this.material.transparent||this.regionMap.transparent)},e.prototype.isPartiallyOpaque=function(){return this.properties.partiallyOpaque||!this.properties.transparent&&(this.fresnel.partiallyOpaque||this.texture.transparent)},e.prototype.getKdTree=function(){var e=this.morphGeometry.targets;return e&&e.length>0?this.morphGeometry.getKdTree(this.geometry.arrays.indices):this.geometry.getKdTree()},e.prototype.getPositions=function(){var e=this.morphGeometry.targets;return e&&e.length>0?e[this.morphGeometry.key1].positions:this.geometry.arrays.positions},e.prototype.getPositionDecodeMat=function(){var e=this.morphGeometry.targets;return e&&e.length>0?e[this.morphGeometry.key1].positionDecodeMat:this.geometry.positionDecodeMat},e.prototype.getFrameEndPositions=function(){var e=this.morphGeometry.targets;return e&&e.length>0?e[this.morphGeometry.key2].positions:null},e.prototype.getFrameEndPositionDecodeMat=function(){var e=this.morphGeometry.targets;return e&&e.length>0?e[this.morphGeometry.key2].positionDecodeMat:null},e.prototype.getNormals=function(){var e=this.morphGeometry.targets;return e&&e.length>0?e[this.morphGeometry.key1].normals:this.geometry.arrays.normals},e.prototype.getFrameEndNormals=function(){var e=this.morphGeometry.targets;return e&&e.length>0?e[this.morphGeometry.key2].normals:null},e.prototype.getIndices=function(){return this.geometry.arrays.indices||null},e.prototype.getMorphFactor=function(){var e=this.morphGeometry.targets;return e&&e.length>0?this.morphGeometry.factor:null},e.prototype.cartesianToBarycentric=function(e,t,r){this.getTrianglePositionOnSurface(e,i,n,o),SceneJS_math_cartesianToBarycentric(t,i,n,o,r)},e.prototype.getPointInWorldSpace=function(e,t){f.set(e),f[3]=1,vec4.transformMat4(f,f,this.modelTransform.matrix),t.set(f.subarray(0,3))},e.prototype.getTriangleIndices=function(e,t){var r=this.geometry.arrays.indices;r?(t[0]=r[e],t[1]=r[e+1],t[2]=r[e+2]):(t[0]=e,t[1]=e+1,t[2]=e+2)},e.prototype.barycentricToCartesian=function(e,t,r){t=t||[1/3,1/3,1/3],this.getTrianglePositionOnSurface(e,i,n,o),SceneJS_math_barycentricToCartesian(t,i,n,o,r)},e.prototype.getTrianglePositionOnSurface=function(e,t,r,a){var i,n,o,f=this.geometry.arrays.indices;(this.geometry||this.morphGeometry)&&(f?(i=f[e],n=f[e+1],o=f[e+2]):(i=e,n=e+1,o=e+2),this.morphGeometry.targets&&this.morphGeometry.targets.length>0?function(e,t,r,a,i,n,o){var f=3*t,d=3*r,p=3*a,m=e.targets[e.key1].positions,g=e.targets[e.key2].positions,y=e.targets[e.key1].positionDecodeMat,v=e.targets[e.key2].positionDecodeMat;e.compressedPositions?(SceneJS_math_decompressPosition(s,m.subarray(f,f+3),y),SceneJS_math_decompressPosition(u,g.subarray(f,f+3),v),SceneJS_math_decompressPosition(l,m.subarray(d,d+3),y),SceneJS_math_decompressPosition(_,g.subarray(d,d+3),v),SceneJS_math_decompressPosition(c,m.subarray(p,p+3),y),SceneJS_math_decompressPosition(h,g.subarray(p,p+3),v)):(s.set(m.subarray(f,f+3)),u.set(g.subarray(f,f+3)),l.set(m.subarray(d,d+3)),_.set(g.subarray(d,d+3)),c.set(m.subarray(p,p+3)),h.set(g.subarray(p,p+3))),vec3.lerp(i,s,u,e.factor),vec3.lerp(n,l,_,e.factor),vec3.lerp(o,c,h,e.factor)}(this.morphGeometry,i,n,o,t,r,a):function(e,t,r,a,i,n,o){var s=e.arrays.positions,l=e.positionDecodeMat,c=3*t,u=3*r,_=3*a;i[0]=s[c],i[1]=s[c+1],i[2]=s[c+2],n[0]=s[u],n[1]=s[u+1],n[2]=s[u+2],o[0]=s[_],o[1]=s[_+1],o[2]=s[_+2],l&&(SceneJS_math_decompressPosition(i,i,l),SceneJS_math_decompressPosition(n,n,l),SceneJS_math_decompressPosition(o,o,l))}(this.geometry,i,n,o,t,r,a))},e.prototype.normalFromBarycentric=function(e,t,r){return t=t||[1/3,1/3,1/3],!!this.normalFromCartesian(e,i,n,o)&&(vec3.scale(r,i,t[0]),vec3.add(r,r,vec3.scale(l,n,t[1])),vec3.add(r,r,vec3.scale(l,o,t[2])),!0)},e.prototype.normalFromCartesian=function(e,t,r,a){if(this.geometry||this.morphGeometry){var i,n,o,f=this.geometry.arrays.indices;return f?(i=f[e],n=f[e+1],o=f[e+2]):(i=e,n=e+1,o=e+2),this.morphGeometry.targets&&this.morphGeometry.targets.length>0?function(e,t,r,a,i,n,o){var f,d,p,m=e.targets[e.key1].normals,g=e.targets[e.key2].normals;return e.compressedNormals?(f=2*t,d=2*r,p=2*a,SceneJS_math_octDecodeVec2(m.subarray(f,f+2),s),SceneJS_math_octDecodeVec2(g.subarray(f,f+2),u),SceneJS_math_octDecodeVec2(m.subarray(d,d+2),l),SceneJS_math_octDecodeVec2(g.subarray(d,d+2),_),SceneJS_math_octDecodeVec2(m.subarray(p,p+2),c),SceneJS_math_octDecodeVec2(g.subarray(p,p+2),h)):(d=3*r,p=3*a,s.set(m.subarray(f=3*t,f+3)),u.set(g.subarray(f,f+3)),l.set(m.subarray(d,d+3)),_.set(g.subarray(d,d+3)),c.set(m.subarray(p,p+3)),h.set(g.subarray(p,p+3))),vec3.lerp(i,s,u,e.factor),vec3.lerp(n,l,_,e.factor),vec3.lerp(o,c,h,e.factor),!0}(this.morphGeometry,i,n,o,t,r,a):function(e,t,r,a,i,n,o){var s=e.arrays.normals;if(!s)return i=i.set([0,0,0]),n=n.set([0,0,0]),o=o.set([0,0,0]),!1;if(e.compressedNormals){var l,c=2*r,u=2*a;s.subarray(l=2*t,l+2),s.subarray(c,c+2),s.subarray(u,u+2),SceneJS_math_octDecodeVec2(s.subarray(l,l+2),i),SceneJS_math_octDecodeVec2(s.subarray(c,c+2),n),SceneJS_math_octDecodeVec2(s.subarray(u,u+2),o)}else c=3*r,u=3*a,i[0]=s[l=3*t],i[1]=s[l+1],i[2]=s[l+2],n[0]=s[c],n[1]=s[c+1],n[2]=s[c+2],o[0]=s[u],o[1]=s[u+1],o[2]=s[u+2];return!0}(this.geometry,i,n,o,t,r,a)}},e.prototype.uvFromBarycentric=function(e,t,s){if(this.geometry&&this.geometry.arrays.uvs&&!(this.geometry.arrays.uvs.length<=0)){var l,c,u,_,h=this.geometry.arrays.indices;for(h?(l=h[e],c=h[e+1],u=h[e+2]):(l=e,c=e+1,u=e+2),_=0;_<this.geometry.arrays.uvs.length;_++){p(this.geometry,_,l,c,u,i,n,o);var f=vec2.create();vec2.scale(f,i,t[0]),vec2.add(f,f,vec2.scale(r,n,t[1])),vec2.add(f,f,vec2.scale(a,o,t[2])),s.push(f)}}},e.prototype.uvFromCartesian=function(e,t,r,a){if(this.geometry&&this.geometry.arrays.uvs&&!(this.geometry.arrays.uvs.length<=0)){var s,l,c,u=this.geometry.arrays.indices;u?(s=u[e],l=u[e+1],c=u[e+2]):(s=e,l=e+1,c=e+2);var _,h=[],f=[],d=[];for(_=0;_<this.geometry.arrays.uvs.length;_++){p(e,_,s,l,c,i,n,o);var m=vec2.create(),g=vec2.create(),y=vec3.create();m[0]=i[0],m[1]=i[1],g[0]=n[0],g[1]=n[1],y[0]=o[0],y[1]=o[1],h.push(m),f.push(g),d.push(y)}}},e.prototype._calculateCentroid=function(){for(var e=vec3.create(),r=1/0,a=1/0,i=1/0,n=-1/0,o=-1/0,s=-1/0,l=Math.min,c=Math.max,u=0,_=this.geometry.arrays.positions.length/3;u<_;++u){d(this.geometry,u,t);var h=t[0],f=t[1],p=t[2];r=l(h,r),a=l(f,a),i=l(p,i),n=c(h,n),o=c(f,o),s=c(p,s)}return e[0]=.5*(r+n),e[1]=.5*(a+o),e[2]=.5*(i+s),e}}(),function(){"use strict";var e=["attribute vec2 aPosition;","varying vec2 vUV;","void main() {","    vUV = aPosition * 0.5 + 0.5;","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),t=new Float32Array([-1,-1,1,-1,-1,1,1,1]);window.SceneJS_PostProcess=function(r,a,i,n){n=n||{},this.gl=a,this.uniformIndices={},this.uniformHandles=[],this.uniformValues=[],this.textureIndices={},this.samplerNames=[],this.textures=[],this.positionBuffer=new SceneJS._webgl.ArrayBuffer(a,a.ARRAY_BUFFER,t,t.length,2,a.STATIC_DRAW),this.program=new SceneJS._webgl.Program(r,a,"post-process",e,i),this.positionsAttribute=this.program.getAttribute("aPosition"),this.uniformCount=0,this.textureCount=0,this.clear=!!n.clear},SceneJS_PostProcess.prototype.setUniform=function(e,t){var r=this.uniformIndices[e];void 0===r&&(r=this.uniformIndices[e]=this.uniformCount++,this.uniformHandles.push(this.program.getUniform(e))),this.uniformValues[r]=t},SceneJS_PostProcess.prototype.setTexture=function(e,t){var r=this.textureIndices[e];void 0===r&&(r=this.textureIndices[e]=this.textureCount++,this.samplerNames.push(e)),this.textures[r]=t},SceneJS_PostProcess.prototype.draw=function(e){e.VAO&&e.VAO.bindVertexArrayOES(null),this.program.bind(),this.positionsAttribute.bindArrayBuffer(this.positionBuffer);for(var t=0;t<this.uniformCount;++t)this.uniformHandles[t].setValue(this.uniformValues[t]);for(t=0;t<this.textureCount;++t)this.program.bindTexture(this.samplerNames[t],this.textures[t],t);this.clear&&(this.gl.clearColor(0,0,0,0),this.gl.clearDepth(1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)},SceneJS_PostProcess.prototype.destroy=function(){this.positionBuffer.destroy(),this.positionBuffer=null,this.program.destroy(),this.program=null},SceneJS_PostProcess.prototype.webglRestored=function(e){for(var r in this.gl=e,this.positionBuffer=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,t,t.length,2,e.STATIC_DRAW),this.program.build(e),this.positionsAttribute=this.program.getAttribute("aPosition"),this.uniformIndices)this.uniformHandles[this.uniformIndices[r]]=this.program.getUniform(r)}}(),function(){"use strict";window.SceneJS_PostProcessStage=function(e,t){for(var r in this.id=t.id,this.display=e,this.postProcess=e._postProcessTypes[t.type],this.uniforms=t.uniforms,this.framebuffer=null,t.framebuffer&&(this.framebuffer=e.framebuffers[t.framebuffer]),this.textures={},t.textures){var a,i=t.textures[r],n=i.framebuffer,o=i.target,s=i.data,l=e._canvas.gl;if(n){if(!(a=e.framebuffers[n])){console.error("Framebuffer not found: "+n);continue}if("color"===o)this.textures[r]=a.getColorTarget(i.attachment||0);else{if("depth"!==o){console.error("Invalid target: "+o);continue}this.textures[r]=a.getDepthTarget()}}else if(s){var c=l.createTexture(),u=void 0!==i.format?l[i.format]:l.RGBA,_=void 0!==i.type?l[i.type]:l.UNSIGNED_BYTE,h=void 0!==i.minFilter?l[i.minFilter]:l.NEAREST,f=void 0!==i.magFilter?l[i.magFilter]:l.NEAREST,d=void 0!==i.wrapS?l[i.wrapS]:l.CLAMP_TO_EDGE,p=void 0!==i.wrapT?l[i.wrapT]:l.CLAMP_TO_EDGE;l.bindTexture(l.TEXTURE_2D,c),l.texImage2D(l.TEXTURE_2D,0,u,i.width,i.height,0,u,_,s),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,h),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,f),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,d),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,p),this.textures[r]={texture:c,gl:l,bind:function(e){return!!this.texture&&(this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),!0)},unbind:function(e){this.texture&&(this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,null))},destroy:function(){this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}},l.bindTexture(l.TEXTURE_2D,null)}}},SceneJS_PostProcessStage.prototype.setUniform=function(e,t){this.uniforms[e]=t,this.display.imageDirty=!0},SceneJS_PostProcessStage.prototype.draw=function(e){for(var t in this.uniforms)this.postProcess.setUniform(t,this.uniforms[t]);for(var r in this.textures)this.postProcess.setTexture(r,this.textures[r]);this.postProcess.draw(e)},SceneJS_PostProcessStage.prototype.destroy=function(){for(var e in this.textures)"function"==typeof this.textures[e].destroy&&this.textures[e].destroy(),this.textures[e]=null}}(),function(){"use strict";var e=window.SceneJS_ChunkFactory=function(){this._chunks={},this._numericIds=1,this.chunkTypes=e.chunkTypes};e.chunkTypes={},e.addChunkType=function(t,r){e.chunkTypes[t]=r},e.prototype.getChunk=function(t,r,a,i){var n=e.chunkTypes[r];if(!n)throw"chunk type not supported: '"+r+"'";var o=this._chunks[t];return o?(o.useCount++,o):((o=new n(t,this._numericIds++,a,i)).useCount=1,this._chunks[t]=o,o)},e.prototype.putChunk=function(e){0!==e.useCount&&--e.useCount<=0&&(e.recycle&&e.recycle(),delete this._chunks[e.id])},e.prototype.webglRestored=function(){var e;for(var t in this._chunks)this._chunks.hasOwnProperty(t)&&(e=this._chunks[t])&&e.build&&e.build()}}(),function(){"use strict";var e=function(e,t,r,a){this.id=e,this.numericId=t,this.program=r;for(var i=0,n=(a=a||[]).length;i<n;++i)a[i]&&a[i].empty&&(a[i]=null);this.cores=a,this.handles={},this.unique=!0,this.build()};e.prototype.build=function(){this.core=this.cores[0],this.handles.draw={},this.handles.xray={},this.handles.pick={uPickColor:this.program.pick.getUniform("SCENEJS_uPickColor")},this.handles.depth={},this.handles.drawTexture={}},e.prototype.draw=function(e,t){var r=this.core,a=this.handles[e],i=this.program.gl;if(t.pickTriangle){var n=r.getPickColors();n&&i.drawArrays(r.primitive,0,n.numItems/4)}else{if(t.pickObject&&a.uPickColor){var o=t.pickIndex>>24&255,s=t.pickIndex>>16&255,l=t.pickIndex>>8&255,c=255&t.pickIndex;t.pickIndex++,a.uPickColor.setValue([c/255,l/255,s/255,o/255])}r.indexBuf?i.drawElements(r.primitive,r.indexBuf.numItems,r.indexBuf.itemType,0):i.drawArrays(r.primitive,0,r.vertexBuf.numItems/3)}t.transparent=!1},SceneJS_ChunkFactory.addChunkType("draw",e)}(),function(){"use strict";var e=SceneJS.PROPERTY_FLAGS,t=SceneJS.DEPTH_TEST_FLAGS,r=vec4.create(),a=function(e,t,r,a){this.id=e,this.numericId=t,this.program=r;for(var i=0,n=(a=a||[]).length;i<n;++i)a[i]&&a[i].empty&&(a[i]=null);this.cores=a,this.handles={},this.unique=!0,this.build()};a.prototype.build=function(){this.propertiesCore=this.cores[0],this.xformCore=this.cores[1];var e=this.program.draw,t=this.program.xray,r=this.program.pick,a=this.program.pickTriangle,i=this.program.depth,n=this.program.drawTexture,o=this.handles.draw={},s=this.handles.xray={},l=this.handles.pick={},c=this.handles.pickTriangle={},u=this.handles.depth={},_=this.handles.drawTexture={};if(o.uDiscardOpaque=e.getUniform("SCENEJS_uDiscardOpaque"),o.uOutputFormat=e.getUniform("SCENEJS_uOutputFormat"),s.uDiscardOpaque=t.getUniform("SCENEJS_uDiscardOpaque"),s.uOutputFormat=t.getUniform("SCENEJS_uOutputFormat"),this.propertiesCore){o.uSolidColor=e.getUniform("SCENEJS_uSolidColor"),o.uXrayParams=e.getUniform("SCENEJS_uXrayParams"),s.uSolidColor=t.getUniform("SCENEJS_uSolidColor"),u.uClipping=i.getUniform("SCENEJS_uClipping"),o.uColorModifications=new Array(this.propertiesCore.colorModifiers.length),o.uColorModCenters=new Array(this.propertiesCore.colorModifiers.length),o.uColorModRadii=new Array(this.propertiesCore.colorModifiers.length),o.uColorModFresnels=new Array(this.propertiesCore.colorModifiers.length);for(var h=0,f=this.propertiesCore.colorModifiers.length;h<f;h++){var d=this.propertiesCore.colorModifiers[h].value;o.uColorModifications[h]=e.getUniform("SCENEJS_uColorModification"+h),(d.isColorFresnel||d.isScalarFresnel)&&(o.uColorModFresnels[h]={edge:e.getUniform("SCENEJS_uColorModFresnelEdge"+h),center:e.getUniform("SCENEJS_uColorModFresnelCenter"+h),power:e.getUniform("SCENEJS_uColorModFresnelPower"+h)}),o.uColorModCenters[h]=e.getUniform("SCENEJS_uColorModCenter"+h),o.uColorModRadii[h]=e.getUniform("SCENEJS_uColorModRadius"+h)}o.uOpacityModifications=new Array(this.propertiesCore.opacityModifiers.length),o.uOpacityModCenters=new Array(this.propertiesCore.opacityModifiers.length),o.uOpacityModRadii=new Array(this.propertiesCore.opacityModifiers.length),o.uOpacityModFresnels=new Array(this.propertiesCore.opacityModifiers.length);var p=0;for(f=this.propertiesCore.opacityModifiers.length;p<f;++p){var m=this.propertiesCore.opacityModifiers[p];o.uOpacityModifications[p]=e.getUniform("SCENEJS_uOpacityModification"+p),m.value.isScalarFresnel&&(o.uOpacityModFresnels[p]={edge:e.getUniform("SCENEJS_uOpacityModFresnelEdge"+p),center:e.getUniform("SCENEJS_uOpacityModFresnelCenter"+p),power:e.getUniform("SCENEJS_uOpacityModFresnelPower"+p)}),o.uOpacityModCenters[p]=e.getUniform("SCENEJS_uOpacityModCenter"+p),o.uOpacityModRadii[p]=e.getUniform("SCENEJS_uOpacityModRadius"+p)}}this.xformCore&&(o.uMatLocation=e.getUniform("SCENEJS_uMMatrix"),o.uNormalMatLocation=e.getUniform("SCENEJS_uMNMatrix"),s.uMatLocation=t.getUniform("SCENEJS_uMMatrix"),s.uNormalMatLocation=t.getUniform("SCENEJS_uMNMatrix"),l.uMatLocation=r.getUniform("SCENEJS_uMMatrix"),c.uMatLocation=a.getUniform("SCENEJS_uMMatrix"),u.uMatLocation=i.getUniform("SCENEJS_uMMatrix"),_.uMatLocation=n.getUniform("SCENEJS_uMMatrix"))},a.prototype.draw=function(a,i){var n=this.program.gl,o=this.handles[a];if(o.uDiscardOpaque&&o.uDiscardOpaque.setValue(i.discardOpaque),o.uOutputFormat&&o.uOutputFormat.setValue(i.outputFormat),this.propertiesCore){var s=this.propertiesCore.depthTest;i.depthTest!=s&&(s==t.ALWAYS_PASS?(n.enable(n.DEPTH_TEST),n.depthFunc(n.ALWAYS)):s==t.DISABLED?n.disable(n.DEPTH_TEST):(n.enable(n.DEPTH_TEST),n.depthFunc(n.LESS)),i.depthTest=s);var l=this.propertiesCore.flags&e.CCW;if(i.frontface!=l&&(n.frontFace(l?n.CCW:n.CW),i.frontface=l),o.uColorModifications)for(var c=0,u=this.propertiesCore.colorModifiers.length;c<u;++c){var _=this.propertiesCore.colorModifiers[c],h=_.value;o.uColorModifications[c]&&o.uColorModifications[c].setValue(h);var f=o.uColorModFresnels[c];f&&(h.isColorFresnel?(f.edge&&(r[0]=h.edge[0],r[1]=h.edge[1],r[2]=h.edge[2],r[3]=h.edgeBias,f.edge.setValue(r)),f.center&&(r[0]=h.center[0],r[1]=h.center[1],r[2]=h.center[2],r[3]=h.centerBias,f.center.setValue(r)),f.power&&f.power.setValue(h.power)):h.isScalarFresnel&&(f.edge&&(r[0]=h.edge,r[3]=h.edgeBias,f.edge.setValue(r)),f.center&&(r[0]=h.center,r[3]=h.centerBias,f.center.setValue(r)),f.power&&f.power.setValue(h.power))),o.uColorModCenters[c]&&o.uColorModCenters[c].setValue(_.range.center),o.uColorModRadii[c]&&o.uColorModRadii[c].setValue(_.range.radius)}if(o.uOpacityModifications){var d=0;for(u=this.propertiesCore.opacityModifiers.length;d<u;++d){var p=this.propertiesCore.opacityModifiers[d];h=p.value,o.uOpacityModifications[d]&&o.uOpacityModifications[d].setValue(h);var m=o.uOpacityModFresnels[d];m&&(m.edge&&(r[0]=h.edge,r[3]=h.edgeBias,m.edge.setValue(r)),m.center&&(r[0]=h.center,r[3]=h.centerBias,m.center.setValue(r)),m.power&&m.power.setValue(h.power)),o.uOpacityModCenters[d]&&o.uOpacityModCenters[d].setValue(p.range.center),o.uOpacityModRadii[d]&&o.uOpacityModRadii[d].setValue(p.range.radius)}}o.uSolidColor&&o.uSolidColor.setValue(this.propertiesCore.solidColor),o.uXrayParams&&o.uXrayParams.setValue(this.propertiesCore.xrayParams)}this.xformCore&&(o.uMatLocation&&o.uMatLocation.setValue(this.xformCore.matrix),o.uNormalMatLocation&&o.uNormalMatLocation.setValue(this.xformCore.normalMatrix))},SceneJS_ChunkFactory.addChunkType("object",a)}(),function(){"use strict";var e=function(e,t,r,a){this.id=e,this.numericId=t,this.program=r;for(var i=0,n=(a=a||[]).length;i<n;++i)a[i]&&a[i].empty&&(a[i]=null);this.cores=a,this.handles={},this.VAOs={draw:null,pick:null,pickTriangle:null,xray:null,depth:null,drawTexture:null},this.build()};e.prototype.build=function(){this.core=this.cores[0],this.core2=this.cores[1];var e=this.program.draw,t=0;this.core2.uvBufs&&(t=this.core2.uvBufs.length),this.handles.draw={aRegionMapUV:e.getAttribute("SCENEJS_aRegionMapUV"),aVertex:e.getAttribute("SCENEJS_aVertex"),aNormal:e.getAttribute("SCENEJS_aNormal"),aUV:new Array(t),uDecodeUV:new Array(t),aTangent:e.getAttribute("SCENEJS_aTangent"),aColor:e.getAttribute("SCENEJS_aVertexColor"),aMorphVertex:e.getAttribute("SCENEJS_aMorphVertex"),aMorphNormal:e.getAttribute("SCENEJS_aMorphNormal"),aMorphTangent:e.getAttribute("SCENEJS_aMorphTangent"),aPointScaleRotation:e.getAttribute("SCENEJS_aPointScaleRotation"),aPointUVTranslate:e.getAttribute("SCENEJS_aPointUVTranslate"),uPointUVScale:e.getUniform("SCENEJS_uPointUVScale"),uMorphFactor:e.getUniform("SCENEJS_uMorphFactor"),uPointSize:e.getUniform("SCENEJS_uPointSize"),uDecodePositions:e.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:e.getUniform("SCENEJS_uDecodeMorphPosMatrix")};for(var r=0;r<t;r++)this.handles.draw.aUV[r]=e.getAttribute("SCENEJS_aUVCoord"+r),this.handles.draw.uDecodeUV[r]=e.getUniform("SCENEJS_uDecodeUVMatrix"+r);var a=this.program.xray;this.handles.xray={aVertex:a.getAttribute("SCENEJS_aVertex"),aNormal:a.getAttribute("SCENEJS_aNormal"),aMorphVertex:a.getAttribute("SCENEJS_aMorphVertex"),aMorphNormal:a.getAttribute("SCENEJS_aMorphNormal"),aPointScaleRotation:a.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:a.getUniform("SCENEJS_uMorphFactor"),uPointSize:a.getUniform("SCENEJS_uPointSize"),uDecodePositions:a.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:a.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var i=this.program.pick;this.handles.pick={aRegionMapUV:i.getAttribute("SCENEJS_aRegionMapUV"),aVertex:i.getAttribute("SCENEJS_aVertex"),aMorphVertex:i.getAttribute("SCENEJS_aMorphVertex"),aPointScaleRotation:i.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:i.getUniform("SCENEJS_uMorphFactor"),uPointSize:i.getUniform("SCENEJS_uPointSize"),uDecodePositions:i.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:i.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var n=this.program.pickTriangle;this.handles.pickTriangle={aVertex:n.getAttribute("SCENEJS_aVertex"),aTriColor:n.getAttribute("SCENEJS_aTriColor"),aMorphVertex:n.getAttribute("SCENEJS_aMorphVertex"),aPointScaleRotation:n.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:n.getUniform("SCENEJS_uMorphFactor"),uPointSize:n.getUniform("SCENEJS_uPointSize"),uDecodePositions:n.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:n.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var o=this.program.depth;this.handles.depth={aVertex:o.getAttribute("SCENEJS_aVertex"),aMorphVertex:o.getAttribute("SCENEJS_aMorphVertex"),aPointScaleRotation:o.getAttribute("SCENEJS_aPointScaleRotation"),uMorphFactor:o.getUniform("SCENEJS_uMorphFactor"),uPointSize:o.getUniform("SCENEJS_uPointSize"),uDecodePositions:o.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:o.getUniform("SCENEJS_uDecodeMorphPosMatrix")};var s=this.program.drawTexture;for(this.handles.drawTexture={aVertex:s.getAttribute("SCENEJS_aVertex"),aUV:new Array(t),uDecodeUV:new Array(t),aMorphVertex:s.getAttribute("SCENEJS_aMorphVertex"),uMorphFactor:s.getUniform("SCENEJS_uMorphFactor"),uDecodePositions:s.getUniform("SCENEJS_uDecodePositionMatrix"),uDecodeMorphPos:s.getUniform("SCENEJS_uDecodeMorphPosMatrix")},r=0;r<t;r++)this.handles.drawTexture.aUV[r]=s.getAttribute("SCENEJS_aUVCoord"+r),this.handles.drawTexture.uDecodeUV[r]=s.getUniform("SCENEJS_uDecodeUVMatrix"+r);for(var l in this.VAOs)this.VAOs[l]={VAO:null,morphKey1:-1,morphKey2:-1}},e.prototype.recycle=function(){var e=this.program.gl.getExtension("OES_vertex_array_object");if(e)for(var t in this.VAOs)this.VAOs[t].VAO&&(e.deleteVertexArrayOES(this.VAOs[t].VAO),this.VAOs[t].VAO=null),this.VAOs[t].morphKey1=-1,this.VAOs[t].morphKey2=-1},e.prototype.morphDraw=function(e,t,r){t.morphKey1=this.core.key1,t.morphKey2=this.core.key2;var a=this.core.key1,i=this.core.key2,n=this.core.targets[a],o=this.core.targets[i];if(e.aMorphVertex?(e.aVertex.bindArrayBuffer(n.vertexBuf),e.aMorphVertex.bindArrayBuffer(o.vertexBuf),r.bindArray+=2):e.aVertex&&(e.aVertex.bindArrayBuffer(this.core2.vertexBuf),r.bindArray++),e.aMorphNormal?(e.aNormal.bindArrayBuffer(n.normalBuf),e.aMorphNormal.bindArrayBuffer(o.normalBuf),r.bindArray+=2):e.aNormal&&(e.aNormal.bindArrayBuffer(this.core2.normalBuf),r.bindArray++),(e.aMorphTangent||e.aTangent)&&r.hasNormalMap&&e.aMorphTangent&&(e.aTangent.bindArrayBuffer(this.core.getTangents(a,this.core2.arrays.indices,this.core2.arrays.uvs[0],this.core2.positionDecodeMat,this.core2.compressedUVs&&this.core2.uvDecodeMats[0])),e.aMorphTangent.bindArrayBuffer(this.core.getTangents(i,this.core2.arrays.indices,this.core2.arrays.uvs[0],this.core2.positionDecodeMat,this.core2.compressedUVs&&this.core2.uvDecodeMats[0])),r.bindArray+=2),e.aUV)for(var s,l=0,c=e.aUV.length;l<c;l++)(s=this.core2.uvBufs[l])&&e.aUV[l]&&(e.aUV[l].bindArrayBuffer(s),r.bindArray++);e.aColor&&(e.aColor.bindArrayBuffer(this.core2.colorBuf),r.bindArray++)},e.prototype.updateGeoUniforms=function(e){e.uDecodePositions&&e.uDecodePositions.setValue(this.core2.positionDecodeMat)},e.prototype.updateMorphUniforms=function(e){var t=this.core.targets[this.core.key2];e.uDecodePositions&&e.uDecodePositions.setValue(this.core.targets[this.core.key1].positionDecodeMat),e.uDecodeMorphPos&&e.uDecodeMorphPos.setValue(t.positionDecodeMat),e.uMorphFactor&&e.uMorphFactor.setValue(this.core.factor)},e.prototype.draw=function(e,t){var r=this.handles[e],a=this.VAOs[e],i=this.core.targets&&this.core.targets.length;if(r.uPointSize&&r.uPointSize.setValue(this.core2.pointSize),r.uPointUVScale&&r.uPointUVScale.setValue(this.core2.pointUVScale),r.uDecodeUV)for(var n=0,o=r.uDecodeUV.length;n<o;n++)r.uDecodeUV[n]&&r.uDecodeUV[n].setValue(this.core2.uvDecodeMats[n]);if(i?this.updateMorphUniforms(r):this.updateGeoUniforms(r),t.pickTriangle)if(i)if(r.aMorphVertex){var s=this.core.getPickPositions(this.core.key1,this.core2.arrays.indices);s&&r.aVertex.bindArrayBuffer(s),(s=this.core.getPickPositions(this.core.key2,this.core2.arrays.indices))&&r.aMorphVertex.bindArrayBuffer(s),r.aTriColor&&r.aTriColor.bindArrayBuffer(this.core2.getPickColors())}else r.aVertex&&(r.aVertex.bindArrayBuffer(this.core2.vertexBuf),this.core2.indexBuf.bind());else r.aVertex&&r.aVertex.bindArrayBuffer(this.core2.getPickPositions()),r.aTriColor&&r.aTriColor.bindArrayBuffer(this.core2.getPickColors());else{if(a.VAO&&t.VAO){if(t.VAO.bindVertexArrayOES(a.VAO),!i)return;if(a.morphKey1==this.core.key1&&a.morphKey2==this.core.key2)return}else t.VAO&&(t.VAO.bindVertexArrayOES(null),a.VAO=t.VAO.createVertexArrayOES(),t.VAO.bindVertexArrayOES(a.VAO));if(i)this.morphDraw(r,a,t);else{var l;if(r.aVertex&&(r.aVertex.bindArrayBuffer(this.core2.vertexBuf),t.bindArray++),r.aNormal&&(r.aNormal.bindArrayBuffer(this.core2.normalBuf),t.bindArray++),r.aUV)for(n=0,o=r.aUV.length;n<o;n++)(l=this.core2.uvBufs[n])&&r.aUV[n]&&(r.aUV[n].bindArrayBuffer(l),t.bindArray++);r.aColor&&(r.aColor.bindArrayBuffer(this.core2.colorBuf),t.bindArray++),r.aPointScaleRotation&&(r.aPointScaleRotation.bindArrayBuffer(this.core2.pointScaleRotationBuf),t.bindArray++),r.aPointUVTranslate&&(r.aPointUVTranslate.bindArrayBuffer(this.core2.pointUVTranslateBuf),t.bindArray++),r.aTangent&&t.hasNormalMap&&(r.aTangent.bindArrayBuffer(this.core2.getTangents(0)),t.bindArray++)}if(r.aRegionMapUV){var c=t.regionMapUVLayerIdx;if(c>=0){var u=this.core2.uvBufs;c<u.length&&(r.aRegionMapUV.bindArrayBuffer(u[c]),t.bindArray++)}}this.core2.indexBuf&&this.core2.indexBuf.bind()}},SceneJS_ChunkFactory.addChunkType("geometry",e)}(),function(){"use strict";var e=function(e,t,r,a){this.id=e,this.numericId=t,this.program=r;for(var i=0,n=(a=a||[]).length;i<n;++i)a[i]&&a[i].empty&&(a[i]=null);this.cores=a,this.handles={},this.build()};e.prototype.build=function(){this.materialCore=this.cores[0],this.textureCore=this.cores[1],this.fresnelCore=this.cores[2],this.cubemapCore=this.cores[3];var e=this.program.draw,t=this.handles.draw={},r=this.handles.drawTexture={};if(this.materialCore&&(t.uMaterialBaseColor=e.getUniform("SCENEJS_uMaterialColor"),t.uMaterialSpecularColor=e.getUniform("SCENEJS_uMaterialSpecularColor"),t.uMaterialEmitColor=e.getUniform("SCENEJS_uMaterialEmitColor"),t.uMaterialShine=e.getUniform("SCENEJS_uMaterialShine"),t.uMetalRoughSpecularf0=e.getUniform("SCENEJS_uMetalRoughSpecularf0")),this.textureCore&&(t.uTexSampler=[],t.uTexMatrix=[],t.uTexBlendFactor=[],o=this.textureCore.layers)){e=this.program.draw;for(var a=0,i=o.length;a<i;a++)t.uTexSampler[a]="SCENEJS_uSampler"+a,t.uTexMatrix[a]=e.getUniform("SCENEJS_uLayer"+a+"Matrix"),t.uTexBlendFactor[a]=e.getUniform("SCENEJS_uLayer"+a+"BlendFactor");r.uDrawSampler="SCENEJS_uDrawSampler"}if(this.fresnelCore){var n=this.fresnelCore;n.diffuse&&(t.uDiffuseFresnelCenterColor=e.getUniform("SCENEJS_uDiffuseFresnelCenterColor"),t.uDiffuseFresnelEdgeColor=e.getUniform("SCENEJS_uDiffuseFresnelEdgeColor"),t.uDiffuseFresnelPower=e.getUniform("SCENEJS_uDiffuseFresnelPower")),n.specular&&(t.uSpecularFresnelCenterColor=e.getUniform("SCENEJS_uSpecularFresnelCenterColor"),t.uSpecularFresnelEdgeColor=e.getUniform("SCENEJS_uSpecularFresnelEdgeColor"),t.uSpecularFresnelPower=e.getUniform("SCENEJS_uSpecularFresnelPower")),n.alpha&&(t.uAlphaFresnelCenterColor=e.getUniform("SCENEJS_uAlphaFresnelCenterColor"),t.uAlphaFresnelEdgeColor=e.getUniform("SCENEJS_uAlphaFresnelEdgeColor"),t.uAlphaFresnelPower=e.getUniform("SCENEJS_uAlphaFresnelPower")),n.transparency&&(t.uTransparencyFresnelCenterColor=e.getUniform("SCENEJS_uTransparencyFresnelCenterColor"),t.uTransparencyFresnelEdgeColor=e.getUniform("SCENEJS_uTransparencyFresnelEdgeColor"),t.uTransparencyFresnelPower=e.getUniform("SCENEJS_uTransparencyFresnelPower")),n.reflect&&(t.uReflectFresnelCenterColor=e.getUniform("SCENEJS_uReflectFresnelCenterColor"),t.uReflectFresnelEdgeColor=e.getUniform("SCENEJS_uReflectFresnelEdgeColor"),t.uReflectFresnelPower=e.getUniform("SCENEJS_uReflectFresnelPower")),n.emit&&(t.uEmitFresnelCenterColor=e.getUniform("SCENEJS_uEmitFresnelCenterColor"),t.uEmitFresnelEdgeColor=e.getUniform("SCENEJS_uEmitFresnelEdgeColor"),t.uEmitFresnelPower=e.getUniform("SCENEJS_uEmitFresnelPower")),n.fragment&&(t.uFragmentFresnelCenterColor=e.getUniform("SCENEJS_uFragmentFresnelCenterColor"),t.uFragmentFresnelEdgeColor=e.getUniform("SCENEJS_uFragmentFresnelEdgeColor"),t.uFragmentFresnelPower=e.getUniform("SCENEJS_uFragmentFresnelPower"))}if(this.cubemapCore){var o=this.cubemapCore.layers;if(t.uCubeMapSampler=new Array(o.length),t.uCubeMapIntensity=new Array(o.length),t.uCubeMapMipLevels=new Array(o.length),o)for(e=this.program.draw,a=0,i=o.length;a<i;a++)t.uCubeMapSampler[a]="SCENEJS_uCubeMapSampler"+a,t.uCubeMapIntensity[a]=e.getUniform("SCENEJS_uCubeMapIntensity"+a),t.uCubeMapMipLevels[a]=e.getUniform("SCENEJS_uCubeMapMipLevels"+a)}},e.prototype.draw=function(e,t){var r,a=this.handles[e];if(this.materialCore&&(a.uMaterialBaseColor&&a.uMaterialBaseColor.setValue(this.materialCore.baseColor),a.uMaterialSpecularColor&&a.uMaterialSpecularColor.setValue(this.materialCore.specularColor),a.uMaterialEmitColor&&a.uMaterialEmitColor.setValue(this.materialCore.emitColor),a.uMaterialSpecular&&a.uMaterialSpecular.setValue(this.materialCore.specular),a.uMaterialShine&&a.uMaterialShine.setValue(this.materialCore.shine),a.uMaterialEmit&&a.uMaterialEmit.setValue(this.materialCore.emit),a.uMaterialAlpha&&a.uMaterialAlpha.setValue(this.materialCore.alpha),a.uMetalRoughSpecularf0&&a.uMetalRoughSpecularf0.setValue(this.materialCore.metalRoughspecularf0)),this.textureCore){var i;if(t.hasNormalMap=!1,i=this.textureCore.layers){var n=this.program[e];if(a.uTexSampler)for(var o=0,s=i.length;o<s;o++)r=i[o],a.uTexSampler[o]&&r.texture&&(n.bindTexture(a.uTexSampler[o],r.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,t.bindTexture++,r._matrixDirty&&r.buildMatrix&&r.buildMatrix.call(r),a.uTexMatrix&&a.uTexMatrix[o]&&a.uTexMatrix[o].setValue(r.matrixAsArray),a.uTexBlendFactor&&a.uTexBlendFactor[o]&&a.uTexBlendFactor[o].setValue(r.blendFactor),t.hasNormalMap=t.hasNormalMap||r.isNormalMap);a.uDrawSampler&&(n.bindTexture(a.uDrawSampler,i[this.textureCore.drawLayerIndex].texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS)}t.texture=this.textureCore}if(this.fresnelCore){var l=this.fresnelCore;l.diffuse&&(a.uDiffuseFresnelCenterColor&&a.uDiffuseFresnelCenterColor.setValue(l.diffuse.centerColor),a.uDiffuseFresnelEdgeColor&&a.uDiffuseFresnelEdgeColor.setValue(l.diffuse.edgeColor),a.uDiffuseFresnelPower&&a.uDiffuseFresnelPower.setValue(l.diffuse.power)),l.specular&&(a.uSpecularFresnelCenterColor&&a.uSpecularFresnelCenterColor.setValue(l.specular.centerColor),a.uSpecularFresnelEdgeColor&&a.uSpecularFresnelEdgeColor.setValue(l.specular.edgeColor),a.uSpecularFresnelPower&&a.uSpecularFresnelPower.setValue(l.specular.power)),l.alpha&&(a.uAlphaFresnelCenterColor&&a.uAlphaFresnelCenterColor.setValue(l.alpha.centerColor),a.uAlphaFresnelEdgeColor&&a.uAlphaFresnelEdgeColor.setValue(l.alpha.edgeColor),a.uAlphaFresnelPower&&a.uAlphaFresnelPower.setValue(l.alpha.power)),l.transparency&&(a.uTransparencyFresnelCenterColor&&a.uTransparencyFresnelCenterColor.setValue(l.transparency.centerColor),a.uTransparencyFresnelEdgeColor&&a.uTransparencyFresnelEdgeColor.setValue(l.transparency.edgeColor),a.uTransparencyFresnelPower&&a.uTransparencyFresnelPower.setValue(l.transparency.power)),l.reflect&&(a.uReflectFresnelCenterColor&&a.uReflectFresnelCenterColor.setValue(l.reflect.centerColor),a.uReflectFresnelEdgeColor&&a.uReflectFresnelEdgeColor.setValue(l.reflect.edgeColor),a.uReflectFresnelPower&&a.uReflectFresnelPower.setValue(l.reflect.power)),l.emit&&(a.uEmitFresnelCenterColor&&a.uEmitFresnelCenterColor.setValue(l.emit.centerColor),a.uEmitFresnelEdgeColor&&a.uEmitFresnelEdgeColor.setValue(l.emit.edgeColor),a.uEmitFresnelPower&&a.uEmitFresnelPower.setValue(l.emit.power)),l.fragment&&(a.uFragmentFresnelCenterColor&&a.uFragmentFresnelCenterColor.setValue(l.fragment.centerColor),a.uFragmentFresnelEdgeColor&&a.uFragmentFresnelEdgeColor.setValue(l.fragment.edgeColor),a.uFragmentFresnelPower&&a.uFragmentFresnelPower.setValue(l.fragment.power))}if(this.cubemapCore&&(i=this.cubemapCore.layers)&&(n=this.program[e],a.uCubeMapSampler))for(o=0,s=i.length;o<s;o++)r=i[o],a.uCubeMapSampler[o]&&r.texture&&(n.bindTexture(a.uCubeMapSampler[o],r.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,a.uCubeMapIntensity[o]&&a.uCubeMapIntensity[o].setValue(r.intensity),a.uCubeMapMipLevels[o]&&a.uCubeMapMipLevels[o].setValue(r.mipLevels))},SceneJS_ChunkFactory.addChunkType("material",e)}(),function(){"use strict";var e=function(e,t,r,a){this.id=e,this.numericId=t,this.program=r;for(var i=0,n=(a=a||[]).length;i<n;++i)a[i]&&a[i].empty&&(a[i]=null);this.cores=a,this.handles={},this.numLights=0,this.numClips=0,this.build()};e.prototype.build=function(){var e=this.program.draw,t=this.program.xray,r=this.program.pick,a=this.program.pickTriangle,i=this.program.depth,n=this.program.drawTexture;this.handles.draw={uPMatrix:e.getUniform("SCENEJS_uPMatrix"),uvMatrix:e.getUniform("SCENEJS_uVMatrix"),uWorldEye:e.getUniform("SCENEJS_uWorldEye"),uFogParams:e.getUniform("SCENEJS_uFogParams"),uFogColor:e.getUniform("SCENEJS_uFogColor"),uCanvasRes:e.getUniform("SCENEJS_uCanvasRes"),uAmbientColor:e.getUniform("SCENEJS_uAmbientColor"),uLightColor:[],uLightDir:[],uLightPos:[],uLightCutOff:[],uLightSpotExp:[],uLightAttenuation:[],uInnerCone:[],uOuterCone:[],uClipNormalAndDist:[],uClipFadeDistance:[],uPBRLightMapIntensity:e.getUniform("SCENEJS_uPBRLightMapIntensity"),uPBRLightMapMipLevels:e.getUniform("SCENEJS_uPBRLightMapMipLevels"),uPBRReflectionMapIntensity:e.getUniform("SCENEJS_uPBRReflectionMapIntensity"),uPBRReflectionMapMipLevels:e.getUniform("SCENEJS_uPBRReflectionMapMipLevels")};var o=this.program;for(this.numLights=0;;){var s=e.getUniform("SCENEJS_uLightColor"+this.numLights);if(!s)break;this.handles.draw.uLightColor[this.numLights]=s,this.handles.draw.uLightPos[this.numLights]=o.draw.getUniform("SCENEJS_uLightPos"+this.numLights),this.handles.draw.uLightDir[this.numLights]=o.draw.getUniform("SCENEJS_uLightDir"+this.numLights),this.handles.draw.uLightAttenuation[this.numLights]=o.draw.getUniform("SCENEJS_uLightAttenuation"+this.numLights),this.handles.draw.uInnerCone[this.numLights]=o.draw.getUniform("SCENEJS_uInnerCone"+this.numLights),this.handles.draw.uOuterCone[this.numLights]=o.draw.getUniform("SCENEJS_uOuterCone"+this.numLights),++this.numLights}for(this.handles.xray={uPMatrix:t.getUniform("SCENEJS_uPMatrix"),uvMatrix:t.getUniform("SCENEJS_uVMatrix"),uWorldEye:t.getUniform("SCENEJS_uWorldEye"),uFogParams:t.getUniform("SCENEJS_uFogParams"),uFogColor:t.getUniform("SCENEJS_uFogColor"),uXrayColor:t.getUniform("SCENEJS_uXrayColor"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.pick={pickMode:r.getUniform("SCENEJS_uPickMode"),uPMatrix:r.getUniform("SCENEJS_uPMatrix"),uvMatrix:r.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.pickTriangle={uPMatrix:a.getUniform("SCENEJS_uPMatrix"),uvMatrix:a.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.depth={uPMatrix:i.getUniform("SCENEJS_uPMatrix"),uvMatrix:i.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.handles.drawTexture={uPMatrix:n.getUniform("SCENEJS_uPMatrix"),uvMatrix:n.getUniform("SCENEJS_uVMatrix"),uClipNormalAndDist:[],uClipFadeDistance:[]},this.numClips=0;;){var l=e.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips);if(!l)break;this.handles.draw.uClipNormalAndDist[this.numClips]=l,this.handles.draw.uClipFadeDistance[this.numClips]=e.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.xray.uClipNormalAndDist[this.numClips]=t.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.xray.uClipFadeDistance[this.numClips]=t.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.pick.uClipNormalAndDist[this.numClips]=r.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.pick.uClipFadeDistance[this.numClips]=r.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.pickTriangle.uClipNormalAndDist[this.numClips]=a.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.pickTriangle.uClipFadeDistance[this.numClips]=a.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.depth.uClipNormalAndDist[this.numClips]=i.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.depth.uClipFadeDistance[this.numClips]=i.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),this.handles.drawTexture.uClipNormalAndDist[this.numClips]=n.getUniform("SCENEJS_uClipNormalAndDist"+this.numClips),this.handles.drawTexture.uClipFadeDistance[this.numClips]=n.getUniform("SCENEJS_uClipFadeDistance"+this.numClips),++this.numClips}var c=e.gl,u=c.createTexture();c.bindTexture(c.TEXTURE_2D,u),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,new Uint8Array(4)),this.dummyDepthTexture={texture:u,gl:c,bind:function(e){return!!this.texture&&(this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),!0)},unbind:function(e){this.texture&&(this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,null))},destroy:function(){this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}},c.bindTexture(c.TEXTURE_2D,null)},e.prototype.draw=function(e,t){this.program[e].bind();var r=this.handles[e];t.textureUnit=0;var a=this.program.gl;if(r.depthMode&&r.depthMode.setValue(t.depthMode),!t.VAO)for(var i=0;i<10;i++)a.disableVertexAttribArray(i);if(r.uPMatrix&&r.uPMatrix.setValue(t.projectionMatrix),r.uvMatrix&&r.uvMatrix.setValue(t.viewMatrix),r.uWorldEye&&r.uWorldEye.setValue(t.cameraEye),r.uAmbientColor&&r.uAmbientColor.setValue(t.ambientColor),r.uLightColor)for(i=0;i<this.numLights;++i){var n=t.lights[i];r.uLightColor[i]&&r.uLightColor[i].setValue(n.color),r.uLightPos[i]&&(r.uLightPos[i].setValue(n.pos),r.uLightAttenuation[i]&&r.uLightAttenuation[i].setValue(n.attenuation)),r.uLightDir[i]&&r.uLightDir[i].setValue(n.dir),r.uInnerCone[i]&&r.uInnerCone[i].setValue(n.innerCone),r.uOuterCone[i]&&r.uOuterCone[i].setValue(n.outerCone)}if(this.numClips>0)for(i=0;i<this.numClips;++i){var o=t.clips.clips[i];r.uClipNormalAndDist[i]&&r.uClipNormalAndDist[i].setValue(o.normalAndDist),r.uClipFadeDistance[i]&&r.uClipFadeDistance[i].setValue(o.fadeDistance)}t.reflection&&t.reflection.texture&&(this.program[e].bindTexture("SCENEJS_uPBRReflectionMapSampler",t.reflection.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,t.bindTexture++,r.uPBRReflectionMapIntensity&&r.uPBRReflectionMapIntensity.setValue(t.reflection.intensity),r.uPBRReflectionMapMipLevels&&r.uPBRReflectionMapMipLevels.setValue(t.reflection.mipLevels)),t.lightmap&&t.lightmap.texture&&(this.program[e].bindTexture("SCENEJS_uPBRLightMapSampler",t.lightmap.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,t.bindTexture++,r.uPBRLightMapIntensity&&r.uPBRLightMapIntensity.setValue(t.lightmap.intensity),r.uPBRLightMapMipLevels&&r.uPBRLightMapMipLevels.setValue(t.lightmap.mipLevels)),r.uFogParams&&r.uFogParams.setValue(t.fogParams),r.uFogColor&&r.uFogColor.setValue(t.fogColor),r.uXrayColor&&r.uXrayColor.setValue(t.xrayColor),this.program[e].bindTexture("SCENEJS_uDepthBuffer",t.depthBuffer||this.dummyDepthTexture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,t.bindTexture++,r.uCanvasRes&&r.uCanvasRes.setValue(t.canvasResolution),r.pickMode&&r.pickMode.setValue(t.pickObject?0:2),t.useProgram++},SceneJS_ChunkFactory.addChunkType("program",e)}(),function(){"use strict";var e=function(e,t,r,a){this.id=e,this.numericId=t,this.program=r;for(var i=0,n=(a=a||[]).length;i<n;++i)a[i]&&a[i].empty&&(a[i]=null);this.cores=a,this.handles={},this.build()};e.prototype.build=function(){this.core=this.cores[0],this.handles.draw={uRegionMapRegionColor:this.program.draw.getUniform("SCENEJS_uRegionMapRegionColor"),uRegionMapHighlightFactor:this.program.draw.getUniform("SCENEJS_uRegionMapHighlightFactor"),uRegionMapHideAlpha:this.program.draw.getUniform("SCENEJS_uRegionMapHideAlpha")},this.sampleName="SCENEJS_uRegionMapSampler"},e.prototype.draw=function(e,t){var r=this.core.texture,a=this.handles[e]||{};r?(t.regionData=this.core.regionData,this.program.draw.bindTexture(this.sampleName,r,t.textureUnit),t.textureUnit=(t.textureUnit+1)%SceneJS.WEBGL_INFO.MAX_TEXTURE_UNITS,a.uRegionMapRegionColor&&a.uRegionMapRegionColor.setValue(this.core.regionColor),a.uRegionMapHighlightFactor&&a.uRegionMapHighlightFactor.setValue(this.core.highlightFactor),a.uRegionMapHideAlpha&&a.uRegionMapHideAlpha.setValue(this.core.hideAlpha),t.regionMapUVLayerIdx=this.core.uvLayerIdx):t.regionMapUVLayerIdx=-1},SceneJS_ChunkFactory.addChunkType("regionMap",e)}(),function(){function e(e){var t,r,a;e.size?(t=e.size[0],r=e.size[1],a=e.size[2]):(t=e.xSize||1,r=e.ySize||1,a=e.zSize||1);var i="geometry/box_"+t+"_"+r+"_"+a+(e.wire?"wire":"_solid");return this.getScene().hasCore("geometry",i)?{type:"geometry",coreId:i}:{type:"geometry",primitive:e.wire?"lines":"triangles",coreId:i,positions:new Float32Array([t,r,a,-t,r,a,-t,-r,a,t,-r,a,t,r,a,t,-r,a,t,-r,-a,t,r,-a,t,r,a,t,r,-a,-t,r,-a,-t,r,a,-t,r,a,-t,r,-a,-t,-r,-a,-t,-r,a,-t,-r,-a,t,-r,-a,t,-r,a,-t,-r,a,t,-r,-a,-t,-r,-a,-t,r,-a,t,r,-a]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1]),uv:new Float32Array([t,r,0,r,0,0,t,0,0,r,0,0,t,0,t,r,t,0,t,r,0,r,0,0,t,r,0,r,0,0,t,0,0,0,t,0,t,r,0,r,0,0,t,0,t,r,0,r]),indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}}SceneJS.Types.addType("geometry/box",{construct:function(t){this.addNode(e.call(this,t))}})}(),function(){function e(e){var t="geometry/quad"+(e.wire?"wire":"_solid");return this.getScene().hasCore("geometry",t)?{type:"geometry",coreId:t}:{type:"geometry",primitive:e.wire?"lines":"triangles",coreId:t,positions:[1,1,0,-1,1,0,-1,-1,0,1,-1,0],normals:[-1,0,0,-1,0,0,-1,0,0,-1,0,0],uv:[1,1,0,1,0,0,1,0],indices:[0,1,2,0,2,3]}}SceneJS.Types.addType("geometry/quad",{construct:function(t){this.addNode(e.call(this,t))}})}(),function(){function e(e){var t=e.latitudeBands||30,r=e.longitudeBands||30,a=e.radius||1,i="geometry/sphere_"+(e.wire?"wire":"_solid")+a+"_"+r+"_"+t;if(this.getScene().hasCore("geometry",i))return{type:"geometry",coreId:i};for(var n=[],o=[],s=[],l=0;l<=t;l++)for(var c=l*Math.PI/t,u=Math.sin(c),_=Math.cos(c),h=0;h<=r;h++){var f=2*h*Math.PI/r,d=Math.sin(f),p=Math.cos(f)*u,m=_,g=d*u,y=h/r,v=l/t;o.push(p),o.push(m),o.push(g),s.push(y),s.push(v),n.push(a*p),n.push(a*m),n.push(a*g)}var S=[];for(l=0;l<t;l++)for(h=0;h<r;h++){var b=l*(r+1)+h,E=b+r+1;S.push(b+1),S.push(E+1),S.push(E),S.push(b+1),S.push(E),S.push(b)}return{type:"geometry",primitive:e.wire?"lines":"triangles",coreId:i,positions:new Float32Array(n),normals:new Float32Array(o),uv:new Float32Array(s),indices:S}}SceneJS.Types.addType("geometry/sphere",{construct:function(t){this.addNode(e.call(this,t))}})}(),function(){function e(e){var t=e.width||1,r=e.height||1,a=e.widthSegments||1,i=e.heightSegments||1,n="geometry/plane_"+(1==e.wire?"wire_":"")+r+"_"+a+"_"+i;if(this.getScene().hasCore("geometry",n))return{type:"geometry",coreId:n};var o,s,l,c,u,_,h,f=[],d=[],p=[],m=[],g=t/2,y=r/2,v=a,S=i,b=v+1,E=S+1,I=t/v,x=r/S;for(s=0;s<E;s++)for(o=0;o<b;o++)l=s*x-y,f.push(o*I-g),f.push(-l),f.push(0),d.push(0),d.push(0),d.push(1),p.push(o/v),p.push(1-s/S);for(s=0;s<S;s++)for(o=0;o<v;o++)u=o+b*(s+1),_=o+1+b*(s+1),h=o+1+b*s,m.push(c=o+b*s),m.push(u),m.push(_),m.push(_),m.push(h),m.push(c);return{type:"geometry",primitive:e.wire?"lines":"triangles",coreId:n,positions:new Float32Array(f),normals:new Float32Array(d),uv:new Float32Array(p),indices:m}}SceneJS.Types.addType("geometry/plane",{construct:function(t){this.addNode(e.call(this,t))}})}(),(("undefined"!=typeof window?window:module.exports).GrowingPacker=function(){}).prototype={fit:function(e){var t,r,a,i=e.length;for(this.root={x:0,y:0,w:i>0?e[0].w:0,h:i>0?e[0].h:0},t=0;t<i;t++)(a=e[t]).fit=(r=this.findNode(this.root,a.w,a.h))?this.splitNode(r,a.w,a.h):this.growNode(a.w,a.h)},findNode:function(e,t,r){return e.used?this.findNode(e.right,t,r)||this.findNode(e.down,t,r):t<=e.w&&r<=e.h?e:null},splitNode:function(e,t,r){return e.used=!0,e.down={x:e.x,y:e.y+r,w:e.w,h:e.h-r},e.right={x:e.x+t,y:e.y,w:e.w-t,h:r},e},growNode:function(e,t){var r=e<=this.root.w,a=t<=this.root.h,i=r&&this.root.w>=this.root.h+t;return a&&this.root.h>=this.root.w+e?this.growRight(e,t):i?this.growDown(e,t):a?this.growRight(e,t):r?this.growDown(e,t):null},growRight:function(e,t){return this.root={used:!0,x:0,y:0,w:this.root.w+e,h:this.root.h,down:this.root,right:{x:this.root.w,y:0,w:e,h:this.root.h}},(node=this.findNode(this.root,e,t))?this.splitNode(node,e,t):null},growDown:function(e,t){return this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+t,down:{x:0,y:this.root.h,w:this.root.w,h:t},right:this.root},(node=this.findNode(this.root,e,t))?this.splitNode(node,e,t):null}},function(){"use strict";var e=window.Human={},t="17.1.3";t=t.indexOf("ENGINE_VERSION")>0?"qa":t;var r,a="2.0.1";a=a.indexOf("API_VERSION")>0?"qa":a,e.VERSION=t,e.API_VERSION=a,e.deployed=!(window.location.hostname.match(/(localhost|192\.168\.11\.\d{1,3})/)||"file:"===window.location.protocol),e.locale="en-US",e.timer=window.performance||window.Date,e.stats={trackingDownloadSize:!1,jsonDownloadTotal:0,geometryDownloadTotal:0,textureDownloadTotal:0,jsonDownloadSizes:{},geometryDownloadSizes:{},textureDownloadSizes:{},loadSequence:{startTime:e.timer.now(),moduleRequest:0,moduleLoaded:0,assetsRequested:0,assetsLoaded:0,texturesRequested:0,texturesLoaded:0},loadTimes:{preModule:0,moduleDownload:0,preAsset:0,assetDownload:0,preTexture:0,textureDownload:0},trackDownloadSize:function(){window.pako&&(this.trackingDownloadSize=!0)}},e.canvasId="theCanvas",e.annotationCanvasId="annotationCanvas",e.containerId="container",e.XML_HTTP_JSON_SUPPORTED=((r=new XMLHttpRequest).open("GET","/"),r.responseType="json","json"===r.responseType),e.ELEMENT_REMOVE_SUPPORTED="function"==typeof Element.prototype.remove,e.error=function(t,r){return void 0===r&&(r=t,t="ERROR"),e._error("HUMAN",t,r,!1)},e.fatalError=function(t,r){return void 0===r&&(r=t,t="ERROR"),e._error("HUMAN",t,r,!0)},e._error=function(t,r,a,i){return e.events.fire("error",{type:t,name:r,message:a,fatal:i,log:e.log.messages.join("\n"),stack:e.utils.getStackTrace(),webglInfo:SceneJS.WEBGL_INFO}),a}}(),function(){"use strict";Human.Component=function(){},Human.Component.prototype={_init:function(e){this._ctx=e,this._handleMap=new Human.utils.Map,this._topicSubs={},this._handleTopics={},this._topicPubs={}},publish:function(e,t,r){r||(this._topicPubs[e]=t);var a=this._topicSubs[e];if(a)for(var i in a)a.hasOwnProperty(i)&&a[i].call(this,t)},on:function(e,t){var r=this._topicSubs[e];r||(this._topicSubs[e]=r={});var a=this._handleMap.addItem();r[a]=t,this._handleTopics[a]=e;var i=this._topicPubs[e];return i&&t.call(this,i),a},off:function(e,t){var r,a;if(t){for(var i in a=this._topicSubs[r=e])if(a[i]===t){e=i;break}}else r=this._handleTopics[e];r&&(delete this._handleTopics[e],(a=this._topicSubs[r])&&delete a[e],this._handleMap.removeItem(e))},once:function(e,t){var r=this,a=this.on(e,(function(e){r.off(a),t(e)}))}}}(),function(){"use strict";var e=Human.math={X_AXIS:vec3.fromValues(1,0,0),Y_AXIS:vec3.fromValues(0,1,0),Z_AXIS:vec3.fromValues(0,0,1),VEC3_ZEROS:vec3.fromValues(0,0,0),VEC3_ONES:vec3.fromValues(1,1,1),TO_RADIANS:Math.PI/180},t=vec3.create(),r=vec3.create();e.clamp=function(e,t,r){return e<t?t:e>r?r:e},e.nextPowerOf2=function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))},e.sign=function(e){return e>0?1:e<0?-1:0},e.lerpScalar=function(e,t,r,a,i){return a+(e-t)/(r-t)*(i-a)},e.lerpVec3=function(e,t,r,a,i,n){var o=(e-t)/(r-t);return(n=n||vec3.create())[0]=a[0]+o*(i[0]-a[0]),n[1]=a[1]+o*(i[1]-a[1]),n[2]=a[2]+o*(i[2]-a[2]),n},e.triangleNormal=function(e,a,i,n){var o=t,s=r;return vec3.subtract(o,a,e),vec3.subtract(s,i,e),vec3.cross(n,o,s),vec3.normalize(n,n),n},e.getShortRotation=function(e,t){var r=t>e?1:-1,a=(t-e)*r;return(a=(a+Math.PI)%(2*Math.PI)-Math.PI)*r},e.lerpRadian=function(t,r,a){return r+t*e.getShortRotation(r,a)},e.lerpVec3Cylindrical=function(t,r,a,i,n,o){var s=(t-r)/(a-r);return(o=o||vec3.create())[0]=i[0]+s*(n[0]-i[0]),o[1]=e.lerpRadian(s,i[1],n[1]),o[2]=i[2]+s*(n[2]-i[2]),o},Human.math.decompressPosition=function(e,t,r){e[0]=t[0]*r[0]+r[12],e[1]=t[1]*r[5]+r[13],e[2]=t[2]*r[10]+r[14]},Human.math.decompressUV=function(e,t,r){e[0]=t[0]*r[0]+r[6],e[1]=t[1]*r[4]+r[7]},Human.math.vec3ObjToArray=function(e,t){var r=t||vec3.create();return r[0]=e.x||0,r[1]=e.y||0,r[2]=e.z||0,r},Human.math.vec3ArrayToObj=function(e){return{x:e[0],y:e[1],z:e[2]}},e.cartesianToCylindrical=function(e,t){var r=t||vec3.create();return r[0]=Math.sqrt(e[0]*e[0]+e[2]*e[2]),r[1]=Math.atan2(e[0],e[2]),r[2]=e[1],r},e.cylindricalToCartesian=function(e,t){var r=t||vec3.create();return r[0]=e[0]*Math.sin(e[1]),r[1]=e[2],r[2]=e[0]*Math.cos(e[1]),r},e.AxisBox3=function(e,t){this.verts=[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]},e.easeOut=function(e,t,r){var a=e*e;return t+r*(-1*a*a+a*e*4+-6*a+4*e)},e.easeIn=function(t,r,a){return 1-e.easeOut(1-t,r,a)},e.easeInOut=function(t,r,a){return t<.5?e.easeIn(2*t,r,a)/2:.5*e.easeOut(2*t-1,r,a)+.5},e.getBoundaryCenter=function(e,t){var r=t||vec3.create();return r[0]=.5*(e.xmax+e.xmin),r[1]=.5*(e.ymax+e.ymin),r[2]=.5*(e.zmax+e.zmin),r};var a=vec3.create();e.getBoundaryDiag=function(e){return a[0]=e.xmax-e.xmin,a[1]=e.ymax-e.ymin,a[2]=e.zmax-e.zmin,vec3.length(a)};var i=mat4.create(),n=mat4.create(),o=mat4.create(),s=mat4.create(),l=mat4.create();e.buildRotationScaleMat3=function(e,t,r){return t=t||this.VEC3_ZEROS,mat4.fromScaling(i,r=r||this.VEC3_ONES),mat4.fromZRotation(n,t[2]*this.TO_RADIANS),mat4.fromYRotation(o,t[1]*this.TO_RADIANS),mat4.fromXRotation(s,t[0]*this.TO_RADIANS),mat4.multiply(l,s,i),mat4.multiply(l,o,l),mat4.multiply(l,n,l),mat3.fromMat4(e,l)}}(),function(){"use strict";var e=Math.abs,t=Math.cos,r=Math.sin,a=Math.atan2,i=Math.sqrt,n=Math.pow,o={x:0,y:0,z:0},s={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(e,t){var r=t(e),a=r.x*r.x+r.y*r.y;return void 0!==r.z&&(a+=r.z*r.z),i(a)},length:function(e){var t,r=0,a=s.Tvalues.length;for(t=0;t<a;t++)r+=s.Cvalues[t]*s.arcfn(.5*s.Tvalues[t]+.5,e);return.5*r},map:function(e,t,r,a,i){return a+(e-t)/(r-t)*(i-a)},lerp:function(e,t,r){var a={x:t.x+e*(r.x-t.x),y:t.y+e*(r.y-t.y)};return t.z&&r.z&&(a.z=t.z+e*(r.z-t.z)),a},pointToString:function(e){var t=e.x+"/"+e.y;return void 0!==e.z&&(t+="/"+e.z),t},pointsToString:function(e){return"["+e.map(s.pointToString).join(", ")+"]"},angle:function(e,t,r){var n=t.x-e.x,o=t.y-e.y,s=r.x-e.x,l=r.y-e.y,c=n*l-o*s,u=i(n*n+o*o),_=i(s*s+l*l);return a(c,(n/=u)*(s/=_)+(o/=u)*(l/=_))},dist:function(e,t){var r=e.x-t.x,a=e.y-t.y;return i(r*r+a*a)},abcratio:function(t,r){if(2!==r&&3!==r)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;var a=n(t,r)+n(1-t,r);return e((a-1)/a)},projectionratio:function(e,t){if(2!==t&&3!==t)return!1;if(void 0===e)e=.5;else if(0===e||1===e)return e;var r=n(1-e,t);return r/(n(e,t)+r)},align:function(e,i){var n=i.p1.x,o=i.p1.y,s=-a(i.p2.y-o,i.p2.x-n);return e.map((function(e){return{x:(e.x-n)*t(s)-(e.y-o)*r(s),y:(e.x-n)*r(s)+(e.y-o)*t(s)}}))}},l=Human.math.bezier=function(t){var r=t&&t.forEach?t:[].slice.call(arguments),a=!1;if("object"==typeof r[0]){a=r.length;var i=[];r.forEach((function(e){["x","y","z"].forEach((function(t){void 0!==e[t]&&i.push(e[t])}))})),r=i}var n=!1,o=r.length;if(a){if(a>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");n=!0}}else if(6!==o&&8!==o&&9!==o&&12!==o&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");var l=!n&&(9===o||12===o)||t&&t[0]&&void 0!==t[0].z;this._3d=l;for(var c=[],u=0,_=l?3:2;u<o;u+=_){var h={x:r[u],y:r[u+1]};l&&(h.z=r[u+2]),c.push(h)}this.order=c.length-1,this.points=c;var f=["x","y"];l&&f.push("z"),this.dims=f,this.dimlen=f.length,function(t){for(var r=s.align(c,{p1:c[0],p2:c[t.order]}),a=0;a<r.length;a++)if(e(r[a].y)>1e-4)return void(t._linear=!1);t._linear=!0}(this),this._t1=0,this._t2=1,this.update()};function c(e,t,r,a,i){void 0===i&&(i=.5);var n=s.projectionratio(i,e),o=1-n,l={x:n*t.x+o*a.x,y:n*t.y+o*a.y},c=s.abcratio(i,e);return{A:{x:r.x+(r.x-l.x)/c,y:r.y+(r.y-l.y)/c},B:r,C:l}}l.quadraticFromPoints=function(e,t,r,a){if(void 0===a&&(a=.5),0===a)return new l(t,t,r);if(1===a)return new l(e,t,t);var i=c(2,e,t,r,a);return new l(e,i.A,r)},l.cubicFromPoints=function(e,t,r,a,i){void 0===a&&(a=.5);var n=c(3,e,t,r,a);void 0===i&&(i=s.dist(t,n.C));var o=i*(1-a)/a,u=s.dist(e,r),_=(r.x-e.x)/u,h=(r.y-e.y)/u,f=n.A;return new l(e,{x:e.x+(f.x+(t.x-i*_-f.x)/(1-a)-e.x)/a,y:e.y+(f.y+(t.y-i*h-f.y)/(1-a)-e.y)/a},{x:r.x+(f.x+(t.x+o*_-f.x)/a-r.x)/(1-a),y:r.y+(f.y+(t.y+o*h-f.y)/a-r.y)/(1-a)},r)},l.prototype={valueOf:function(){return this.toString()},toString:function(){return s.pointsToString(this.points)},update:function(){this.dpoints=[];for(var e=this.points,t=e.length,r=t-1;t>1;t--,r--){for(var a,i=[],n=0;n<r;n++)a={x:r*(e[n+1].x-e[n].x),y:r*(e[n+1].y-e[n].y)},this._3d&&(a.z=r*(e[n+1].z-e[n].z)),i.push(a);this.dpoints.push(i),e=i}this.computedirection()},computedirection:function(){var e=this.points,t=s.angle(e[0],e[this.order],e[1]);this.clockwise=t>0},length:function(){return s.length(this.derivative.bind(this))},_lut:[],getLUT:function(e){if(this._lut.length===(e=e||100))return this._lut;this._lut=[];for(var t=0;t<=e;t++)this._lut.push(this.compute(t/e));return this._lut},on:function(e,t){t=t||5;for(var r,a=this.getLUT(),i=[],n=0,o=0;o<a.length;o++)s.dist(r=a[o],e)<t&&(i.push(r),n+=o/a.length);return!!i.length&&n/i.length},get:function(e){return this.compute(e)},point:function(e){return this.points[e]},compute:function(e){if(0===e)return this.points[0];if(1===e)return this.points[this.order];var t,r=this.points,a=1-e;if(1===this.order)return t={x:a*r[0].x+e*r[1].x,y:a*r[0].y+e*r[1].y},this._3d&&(t.z=a*r[0].z+e*r[1].z),t;if(this.order<4){var i,n,s,l=a*a,c=e*e,u=0;return 2===this.order?(r=[r[0],r[1],r[2],o],i=l,n=a*e*2,s=c):3===this.order&&(i=l*a,n=l*e*3,s=a*c*3,u=e*c),t={x:i*r[0].x+n*r[1].x+s*r[2].x+u*r[3].x,y:i*r[0].y+n*r[1].y+s*r[2].y+u*r[3].y},this._3d&&(t.z=i*r[0].z+n*r[1].z+s*r[2].z+u*r[3].z),t}for(var _=JSON.parse(JSON.stringify(this.points));_.length>1;){for(var h=0;h<_.length-1;h++)_[h]={x:_[h].x+(_[h+1].x-_[h].x)*e,y:_[h].y+(_[h+1].y-_[h].y)*e},void 0!==_[h].z&&(_[h]=_[h].z+(_[h+1].z-_[h].z)*e);_.splice(_.length-1,1)}return _[0]},derivative:function(e){var t,r,a=1-e,i=0,n=this.dpoints[0];2===this.order&&(n=[n[0],n[1],o],t=a,r=e),3===this.order&&(t=a*a,r=a*e*2,i=e*e);var s={x:t*n[0].x+r*n[1].x+i*n[2].x,y:t*n[0].y+r*n[1].y+i*n[2].y};return this._3d&&(s.z=t*n[0].z+r*n[1].z+i*n[2].z),s}}}(),function(){"use strict";var e=Human.math.intersections={},t=1e-8,r=vec3.create(),a=vec3.create(),i=[new Float32Array([1,0,0]),new Float32Array([0,1,0]),new Float32Array([0,0,1]),new Float32Array([-1,0,0]),new Float32Array([0,-1,0])];e.pointAabb=function(e,t,r){return!(e[0]<t[0]||e[0]>r[0]||e[1]<t[1]||e[1]>r[1]||e[2]<t[2]||e[2]>r[2])},e.aabbAabb=function(e,t,r,a){return!(t[0]<r[0]||a[0]<e[0]||t[1]<r[1]||a[1]<e[1]||t[2]<r[2]||a[2]<e[2])},e.rayAabb=function(e,r,a,i,n){for(var o=0,s=Number.POSITIVE_INFINITY,l=Math.abs,c=Math.min,u=Math.max,_=0;_<3;++_)if(l(r[_])<t){if(e[_]<a[_]||e[_]>i[_])return!1}else{var h=(a[_]-e[_])/r[_],f=(i[_]-e[_])/r[_];if(h>f){var d=h;h=f,f=d}if((o=u(o,h))>(s=c(s,f)))return!1}return n&&(n[0]=o,n[1]=s),!0};var n=new Float32Array(3),o=new Float32Array(3),s=new Float32Array(3),l=new Float32Array(3),c=new Float32Array(3);e.rayTriangle=function(e,r,a,i,u,_){vec3.sub(n,i,a),vec3.sub(o,u,a),vec3.cross(l,r,o);var h=vec3.dot(l,n);if(h>-1e-8&&h<t)return!1;var f=1/h;vec3.sub(s,e,a);var d=f*vec3.dot(l,s);if(d<0||d>1)return!1;vec3.cross(c,s,n);var p=f*vec3.dot(c,r);if(p<0||d+p>1)return!1;var m=f*vec3.dot(c,o);return!(m<t||(_&&m<_.t&&(_.u=d,_.v=p,_.w=1-d-p,_.t=m),0))},e.pointPolyhedron=function(e,t){var r=0,a=0,n=t.getObject();if(!n)return!1;for(var o=0,s=i.length;o<s;++o)g(e,i[o],n.getKdTree(),n)%2==1?++r:++a;return r>a},e.rayPolyhedron=function(e,t,r,a){var i=r.getObject();return i?(a=a||{t:Number.POSITIVE_INFINITY,u:0,v:0,w:0,triangleIndex:-1},g(e,t,i.getKdTree(),i,a)>0?a:null):null},e.planeAabb=function(e,t,r,a){var i=a[0],n=a[1],o=a[2];if(e[0]>=0&&(i=r[0]),e[1]>=0&&(n=r[1]),e[2]>=0&&(o=r[2]),i*e[0]+n*e[1]+o*e[2]+t>0)return-1;var s=r[0],l=r[1],c=r[2];return e[0]>=0&&(s=a[0]),e[1]>=0&&(l=a[1]),e[2]>=0&&(c=a[2]),s*e[0]+l*e[1]+c*e[2]+t>0?0:1},e.planesAabb=function(e,t,r,a){for(var i=1,n=e.length,o=0;o<n;++o){var s=e[o],l=this.planeAabb(s.n,s.d,t,r);if(a&&(a[o]=l),l<1&&(i=l),-1===i)break}if(a&&o<n)for(var c=5;c>o;--c)a[c]=void 0;return i};var u=mat4.create(),_=mat3.create(),h=vec3.create(),f=vec3.create(),d=vec3.create(),p=vec3.create(),m=vec3.create();function g(t,r,a,i,n){if(!e.rayAabb(t,r,a.bb.min,a.bb.max))return 0;if(a.triangles){for(var o=a.triangles,s=0,l=0,c=o.length;l<c;++l)i.getTrianglePositionOnSurface(3*o[l],b,E,I),e.rayTriangle(t,r,b,E,I,n)&&(n&&(n.triangleIndex=o[l]),++s);return s}return g(t,r,a.left,i,n)+g(t,r,a.right,i,n)}e.pointObject=function(e,t){var r=Human.scene.objects[t],a=r.getBoundary();if(p[0]=a.xmin,p[1]=a.ymin,p[2]=a.zmin,m[0]=a.xmax,m[1]=a.ymax,m[2]=a.zmax,!this.pointAabb(e,p,m))return!1;mat4.invert(u,r.getWorldMatrix()),vec3.transformMat4(h,e,u);for(var i=0,n=r.renderables.length;i<n;++i){var o=r.renderables[i];if(p[0]=(a=o.boundary).xmin,p[1]=a.ymin,p[2]=a.zmin,m[0]=a.xmax,m[1]=a.ymax,m[2]=a.zmax,this.pointAabb(h,p,m)){var s=o.geometryNode;if(s&&this.pointPolyhedron(h,s))return!0}}return!1},e.rayObjectAabb=function(e,t,r,a){var i=Human.scene.objects[r].getBoundary();return p[0]=i.xmin,p[1]=i.ymin,p[2]=i.zmin,m[0]=i.xmax,m[1]=i.ymax,m[2]=i.zmax,this.rayAabb(e,t,p,m,a)},e.rayObject=function(e,t,r,a,i){var n=Human.scene.objects[r];if(!this.rayObjectAabb(e,t,r))return null;mat4.invert(u,n.getWorldMatrix()),vec3.transformMat4(f,e,u),mat3.fromMat4(_,u),vec3.transformMat3(d,t,_);for(var o=0,s=n.renderables.length;o<s;++o){var l=n.renderables[o];if(!i||i(l)){var c=l.boundary;if(p[0]=c.xmin,p[1]=c.ymin,p[2]=c.zmin,m[0]=c.xmax,m[1]=c.ymax,m[2]=c.zmax,this.rayAabb(f,d,p,m)){var h=l.geometryNode;if(h){var g=this.rayPolyhedron(f,d,h,a);if(g)return g}}}}return null},e.raySceneAabb=function(t,r,a){var i=[];return function t(r,a,i,n,o){if(!i.left){for(var s=i.objects,l=0,c=s.length;l<c;++l){var u=s[l],_=u.objectId;n&&!n(u)||e.rayObjectAabb(r,a,_,y)&&o.push({object:u,tmin:y[0],tmax:y[1]})}return o}return e.rayAabb(r,a,i.bb.min,i.bb.max)?(t(r,a,i.left,n,o),t(r,a,i.right,n,o),o):o}(t,r,Human.scene.getKdTree(),a,i),i.length>0?(i.sort(S),i):null},e.rayScene=function(e,t,r,a){var i=[],n=this.raySceneAabb(e,t,r);if(n)for(var o=0,s=n.length;o<s;++o){var l=n[o].object.objectId,c={t:Number.POSITIVE_INFINITY,u:0,v:0,w:0,triangleIndex:-1,objectId:l};this.rayObject(e,t,l,c,a)&&i.push(c)}return i.length>0?(i.sort(v),i):null},e.spherePolyhedron=function(t,i,n){var o=r,s=a;return o[0]=i[0]-n,o[1]=i[1]-n,o[2]=i[2]-n,s[0]=i[0]+n,s[1]=i[1]+n,s[2]=i[2]+n,C(t,(function(t){return e.aabbAabb(t.bb.min,t.bb.max,o,s)}),(function(e,t,r){return function(e,t,r,a,i){vec3.subtract(T,r,e),vec3.subtract(N,t,e),vec3.cross(A,N,T),vec3.cross(M,A,N);var n=vec3.length(T);vec3.scale(M,M,n*=n),vec3.cross(P,T,A);var o=vec3.length(N);vec3.scale(P,P,o*=o),vec3.add(M,M,P);var s=vec3.length(A);vec3.scale(D,M,1/(2*(s*=s)));var l=vec3.length(D);return vec3.add(w,e,D),vec3.subtract(F,a,w),vec3.length(F)<=l+i}(e,t,r,i,n)}))},e.sphereInPolyhedron=function(t,i,n){var o=r,s=a;return o[0]=i[0]-n,o[1]=i[1]-n,o[2]=i[2]-n,s[0]=i[0]+n,s[1]=i[1]+n,s[2]=i[2]+n,C(t,(function(t){return e.aabbAabb(t.bb.min,t.bb.max,o,s)}),(function(e,t,r){return function(e,t,r,a,i){var n=i*i,o=e[0]-a[0],s=e[1]-a[1],l=e[2]-a[2],c=o*o+s*s+l*l;return!(c>n||(c=(o=t[0]-a[0])*o+(s=t[1]-a[1])*s+(l=t[2]-a[2])*l)>n||(c=(o=r[0]-a[0])*o+(s=r[1]-a[1])*s+(l=r[2]-a[2])*l)>n)}(e,t,r,i,n)}))};var y=new Float32Array(2);function v(e,t){return e.t-t.t}function S(e,t){return e.tmin-t.tmin}var b=new Float32Array(3),E=new Float32Array(3),I=new Float32Array(3),x=[];function C(e,t,r){var a=[],i=e.getObject();if(!i)return a;for(x.length=0,x.push(i.getKdTree());x.length>0;){var n=x.pop();if(t(n)&&(n.left&&x.push(n.left),n.right&&x.push(n.right),n.triangles))for(var o=0,s=n.triangles.length;o<s;++o)i.getTrianglePositionOnSurface(3*n.triangles[o],b,E,I),r(b,E,I)&&a.push(n.triangles[o])}return a}var T=new Float32Array(3),N=new Float32Array(3),A=new Float32Array(3),D=new Float32Array(3),M=new Float32Array(3),P=new Float32Array(3),w=new Float32Array(3),F=new Float32Array(3)}(),function(){"use strict";Human.utils=Human.utils||{};var e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];function t(e,t){return e<t?-1:e>t?1:0}function r(e,t,r,a){var i=new XMLHttpRequest;i.open("GET",e,!0),i.timeout=0,i.responseType=t,i.onerror=function(){a(new Error("Failed request ("+e+"): "+i.status+" - "+i.statusText))},i.onload=window.localContentOnly?function(){e.endsWith("-etc1.pvr")&&1347834371!==new DataView(i.response).getInt32(0)?a(new Error("Failed offline PVR get request: "+i.status+" - "+i.statusText)):r(i.response)}:function(){200===i.status?r(i.response):a&&a(new Error("Failed network request ("+e+"): "+i.status+" - "+i.statusText))},i.send(null)}Human.utils.leftPad=function(e,t,r){for(;e.length<r;)e=t+e;return e},Human.utils.toHexString=function(t){for(var r="";t>0;)r=e[15&t]+r,t>>=4;return r},Human.utils.floatRGBToHexString=function(e,t,r){return"#"+this.leftPad(this.toHexString(Math.floor(255*e)),"0",2)+this.leftPad(this.toHexString(Math.floor(255*t)),"0",2)+this.leftPad(this.toHexString(Math.floor(255*r)),"0",2)},Human.utils.isArray=function(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length},Human.utils.isObject=function(e){return!!e&&"[object Object]"===Object.prototype.toString.call(e)},Human.utils.isPrimitive=function(e){return null===e||!!(typeof e).match(/^(string|number|boolean|undefined)$/)},Human.utils.isString=function(e){return"string"==typeof e||e instanceof String},Human.utils.filterInPlace=function(e,t){for(var r=0,a=0,i=e.length;a<i;a++)t(e[a])?e[a-r]=e[a]:r++;return e.length=e.length-r,e},Human.utils.getStackTrace=function(){var e,t=new Error;if(t.stack)e=t.stack;else try{throw t}catch(r){e=r.stack}return e||null},Human.utils.extend=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e},Human.utils.apply=function(e,t){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},Human.utils.applyIf=function(e,t){for(var r in e)e.hasOwnProperty(r)&&null==t[r]&&(t[r]=e[r]);return t},Human.utils.applyIf2=function(e,t){e=e||{};var r={};for(var a in t)t.hasOwnProperty(a)&&(r[a]=void 0!==e[a]?e[a]:t[a]);return r},Human.utils.shallowClone=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},Human.utils.deepClone=function(e){if(null==e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e)return e;var t;if(Array.isArray(e)){t=new Array(e.length);for(var r=0,a=e.length;r<a;++r)t[r]=Human.utils.deepClone(e[r]);return t}for(var i in t={},e)t[i]=Human.utils.deepClone(e[i]);return t},Human.utils.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},Human.utils.getDir=function(e){var t=e.lastIndexOf("/");return t>-1?e.substring(0,t>0?t+1:0):""},Human.utils.async=function(e){setTimeout(e,0)},Human.utils.noop=function(){},Human.utils.getKeys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t},Human.utils.createUUID=function(){for(var e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],t=["8","9","A","B"],r=[],a=0;a<38;a++)switch(a){case 8:case 13:case 18:r.push("-");break;case 14:r.push("4");break;case 19:r.push(t[Math.round(3*Math.random())]);break;default:r.push(e[Math.round(15*Math.random())])}return r.join("")},Human.utils.binarySearch=function(e,r,a,i){i=i||{index1:null,index2:null,value1:null,value2:null};var n,o,s,l=0,c=e.length-1;if((a=a||t)(e[0],r)>0)return i.index1=null,i.value1=null,i.index2=0,i.value2=e[0],i;if(a(e[c],r)<0)return i.index1=c,i.value1=e[c],i.index2=null,i.value2=null,i;for(;l<=c;){if(s=e[(n=Math.floor((l+c)/2))+1],a(o=e[n],r)<=0&&a(s,r)>=0)return i.index1=n,i.index2=n+1,i.value1=o,i.value2=s,i;a(o,r)>0?c=n-1:l=n+1}},Human.utils.atos=function(e,t,r){t=t||0,r=r||e.byteLength;var a=new Uint8Array(e,t,r);return new TextDecoder("utf-8").decode(a)},Human.utils.atoj=function(e,t,r){return JSON.parse(Human.utils.atos(e,t,r))},Human.utils.benchmark=function(e,t){t=t||1e7;for(var r=performance.now(),a=0;a<t;a++)e();r=performance.now()-r,console.log("Total time: "+r.toFixed(3)+"ms"),console.log("Time / operation: "+(r/t).toExponential(3)+"ms")},Human.utils.setRandomVisibleObjects=function(e){for(var t=Object.keys(Human.scene.objects).filter((function(e){return Human.scene.objects[e].isLeaf()})),r={},a=0;a<e;a++){var i=Math.floor(Math.random()*t.length);r[t.splice(i,1)]=!0}Human.scene.setEnabledObjects({objectIds:r,replace:!0})},Human.utils.getText=function(e,t,a){r(e,"text",t,a)},Human.XML_HTTP_JSON_SUPPORTED?Human.utils.getJSON=function(e,t,a){r(e,"json",t,a)}:Human.utils.getJSON=function(e,t,r){this.getText(e,(function(e){t(JSON.parse(e))}),r)},Human.utils.getBinary=function(e,t,a){r(e,"arraybuffer",t,a)},Human.utils.elementVisible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},Human.ELEMENT_REMOVE_SUPPORTED?Human.utils.removeElement=function(e){e.remove()}:Human.utils.removeElement=function(e){null!==e.parentNode&&e.parentNode.removeChild(e)},Human.utils.boundaryToScreen=function(e){var t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=[e.xmin,e.ymin,e.zmin,1],o=[e.xmin,e.ymin,e.zmax,1],s=[e.xmin,e.ymax,e.zmin,1],l=[e.xmin,e.ymax,e.zmax,1],c=[e.xmax,e.ymin,e.zmin,1],u=[e.xmax,e.ymin,e.zmax,1],_=[e.xmax,e.ymax,e.zmin,1],h=[e.xmax,e.ymax,e.zmax,1],f=Human.renderer.getViewMat(),d=Human.renderer.getProjMat(),p=mat4.create();mat4.multiply(p,d,f),vec4.transformMat4(n,n,p),t=Math.min(t,n[0]/n[3]),r=Math.max(r,n[0]/n[3]),a=Math.min(a,n[1]/n[3]),i=Math.max(i,n[1]/n[3]),vec4.transformMat4(o,o,p),t=Math.min(t,o[0]/o[3]),r=Math.max(r,o[0]/o[3]),a=Math.min(a,o[1]/o[3]),i=Math.max(i,o[1]/o[3]),vec4.transformMat4(s,s,p),t=Math.min(t,s[0]/s[3]),r=Math.max(r,s[0]/s[3]),a=Math.min(a,s[1]/s[3]),i=Math.max(i,s[1]/s[3]),vec4.transformMat4(l,l,p),t=Math.min(t,l[0]/l[3]),r=Math.max(r,l[0]/l[3]),a=Math.min(a,l[1]/l[3]),i=Math.max(i,l[1]/l[3]),vec4.transformMat4(c,c,p),t=Math.min(t,c[0]/c[3]),r=Math.max(r,c[0]/c[3]),a=Math.min(a,c[1]/c[3]),i=Math.max(i,c[1]/c[3]),vec4.transformMat4(u,u,p),t=Math.min(t,u[0]/u[3]),r=Math.max(r,u[0]/u[3]),a=Math.min(a,u[1]/u[3]),i=Math.max(i,u[1]/u[3]),vec4.transformMat4(_,_,p),t=Math.min(t,_[0]/_[3]),r=Math.max(r,_[0]/_[3]),a=Math.min(a,_[1]/_[3]),i=Math.max(i,_[1]/_[3]),vec4.transformMat4(h,h,p),t=Math.min(t,h[0]/h[3]),r=Math.max(r,h[0]/h[3]),a=Math.min(a,h[1]/h[3]),i=Math.max(i,h[1]/h[3]);var m=Human.renderer.canvas.canvas[0],g=(.5*t+.5)*m.width,y=(.5*r+.5)*m.width,v=m.height-(.5*i+.5)*m.height,S=m.height-(.5*a+.5)*m.height;return{min:[g,v],max:[y,S],pixelCoverage:(y-g)*(S-v)}},Human.utils.visibleAssetReport=function(){var e={totalVertices:0,totalTriangles:0,objectStats:{},geometryStats:{},textureStats:{},objectsByTrianglesPerPixel:null,objectsByTexelsPerPixel:null,geometriesByTriangleCount:null,texturesBySize:null},t=Human.scene.objects,r=Object.keys(Human.scene.enabledObjects).filter((function(e){return!!Human.scene.objects[e].geometry&&!!Human.scene.objects[e].material}));e.objectsByTrianglesPerPixel=new Array(r.length),e.objectsByTexelsPerPixel=new Array(r.length);for(var a=e.geometryStats,i=e.textureStats,n=0,o=r.length;n<o;++n){for(var s=r[n],l=t[s],c=l.geometry._core.arrays,u=c.positions.length/3,_=c.indices.length/3,h=l.material.textures||[],f=new Array(h.length),d=0;d<h.length;++d){var p=h[d]._core,m=p.compressedSrc||p.src||p.uri;f[d]=i[m]=i[m]||{src:m,width:p.width,height:p.height,objectIds:[],count:0,atlasSharing:0,atlas:!1,adjustedTexels:p.width*p.height},i[m].count++;for(var g=!0,y=0,v=i[m].objectIds.length;y<v;++y){var S=t[i[m].objectIds[y]].geometryId;S!==l.geometryId&&(i[m].atlas=!0),S===l.geometryId&&(g=!1)}g&&i[m].atlasSharing++,i[m].objectIds.push(s)}l._setBoundaryDirty();var b=Human.utils.boundaryToScreen(l.getBoundary());e.totalVertices+=u,e.totalTriangles+=_,e.objectsByTexelsPerPixel[n]=e.objectsByTrianglesPerPixel[n]=e.objectStats[s]={objectId:s,vertices:u,triangles:_,textures:f,canvasBounds:{min:b.min,max:b.max},pixelCoverage:b.pixelCoverage,trianglesPerPixel:_/b.pixelCoverage,texelsPerPixel:0},a[l.geometryId]=a[l.geometryId]||{geometryId:l.geometryId,vertices:u,triangles:_,totalVertices:0,totalTriangles:0,objectIds:[],count:0},a[l.geometryId].count++,a[l.geometryId].totalVertices+=u,a[l.geometryId].totalTriangles+=_,a[l.geometryId].objectIds.push(s)}return Object.keys(i).forEach((function(e){var t=i[e];t.atlas&&(t.adjustedTexels/=t.atlasSharing)})),e.objectsByTrianglesPerPixel.sort((function(e,t){return t.trianglesPerPixel-e.trianglesPerPixel})),e.objectsByTexelsPerPixel.filter((function(e){return e.textures.length>0})).forEach((function(e){e.textures.sort((function(e,t){return t.adjustedTexels-e.adjustedTexels})),e.texelsPerPixel=e.textures[0].adjustedTexels/e.pixelCoverage})),e.objectsByTexelsPerPixel.sort((function(e,t){return t.texelsPerPixel-e.texelsPerPixel})),e.geometriesByTriangleCount=Object.keys(a).map((function(e){return a[e]})).sort((function(e,t){return t.triangles*t.count-e.triangles*e.count})),e.texturesBySize=Object.keys(i).map((function(e){return i[e]})).sort((function(e,t){return t.adjustedTexels-e.adjustedTexels})),e},Human.utils.textGzipSize=function(e){if(window.pako){var t=(new TextEncoder).encode(e);return pako.deflate(t).byteLength}return 0},Human.utils.binaryGzipSize=function(e){if(window.pako){var t=new Uint8Array(e);return pako.deflate(t).byteLength}return 0},Human.utils.drawKdTree=function(e,t){!function e(t,r){if(t){var a=t.bb.min,i=t.bb.max,n=a[0],o=a[1],s=a[2],l=i[0],c=i[1],u=i[2];r.addNode({type:"geometry",primitive:"lines",positions:[n,c,s,l,c,s,l,c,s,l,o,s,l,o,s,n,o,s,n,o,s,n,c,s,n,c,s,n,c,u,l,c,s,l,c,u,n,o,s,n,o,u,l,o,s,l,o,u,n,c,u,l,c,u,l,c,u,l,o,u,l,o,u,n,o,u,n,o,u,n,c,u]}),e(t.left,r),e(t.right,r)}}(e,t)},Human.utils.kdTreeStats=function(e){var t={numNodes:0,numLeaves:0,numObjects:0,averageLeafObjects:0,depthSum:0,averageDepth:0};return function e(t,r,a){r++,a.numNodes++;var i=t.triangles||t.objects;i?(a.numLeaves++,a.numObjects+=i.length,a.depthSum+=r):(e(t.left,r,a),e(t.right,r,a))}(e,0,t),t.averageDepth=t.depthSum/t.numLeaves,t.averageLeafObjects=t.numObjects/t.numLeaves,t},Human.utils.loadScript=function(e,t){var r=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript",a.src=e,null!==t&&(a.onload=t),r.appendChild(a)}}(),Human.utils.Map=function(e,t){"use strict";this.items=e||[];var r=t||0,a=r;"number"!=typeof r&&(a=r+"0"),this.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(this.items[t])throw"ID clash: '"+t+"'";return this.items[t]=e=arguments[1],t}for(;;){var i;if(e=arguments[0],"number"==typeof r?i=a++:(i=r+parseInt(a.substr(r.length)),a=r+(parseInt(a.substr(r.length))+1)),!this.items[i])return this.items[i]=e,i}},this.removeItem=function(e){var t=this.items[e];return void 0!==t&&(delete this.items[e],a=e),t}},Human.utils.IDPool=function(e){"use strict";var t=(e=e||{}).prefix||"id",r=t.length,a=[],i={},n={};this.getId=function(e){if(e){if(i[e]||n[e])throw"ID already in use: "+e;return i[e]=!0,e}for(var r,o=0,s=a.length;o<s;o++)if(!a[o]&&!i[r=t+o])return a[o]=!0,n[r]=!0,r;return a.push(!0),n[r=t+(a.length-1)]=!0,r},this.containsId=function(e){return void 0!==i[e]||void 0!==n[e]},this.putId=function(e){i[e]?delete i[e]:n[e]&&(a[parseInt(e.substr(r))]=!1,delete n[e])}},function(){"use strict";var e=Human.utils.selection={},t=function(e){this.defunct="function"!=typeof e?t.defunct:function(){return!1},this.tokens=[],this.rules=[],this.remove=0,this.state=0,this.index=0,this.input=""};t.prototype.addRule=function(e,t,r){var a=e.global;if(!a){var i="g";e.multiline&&(i+="m"),e.ignoreCase&&(i+="i"),e=new RegExp(e.source,i)}return"[object Array]"!==Object.prototype.toString.call(r)&&(r=[0]),this.rules.push({pattern:e,global:a,action:t,start:r}),this},t.prototype.setInput=function(e){return this.remove=0,this.state=0,this.index=0,this.tokens.length=0,this.input=e,this},t.prototype.lex=function(){if(this.tokens.length)return this.tokens.shift();var e;for(this.reject=!0;this.index<=this.input.length;){for(var t=this.scan().splice(this.remove),r=this.index;t.length&&this.reject;){var a=t.shift(),i=a.result,n=a.length;if(this.index+=n,this.reject=!1,this.remove++,e=a.action.apply(this,i),this.reject)this.index=i.index;else if(void 0!==e)switch(Object.prototype.toString.call(e)){case"[object Array]":this.tokens=e.slice(1),e=e[0];default:return n&&(this.remove=0),e}}var o=this.input;if(r<o.length)if(this.reject){if(this.remove=0,void 0!==(e=this.defunct.call(this,o.charAt(this.index++))))return"[object Array]"===Object.prototype.toString.call(e)?(this.tokens=e.slice(1),e[0]):e}else this.index!==r&&(this.remove=0),this.reject=!0;else{if(!t.length)break;this.reject=!0}}},t.prototype.scan=function(){for(var e=[],t=0,r=this.state,a=this.index,i=this.input,n=0,o=this.rules.length;n<o;n++){var s=this.rules[n],l=s.start,c=l.length;if(!c||l.indexOf(r)>=0||r%2&&1===c&&!l[0]){var u=s.pattern;u.lastIndex=a;var _=u.exec(i);if(_&&_.index===a){var h=e.push({result:_,action:s.action,length:_[0].length});for(s.global&&(t=h);--h>t;){var f=h-1;if(e[h].length>e[f].length){var d=e[h];e[h]=e[f],e[f]=d}}}}}return e};var r,a=function(e){this.table=e};a.prototype.parse=function(e){for(var t,r=e.length,a=this.table,i=[],n=[],o=0;o<r;)switch(t=e[o++]){case"(":n.unshift(t);break;case")":for(;n.length&&"("!==(t=n.shift());)i.push(t);if("("!==t)throw new Error("Mismatched parentheses.");break;default:if(a.hasOwnProperty(t)){for(;n.length;){var s=n[0];if("("===s)break;var l=a[t],c=l.precedence,u=a[s].precedence;if(c>u||c===u&&"right"===l.associativity)break;i.push(n.shift())}n.unshift(t)}else i.push(t)}for(;n.length;)"("!==(t=n.shift())&&i.push(t);return i},[].push(r=function(){return this});var i={};function n(e,t,a){var i,n,o=Object.create(null),s=[];if(e.forEach((function(e){i=r.call(e),o[i]||(o[i]={value:e,freq:1})})),t.forEach((function(e){i=r.call(e),o[i]?1===o[i].freq&&(o[i].freq=3):o[i]={value:e,freq:2}})),a){for(n in o)a(o[n].freq)&&s.push(o[n].value);return s}return o}i.union=function(e,t){return n(e,t,(function(){return!0}))},i.intersection=function(e,t){return n(e,t,(function(e){return 3===e}))},i.difference=function(e,t){return n(e,t,(function(e){return e<3}))},i.complement=function(e,t){return n(e,t,(function(e){return 1===e}))},i.equals=function(e,t){var r,a=0,i=Math.pow(2,53),o=n(e,t);for(r in o)a=Math.max(a,o[r].freq),i=Math.min(i,o[r].freq);return 3===i&&3===a};var o={"<AND>":{precedence:1,associativity:"left"},"<OR>":{precedence:1,associativity:"left"},"<XOR>":{precedence:1,associativity:"left"},"<NOT>":{precedence:1,associativity:"left"}},s={"<AND>":function(e,t){return e&&t},"<OR>":function(e,t){return e||t},"<NOT>":function(e){return!e}};e.StringMatcher=function(){this.lexer=new t((function(){return!1})),this.parser=new a(o),this.operators=s,this.lexer.addRule(/[A-z0-9]+/i,(function(e){return e})),this.lexer.addRule(/(<[A-Z]+>)/,(function(e){return e})),this.lexer.addRule(/[\(\+\-\*\/\)]/,(function(e){return e}))},e.StringMatcher.prototype.parse=function(e){this.lexer.setInput(e);for(var t=[],r=this.lexer.lex();r;)t.push(r),r=this.lexer.lex();return this.parser.parse(t)},e.StringMatcher.prototype.match=function(e,t){var r,a,i=this.parse(t),n=[];return i.forEach((function(t){this.operators.hasOwnProperty(t)?"<NOT>"!==t?(r=n.pop(),n.push(this.operators[t](r))):(a=n.pop(),r=n.pop(),n.push(this.operators[t](r,a))):(t="("+t+")",n.push(!!e.match(new RegExp(t,"i"))))})),n[0]};var l={"<AND>":{precedence:1,associativity:"left"},"<OR>":{precedence:1,associativity:"left"},"<XOR>":{precedence:1,associativity:"left"},"<NOT>":{precedence:1,associativity:"left"}},c={"<AND>":function(e,t){return i.intersection(e,t)},"<OR>":function(e,t){return i.union(e,t)},"<XOR>":function(e,t){return i.difference(e,t)},"<NOT>":function(e,t){return i.complement(e,t)}};e.GraphMatcher=function(){this.lexer=new t((function(){return!1})),this.parser=new a(l),this.operators=c,this.lexer.addRule(/[A-z0-9\-]+/i,(function(e){return e})),this.lexer.addRule(/(<[A-Z]+>)/,(function(e){return e})),this.lexer.addRule(/[\(\)]/,(function(e){return e}))},e.GraphMatcher.prototype.parse=function(e){this.lexer.setInput(e);for(var t=[],r=this.lexer.lex();r;)t.push(r),r=this.lexer.lex();return this.parser.parse(t)},e.GraphMatcher.prototype.match=function(e,t){var r,a,i=this.parse(t),n=[],o=this;return i.forEach((function(t){o.operators.hasOwnProperty(t)?(a=n.pop(),r=n.pop(),Array.isArray(r)||(r=e.access(r)),Array.isArray(a)||(a=e.access(a)),n.push(o.operators[t](r,a))):Array.isArray(t)?n.push(t):n.push(e.access(t))})),n[0]}}(),function(){"use strict";var e=Human.events={},t={},r=[{}],a={},i={},n=!1;e.addBinder=function(e,r){(t[e]||(t[e]=[])).push(r)},e.createChannel=function(t){var a=r.length;return r.push({}),t&&t.enabled&&e.enableChannel(a,t.enabled),a},e.enableChannel=function(e,t){a[e]=t},e.onEvent=e.on=function(){var e,n,o,s;if("number"==typeof arguments[0]){if((e=arguments[0])>r.length-1)return void Human.log.error("Human_event.onEvent","Channel not created: "+e+" - should be created first with Human.events.createChannel");n=arguments[1],o=arguments[2],s=arguments[3]}else if("object"==typeof arguments[0]){var l=arguments[0];o=l.fn;var c=t[n=l.type];if(c)for(var u=l.mask||{},_=0,h=c.length;_<h;_++)c[_](u,o);e=null!=l.channel?l.channel:0,s=l.options}else e=0,n=arguments[0],o=arguments[1],s=arguments[2];a[e]=!s||null==s.enable||s.enable,s=s||{};var f=r[e];f||(f=r[e]={});var d=f[n];d||(f[n]=d=[]);var p={fn:o,priority:void 0===s.priority?d.length:s.priority,once:s.once};for(_=0;_<d.length;_++)if(d[_].priority>p.priority)return void d.splice(_,0,p);d.push(p),i[n]&&p.fn(i[n])},e.once=function(t,r){e.on(t,r,{once:!0})},e.fireEvent=e.fire=function(e,t,o){if(!n){for(var s,l=0,c=r.length;l<c;l++)if(a[l]&&(s=r[l][e])){var u,_;t||(t={});for(var h=0,f=s.length;h<f;h++)if(_=s[h])try{_.fn(t),_.once&&(u||(u=[]),u.push(h))}catch(d){Human.log.error(d)}if(u)for(h=u.length-1;h>=0;h--)s.splice(u[h],1)}o&&(i[e]=t)}},e.blockEvents=function(e){n=!0;try{e()}catch(t){Human.log.error(t.message)}n=!1},e.unEvent=e.off=function(e,t,a){if(null==a)a=0;else if(a>=r.length||a<0)throw"Channel does not exist: "+a;var i=r[a];i||(i=r[a]={});var n=i[e];n||(i[e]=n=[]);for(var o=n.length;o--;)n[o].fn===t&&n.splice(o,1)}}(),function(){"use strict";var e=Human.properties={},t=new Human.utils.IDPool;e.properties={};var r={},a={},i={};e.subscribe=function(n){var o=(n=n||{}).propId;if(!o)return Human.log.error("Human.properties.subscribe","Param expected: propId"),null;var s=n.callback;if(!s)return Human.log.error("Human.properties.subscribe","Param expected: callback"),null;if(n.subId&&t.containsId(n.subId))return Human.log.error("Human.properties.subscribe","Subscription already exists with this ID: "+n.subId),null;var l=n.value,c=t.getId(n.subId);return e.properties[o]?((a[o]||(a[o]={}))[c]=s,l&&(e.properties[o]=l),r[c]=s,i[c]=o,s(l),c):((a[o]||(a[o]={}))[c]=s,null==l&&(l={}),e.properties[o]=l,r[c]=s,i[c]=o,s(l),c)},e.resubscribe=function(t,n){var o=r[t];if(o){var s=i[t],l=e.properties[n];s&&l&&(a[s]&&delete a[s][t],(a[n]||(a[n]={}))[t]=o,i[t]=n,o(l))}else Human.log.warn("Human.properties.resubscribe","Subscription not found: '"+t+"'")},e.set=function(t){var r,i;for(var n in t)if(t.hasOwnProperty(n)&&(e.properties[n]=r=t[n],i=a[n]))for(var o in i)i.hasOwnProperty(o)&&i[o](r)},e.unsubscribe=function(e){var t=i[e];t&&(delete i[e],delete a[t][e])},e.query=function(t){if(!t)return e.properties;var r;if(t){var a=new RegExp(t);for(var i in r={},e.properties)e.properties.hasOwnProperty(i)&&a.test(i)&&(r[i]=e.properties[i])}return r};var n={"annotations.margins":{top:80,left:50,right:50,bottom:50},"annotations.labelWidth":120,"annotations.horizontalLines":!1,"annotations.fadeoutAngle":100,"annotation.layout.labelWidth":100,"annotations.layout.type":"draggable","camera.optics.far":5e3,"camera.optics.fov":55,"camera.optics.near":.1,"camera.zoomLimits":{max:300,min:.01},"fog.color":[1,1,1],"fog.density":.01,"fog.enabled":!1,"fog.end":1e3,"fog.max":1,"fog.min":0,"fog.mode":1,"fog.start":0,"timeline.autoPlay.enabled":!1,"timeline.autoPlay.type":"play","timeline.chapterCamerasEnabled":!0,"timeline.prevNextMode":"scrub","ui.mouseWheel.capture":!0,"ui.zoom.mouseWheel.enabled":!0};e.getDefaults=function(e){return e?n[e]:Human.utils.shallowClone(n)},e.setDefaults=function(e){Human.utils.apply(e,n)},e.applyDefaults=function(){this.set(n)}}(),function(){"use strict";var e=Human.log={};e.LOG_NONE=0,e.LOG_DEBUG=1,e.LOG_INFO=2,e.LOG_WARN=3,e.LOG_ERROR=4,e.messages=[],e.maxMessages=100;var t=["none","debug","info","warn","error"],r=e.messageBuf=[],a=e.LOG_WARN,i=e.reporters={};function n(e){return e.length<45?e+"                                                           ".substr(0,45-e.length):e}function o(r,a){var i=t[a].toUpperCase();e.messages.length>e.maxMessages&&e.messages.shift(),e.messages.push(r="["+i+"]\t"+r)}e.setLevel=function(e){a=e},e.getLevel=function(){return a},e.log=function(n,s){switch(s=null==s?e.INFO:s){case e.LOG_DEBUG:a<=e.LOG_DEBUG&&window.console&&window.console.debug&&(window.console.debug(n),o(n,s),Human.events.fire("_log.debug",n));break;case e.LOG_ERROR:a<=e.LOG_ERROR&&window.console&&window.console.error&&(window.console.error(n),o(n,s),Human.events.fire("_log.error",n));break;case e.LOG_INFO:a<=e.LOG_INFO&&window.console&&window.console.info&&(window.console.info(n),o(n,s),Human.events.fire("_log.info",n));break;case e.LOG_WARN:a<=e.LOG_WARN&&window.console&&window.console.warn&&(window.console.warn(n),o(n,s),Human.events.fire("_log.warn",n))}var l={message:n,level:t[s]};for(var c in i)i.hasOwnProperty(c)&&Human.events.fire(c,l);r.length>200&&(r.length=0,r.push({message:"Logging buffer exceeded max length of 200 - messages to this point were flushed",level:t[e.LOG_WARN]})),r.push(l)},e.debug=function(){e.log(1===arguments.length?arguments[0]:"["+n(arguments[0])+"] "+arguments[1],e.LOG_DEBUG)},e.error=function(){e.log(1===arguments.length?arguments[0]:"["+n(arguments[0])+"] "+arguments[1],e.LOG_ERROR)},e.info=function(){e.log(1===arguments.length?arguments[0]:"["+n(arguments[0])+"] "+arguments[1],e.LOG_INFO)},e.warn=function(){e.log(1===arguments.length?arguments[0]:"["+n(arguments[0])+"] "+arguments[1],e.LOG_WARN)},Human.events.on("error",(function(t){e.error(t.message)}))}(),function(){"use strict";var e,t,r,a=Human.request={};a.getHashStr=function(){return window.location.hash},a.getHashParams=function(){if(!t||e!==window.location.hash){t={};for(var r,a=window.location.hash.slice(1).split(","),i=0,n=a.length;i<n;i++)r=a[i].split("="),t[r[0]]=r[1];e=window.location.hash}return t},a.getHashParam=function(r){return t&&e===window.location.hash||a.getHashParams(),t[r]},a.getSearchStr=function(){return window.location.search},a.getSearchParams=function(){if(!r){r={};for(var e,t=window.location.search.slice(1).split("&"),a=0,i=t.length;a<i;a++)e=t[a].split("="),r[e[0]]=e[1]}return r},a.getSearchParam=function(e){return r||a.getSearchParams(),r[e]}}(),function(){"use strict";var e=Human.rpc={windowClientEnabled:!0};e._procedures={},e._eventMap={};var t=[],r=!1,a={},i=[];function n(e,t){this.procName=e,this.callId=t}function o(e){return!e||"object"!=typeof e||e!==window&&("string"!=typeof e.nodeName||"function"!=typeof e.querySelectorAll||"function"!=typeof e.getElementsByTagName)&&("function"!=typeof e.preventDefault||"function"!=typeof e.stopPropagation)}n.prototype.setResult=function(e){for(var r=0,a=t.length;r<a;r++)t[r](this.callId,e)},n.prototype.info=function(e){Human.log.info(this.procName,e)},n.prototype.warn=function(e){Human.log.warn(this.procName,e)},n.prototype.error=function(e){Human.log.error(this.procName,e)},e.define=function(t,i,o){e._procedures[t]&&Human.log.warn("Human.rpc.define","Redefining procedure: "+t),((o=o||{}).hidden||r)&&(a[t]=!0),e._procedures[t]=function(e,r){i.call(new n(t,e),r||{})}},e.defineEvent=function(t,r){e._eventMap[t]&&Human.log.warn("Human.rpc.defineEvent","Redefining event: "+t),e._eventMap[t]=r||t},e.enableEvent=function(t,r,a){if(e._eventMap[r]){var i=e._eventMap[r];"string"==typeof i?Human.events[a?"once":"on"](i,(function(e){t.setResult(e)})):function(e,t,r){var a=!1,i=r?"once":"on",n=t.events,o=t.map;function s(t){if(!r||!a){a=!0;var i=o?o(t):t;null!==i&&e.setResult(i||{})}}t.init&&t.init();for(var l=0,c=n.length;l<c;l++)Human.events[i](n[l],s)}(t,i,a)}else Human.log.warn("Human.rpc.enableEvent","Event: "+r+" not defined.")},e.getProcedures=function(){var t=Object.keys(e._procedures);return Human.utils.filterInPlace(t,(function(e){return!a[e]})),t},e.getEvents=function(){return["human.ready"].concat(Object.keys(e._eventMap))},e.hideDefinitions=function(e){r=!0;try{e()}finally{r=!1}},e.onResult=function(e){t.push(e)},e.call=function(t,r,a){var i=e._procedures[r];i?i(t,a):Human.log.warn("Human.rpc.call","Target procedure not found: "+r)},e.log=function(e){i.length>1e4&&i.shift(),i.push({engine_version:Human.VERSION,api_version:Human.API_VERSION,identifier:e,category:e.split(".")[0]})},e.getLog=function(){return i},e.logPending=function(){return i.length>0},e.resetLog=function(){i.length=0},e.filterUnsafeProperties=function(e){if(!Human.utils.isObject(e))return e;var t={};for(var r in e)e.hasOwnProperty(r)&&o(e[r])&&(t[r]=e[r]);return t}}(),Human.rpc.hideDefinitions((function(){"use strict";Human.rpc.define("apiEvents.on",(function(e){Human.rpc.enableEvent(this,e,!1)})),Human.rpc.define("apiEvents.once",(function(e){Human.rpc.enableEvent(this,e,!0)}))})),Human.rpc.define("camera.path",(function(e){"use strict";var t=this;Human.renderer.camera.fly.flyAlongCurvePath(e,(function(){t.setResult(!0)}))})),Human.rpc.define("scene.pickingMode",(function(e){"use strict";"dissect"===e?(Human.events.blockEvents((function(){Human.view.annotations.setEnabled(!1)})),Human.view.dissect.setEnabled(!0)):"annotate"===e?(Human.events.blockEvents((function(){Human.view.dissect.setEnabled(!1)})),Human.view.annotations.setEnabled(!0)):"highlight"===e?(Human.events.blockEvents((function(){Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1)})),Human.view.highlight.setEnabled(!0)):"none"===e&&Human.events.blockEvents((function(){Human.view.dissect.setEnabled(!1),Human.view.annotations.setEnabled(!1),Human.view.highlight.setEnabled(!1),Human.view.xray.setEnabled(!1)})),this.setResult(!0)})),Human.rpc.define("scene.selectionMode",(function(e){"use strict";"isolate"===e?(Human.events.blockEvents((function(){Human.view.highlight.setEnabled(!1)})),Human.view.isolate.setEnabled(!0)):"highlight"===e?(Human.events.blockEvents((function(){Human.view.isolate.setEnabled(!1)})),Human.view.highlight.setEnabled(!0)):"none"===e&&(Human.events.blockEvents((function(){Human.view.isolate.setEnabled(!1)})),Human.view.highlight.setEnabled(!1)),this.setResult(!0)})),Human.rpc.hideDefinitions((function(){"use strict";var e,t,r;function a(e){var t,r={},a=Human.rpc.fmaIds,i=Human.modules.MALE_STATE_ID,n=Human.modules.FEMALE_STATE_ID;for(var o in e)if(e.hasOwnProperty(o)){t=a[o];for(var s=0;s<t.length;s++){var l=Human.scene.objects[i+"-"+t[s]]||Human.scene.objects[n+"-"+t[s]];l&&(r[l.objectId]=e[o])}}return r}Human.rpc.defineEvent("human.error",{events:["error"]}),Human.rpc.define("bookmarks.capture",(function(){this.setResult(Human.bookmarks.capture())})),Human.rpc.define("bookmarks.restore",(function(e){var t=this;Human.bookmarks.restore(e,(function(){t.setResult(!0)}))})),Human.rpc.define("events.off",(function(e){if(e.id)l(e.id);else if(e.ids)for(var t=e.ids,r=0,a=t.length;r<a;r++)l(t[r]);else for(var i in s)s.hasOwnProperty(i)&&l(i)})),Human.rpc.define("camera.query",(function(){var e=Human.renderer.camera.getLookAt();e.zoom=Human.renderer.camera.getZoom(),this.setResult(e)})),Human.rpc.define("properties.query",(function(e){this.setResult(Human.properties.query(e.regex))})),Human.rpc.define("actions.doAction",(function(e){Human.actions._doAction([e.action,e.arguments])})),Human.rpc.define("alert",(function(e){window.alert(e.message||"")})),Human.rpc.define("videos.getClips",(function(){this.setResult(Human.media.videos.clipsList)})),Human.rpc.define("videos.open",(function(e){var t=this;Human.media.videos.open(e.clipId,(function(){t.setResult(!0)}))})),Human.rpc.define("videos.play",(function(e){Human.media.videos.play(e.clipId)})),Human.rpc.define("videos.scrub",(function(e){Human.media.videos.scrub(e.clipId,e.time)})),Human.rpc.define("videos.pause",(function(e){Human.media.videos.pause(e.clipId)})),Human.rpc.define("videos.stop",(function(e){Human.media.videos.stop(e.clipId)})),Human.rpc.define("videos.close",(function(e){Human.media.videos.close(e.clipId)})),Human.rpc.define("audio.getClips",(function(){this.setResult(Human.media.audio.clipsList)})),Human.rpc.define("audio.open",(function(e){var t=this;Human.media.audio.open(e.clipId,(function(){t.setResult(!0)}))})),Human.rpc.define("audio.play",(function(e){Human.media.audio.play(e.clipId)})),Human.rpc.define("audio.scrub",(function(e){Human.media.audio.scrub(e.clipId,e.time)})),Human.rpc.define("audio.pause",(function(e){Human.media.audio.pause(e.clipId)})),Human.rpc.define("audio.stop",(function(e){Human.media.audio.stop(e.clipId)})),Human.rpc.define("audio.close",(function(e){Human.media.videos.close(e.clipId)})),Human.rpc.define("modules.getModules",(function(e){this.setResult(Human.modules.query(e))})),Human.rpc.define("modules.activate",(function(e){var t=this;Human.modules.activateModules(e,(function(){t.setResult(!0)}))})),Human.rpc.define("modules.deactivate",(function(e){Human.modules.deactivateModules(e)})),Human.rpc.define("properties.subscribe",(function(e){var t=this;Human.properties.subscribe({subId:e.subId,propId:"myProperty",callback:function(e){t.setResult(e)}})})),Human.rpc.define("properties.resubscribe",(function(e){Human.properties.resubscribe(e.subId,e.propId)})),Human.rpc.define("properties.unsubscribe",(function(e){Human.properties.unsubscribe(e.subId)})),Human.rpc.define("renderer.getBGColor",(function(){this.setResult(Human.renderer.bg.getBGColor())})),Human.rpc.define("renderer.setBGColor",(function(e){Human.renderer.bg.setBGColor(e.color)})),Human.rpc.define("request.getParams",(function(){this.setResult({hashParams:Human.request.getHashParams(),hashStr:Human.request.getHashStr(),searchParams:Human.request.getSearchParams(),searchStr:Human.request.getSearchStr()})})),Human.rpc.defineEvent("scene.pickingModeUpdated",{events:["highlight.toggled","dissect.toggled","annotations.toggled"],map:function(){var t;return Human.view.dissect.enabled?t="dissect":Human.view.annotations.enabled?t="annotate":Human.view.highlight.enabled&&(t="highlight"),t===e?null:{pickingMode:e=t}}}),Human.rpc.defineEvent("scene.selectionModeUpdated",{events:["highlight.toggled","isolate.toggled"],map:function(){var e;return(e=Human.view.isolate.enabled?"isolate":Human.view.highlight.enabled?"highlight":"none")===t?null:{selectionMode:t=e}}}),Human.rpc.define("scene.queryBoundary",(function(e){var t,r,a;if(e.objectId&&Human.scene.objects[e.objectId])t=Human.scene.objects[e.objectId].getBoundary();else if(e.fmaId){if(a=e.fmaId,!(r=Human.scene.objectsByFMAID[a]))return void this.error("No scene object found for the given FMA ID: '"+a+"'");t=r.getBoundary()}else if(e.objectIds)t=Human.scene.getBoundary({objectIds:e.objectIds});else if(e.fmaIds){for(var i=e.fmaIds,n=[],o=0,s=i.length;o<s;o++){if(a=i[o],!(r=Human.scene.objectsByFMAID[a]))return void this.error("No scene object found for the given FMA ID: '"+a+"'");n.push(r.objectId)}t=Human.scene.getBoundary({objectIds:n})}else t=e.selectedObjects?Human.scene.getBoundary({objects:Human.scene.selectedObjects}):e.enabledObjects?Human.scene.getBoundary({objects:Human.scene.enabledObjects}):Human.scene.getBoundary();this.setResult(t)})),r=document.getElementById("theCanvas"),Human.rpc.define("scene.getObjectCanvasPos",(function(e){var t=Human.scene.objects[e.objectId];if(t){var a=t.getCenter();this.setResult(function(e,t){t&&vec3.add(e,t,e);var a=Human.renderer.getViewMat(),i=Human.renderer.getProjMat(),n=vec4.create();vec3.transformMat4(n,e,a),n[3]=1,vec4.transformMat4(n,n,i);var o=n[1],s=n[3];return[Math.round((1+n[0]/s)*r.width/2),Math.round((1-o/s)*r.height/2)]}(a,e.offset))}})),Human.rpc.define("timeline.getBookmark",(function(){this.setResult(Human.timeline.getBookmark())})),Human.rpc.define("timeline.setBookmark",(function(e){Human.timeline.setBookmark(e)})),Human.rpc.define("clip.set",(function(e){if(e.clips){var t,r=e.clips;for(var a in r)r.hasOwnProperty(a)&&((t=r[a]).clipId=a,Human.renderer.clip.setClip(t))}else e.clip&&Human.renderer.clip.setClip(e.clip)})),Human.rpc.define("clip.reset",(function(){Human.renderer.clip.reset()})),Human.rpc.define("effects.getEffects",(function(){var e,t=[],r=Human.view.effects.effects;for(var a in r)r.hasOwnProperty(a)&&t.push({effectId:a,displayName:(e=r[a]).displayName,description:e.description,enabled:e.enabled,params:e.params});this.setResult(t)})),Human.rpc.define("effects.setEnabled",(function(e){Human.view.effects.setEnabled(e)})),Human.rpc.define("effects.setParams",(function(e){Human.view.effects.setParams(e)})),Human.rpc.define("lights.getLights",(function(){var e,t=[],r=Human.renderer.lights.lights;for(var a in r)r.hasOwnProperty(a)&&t.push({lightId:a,displayName:(e=r[a]).displayName,description:e.description,enabled:e.enabled,params:e.params});this.setResult(t)})),Human.rpc.define("lights.setEnabled",(function(e){Human.renderer.lights.setEnabled(e)})),Human.rpc.define("lights.setParams",(function(e){Human.renderer.lights.setParams(e)})),Human.rpc.define("highlight.setEnabled",(function(e){var t=e.enable;null==t&&(t=!Human.view.highlight.enabled),Human.view.highlight.setEnabled(t),t&&(Human.view.isolate.setEnabled(!1),Human.view.xray.setEnabled(!1))})),Human.rpc.define("isolate.setEnabled",(function(e){var t=e.enable;null==t&&(t=!Human.view.isolate.enabled),Human.view.isolate.setEnabled(t),(!t||Human.scene.anySelected())&&t&&(Human.view.highlight.setEnabled(!1),Human.view.xray.setEnabled(!1),Human.renderer.pick.setSinglePickEnabled(!0),Human.renderer.pick.setMultiPickEnabled(!1))})),Human.rpc.define("pick.doublePick",(function(e){Human.renderer.pick.doublePick({canvasX:e.canvasX,canvasY:e.canvasY})})),Human.rpc.define("pick.hoverPick",(function(e){Human.renderer.pick.hoverPick({canvasX:e.canvasX,canvasY:e.canvasY})})),Human.rpc.define("xray.setEnabled",(function(e){var t=e.enable;null==t&&(t=!Human.view.xray.enabled),Human.view.xray.setEnabled(t),t&&(Human.view.highlight.setEnabled(!1),Human.view.isolate.setEnabled(!1))})),Human.rpc.define("queryModes",(function(){var e={xray:Human.view.xray.enabled,highlight:Human.view.highlight.enabled,annotation:Human.view.annotations.enabled,singlePick:Human.renderer.pick.singleEnabled,multipick:Human.renderer.pick.multiEnabled,dissect:Human.view.dissect.enabled};this.setResult(e)})),Human.rpc.define("navigation.setEnabled",(function(e){c("navigator_container",e.enable)})),Human.rpc.define("fullscreen.setEnabled",(function(e){c("embed-full-screen",e.enable)}));var i=Human.log.reporters,n=Human.log.messageBuf;function o(e){var t,r={};for(var a in e)e.hasOwnProperty(a)&&(t=e[a],Human.utils.isPrimitive(t)&&"_"!==a[0]&&(r[a]=t));return r.objectId=e.object?e.object.objectId:"",r.title=e.label.title,r.description=e.label.description,r.pos=e.pin.pos,r.pinVec=e.pin.dir,r.visible=e.pin.visible,r}Human.rpc.define("log.createReporter",(function(e){if(e.id){var t="log.reporters."+e.id;if(!i[t]){i[t]={};for(var r=0,a=n.length;r<a;r++)Human.events.fire(t,n[r])}}else Human.log.error("param expected: id")})),Human.rpc.define("log.destroyReporter",(function(e){e.id?delete i["log.reporters."+e.id]:Human.log.error("param expected: id")})),Human.rpc.define("annotations.getAnnotations",(function(){var e=Human.view.annotations.annotations,t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=o(e[r]));this.setResult(t)})),Human.rpc.define("camera.flyTo",(function(e){var t=this;Human.renderer.camera.fly.flyTo(e,(function(){t.setResult(!0)}))})),Human.rpc.define("camera.jumpTo",(function(e){var t=this;Human.renderer.camera.fly.jumpTo(e,(function(){t.setResult(!0)}))})),Human.rpc.define("camera.getZoom",(function(){this.setResult(Human.renderer.camera.getZoom())}));var s={};function l(e){var t=s[e];t&&(Human.unEvent(t[0],t[1]),delete s[e])}Human.rpc.define("events.on",(function(e){var t=this,r=this.id;if(r&&s[r])this.error("an event is already bound to this ID: '"+r+"'");else{var a=e.type;if(a){var i=function(e){t.setResult(e)};e.mask?(e.fn=i,Human.events.on(e)):Human.events.on(e.type,i),r&&(s[r]=[a,i])}else this.error("parameter expected: 'type'")}})),Human.rpc.define("events.once",(function(e){var t=this,r=e.type;r?Human.events.once(r,(function(e){t.setResult(e)})):this.error("parameter expected: 'type'")})),Human.rpc.define("events.fire",(function(e){Human.events.fire(e.eventName,e.params)})),Human.rpc.define("reset",(function(){var e=this;Human.init.reset((function(){e.setResult(!0)}))})),Human.rpc.define("reload",(function(){Human.init.reload()})),Human.rpc.define("pick.pick",(function(e){Human.renderer.pick.pick({canvasX:e.canvasX,canvasY:e.canvasY})})),Human.rpc.define("pick.queryPick",(function(e){this.setResult(Human.renderer.pick.queryPick({canvasX:e.canvasX,canvasY:e.canvasY,rayPick:e.rayPick})||{})})),Human.rpc.define("scene.setEnabledObjects",(function(e){var t;if(e.fmaIds)t=a(e.fmaIds);else if(Human.utils.isArray(e.objectIds)){t={};for(var r=0,i=e.objectIds.length;r<i;r++)t[e.objectIds[r]]=!0}else t=e.objectIds;Human.scene.setEnabledObjects({objects:t,replace:e.replace})})),Human.rpc.define("scene.setSelectedObjects",(function(e){var t;if(e.fmaIds)t=a(e.fmaIds);else if(Human.utils.isArray(e.objectIds)){t={};for(var r=0,i=e.objectIds.length;r<i;r++)t[e.objectIds[r]]=!0}else t=e.objectIds;e.objectIds=t,Human.scene.setSelectedObjects(e)})),function(){function e(r,a){if(r){a.push(t(r));for(var i=0,n=r.objects.length;i<n;i++)e(r.objects[i],a)}}function t(e){var t={};for(var r in e)if(e.hasOwnProperty(r)&&"_"!==r[0]){var a=e[r];Human.utils.isPrimitive(a)&&(t[r]=a)}return t.parentObjectId=e.parent?e.parent.objectId:null,t}Human.rpc.define("scene.getObjects",(function(r){var a,i=[];if(r.objectId)(a=Human.scene.objects[r.objectId])&&i.push(t(a));else for(var n=0,o=Human.scene.rootObjects.length;n<o;n++)e(Human.scene.rootObjects[n],i);this.setResult(i)}))}(),Human.rpc.define("scene.setObjectTransform",(function(e){var t,r=e.objectId,a=e.fmaId;if(r){if(!(t=Human.scene.objects[r]))return void this.error("Scene object not found: '"+r+"'")}else if(a&&!(t=Human.scene.objectsByFMAID[a]))return void this.error("scene object not found for the given FMA ID: '"+a+"'");t.setTransform(e)})),Human.rpc.define("timeline.scrub",(function(e){Human.timeline.scrub(e)})),Human.rpc.define("timeline.stop",(function(){Human.timeline.stop()})),Human.rpc.define("timeline.prev",(function(){Human.timeline.prev()})),Human.rpc.define("timeline.next",(function(){Human.timeline.next()})),Human.rpc.define("timeline.unpause",(function(){Human.timeline.unpause()})),Human.rpc.define("properties.set",(function(e){Human.properties.set(e.props||e||{})}));var c=function(e,t){var r=void 0===t||t;document.getElementById(e).style.display=r?"block":"none"}})),Human.rpc.fmaIds={3734:["Base_of_aorta_3734_ID"],3768:["Aortic_arch_3768_ID"],3784:["Descending_Aorta_3784_ID"],3818:["Marginal_branch_of_right_coronary_artery_3818_ID"],3829:["Anterior_atrial_branch_of_right_coronary_artery_3829_ID"],3837:["Posterior_left_ventricular_branch_of_left_coronary_artery_3837_ID"],3932:["left_lower_subclavian_artery_3932_ID","Right_Brachiocephalic_trunk_3932_ID"],3941:["Right_common_carotid_artery_3941_ID"],3945:["Right_external_carotid_artery_3945_ID"],3949:["Right_Internal_Carotid_Artery_3949_ID"],3950:["Right_Internal_Carotid_Artery_3950_ID"],3958:["Right_Vertebral_Artery_3958_ID"],3969:["Right_internal_thoracic_artery_3969_ID"],3988:["Superior_right_epigastric_artery_3988_ID","Right_Superior_epigastric_artery_3988_ID"],4058:["Left_common_carotid_artery_4058_ID","Base_of_left_common_carotid_artery_4058_ID","Base_of_Left_common_carotid_artery_4058_ID"],4060:["Left_external_carotid_artery_4060_ID"],4062:["Left_Internal_Carotid_Artery_4062_ID"],4066:["Left_Vertebral_Artery_4066_ID"],4068:["Left_internal_thoracic_artery_4068_ID"],4083:["Left_Superior_epigastric_artery_4083_ID"],4085:["Right_costocervical_trunk_4085_ID"],4086:["Right_costocervical_trunk_4086_ID","Left_costocervical_trunk_4086_ID"],4134:["Left_deep_cervical_artery_4134_ID","left_deep_cervical_artery_4134_ID"],4634:["Right_Subcostal_artery_4634_ID","Right_subcostal_artery_4634_ID"],4654:["Left_Subcostal_artery_4654_ID","Left_subcostal_artery_4654_ID"],4693:["Right_subclavian_artery_4693_ID"],4694:["left_subclavian_artery_4694_ID","Left_Lower_Subclavian_artery_4694_ID","right_subclavian_artery_4694_ID"],4706:["Coronary_sinus_4706_ID"],4707:["Great_cardiac_vein_4707_ID"],4712:["Posterior_vein_of_left_ventricle_4712_ID"],4713:["Middle_cardiac_vein_4713_ID"],4714:["Small_cardiac_vein_4714_ID"],4715:["Oblique_vein_of_left_atrium_4715_ID"],4720:["Superior_Vena_Cava_4720_ID"],4728:["Inferior_Thyroid_vein_4728_ID"],4751:["Right_Brachiocephalic_vein_4751_ID","Right_brachiocephalic_vein_4751_ID"],4755:["Right_internal_jugular_vein_4755_ID"],4756:["Right_Vertebral_vein_4756_ID"],4758:["Right_internal_thoracic_vein_4758_ID"],4761:["Left_Brachiocephalic_vein_4761_ID","Left_brachiocephalic_vein_4761_ID"],4763:["Left_internal_jugular_vein_4763_ID"],4764:["Left_Vertebral_vein_4764_ID"],4766:["Left_internal_thoracic_vein_4766_ID"],4771:["Right_Superior_epigastric_vein_4771_ID","Right_superior_epigastric_vein_4771_ID"],4785:["Left_superior_epigastric_vein_4785_ID"],4838:["Azygos_Vein_4838_ID","Azygos_vein_4838_ID"],4843:["Right_ascending_lumbar_vein_4843_ID"],4944:["Hemiazgos_vein_4944_ID","Hemiazygos_vein_4944_ID"],4950:["Left_ascending_lumbar_vein_4950_ID"],5011:["Left_Accessory_Hemiazgos_vein_5011_ID","Left_Accessory_Hemiazygos_vein_5011_ID"],5883:["Right_Splanchnic_Nerve_5883_ID","Left_Splanchnic_Nerve_5883_ID"],6192:["Right_Phrenic_Nerve_6192_ID"],6193:["Left_Phrenic_Nerve_6193_ID"],6246:["Left_Recurrent_Laryngeal_Nerve_6246_ID","Right_Recurrent_Laryngeal_Nerve_6246_ID"],6258:["Left_Sympathetic_Chain_6258_ID","Right_Sympathetic_Chain_6258_ID"],6259:["Right_Sympathetic_Chain_6259_ID"],6442:["Left_C1_Spinal_Nerve_6442_ID","Right_C1_Spinal_Nerve_6442_ID"],6451:["Left_C2_Spinal_Nerve_6451_ID","Right_C2_Spinal_Nerve_6451_ID"],6453:["Left_C3_Spinal_Nerve_6453_ID","Right_C3_Spinal_Nerve_6453_ID"],6456:["Left_C4_Spinal_Nerve_6456_ID","Right_C4_Spinal_Nerve_6456_ID"],6457:["Right_C5_Spinal_Nerve_6457_ID","Left_C5_Spinal_Nerve_6457_ID"],6459:["Left_C6_Spinal_Nerve_6459_ID","Right_C6_Spinal_Nerve_6459_ID"],6461:["Right_C7_Spinal_Nerve_Group_6461_ID","Left_C7_Spinal_Nerve_6461_ID","Right_C7_Spinal_Nerve_6461_ID","Left_C7_Spinal_Nerve_Group_6461_ID"],6465:["Left_C8_Spinal_Nerve_6465_ID","Right_C8_Spinal_Nerve_6465_ID"],6582:["Ansa_Subclavia_6582_ID"],6642:["Superior_hypogastric_nerve_plexus_6642_ID"],6643:["Inferior_hypogastric_nerve_plexus_6643_ID"],6647:["Prostatic_nerve_plexus_6647_ID"],7088:["Heart_7088_ID"],7096:["Right_atrium_7096_ID"],7097:["Left_atrium_7097_ID"],7098:["Right_Ventricle_7098_ID"],7101:["Left_Ventricle_7101_ID"],7131:["Esophagus_7131_ID"],7133:["Interventricular_Septum_7133_ID"],7148:["Stomach_7148_ID"],7196:["Spleen_7196_ID"],7197:["Liver_7197_ID"],7198:["Pancreas_7198_ID"],7200:["Small_intestine_7200_ID"],7202:["Gallbladder_7202_ID"],7204:["Left_Kidney_7204_ID","Right_Kidney_7204_ID"],7205:["Right_Kidney_7205_ID","Left_Kidney_7205_ID"],7206:["Duodenum_7206_ID"],7207:["Jejunum_7207_ID"],7208:["Ileum_7208_ID"],7209:["Ovaries_7209_ID"],7211:["Right_testis_7211_ID"],7212:["Left_testis_7212_ID"],7213:["Right_Ovary_7213_ID"],7214:["Left_Ovary_7214_ID"],7218:["Right_auricle_7218_ID"],7219:["Left_auricle_7219_ID"],7234:["Tricuspid_Valve_7234_ID"],7235:["Mitral_valve_7235_ID"],7236:["Aortic_Valve_7236_ID"],7246:["Pulmonary_Valve_7246_ID"],7309:["Right_Lung_7309_ID"],7310:["Left_Lung_7310_ID"],7333:["Right_Superior_Lobe_7333_ID"],7337:["Right_Inferior_Lobe_7337_ID"],7370:["Left_Superior_Lobe_7370_ID"],7371:["Left_Inferior_Lobe_7371_ID"],7383:["Right_Middle_Lobe_7383_ID"],7394:["Trachea_7394_ID"],7486:["manubrium_of_sternum_7486_ID","body_of_sternum_7486_ID"],7591:["Right_Costal_Cartilage_7591_ID","Left_Costal_Cartilage_7591_ID"],7592:["Left_Costal_Cartilage_7592_ID","Right_Costal_Cartilage_7592_ID"],7647:["spinal_cord_7647_ID"],7857:["Left_first_rib_7857_ID","Right_first_rib_7857_ID"],7882:["Right_second_rib_7882_ID"],7883:["Left_second_rib_7883_ID"],7909:["Right_third_rib_7909_ID"],7910:["Left_third_rib_7910_ID"],7957:["Right_fourth_rib_7957_ID"],7958:["Left_fourth_rib_7958_ID"],8066:["Right_fifth_rib_8066_ID","Left_fifth_rib_8066_ID"],8175:["Left_sixth_rib_8175_ID","Right_sixth_rib_8175_ID"],8229:["Left_seventh_rib_8229_ID","Right_seventh_rib_8229_ID"],8283:["Left_eighth_rib_8283_ID","Right_eighth_rib_8283_ID"],8364:["Left_ninth_rib_8364_ID","Right_ninth_rib_8364_ID"],8445:["Right_tenth_rib_8445_ID","Left_tenth_rib_8445_ID"],8531:["Left_eleventh_rib_8531_ID","Right_eleventh_rib_8531_ID"],8533:["Right_twelfth_rib_8533_ID","Left_twelfth_rib_8533_ID"],8612:["Pulmonary_trunk_8612_ID"],9165:["First_thoracic_vertebra_9165_ID"],9187:["Second_thoracic_vertebra_9187_ID"],9209:["Third_thoracic_vertebra_9209_ID"],9248:["Fourth_thoracic_vertebra_9248_ID"],9600:["Prostate_9600_ID"],9603:["Thyroid_Gland_9603_ID"],9615:["Cricoid_cartilage_9615_ID"],9706:["Bile_Ducts_9706_ID"],9707:["Penis_9707_ID"],9710:["Vomer_9710_ID"],9711:["Maxilla_9711_ID"],9761:["Right_Transversus_thoracis_9761_ID"],9762:["Right_Transversus_thoracis_9762_ID","Left_Transversus_thoracis_9762_ID"],9922:["Fifth_thoracic_vertebra_9922_ID"],9945:["Sixth_thoracic_vertebra_9945_ID"],9968:["Seventh_thoracic_vertebra_9968_ID"],9991:["Eighth_thoracic_vertebra_9991_ID"],10014:["Ninth_thoracic_vertebra_10014_ID"],10037:["Tenth_thoracic_vertebra_10037_ID"],10059:["Eleventh_thoracic_vertebra_10059_ID"],10081:["Twelfth_thoracic_vertebra_10081_ID"],10551:["Right_dorsal_scapular_artery_10551_ID"],10552:["right_dorsal_scapular_artery_10552_ID","left_dorsal_scapular_artery_10552_ID"],10660:["Right_deep_cervical_artery_10660_ID"],10679:["Right_inferior_thyroid_artery_10679_ID"],10680:["left_inferior_thyroid_artery_10680_ID","Right_suprascapular_artery_10680_ID"],10681:["left_suprascapular_artery_10681_ID","Right_transverse_cervical_artery_10681_ID","right_suprascapular_artery_10681_ID"],10682:["left_transverse_cervical_artery_10682_ID","Right_superficial_cervical_artery_10682_ID"],10683:["left_superficial_cervical_artery_10683_ID"],10951:["Inferior_vena_cava_10951_ID","base_of_inferior_vena_cava_10951_ID"],12519:["Atlas_C1_12519_ID"],12520:["Axis_C2_12520_ID"],12521:["Third_cervical_vertebra_12521_ID"],12522:["Fourth_cervical_vertebra_12522_ID"],12523:["Fifth_cervical_vertebra_12523_ID"],12524:["Sixth_cervical_vertebra_12524_ID"],12525:["Seventh_cervical_vertebra_12525_ID"],12770:["Deep_lateral_cervical_lymph_nodes_12770_ID"],12858:["Union_between_ascending_lumbar_veins_12858_ID"],13072:["First_lumbar_vertebra_13072_ID"],13073:["Second_lumbar_vertebra_13073_ID"],13074:["Third_lumbar_vertebra_13074_ID"],13075:["Fourth_lumbar_vertebra_13075_ID"],13076:["Fifth_lumbar_vertebra_13076_ID"],13111:["Right_external_jugular_vein_13111_ID"],13112:["Left_external_jugular_vein_13112_ID","Right_external_jugular_vein_13112_ID"],13113:["Left_external_jugular_vein_13113_ID"],13295:["Diaphragm_13295_ID"],13322:["Right_Clavicle_13322_ID"],13323:["Left_Clavicle_13323_ID"],13325:["Right_cephalic_vein_13325_ID"],13326:["right_cephalic_vein_13326_ID","left_cephalic_vein_13326_ID"],13328:["Left_Clavicle_13328_ID"],13336:["Right_external_oblique_13336_ID"],13337:["Left_external_oblique_13337_ID"],13346:["Right_Sternohyoid_13346_ID"],13347:["Left_Sternohyoid_13347_ID"],13350:["Right_Sternothyroid_13350_ID"],13351:["Left_Sternothyroid_13351_ID"],13352:["Right_Thyrohyoid_13352_ID"],13353:["Left_Thyrohyoid_13353_ID"],13354:["Intercostal_Muscles_of_Left_Thorax_13354_ID","Intercostal_Muscles_of_Right_Thorax_13354_ID"],13358:["Right_latissimus_dorsi_13358_ID"],13359:["Left_latissimus_dorsi_13359_ID"],13373:["Right_pectoralis_major_13373_ID"],13374:["Left_pectoralis_major_13374_ID","Right_pectoralis_major_13374_ID"],13375:["Right_Pectoralis_minor_13375_ID"],13376:["Left_Pectoralis_minor_13376_ID","Right_Pectoralis_minor_13376_ID"],13377:["Right_Rectus_Abdominis_13377_ID"],13378:["Left_Rectus_Abdominis_13378_ID"],13379:["Right_Rectus_Abdominis_13379_ID"],13381:["Right_Rhomboid_Major_13381_ID"],13382:["Left_Rhomboid_Major_13382_ID"],13383:["Right_Rhomboid_Minor_13383_ID"],13384:["Left_Rhomboid_Minor_13384_ID"],13395:["Right_Scapula_13395_ID"],13396:["Left_Scapula_13396_ID","Right_Scapula_13396_ID"],13398:["Right_serratus_anterior_13398_ID"],13399:["Left_serratus_anterior_13399_ID"],13403:["Right_Serratus_Posterior_Superior_13403_ID"],13404:["Left_Serratus_Posterior_Superior_13404_ID"],13405:["Right_Serratus_Posterior_Inferior_13405_ID"],13406:["Left_Serratus_Posterior_Inferior_13406_ID"],13408:["Right_Sternocleidomastoid_13408_ID"],13409:["Left_Sternocleidomastoid_13409_ID"],13410:["Right_Subclavius_13410_ID"],13411:["Left_Subclavius_13411_ID","Right_Subclavius_13411_ID"],13414:["Right_subscapularis_13414_ID"],13415:["Left_subscapularis_13415_ID","Right_subscapularis_13415_ID"],13417:["Right_Thoracoepigastric_vein_13417_ID"],13418:["Left_Thoracoepigastric_vein_13418_ID"],13419:["Right_Trapezius_13419_ID"],13420:["Left_Trapezius_13420_ID"],13421:["Ligamentum_arteriosum_13421_ID"],13478:["Vertebral_Column_13478_ID"],13889:["Pituitary_Gland_13889_ID"],13890:["Parathyroid_Glands_13890_ID"],13892:["Right_Internal_oblique_13892_ID"],13893:["Left_Internal_oblique_13893_ID"],13912:["Anterior_interventricular_artery_13912_ID"],14331:["splenic_vein_14331_ID"],14332:["superior_mesenteric_vein_14332_ID"],14335:["Right_renal_vein_14335_ID"],14336:["Left_renal_vein_14336_ID"],14338:["Right_Hepatic_Vein_14338_ID"],14339:["Left_Hepatic_Vein_14339_ID"],14341:["Right_testicular_vein_14341_ID"],14345:["Left_testicular_vein_14345_ID"],14384:["Right_median_nerve_14384_ID"],14385:["Left_median_nerve_14385_ID"],14468:["Right_Recurrent_Laryngeal_Nerve_14468_ID"],14469:["Left_Recurrent_Laryngeal_Nerve_14469_ID"],14542:["Appendix_14542_ID"],14543:["Colon_14543_ID"],14544:["Rectum_14544_ID"],14545:["Ascending_colon_14545_ID"],14546:["Transverse_colon_14546_ID"],14547:["Descending_Colon_14547_ID"],14548:["Sigmoid_Colon_14548_ID"],14735:["Right_Lumbar_artery_14735_ID","Left_Lumbar_Artery_14735_ID","Right_Lumbar_Artery_14735_ID"],14746:["Right_Inferior_Phrenic_Artery_14746_ID"],14747:["Left_Inferior_Phrenic_Artery_14747_ID"],14749:["superior_mesenteric_artery_14749_ID"],14750:["Inferior_Mesenteric_artery_14750_ID"],14752:["Right_renal_artery_14752_ID"],14753:["Left_Renal_artery_14753_ID"],14759:["Right_testicular_artery_14759_ID"],14760:["Left_testicular_artery_14760_ID"],14768:["Left_Gastric_Artery_14768_ID"],14771:["Common_hepatic_artery_14771_ID"],14772:["Hepatic_artery_proper_14772_ID"],14773:["Splenic_artery_14773_ID"],14775:["Gastroduodenal_artery_14775_ID"],14776:["Right_Gastric_artery_14776_ID"],14778:["Right_hepatic_artery_14778_ID"],14779:["Left_hepatic_artery_14779_ID"],14781:["Right_Gastroepiploic_artery_14781_ID"],14787:["Dorsal_pancreatic_artery_14787_ID"],14790:["Inferior_pancreatic_artery_14790_ID"],14791:["Prepancreatic_Artery_14791_ID"],14792:["Great_pancreatic_artery_14792_ID"],14793:["Caudal_pancreatic_artery_14793_ID"],14796:["Left_Gastroepiploic_artery_14796_ID"],14810:["middle_colic_artery_14810_ID"],14811:["Right_colic_artery_14811_ID"],14812:["Celiac_Trunk_14812_ID"],14815:["Ileocolic_artery_14815_ID"],14819:["ileal_branch_of_ileocolic_artery_14819_ID"],14820:["Ileal_branch_of_ileocolic_vein_14820_ID","Colic_branch_of_ileocolic_vein_14820_ID"],14822:["Superior_branch_of_ileocolic_artery_14822_ID"],14826:["Left_colic_artery_14826_ID"],14830:["Sigmoid_artery_14830_ID"],14831:["Marginal_artery_of_colon_14831_ID"],14832:["Superior_Rectal_artery_14832_ID"],14835:["Cystic_artery_14835_ID"],15388:["Pancreatic_tributary_of_splenic_vein_15388_ID"],15390:["left_gastroepiploic_vein_15390_ID"],15391:["Inferior_Mesenteric_vein_15391_ID"],15394:["Left_colic_vein_15394_ID"],15395:["Sigmoid_vein_15395_ID"],15397:["Right_gastroepiploic_vein_15397_ID"],15398:["Anterior_Superior_pancreaticoduodenal_vein_15398_ID","Anterior_Inferior_pancreaticoduodenal_vein_15398_ID","Pancreaticoduodenal_vein_15398_ID","Posterior_Superior_pancreaticoduodenal_vein_15398_ID","Posterior_Inferior_pancreaticoduodenal_vein_15398_ID"],15399:["Left_Gastric_vein_15399_ID"],15400:["Right_Gastric_vein_15400_ID"],15407:["right_colic_vein_15407_ID"],15408:["Ileocolic_vein_15408_ID"],15414:["Right_Hepatic_Portal_Vein_15414_ID"],15415:["Left_Hepatic_Portal_Vein_15415_ID"],15571:["Right_Ureter_15571_ID"],15572:["Left_Ureter_15572_ID"],15629:["Right_Adrenal_Gland_15629_ID"],15630:["Left_Adrenal_Gland_15630_ID"],15710:["Internal_anal_sphincter_15710_ID"],15900:["Bladder_15900_ID"],16202:["Sacrum_16202_ID"],16491:["Right_iliohypogastric_nerve_16491_ID"],16492:["Left_iliohypogastric_nerve_16492_ID"],16493:["Right_ilioinguinal_nerve_16493_ID"],16494:["Left_ilioinguinal_nerve_16494_ID"],16497:["Right_lateral_femoral_cutaneous_nerve_16497_ID"],16498:["Left_lateral_femoral_cutaneous_nerve_16498_ID"],16499:["Right_femoral_nerve_16499_ID"],16500:["Left_femoral_nerve_16500_ID"],16501:["Right_obturator_nerve_16501_ID"],16502:["Left_obturator_nerve_16502_ID"],17559:["Uterus_17559_ID"],17740:["Cervix_of_uterus_17740_ID"],18245:["Right_Fallopian_Tube_18245_ID","Left_Fallopian_Tube_18245_ID"],18256:["Right_epididymis_18256_ID"],18257:["Left_epididymis_18257_ID"],18806:["Right_external_iliac_artery_18806_ID"],18807:["Left_external_iliac_artery_18807_ID"],18809:["Right_internal_iliac_artery_18809_ID"],18810:["Left_internal_iliac_artery_18810_ID"],18824:["Right_inferior_vesical_artery_18824_ID"],18825:["Left_inferior_vesical_artery_18825_ID"],18829:["Left_Uterine_Artery_18829_ID","Right_Uterine_Artery_18829_ID"],18836:["Right_internal_pudendal_artery_18836_ID"],18837:["Left_internal_pudendal_artery_18837_ID"],18846:["Right_iliolumbar_artery_18846_ID"],18847:["Left_iliolumbar_artery_18847_ID"],18856:["Right_lateral_sacral_artery_18856_ID"],18857:["Left_lateral_sacral_artery_18857_ID"],18866:["Right_obturator_artery_18866_ID"],18867:["Left_obturator_artery_18867_ID"],18869:["Right_superior_gluteal_artery_18869_ID"],18870:["Right_superior_gluteal_artery_18870_ID","Left_superior_gluteal_artery_18870_ID"],18872:["Right_inferior_gluteal_artery_18872_ID"],18873:["Left_inferior_gluteal_artery_18873_ID"],18885:["Right_external_iliac_vein_18885_ID"],18886:["Left_external_iliac_vein_18886_ID"],18887:["Right_internal_iliac_vein_18887_ID"],18888:["Left_internal_iliac_vein_18888_ID"],18891:["Right_inferior_vesical_vein_18891_ID"],18892:["Left_inferior_vesical_vein_18892_ID"],18897:["Right_Uterine_Vein_18897_ID"],18898:["Left_Uterine_Vein_18898_ID"],18903:["Right_iliolumbar_vein_18903_ID"],18904:["Left_iliolumbar_vein_18904_ID"],18906:["Right_lateral_sacral_vein_18906_ID"],18907:["Left_lateral_sacral_vein_18907_ID"],18909:["Right_superior_gluteal_vein_18909_ID"],18910:["Left_superior_gluteal_vein_18910_ID"],18912:["Right_inferior_gluteal_vein_18912_ID"],18913:["Left_inferior_gluteal_vein_18913_ID"],18915:["Right_obturator_vein_18915_ID"],18916:["Left_obturator_vein_18916_ID"],18918:["Right_internal_pudendal_vein_18918_ID"],18919:["Left_internal_pudendal_vein_18919_ID"],19086:["Muscles_of_the_Pelvis_19086_ID"],19087:["Levator_Ani_19087_ID"],19090:["Pubococcygeus_19090_ID"],19091:["Puborectalis_19091_ID"],19119:["Right_Uterosacral_Ligament_19119_ID"],19120:["Left_Uterosacral_Ligament_19120_ID"],19235:["Right_vas_deferens_19235_ID"],19236:["Left_vas_deferens_19236_ID"],19387:["Right_Seminal_Vesicle_19387_ID"],19388:["Left_Seminal_Vesicle_19388_ID"],19617:["Corpus_spongiosum_of_penis_19617_ID"],19618:["Right_corporus_cavernosum_of_penis_19618_ID","Left_corporus_cavernosum_of_penis_19618_ID"],19667:["Urethra_19667_ID"],19668:["Male_urethra_19668_ID"],19730:["Left_Ischiocavernosus_19730_ID","Right_Ischiocavernosus_19730_ID"],19731:["Right_Superficial_Transverse_Perineal_Muscle_19731_ID","Left_Superficial_Transverse_Perineal_Muscle_19731_ID"],19732:["Deep_transverse_perineal_muscle_19732_ID"],19949:["Vagina_19949_ID"],20224:["Right_Ribs_20224_ID"],20225:["Right_Ribs_20225_ID","Left_Ribs_20225_ID"],20226:["Right_Bony_Pelvis_20226_ID","Left_Ribs_20226_ID","Right_side_of_bony_pelvis_20226_ID"],20227:["Left_Bony_Pelvis_20227_ID","Left_side_of_bony_pelvis_20227_ID"],20274:["Perineal_Body_20274_ID"],20630:["Right_genitofemoral_nerve_20630_ID"],20631:["Left_genitofemoral_nerve_20631_ID"],20632:["Genital_branch_of_right_genitofemoral_nerve_20632_ID"],20633:["Genital_branch_of_left_genitofemoral_nerve_20633_ID"],20634:["Femoral_branch_of_right_genitofemoral_nerve_20634_ID"],20635:["Femoral_branch_of_left_genitofemoral_nerve_20635_ID"],20688:["Right_Inferior_Epigastric_Artery_20688_ID"],20689:["Left_Inferior_Epigastric_Artery_20689_ID"],20735:["Right_Superficial_Epigastric_Artery_20735_ID"],20736:["Left_Superficial_Epigastric_Artery_20736_ID"],20796:["Right_deep_femoral_artery_20796_ID"],20797:["Left_deep_femoral_artery_20797_ID"],20801:["Right_lateral_circumflex_femoral_artery_20801_ID"],20802:["Left_lateral_circumflex_femoral_artery_20802_ID"],20807:["Right_Medial_circumflex_femoral_artery_20807_ID"],20808:["Left_Medial_circumflex_femoral_artery_20808_ID"],20818:["Right_dorsal_artery_of_penis_20818_ID"],20819:["Left_dorsal_artery_of_penis_20819_ID"],20967:["Prostatic_part_of_right_inferior_vesical_artery_20967_ID"],20968:["Prostatic_part_of_left_inferior_vesical_artery_20968_ID"],21163:["Right_Inferior_Epigastric_Vein_21163_ID"],21164:["Left_Inferior_Epigastric_Vein_21164_ID"],21188:["Right_Femoral_Vein_21188_ID"],21189:["Left_Femoral_Vein_21189_ID"],21378:["Superficial_Veins_of_the_Left_Leg_21378_ID","Superficial_Veins_of_the_Right_Leg_21378_ID"],21379:["Right_Great_Saphenous_Vein_21379_ID"],21380:["Left_Great_Saphenous_Vein_21380_ID"],21422:["Descending_branch_of_right_lateral_circumflex_femoral_artery_21422_ID"],21423:["Descending_branch_of_left_lateral_circumflex_femoral_artery_21423_ID"],21863:["Right_Pudendal_nerve_21863_ID"],21864:["Left_Pudendal_nerve_21864_ID"],21919:["Right_superficial_transverse_perineal_muscle_21919_ID"],21920:["Left_superficial_transverse_perineal_muscle_21920_ID"],21921:["Right_bulbospongiosus_21921_ID"],21922:["Left_bulbospongiosus_21922_ID"],21923:["Right_ischiocavernosus_21923_ID"],21924:["Left_ischiocavernosus_21924_ID"],21930:["External_Anal_Sphincter_21930_ID"],22109:["Right_Tibial_nerve_22109_ID"],22110:["Left_Tibial_nerve_22110_ID"],22111:["Right_sciatic_nerve_22111_ID"],22112:["Left_sciatic_nerve_22112_ID"],22171:["Right_inferior_ulnar_collateral_artery_22171_ID"],22172:["right_inferior_ulnar_collateral_artery_22172_ID","left_inferior_ulnar_collateral_artery_22172_ID"],22322:["Right_Iliacus_22322_ID"],22323:["Left_Iliacus_22323_ID"],22324:["Right_Obturator_Internus_22324_ID"],22325:["Left_Obturator_Internus_22325_ID"],22326:["Right_Obturator_externus_22326_ID"],22327:["Left_Obturator_externus_22327_ID"],22328:["Right_gluteus_maximus_22328_ID"],22329:["Left_gluteus_maximus_22329_ID"],22330:["Right_gluteus_medius_22330_ID"],22331:["Left_gluteus_medius_22331_ID"],22332:["Right_Gluteus_minimus_22332_ID"],22333:["Left_Gluteus_minimus_22333_ID"],22334:["Right_superior_gemellus_22334_ID"],22335:["Left_superior_gemellus_22335_ID"],22336:["Right_inferior_gemellus_22336_ID"],22337:["Left_inferior_gemellus_22337_ID"],22338:["Right_Quadratus_femoris_22338_ID"],22339:["Left_Quadratus_femoris_22339_ID"],22340:["Right_Piriformis_22340_ID"],22341:["Left_Piriformis_22341_ID"],22342:["Right_Psoas_Major_22342_ID"],22343:["Left_Psoas_Major_22343_ID"],22344:["Right_Transversus_abdominis_22344_ID"],22345:["Left_Transversus_abdominis_22345_ID"],22348:["Right_Quadratus_lumborum_22348_ID"],22349:["Left_Quadratus_lumborum_22349_ID"],22351:["Right_Psoas_Minor_22351_ID"],22352:["Left_Psoas_Minor_22352_ID"],22354:["Right_Sartorius_22354_ID"],22355:["Left_Sartorius_22355_ID"],22358:["Right_Semitendinosus_22358_ID"],22359:["Left_Semitendinosus_22359_ID"],22360:["Right_Biceps_Femoris_22360_ID"],22361:["Left_Biceps_Femoris_22361_ID"],22425:["Right_Tensor_Fasciae_Latae_22425_ID"],22426:["Left_Tensor_Fasciae_Latae_22426_ID"],22444:["Right_quadriceps_femoris_22444_ID"],22445:["Left_quadriceps_femoris_22445_ID"],22446:["Right_Articularis_Genus_22446_ID"],22447:["Left_Articularis_Genus_22447_ID"],22448:["Right_Semimembranosus_22448_ID"],22449:["Left_Semimembranosus_22449_ID"],22450:["Right_Pectineus_22450_ID"],22451:["Left_Pectineus_22451_ID"],22456:["Right_Adductor_Longus_22456_ID"],22457:["Right_Adductor_Longus_22457_ID","Left_Adductor_Longus_22457_ID"],22458:["Left_Adductor_Longus_22458_ID"],22459:["Right_Adductor_Magnus_22459_ID"],22460:["Left_Adductor_Magnus_22460_ID"],22507:["Right_descending_genicular_artery_22507_ID"],22508:["Left_descending_genicular_artery_22508_ID"],22539:["Right_Fibularis_tertius_22539_ID","Left_Fibularis_tertius_22539_ID"],22545:["Right_Tibialis_anterior_22545_ID","Left_Tibialis_anterior_22545_ID"],22547:["Left_Extensor_hallucis_longus_22547_ID","Right_Extensor_hallucis_longus_22547_ID"],22548:["Right_Extensor_hallucis_longus_22548_ID","Left_Extensor_hallucis_longus_22548_ID"],22549:["Right_extensor_digitorum_longus_22549_ID","Left_extensor_digitorum_longus_22549_ID"],22551:["Right_Fibularis_tertius_22551_ID","Left_Fibularis_tertius_22551_ID"],22553:["Right_Fibularis_longus_22553_ID","Left_Fibularis_longus_22553_ID"],22555:["Left_Fibularis_brevis_22555_ID","Right_Fibularis_brevis_22555_ID"],22556:["Right_Gastrocnemius_22556_ID"],22557:["Left_Gastrocnemius_22557_ID"],22559:["Right_Soleus_22559_ID","Left_Soleus_22559_ID"],22561:["Left_Plantaris_22561_ID","Right_Plantaris_22561_ID"],22586:["Right_superior_medial_genicular_artery_22586_ID"],22587:["Left_superior_medial_genicular_artery_22587_ID"],22588:["Right_superior_lateral_genicular_artery_22588_ID"],22589:["Left_superior_lateral_genicular_artery_22589_ID"],22592:["Right_Popliteus_22592_ID","Left_Popliteus_22592_ID"],22655:["Right_Axillary_artery_22655_ID"],22656:["Left_Axillary_artery_22656_ID","Right_Axillary_artery_22656_ID"],22669:["right_superior_thoracic_artery_22669_ID"],22670:["left_superior_thoracic_artery_22670_ID"],22675:["Right_lateral_thoracic_artery_22675_ID"],22676:["right_lateral_thoracic_artery_22676_ID","left_lateral_thoracic_artery_22676_ID"],22679:["Right_subscapular_artery_22679_ID"],22680:["left_subscapular_artery_22680_ID","right_subscapular_artery_22680_ID"],22682:["Right_anterior_humeral_circumflex_artery_22682_ID"],22683:["right_anterior_humeral_circumflex_artery_22683_ID","left_anterior_humeral_circumflex_artery_22683_ID"],22686:["Right_posterior_humeral_circumflex_artery_22686_ID"],22687:["left_posterior_humeral_circumflex_artery_22687_ID","right_posterior_humeral_circumflex_artery_22687_ID"],22691:["Right_brachial_artery_22691_ID"],22692:["right_brachial_artery_22692_ID","left_brachial_artery_22692_ID"],22696:["Right_deep_brachial_artery_22696_ID"],22697:["right_deep_brachial_artery_22697_ID","left_deep_brachial_artery_22697_ID"],22707:["Right_superior_ulnar_collateral_artery_22707_ID"],22708:["right_superior_ulnar_collateral_artery_22708_ID","left_superior_ulnar_collateral_artery_22708_ID"],22726:["Right_Splenius_cervicis_22726_ID"],22727:["Left_Splenius_cervicis_22727_ID"],22728:["Right_Splenius_capitis_22728_ID"],22729:["Left_Splenius_capitis_22729_ID"],22733:["Right_radial_artery_22733_ID"],22734:["Right_radial_artery_22734_ID","Left_radial_artery_22734_ID"],22740:["Right_Iliocostalis_Lumborum_22740_ID"],22741:["Left_Iliocostalis_Lumborum_22741_ID"],22742:["Right_Iliocostalis_Thoracis_22742_ID"],22743:["Left_Iliocostalis_Thoracis_22743_ID"],22744:["Right_Iliocostalis_Cervicis_22744_ID"],22745:["Left_Iliocostalis_Cervicis_22745_ID"],22751:["Right_Longissimus_Thoracis_22751_ID"],22753:["Left_Longissimus_Thoracis_22753_ID"],22754:["Right_Longissimus_Capitis_22754_ID"],22756:["Left_Longissimus_Capitis_22756_ID"],22757:["Right_Longissimus_Cervicis_22757_ID"],22758:["Left_Longissimus_Cervicis_22758_ID"],22765:["Right_radial_recurrent_artery_22765_ID"],22766:["left_radial_recurrent_artery_22766_ID","right_radial_recurrent_artery_22766_ID"],22772:["dorsal_carpal_branch_of_Right_radial_artery_22772_ID"],22773:["dorsal_carpal_branch_of_left_radial_artery_22773_ID","dorsal_carpal_branch_of_right_radial_artery_22773_ID"],22779:["Right_Spinalis_Thoracis_22779_ID"],22780:["Left_Spinalis_Thoracis_22780_ID"],22781:["Right_Spinalis_Cervicis_22781_ID"],22782:["Left_Spinalis_Cervicis_22782_ID"],22783:["Right_Spinalis_Capitis_22783_ID"],22784:["Left_Spinalis_Capitis_22784_ID"],22798:["Right_ulnar_artery_22798_ID","Left_ulnar_artery_22798_ID"],22801:["Right_anterior_ulnar_recurrent_artery_22801_ID"],22802:["right_anterior_ulnar_recurrent_artery_22802_ID","left_anterior_ulnar_recurrent_artery_22802_ID"],22804:["Right_posterior_ulnar_recurrent_artery_22804_ID"],22805:["right_posterior_ulnar_recurrent_artery_22805_ID","left_posterior_ulnar_recurrent_artery_22805_ID"],22807:["Right_common_interosseous_artery_22807_ID"],22808:["left_common_interosseous_artery_22808_ID","right_common_interosseous_artery_22808_ID"],22812:["Right_anterior_interosseous_artery_22812_ID"],22813:["left_anterior_interosseous_artery_22813_ID","right_anterior_interosseous_artery_22813_ID"],22821:["dorsal_carpal_branch_of_Right_ulnar_artery_22821_ID"],22822:["dorsal_carpal_branch_of_left_ulnar_artery_22822_ID","dorsal_carpal_branch_of_right_ulnar_artery_22822_ID"],22836:["Right_superficial_palmar_arch_22836_ID"],22837:["left_superficial_palmar_arch_22837_ID","right_superficial_palmar_arch_22837_ID"],22839:["Right_deep_palmar_arterial_arch_22839_ID"],22840:["left_deep_palmar_venous_arch_22840_ID","right_deep_palmar_venous_arch_22840_ID","right_deep_palmar_arterial_arch_22840_ID","left_deep_palmar_arterial_arch_22840_ID","right_deep_palmar_arch_22840_ID","left_deep_palmar_arch_22840_ID"],22872:["Right_Semispinalis_thoracis_22872_ID"],22873:["Left_Semispinalis_thoracis_22873_ID"],22874:["Right_Semispinalis_cervicis_22874_ID"],22875:["Left_Semispinalis_cervicis_22875_ID"],22876:["Right_Semispinalis_capitis_22876_ID"],22877:["Left_Semispinalis_capitis_22877_ID"],22878:["Right_Multifidus_22878_ID"],22879:["Left_Multifidus_22879_ID"],22909:["Right_basilic_vein_22909_ID"],22910:["right_basilic_vein_22910_ID","left_basilic_vein_22910_ID","Left_basilic_vein_22910_ID"],22920:["Right_palmar_metacarpal_veins_22920_ID"],22921:["right_palmar_metacarpal_veins_22921_ID","left_palmar_metacarpal_veins_22921_ID"],22935:["Right_medial_brachial_vein_22935_ID"],22936:["right_medial_brachial_vein_22936_ID","left_medial_brachial_vein_22936_ID"],22948:["Right_radial_vein_22948_ID"],22949:["left_radial_vein_22949_ID","right_radial_vein_22949_ID"],22951:["right_ulnar_vein_22951_ID"],22952:["right_ulnar_vein_22952_ID","left_ulnar_vein_22952_ID"],22964:["Right_median_cubital_vein_22964_ID"],22965:["right_median_cubital_vein_22965_ID","left_median_cubital_vein_22965_ID"],22968:["Right_median_antebrachial_vein_22968_ID"],22969:["left_median_antebrachial_vein_22969_ID","right_median_antebrachial_vein_22969_ID"],23111:["Right_deep_dorsal_vein_23111_ID"],23112:["right_deep_dorsal_vein_23112_ID","left_deep_dorsal_vein_23112_ID"],23123:["Right_medial_collateral_artery_23123_ID"],23124:["right_medial_collateral_artery_23124_ID","left_medial_collateral_artery_23124_ID"],23126:["Right_radial_collateral_artery_23126_ID"],23127:["right_radial_collateral_artery_23127_ID","left_radial_collateral_artery_23127_ID"],23130:["Right_Humerus_23130_ID","Left_Humerus_23130_ID"],23180:["Right_circumflex_scapular_artery_23180_ID"],23181:["right_circumflex_scapular_artery_23181_ID","left_circumflex_scapular_artery_23181_ID"],23464:["Left_radius_23464_ID","Right_radius_23464_ID"],23467:["Left_Ulna_23467_ID","Right_Ulna_23467_ID"],23707:["Right_Interosseous_membrane_23707_ID"],23708:["Left_Interosseous_membrane_23708_ID"],24160:["Bones_of_the_Right_Arm_24160_ID"],24162:["Bones_of_the_Left_Arm_24162_ID"],24435:["Right_scaphoid_bone_24435_ID","Left_scaphoid_bone_24435_ID"],24437:["Left_lunate_bone_24437_ID","Right_lunate_bone_24437_ID"],24439:["Left_triquetral_bone_24439_ID","Right_triquetral_bone_24439_ID"],24441:["Right_pisiform_24441_ID","Left_pisiform_24441_ID"],24443:["Right_trapezium_24443_ID","Left_trapezium_24443_ID"],24444:["Right_trapezoid_bone_24444_ID","Left_trapezoid_bone_24444_ID"],24446:["Right_capitate_bone_24446_ID","Left_capitate_bone_24446_ID"],24448:["Left_hamate_bone_24448_ID","Right_hamate_bone_24448_ID"],24474:["Right_femur_24474_ID"],24475:["Left_femur_24475_ID"],24477:["Right_tibia_24477_ID"],24478:["Right_tibia_24478_ID","Left_tibia_24478_ID"],24480:["Right_fibula_24480_ID"],24481:["Right_fibula_24481_ID","Left_fibula_24481_ID"],24482:["Right_talus_24482_ID"],24483:["Right_talus_24483_ID","Left_talus_24483_ID"],24486:["Right_patella_24486_ID"],24487:["Right_patella_24487_ID","Left_patella_24487_ID"],24497:["Right_calcaneus_24497_ID"],24498:["Right_calcaneus_24498_ID","Left_calcaneus_24498_ID"],24500:["Navicular_bone_of_right_foot_24500_ID"],24501:["Navicular_of_right_foot_24501_ID","Navicular_of_left_foot_24501_ID","Navicular_bone_of_left_foot_24501_ID"],24521:["Right_medial_Cuneiform_bone_24521_ID"],24522:["Left_medial_Cuneiform_bone_24522_ID","Right_medial_Cuneiform_bone_24522_ID"],24523:["Right_intermediate_Cuneiform_bone_24523_ID"],24524:["Right_intermediate_Cuneiform_bone_24524_ID","Left_intermediate_Cuneiform_bone_24524_ID"],24525:["Right_lateral_Cuneiform_bone_24525_ID"],24526:["Right_lateral_Cuneiform_bone_24526_ID","Left_lateral_Cuneiform_bone_24526_ID"],24528:["Right_cuboid_bone_24528_ID"],24529:["Left_cuboid_bone_24529_ID","Right_cuboid_bone_24529_ID"],25005:["Anterior_atlanto_occipital_membrane_25005_ID","Anterior_atlantooccipital_membrane_25005_ID"],29711:["Prostatic_venous_plexus_29711_ID"],31893:["Anterior_longitudinal_ligament_31893_ID"],32530:["Right_Rectus_capitis_posterior_major_32530_ID"],32531:["Left_Rectus_Capitis_posterior_major_32531_ID"],32532:["Right_Rectus_capitis_posterior_minor_32532_ID"],32533:["Left_Rectus_capitis_posterior_minor_32533_ID","Right_Rectus_Capitis_posterior_major_32533_ID"],32535:["Right_Rectus_capitis_posterior_minor_32535_ID"],32540:["Right_Levator_Scapulae_32540_ID","Right_Levator_scapulae_32540_ID"],32541:["Left_Levator_scapulae_32541_ID"],32542:["Right_Deltoid_32542_ID"],32543:["Left_Deltoid_32543_ID","Right_Deltoid_32543_ID"],32544:["Right_supraspinatus_32544_ID","Right_Supraspinatus_32544_ID"],32545:["Left_Supraspinatus_32545_ID"],32547:["Right_infraspinatus_32547_ID"],32548:["Left_infraspinatus_32548_ID"],32551:["Right_Teres_Major_32551_ID"],32552:["Left_Teres_Major_32552_ID"],32553:["Right_teres_minor_32553_ID"],32554:["Left_teres_minor_32554_ID"],33098:["Right_Rotatores_short_fibers_33098_ID","Right_Rotatores_long_fibers_33098_ID"],33099:["Left_Rotatores_long_fibers_33099_ID","Left_Rotatores_short_fibers_33099_ID"],33520:["Right_pectoral_girdle_muscles_33520_ID"],33521:["Left_pectoral_girdle_muscles_33521_ID","Right_pectoral_girdle_muscles_33521_ID"],37318:["Right_ulnar_nerve_37318_ID"],37319:["Left_ulnar_nerve_37319_ID"],37386:["Right_Abductor_pollicis_brevis_37386_ID"],37387:["Left_Abductor_pollicis_brevis_37387_ID"],37388:["Right_Flexor_pollicis_brevis_37388_ID"],37389:["Left_Flexor_pollicis_brevis_37389_ID"],37390:["Right_Opponens_pollicis_37390_ID"],37391:["Left_Opponens_pollicis_37391_ID"],37392:["Right_Adductor_pollicis_37392_ID"],37393:["Left_Adductor_pollicis_37393_ID","Right_Palmaris_brevis_37393_ID"],37395:["Left_Palmaris_brevis_37395_ID"],37396:["Right_Abductor_digiti_minimi_37396_ID"],37397:["Left_Abductor_digiti_minimi_37397_ID"],37398:["Right_Flexor_digiti_minimi_brevis_37398_ID"],37399:["Left_Flexor_digiti_minimi_brevis_37399_ID"],37400:["Right_Opponens_digiti_minimi_37400_ID"],37401:["Left_Opponens_digiti_minimi_37401_ID"],37460:["Right_Abductor_hallucis_37460_ID","Left_Abductor_hallucis_37460_ID"],37462:["Right_Flexor_digiti_minimi_brevis_37462_ID","Left_Flexor_digiti_minimi_brevis_37462_ID"],37464:["Abductor_digiti_minimi_of_right_foot_37464_ID","Abductor_digiti_minimi_of_left_foot_37464_ID"],37468:["Left_Flexor_hallucis_brevis_37468_ID","Right_Flexor_hallucis_brevis_37468_ID"],37470:["Left_Adductor_hallucis_37470_ID","Left_Adductor_hallucis_oblique_head_37470_ID","Left_Adductor_hallucis_transverse_head_37470_ID","Right_Adductor_hallucis_37470_ID","Right_Adductor_hallucis_oblique_head_37470_ID","Right_Adductor_hallucis_transverse_head_37470_ID"],37665:["Right_Coracobrachialis_37665_ID"],37666:["Left_Coracobrachialis_37666_ID","Right_Coracobrachialis_37666_ID"],37668:["Right_Brachialis_37668_ID"],37669:["Left_Brachialis_37669_ID"],37671:["Right_Biceps_Brachii_37671_ID"],37672:["Right_Biceps_Brachii_37672_ID","Left_Biceps_Brachii_37672_ID"],37689:["Right_Triceps_Brachii_37689_ID"],37690:["Right_Triceps_Brachii_37690_ID","Left_Triceps_Brachii_37690_ID"],37705:["Right_anconeus_37705_ID"],37706:["Left_anconeus_37706_ID","Right_anconeus_37706_ID"],38451:["Right_Pronator_teres_38451_ID"],38452:["Left_Pronator_teres_38452_ID"],38454:["Right_Pronator_quadratus_38454_ID"],38455:["Left_Pronator_quadratus_38455_ID"],38460:["Right_Flexor_carpi_radialis_longus_38460_ID"],38461:["Left_Flexor_carpi_radialis_longus_38461_ID"],38463:["Right_Palmaris_longus_38463_ID"],38464:["Left_Palmaris_longus_38464_ID"],38466:["Right_Flexor_carpi_ulnaris_38466_ID"],38467:["Left_Flexor_carpi_ulnaris_38467_ID"],38483:["Right_flexor_pollicis_longus_38483_ID"],38484:["Left_flexor_pollicis_longus_38484_ID"],38486:["Right_Brachioradialis_38486_ID"],38487:["Left_Brachioradialis_38487_ID"],38495:["Right_Extensor_carpi_radialis_longus_38495_ID"],38496:["Left_Extensor_carpi_radialis_longus_38496_ID"],38498:["Right_Extensor_carpi_radialis_brevis_38498_ID"],38499:["Left_Extensor_carpi_radialis_brevis_38499_ID"],38504:["Right_Extensor_digiti_minimi_38504_ID"],38505:["Left_Extensor_digiti_minimi_38505_ID"],38507:["Right_Extensor_carpi_ulnaris_38507_ID"],38508:["Left_Extensor_carpi_ulnaris_38508_ID"],38513:["Right_Supinator_38513_ID"],38514:["Left_Supinator_38514_ID"],38516:["Right_Abductor_pollicis_longus_38516_ID"],38517:["Left_Abductor_pollicis_longus_38517_ID"],38519:["Right_Extensor_pollicis_brevis_38519_ID"],38520:["Left_Extensor_pollicis_brevis_38520_ID"],38522:["Right_Extensor_pollicis_longus_38522_ID"],38523:["Left_Extensor_pollicis_longus_38523_ID"],38525:["Right_Extensor_indicis_38525_ID"],38526:["Left_Extensor_indicis_38526_ID"],38928:["Right_Rectus_Femoris_38928_ID"],38929:["Left_Rectus_Femoris_38929_ID"],38930:["Right_Vastus_Lateralis_38930_ID"],38931:["Left_Vastus_Lateralis_38931_ID"],38932:["Right_Vastus_Medialis_38932_ID"],38933:["Left_Vastus_Medialis_38933_ID"],38934:["Right_Vastus_Intermedius_38934_ID"],38935:["Left_Vastus_Intermedius_38935_ID"],39091:["Left_forearm_muscles_39091_ID"],39092:["Right_forearm_muscles_39092_ID"],39987:["Right_Extensor_retinaculum_of_hand_39987_ID","Left_Extensor_retinaculum_of_hand_39987_ID"],39988:["Right_Flexor_retinaculum_of_hand_39988_ID","Left_Flexor_retinaculum_of_hand_39988_ID"],42313:["Right_Pisohamate_Ligament_42313_ID","Left_Pisohamate_Ligament_42313_ID"],42369:["Right_hand_muscles_42369_ID"],42370:["Left_hand_muscles_42370_ID"],43883:["Right_Gracilis_43883_ID"],43884:["Left_Gracilis_43884_ID"],43890:["Right_inferior_medial_genicular_artery_43890_ID"],43891:["Left_inferior_medial_genicular_artery_43891_ID","Right_inferior_medial_genicular_artery_43891_ID"],43892:["Right_inferior_lateral_genicular_artery_43892_ID"],43893:["Left_inferior_lateral_genicular_artery_43893_ID"],43896:["Right_anterior_tibial_artery_43896_ID"],43897:["Right_anterior_tibial_artery_43897_ID","Left_anterior_tibial_artery_43897_ID"],43898:["Left_anterior_tibial_artery_43898_ID","Right_posterior_tibial_artery_43898_ID"],43899:["Left_posterior_tibial_artery_43899_ID"],43907:["Right_anterior_tibial_recurrent_artery_43907_ID"],43908:["Left_anterior_tibial_recurrent_artery_43908_ID"],43916:["Right_dorsalis_pedis_artery_43916_ID"],43917:["Left_dorsalis_pedis_artery_43917_ID"],43922:["Right_fibular_artery_43922_ID"],43923:["Left_fibular_artery_43923_ID"],43929:["Right_medial_plantar_artery_43929_ID"],43930:["Left_medial_plantar_artery_43930_ID"],43931:["Right_lateral_plantar_artery_43931_ID"],43932:["Left_lateral_plantar_artery_43932_ID"],43935:["Right_deep_medial_plantar_artery_43935_ID"],43936:["Left_deep_medial_plantar_artery_43936_ID"],43943:["Right_plantar_arch_43943_ID"],43944:["Left_plantar_arch_43944_ID"],43950:["Calcaneal_branch_of_right_fibular_artery_43950_ID"],43951:["Calcaneal_branch_of_left_fibular_artery_43951_ID"],44227:["Left_Popliteal_Lymph_Nodes_44227_ID","Right_Popliteal_Lymph_Nodes_44227_ID"],44249:["Right_Long_plantar_ligament_44249_ID","Left_Long_plantar_ligament_44249_ID"],44310:["Lymphatics_of_the_Lower_Limb_44310_ID"],44326:["Descending_branch_of_right_lateral_circumflex_femoral_Vein_44326_ID"],44327:["Descending_branch_of_left_lateral_circumflex_femoral_Vein_44327_ID"],44328:["Right_Popliteal_vein_44328_ID"],44329:["Left_Popliteal_vein_44329_ID"],44334:["Right_small_saphenous_vein_44334_ID"],44335:["Left_small_saphenous_vein_44335_ID"],44336:["Right_Anterior_Tibial_Vein_44336_ID"],44337:["Left_Anterior_Tibial_Vein_44337_ID"],44338:["Right_Posterior_Tibial_Vein_44338_ID"],44339:["Left_Posterior_Tibial_Vein_44339_ID"],44340:["Right_superficial_epigastric_vein_44340_ID"],44341:["Left_superficial_epigastric_vein_44341_ID"],44583:["Right_Oblique_Popliteal_Ligament_44583_ID"],44584:["Left_Oblique_Popliteal_Ligament_44584_ID"],44585:["Right_Patellar_Ligament_44585_ID"],44586:["Left_Patellar_Ligament_44586_ID"],44597:["Right_Arcuate_Popliteal_Ligament_44597_ID"],44599:["Left_Arcuate_Popliteal_Ligament_44599_ID"],44601:["Right_Tibial_Collateral_Ligament_44601_ID"],44602:["Left_Tibial_Collateral_Ligament_44602_ID"],44609:["Right_Fibular_Collateral_Ligament_44609_ID"],44610:["Left_Fibular_Collateral_Ligament_44610_ID"],44615:["Right_Anterior_Cruciate_Ligament_44615_ID"],44616:["Left_Anterior_Cruciate_Ligament_44616_ID"],44618:["Right_Posterior_Cruciate_Ligament_44618_ID"],44619:["Left_Posterior_Cruciate_Ligament_44619_ID"],44741:["Right_proper_plantar_digital_nerves_44741_ID"],44742:["Left_proper_plantar_digital_nerves_44742_ID"],44874:["Right_dorsal_branch_of_ulnar_nerve_44874_ID"],44875:["Left_dorsal_branch_of_ulnar_nerve_44875_ID"],44881:["Branch_of_Dorsal_venous_arch_of_Right_foot_44881_ID","Right_Dorsalis_pedis_vein_44881_ID","Dorsal_venous_arch_of_Right_foot_44881_ID"],44882:["Branch_of_Dorsal_venous_arch_of_Left_foot_44882_ID","Dorsal_venous_arch_of_Left_foot_44882_ID","Left_Dorsalis_pedis_vein_44882_ID"],44883:["Medial_branch_of_Plantar_venous_arch_of_right_foot_44883_ID","Plantar_venous_arch_of_Right_foot_44883_ID","Lateral_branch_of_Plantar_venous_arch_of_right_foot_44883_ID"],44884:["Medial_branch_of_Plantar_venous_arch_of_left_foot_44884_ID","Lateral_branch_of_Plantar_venous_arch_of_left_foot_44884_ID","Plantar_venous_arch_of_Left_foot_44884_ID"],44885:["Right_Fibular_vein_44885_ID"],44886:["Left_Fibular_vein_44886_ID"],44887:["Right_Superior_Medial_Genicular_vein_44887_ID","Right_Genicular_Veins_44887_ID","Right_Inferior_Medial_Genicular_Vein_44887_ID","Right_Superior_Lateral_Genicular_vein_44887_ID","Right_Inferior_Lateral_Genicular_Vein_44887_ID"],44888:["Left_Inferior_Lateral_Genicular_Vein_44888_ID","Left_Genicular_Veins_44888_ID","Left_Inferior_Medial_Genicular_Vein_44888_ID","Left_Superior_Medial_Genicular_vein_44888_ID","Left_Superior_Lateral_Genicular_vein_44888_ID"],44918:["Right_medial_circumflex_femoral_vein_44918_ID"],44919:["Left_medial_circumflex_femoral_vein_44919_ID"],44920:["Right_lateral_circumflex_femoral_vein_44920_ID"],44922:["Left_lateral_circumflex_femoral_vein_44922_ID"],45257:["Right_Intermediate_Femoral_Cutaneous_Nerve_45257_ID"],45258:["Left_Intermediate_Femoral_Cutaneous_Nerve_45258_ID"],45263:["Right_saphenous_nerve_45263_ID"],45264:["Left_saphenous_nerve_45264_ID"],45338:["Right_Posterior_femoral_cutaneous_nerve_45338_ID"],45339:["Left_Posterior_femoral_cutaneous_nerve_45339_ID"],45357:["Right_common_fibular_nerve_45357_ID"],45358:["Left_common_fibular_nerve_45358_ID"],45363:["Right_superficial_fibular_nerve_45363_ID"],45364:["Left_superficial_fibular_nerve_45364_ID"],45387:["Right_deep_fibular_nerve_45387_ID"],45388:["Left_deep_fibular_nerve_45388_ID"],45389:["Right_Lateral_terminal_branch_of_deep_fibular_nerve_45389_ID"],45390:["Left_Lateral_terminal_branch_of_deep_fibular_nerve_45390_ID"],45426:["Right_sural_nerve_45426_ID"],45427:["Left_sural_nerve_45427_ID"],45434:["Right_medial_proper_plantar_nerve_45434_ID"],45435:["Left_medial_proper_plantar_nerve_45435_ID"],45450:["Right_lateral_plantar_nerve_45450_ID"],45451:["Left_lateral_plantar_nerve_45451_ID"],45654:["Female_Internal_Genitalia_45654_ID"],45739:["Right_platysma_45739_ID"],45740:["Left_platysma_45740_ID"],45769:["Internal_Urethral_Sphincter_45769_ID"],45826:["Right_Stylohyoid_45826_ID"],45827:["Left_Stylohyoid_45827_ID"],45858:["Right_Iliococcygeus_45858_ID"],45859:["Left_Iliococcygeus_45859_ID"],45890:["Right_Biceps_Femoris_Short_Head_45890_ID"],45891:["Left_Biceps_Femoris_Short_Head_45891_ID"],46283:["Superior_oblique_part_of_right_longus_colli_46283_ID"],46284:["Superior_oblique_part_of_left_longus_colli_46284_ID"],46285:["Vertical_Intermediate_part_of_right_longus_colli_46285_ID"],46286:["Vertical_Intermediate_part_of_left_longus_colli_46286_ID"],46287:["Inferior_oblique_part_of_right_longus_colli_46287_ID"],46288:["Inferior_oblique_part_of_left_longus_colli_46288_ID"],46292:["Right_Digastric_46292_ID","Right_Digastric_muscle_46292_ID"],46293:["Left_Digastric_46293_ID","Left_Digastric_muscle_46293_ID"],46309:["Right_Longus_capitis_46309_ID"],46310:["Left_Longus_capitis_46310_ID"],46313:["Right_Rectus_capitis_anterior_46313_ID"],46314:["Left_Rectus_capitis_anterior_46314_ID"],46317:["Right_Rectus_capitis_lateralis_46317_ID"],46318:["Right_Rectus_capitis_lateralis_46318_ID","Left_Rectus_capitis_lateralis_46318_ID"],46319:["Left_Rectus_capitis_lateralis_46319_ID"],46321:["Right_Mylohyoid_muscle_46321_ID","Right_Mylohyoid_Muscle_46321_ID"],46322:["Left_Mylohyoid_46322_ID","Left_Mylohyoid_Muscle_46322_ID"],46326:["Right_Geniohyoid_46326_ID"],46327:["Left_Geniohyoid_46327_ID"],46443:["Right_Coccygeus_46443_ID"],46444:["Left_Coccygeus_46444_ID"],46563:["Vertical_part_of_left_cricothyroid_muscle_46563_ID","Right_Cricothyroid_muscle_46563_ID","Oblique_part_of_left_cricothyroid_muscle_46563_ID"],46564:["Vertical_part_of_left_cricothyroid_muscle_46564_ID","Left_Cricothyroid_muscle_46564_ID","Oblique_part_of_left_cricothyroid_muscle_46564_ID"],46621:["Superior_Pharyngeal_Constrictor_46621_ID"],46622:["Middle_Pharyngeal_Constrictor_46622_ID"],46623:["Inferior_Pharyngeal_Constrictor_46623_ID"],46690:["Genioglossus_46690_ID"],46703:["Right_Hyoglossus_46703_ID"],46704:["Left_Hyoglossus_46704_ID"],46705:["Right_Styloglossus_46705_ID"],46706:["Right_Styloglossus_46706_ID","Left_Styloglossus_46706_ID"],46759:["Right_frontalis_46759_ID"],46760:["Left_frontalis_46760_ID"],46761:["Right_occipitalis_46761_ID"],46762:["Left_occipitalis_46762_ID"],46768:["Epicranial_aponeurosis_46768_ID"],46777:["Depressor_septi_nasi_46777_ID"],46792:["Right_orbicularis_oculi_46792_ID"],46793:["Left_orbicularis_oculi_46793_ID"],46796:["Right_corrugator_supercilii_46796_ID"],46797:["Left_corrugator_supercilii_46797_ID"],46803:["Right_levator_labii_superioris_alaeque_nasi_46803_ID"],46804:["Left_levator_labii_superioris_alaeque_nasi_46804_ID"],46806:["Right_levator_labii_superioris_46806_ID"],46807:["Left_levator_labii_superioris_46807_ID"],46812:["Right_zygomaticus_major_46812_ID"],46813:["Left_zygomaticus_major_46813_ID"],46814:["Right_zygomaticus_minor_46814_ID"],46815:["Left_zygomaticus_minor_46815_ID"],46817:["Right_depressor_labii_inferioris_46817_ID"],46818:["Left_depressor_labii_inferioris_46818_ID"],46823:["Right_levator_anguli_oris_46823_ID"],46824:["Left_levator_anguli_oris_46824_ID"],46826:["Right_mentalis_46826_ID"],46827:["Left_mentalis_46827_ID"],46829:["Right_depressor_anguli_oris_46829_ID"],46830:["Left_depressor_anguli_oris_46830_ID"],46835:["Right_buccinator_46835_ID"],46836:["Left_buccinator_46836_ID"],46839:["Right_risorius_46839_ID"],46840:["Left_risorius_46840_ID"],46841:["Orbicularis_oris_46841_ID"],48025:["Left_Tendon_of_Digastric_48025_ID","Right_Tendon_of_Digastric_48025_ID","Right_Tendon_of_Digastric_Muscle_48025_ID","Left_Tendon_of_Digastric_Muscle_48025_ID"],48957:["Right_auricularis_superior_48957_ID"],48958:["Left_auricularis_superior_48958_ID"],48959:["Right_auricularis_anterior_48959_ID"],48960:["Left_auricularis_anterior_48960_ID"],48961:["Right_auricularis_posterior_48961_ID"],48962:["Left_auricularis_posterior_48962_ID"],48997:["Right_masseter_48997_ID"],48998:["Left_masseter_48998_ID"],49007:["Right_temporalis_49007_ID"],49008:["Left_temporalis_49008_ID"],49012:["Right_Medial_Pterygoid_49012_ID"],49013:["Left_Medial_Pterygoid_49013_ID"],49016:["Right_inferior_lateral_pterygoid_49016_ID","Right_superior_lateral_pterygoid_49016_ID"],49017:["Left_superior_lateral_pterygoid_49017_ID","Left_inferior_lateral_pterygoid_49017_ID"],49036:["Left_inferior_rectus_49036_ID"],49044:["Right_superior_rectus_49044_ID"],49045:["Left_superior_rectus_49045_ID"],49046:["Right_inferior_rectus_49046_ID"],49047:["Left_inferior_rectus_49047_ID"],49048:["Right_levator_palpebrae_superioris_49048_ID"],49049:["Left_levator_palpebrae_superioris_49049_ID"],49050:["Right_inferior_oblique_49050_ID"],49051:["Left_inferior_oblique_49051_ID"],49052:["Right_superior_oblique_49052_ID"],49053:["Left_superior_oblique_49053_ID"],49054:["Right_lateral_rectus_49054_ID"],49055:["Left_lateral_rectus_49055_ID"],49056:["Right_medial_rectus_49056_ID"],49057:["Left_medial_rectus_49057_ID"],49152:["Right_Ciliary_Muscle_49152_ID"],49153:["Left_Ciliary_Muscle_49153_ID"],49177:["Upper_Gastrointestinal_Tract_49177_ID"],49386:["Right_Inferior_extensor_retinaculum_49386_ID","Left_Inferior_extensor_retinaculum_49386_ID"],49388:["Right_Superior_extensor_retinaculum_49388_ID","Left_Superior_extensor_retinaculum_49388_ID"],49481:["Right_superior_laryngeal_artery_49481_ID"],49482:["Left_superior_laryngeal_artery_49482_ID"],49486:["Right_superior_thyroid_artery_49486_ID"],49487:["Left_superior_thyroid_artery_49487_ID"],49498:["Right_ascending_pharyngeal_artery_49498_ID"],49499:["Left_ascending_pharyngeal_artery_49499_ID"],49550:["Right_facial_artery_49550_ID"],49551:["Left_facial_artery_49551_ID","Right_facial_artery_49551_ID"],49552:["Left_facial_artery_49552_ID"],49556:["Right_ascending_palatine_artery_49556_ID"],49557:["Left_ascending_palatine_artery_49557_ID"],49559:["Right_tonsillar_artery_49559_ID"],49560:["Left_tonsillar_artery_49560_ID"],49561:["Right_tonsillar_artery_49561_ID"],49567:["Inferior_labial_artery_49567_ID"],49570:["Superior_labial_artery_49570_ID"],49584:["Right_angular_artery_49584_ID"],49585:["Left_angular_artery_49585_ID"],49625:["Right_posterior_auricular_artery_49625_ID"],49626:["Left_posterior_auricular_artery_49626_ID"],49651:["Right_superficial_temporal_artery_49651_ID"],49652:["Left_superficial_temporal_artery_49652_ID"],49658:["Right_transverse_facial_artery_49658_ID"],49659:["Left_transverse_facial_artery_49659_ID"],49660:["Right_transverse_facial_artery_49660_ID"],49676:["Right_maxillary_artery_49676_ID"],49677:["Left_maxillary_artery_49677_ID"],49678:["Right_maxillary_artery_49678_ID"],49705:["Right_mental_artery_49705_ID","branch_of_right_mental_artery_49705_ID"],49706:["Left_mental_artery_49706_ID","branch_of_left_mental_artery_49706_ID"],49712:["Right_middle_meningeal_artery_49712_ID"],49713:["Left_middle_meningeal_artery_49713_ID"],49743:["Right_deep_temporal_artery_49743_ID"],49744:["Left_deep_temporal_artery_49744_ID"],49755:["Right_buccal_artery_49755_ID"],49756:["Left_buccal_artery_49756_ID"],49768:["Right_infraorbital_artery_49768_ID"],49769:["Left_infraorbital_artery_49769_ID"],49792:["Right_descending_palatine_artery_49792_ID"],49793:["Left_descending_palatine_artery_49793_ID"],49799:["Left_greater_palatine_artery_49799_ID"],49800:["Right_greater_palatine_artery_49800_ID"],49802:["Right_lesser_palatine_artery_49802_ID"],49803:["Left_lesser_palatine_artery_49803_ID"],49805:["Right_sphenopalatine_artery_49805_ID"],49806:["Left_sphenopalatine_artery_49806_ID"],49810:["Right_posterior_lateral_nasal_artery_49810_ID"],49811:["Left_posterior_lateral_nasal_artery_49811_ID"],49812:["Posterior_septal_branch_of_right_sphenopalatine_artery_49812_ID"],49813:["Posterior_septal_branch_of_left_sphenopalatine_artery_49813_ID"],49869:["Right_opthalmic_artery_49869_ID","Right_ophthalmic_artery_49869_ID"],49870:["Left_opthalmic_artery_49870_ID","Left_ophthalmic_artery_49870_ID"],49881:["Right_central_retinal_artery_49881_ID","Left_central_retinal_artery_49881_ID"],49911:["Right_Inferior_Pulmonary_vein_49911_ID"],49913:["Left_Inferior_Pulmonary_vein_49913_ID"],49914:["Right_Superior_Pulmonary_vein_49914_ID"],49916:["Left_Superior_Pulmonary_vein_49916_ID"],49928:["Right_lacrimal_artery_49928_ID"],49929:["Left_lacrimal_artery_49929_ID"],49974:["Right_supraorbital_artery_49974_ID"],49975:["Left_supraorbital_artery_49975_ID"],49987:["Right_anterior_ethmoidal_artery_49987_ID"],49988:["Left_anterior_ethmoidal_artery_49988_ID"],49990:["Right_posterior_ethmoidal_artery_49990_ID"],49991:["Left_posterior_ethmoidal_artery_49991_ID"],50001:["Right_dorsal_nasal_artery_50001_ID"],50002:["Left_dorsal_nasal_artery_50002_ID"],50026:["Right_supratrochlear_artery_50026_ID"],50027:["Left_supratrochlear_artery_50027_ID","Right_supratrochlear_artery_50027_ID"],50028:["Left_supratrochlear_artery_50028_ID"],50029:["Right_anterior_cerebral_artery_50029_ID"],50030:["Left_anterior_cerebral_artery_50030_ID"],50031:["Left_anterior_cerebral_artery_50031_ID"],50038:["Left_coronary_artery_50038_ID"],50039:["Right_Coronary_Artery_50039_ID"],50082:["Right_Middle_Cerebral_Artery_50082_ID"],50083:["Left_Middle_Cerebral_Artery_50083_ID"],50085:["Right_Posterior_Communicating_Artery_50085_ID"],50086:["Left_Posterior_Communicating_Artery_50086_ID"],50169:["Anterior_Communicating_Artery_50169_ID"],50197:["Muscles_of_the_Right_Arm_50197_ID"],50198:["Muscles_of_the_Right_Arm_50198_ID","Muscles_of_the_Left_Arm_50198_ID"],50203:["Right_upper_arm_muscles_50203_ID"],50204:["Right_upper_arm_muscles_50204_ID","Left_upper_arm_muscles_50204_ID"],50221:["Right_shoulder_muscles_50221_ID","Left_shoulder_muscles_50221_ID"],50222:["Left_shoulder_muscles_50222_ID","Right_shoulder_muscles_50222_ID"],50542:["Basilar_Artery_50542_ID"],50545:["Right_Anterior_Inferior_cerebellar_artery_50545_ID","Right_anterior_Inferior_cerebellar_artery_50545_ID"],50546:["Left_Anterior_Inferior_cerebellar_artery_50546_ID","Left_anterior_Inferior_cerebellar_artery_50546_ID"],50574:["Right_Superior_Cerebellar_artery_50574_ID"],50575:["Left_Superior_Cerebellar_Artery_50575_ID","Left_Superior_Cerebellar_artery_50575_ID"],50584:["Right_Posterior_cerebral_artery_50584_ID","Right_posterior_cerebral_artery_50584_ID"],50585:["Left_Posterior_cerebral_artery_50585_ID","Left_posterior_cerebral_artery_50585_ID"],50718:["Superior_Terminal_Branch_of_Right_Middle_Cerebral_Artery_50718_ID"],50719:["Superior_Terminal_Branch_of_Left_Middle_Cerebral_Artery_50719_ID"],50735:["Hepatic_Portal_and_Associated_Branches_50735_ID"],50764:["Right_transverse_sinus_50764_ID"],50765:["Left_transverse_sinus_50765_ID"],50767:["Superior_sagittal_sinus_50767_ID"],50768:["Inferior_Sagittal_Sinus_50768_ID"],50769:["Straight_Sinus_50769_ID"],50773:["Intercavernous_sinus_50773_ID"],50781:["Occipital_Sinus_50781_ID"],50784:["Sinus_Confluence_50784_ID"],50808:["Right_superior_thyroid_vein_50808_ID"],50809:["Left_superior_thyroid_vein_50809_ID"],50852:["Right_posterior_auricular_vein_50852_ID"],50853:["Left_posterior_auricular_vein_50853_ID"],50859:["Right_suprascapular_vein_50859_ID"],50860:["Left_suprascapular_vein_50860_ID","Right_suprascapular_vein_50860_ID"],50872:["Right_Pulmonary_artery_50872_ID"],50873:["Left_Pulmonary_artery_50873_ID"],50875:["Right_optic_nerve_50875_ID"],50876:["Left_Facial_Vein_50876_ID","Right_Facial_Vein_50876_ID"],50877:["Right_Facial_Vein_50877_ID","Left_Facial_Vein_50877_ID"],50878:["Left_optic_nerve_50878_ID"],50879:["Right_oculomotor_nerve_50879_ID"],50880:["Left_oculomotor_nerve_50880_ID"],50881:["Right_trochlear_nerve_50881_ID"],50882:["Left_trochlear_nerve_50882_ID"],50886:["Right_abducens_nerve_50886_ID"],50887:["Left_abducens_nerve_50887_ID"],50888:["Right_facial_nerve_50888_ID"],50889:["Left_facial_nerve_50889_ID"],50890:["Right_vestibulocochlear_nerve_50890_ID"],50891:["Left_vestibulocochlear_nerve_50891_ID"],50892:["Right_glossopharyngeal_nerve_50892_ID"],50894:["Left_glossopharyngeal_nerve_50894_ID"],50897:["Right_spinal_accessory_nerve_50897_ID","Left_spinal_accessory_nerve_50897_ID"],50899:["Left_spinal_accessory_nerve_50899_ID"],50902:["Right_hypoglossal_nerve_50902_ID"],50903:["Left_hypoglossal_Nerve_50903_ID"],50929:["Right_retromandibular_vein_50929_ID"],50930:["Left_retromandibular_vein_50930_ID"],50933:["Right_Superficial_Temporal_Vein_50933_ID"],50934:["Left_Superficial_Temporal_Vein_50934_ID"],51042:["Right_Deep_Femoral_vein_51042_ID"],51043:["Left_Deep_Femoral_vein_51043_ID"],51085:["Tendon_of_left_flexor_digitorum_brevis_51085_ID","Tendon_of_right_flexor_digitorum_brevis_51085_ID","Right_flexor_digitorum_longus_51085_ID","Left_flexor_digitorum_longus_51085_ID"],51289:["Right_superior_petrosal_sinus_51289_ID"],51290:["Left_superior_petrosal_sinus_51290_ID"],51402:["Right_Cavernous_sinus_51402_ID"],51403:["Left_Cavernous_Sinus_51403_ID"],51489:["Right_occipital_vein_51489_ID"],51490:["Left_occipital_vein_51490_ID"],51885:["Left_central_retinal_vein_51885_ID","Right_central_retinal_vein_51885_ID"],51942:["Right_superior_central_retinal_artery_51942_ID","Left_superior_central_retinal_artery_51942_ID"],51944:["Right_inferior_central_retinal_artery_51944_ID","Left_inferior_central_retinal_artery_51944_ID"],52619:["Right_trigeminal_ganglion_52619_ID"],52620:["Left_trigeminal_ganglion_52620_ID"],52629:["Right_lacrimal_nerve_52629_ID"],52630:["Left_lacrimal_nerve_52630_ID"],52639:["Right_opthalmic_nerve_52639_ID"],52640:["Left_opthalmic_nerve_52640_ID"],52643:["Right_supratrochlear_nerve_52643_ID"],52644:["Left_supratrochlear_nerve_52644_ID"],52661:["Medial_branch_of_right_supraorbital_nerve_52661_ID"],52662:["Medial_branch_of_left_supraorbital_nerve_52662_ID"],52663:["Lateral_branch_of_right_supraorbital_nerve_52663_ID"],52664:["Lateral_branch_of_left_supraorbital_nerve_52664_ID"],52669:["Right_nasociliary_nerve_52669_ID"],52670:["Left_nasociliary_nerve_52670_ID"],52725:["Right_maxillary_nerve_52725_ID"],52726:["Left_maxillary_nerve_52726_ID"],52734:["Frontal_bone_52734_ID"],52735:["Occipital_bone_52735_ID"],52736:["Sphenoid_bone_52736_ID"],52738:["Right_temporal_bone_52738_ID"],52739:["Left_temporal_bone_52739_ID"],52740:["Ethmoid_bone_52740_ID"],52745:["Nasal_bone_52745_ID"],52746:["Palatine_bone_52746_ID"],52748:["Mandible_52748_ID"],52749:["Hyoid_bone_52749_ID"],52784:["Left_lateral_posterior_superior_nasal_nerve_52784_ID"],52785:["Right_lateral_posterior_superior_nasal_nerve_52785_ID"],52788:["Right_parietal_bone_52788_ID"],52789:["Left_parietal_bone_52789_ID"],52803:["Right_greater_palatine_nerve_52803_ID"],52804:["Left_greater_palatine_nerve_52804_ID"],52806:["Right_lesser_palatine_nerve_52806_ID"],52807:["Left_lesser_palatine_nerve_52807_ID"],52824:["Left_posterior_inferior_nasal_nerve_52824_ID"],52825:["Right_posterior_inferior_nasal_nerve_52825_ID"],52892:["Right_zygomatic_bone_52892_ID"],52893:["Left_zygomatic_bone_52893_ID"],52974:["Zygomaticotemporal_branch_of_right_zygomatic_nerve_52974_ID"],52975:["Zygomaticotemporal_branch_of_left_zygomatic_nerve_52975_ID"],52976:["Zygomaticofacial_branch_of_right_zygomatic_nerve_52976_ID"],52977:["Zygomaticotemporal_branch_of_right_zygomatic_nerve_52977_ID","Zygomaticofacial_branch_of_left_zygomatic_nerve_52977_ID"],52978:["Zygomaticotemporal_branch_of_left_zygomatic_nerve_52978_ID"],52979:["Right_infraorbital_nerve_52979_ID"],52980:["Left_infra_orbital_nerve_52980_ID","Left_infraorbital_nerve_52980_ID"],52997:["Right_Mandibular_Nerve_52997_ID"],52998:["Left_Mandibular_Nerve_52998_ID"],53001:["Right_auriculotemporal_nerve_53001_ID"],53002:["Left_auriculotemporal_nerve_53002_ID"],53069:["Right_pterygopalatine_ganglion_53069_ID"],53070:["Left_pterygopalatine_ganglion_53070_ID"],53121:["Right_zygomatic_bone_53121_ID"],53122:["Left_zygomatic_bone_53122_ID"],53185:["Buccal_branch_of_right_facial_nerve_53185_ID","Buccal_branch_of_Right_Facial_Nerve_53185_ID"],53186:["Buccal_branch_of_Left_Facial_Nerve_53186_ID"],53219:["Right_lingual_nerve_53219_ID"],53220:["Left_lingual_nerve_53220_ID"],53244:["Right_Inferior_Alveolar_Nerve_53244_ID"],53245:["Left_Inferior_Alveolar_Nerve_53245_ID"],53251:["Right_mental_nerve_53251_ID","Left_mental_nerve_53251_ID"],53252:["Left_mental_nerve_53252_ID"],53279:["Right_posterior_auricular_nerve_53279_ID"],53280:["Left_posterior_auricular_nerve_53280_ID"],53290:["Temporal_branch_of_the_right_facial_nerve_53290_ID"],53291:["Temporal_branch_of_the_left_facial_nerve_53291_ID","Temporal_branch_of_the_right_facial_nerve_53291_ID"],53366:["Marginal_mandibular_branch_of_right_facial_nerve_53366_ID"],53367:["Marginal_mandibular_branch_of_left_facial_nerve_53367_ID"],53398:["Cervical_branch_of_right_facial_nerve_53398_ID"],53399:["Cervical_branch_of_left_facial_nerve_53399_ID"],53549:["Right_ciliary_ganglion_53549_ID"],53550:["Left_ciliary_ganglion_53550_ID"],53641:["Right_ear_53641_ID"],53642:["Left_ear_53642_ID"],53643:["Left_ear_53643_ID"],53645:["Right_Lacrimal_Bone_53645_ID"],53646:["Left_lacrimal_bone_53646_ID"],53654:["Palatine_bone_53654_ID"],54375:["Nasal_septum_54375_ID"],54449:["Right_eye_54449_ID"],54450:["Left_eye_54450_ID"],54640:["Tongue_54640_ID"],55099:["Thyroid_Cartilage_55099_ID"],55123:["Lower_part_of_cricopharyngeus_55123_ID"],55132:["Thyrohyoid_Membrane_55132_ID"],55143:["Right_ansa_cervicalis_nerve_55143_ID"],55144:["left_ansa_cervicalis_nerve_55144_ID"],55145:["Right_ansa_cervicalis_nerve_55145_ID"],55233:["Cricothyroid_ligament_55233_ID"],55560:["Right_Superior_Parathyroid_55560_ID"],55561:["Left_Superior_Parathyroid_55561_ID"],55562:["Right_Inferior_Parathyroid_55562_ID"],55563:["Left_Inferior_Parathyroid_55563_ID"],55610:["Right_procerus_55610_ID"],55611:["Left_procerus_55611_ID"],55612:["Transverse_part_of_right_nasalis_55612_ID"],55613:["Transverse_part_of_left_nasalis_55613_ID"],55614:["Alar_part_of_right_nasalis_55614_ID"],55615:["Alar_part_of_left_nasalis_55615_ID"],56103:["Right_Internal_acoustic_meatus_56103_ID"],56104:["Left_Internal_acoustic_meatus_56104_ID"],56427:["Right_tympanic_membrane_56427_ID"],56428:["Left_tympanic_membrane_56428_ID"],58236:["Right_Iris_58236_ID"],58237:["Left_Iris_58237_ID"],58242:["Right_Lens_58242_ID"],58243:["Left_Lens_58243_ID"],58271:["Right_Sclera_58271_ID"],58272:["Left_Sclera_58272_ID"],58299:["Right_Choroid_58299_ID"],58300:["Left_Choroid_58300_ID"],58302:["Right_Retina_58302_ID"],58303:["Left_Retina_58303_ID"],58841:["Right_Hyaloid_Canal_58841_ID"],58842:["Left_Hyaloid_Canal_58842_ID"],59102:["Right_lacrimal_gland_59102_ID"],59103:["Left_lacrimal_gland_59103_ID"],59505:["Right_major_alar_cartilage_59505_ID"],59506:["Left_major_alar_cartilage_59506_ID"],59512:["Right_lateral_nasal_cartilage_59512_ID"],59513:["Left_lateral_nasal_cartilage_59513_ID"],59545:["Right_lacrimal_sac_59545_ID"],59546:["Left_lacrimal_sac_59546_ID"],59797:["Left_Parotid_Gland_59797_ID","Right_Parotid_Gland_59797_ID"],59798:["Right_Parotid_Gland_59798_ID","Left_Parotid_Gland_59798_ID"],59802:["Right_Submandibular_Gland_59802_ID"],59803:["Left_Submandibular_Gland_59803_ID"],59804:["Right_Sublingual_Gland_59804_ID"],59805:["Left_Sublingual_Gland_59805_ID"],59866:["Right_Parotid_Duct_59866_ID"],59867:["Left_Parotid_Duct_59867_ID"],59964:["Right_Submandibular_Duct_59964_ID"],59965:["Left_Submandibular_Duct_59965_ID"],60180:["Right_osseous_labyrinth_60180_ID"],60181:["Left_osseous_labyrinth_60181_ID"],60188:["Right_Anterior_semicircular_canal_60188_ID"],60189:["Left_Anterior_semicircular_canal_60189_ID"],60191:["Right_Posterior_semicircular_canal_60191_ID"],60192:["Left_Posterior_semicircular_canal_60192_ID"],60194:["Right_Lateral_semicircular_canal_60194_ID"],60195:["Left_Lateral_semicircular_canal_60195_ID"],60202:["Right_Cochlea_60202_ID"],60203:["Left_Cochlea_60203_ID"],61020:["Right_Internal_Ear_61020_ID"],61021:["Left_Internal_Ear_61021_ID"],61735:["Right_external_acoustic_tube_61735_ID"],61736:["Left_external_acoustic_tube_61736_ID"],61965:["fornix_61965_ID"],62008:["hypothalamus_62008_ID"],62033:["Pineal_Gland_62033_ID"],62045:["optic_chiasm_62045_ID"],64919:["Right_Iliopsoas_64919_ID"],64920:["Left_Iliopsoas_64920_ID"],65015:["Left_Flexor_hallucis_longus_65015_ID","Right_Flexor_hallucis_longus_65015_ID"],65019:["Left_Tibialis_posterior_65019_ID","Right_Tibialis_posterior_65019_ID"],65281:["Right_long_thoracic_nerve_65281_ID"],65282:["Left_long_thoracic_nerve_65282_ID"],65536:["Right_lumbosacral_trunk_nerve_65536_ID"],65537:["Left_lumbosacral_trunk_nerve_65537_ID","Left_lumbosacral_trunk_65537_ID"],66321:["Right_thoracodorsal_artery_66321_ID"],66322:["right_thoracodorsal_artery_66322_ID","left_thoracodorsal_artery_66322_ID"],67584:["Left_nerve_of_pterygoid_canal_67584_ID","Right_nerve_of_pterygoid_canal_67584_ID"],67944:["cerebellum_67944_ID"],69316:["Right_Brachiocephalic_trunk_69316_ID"],69490:["Right_lateral_tarsal_artery_69490_ID"],69491:["Left_lateral_tarsal_artery_69491_ID"],69494:["Right_arcuate_artery_69494_ID"],69495:["Left_arcuate_artery_69495_ID"],69514:["Right_deep_plantar_artery_69514_ID"],69515:["Right_deep_plantar_artery_69515_ID"],69516:["Left_deep_plantar_artery_69516_ID"],69726:["Calcaneal_branch_of_right_posterior_tibial_artery_69726_ID"],69727:["Calcaneal_branch_of_left_posterior_tibial_artery_69727_ID"],70249:["Right_femoral_artery_70249_ID"],70250:["Left_femoral_artery_70250_ID"],70799:["Right_dorsal_metacarpal_arteries_70799_ID"],70800:["left_dorsal_metacarpal_arteries_70800_ID","right_dorsal_metacarpal_arteries_70800_ID"],70801:["left_dorsal_digital_arteries_70801_ID","right_dorsal_digital_arteries_70801_ID","Right_dorsal_digital_arteries_70801_ID","Right_palmar_metacarpal_arteries_70801_ID"],70802:["left_palmar_metacarpal_arteries_70802_ID","right_palmar_metacarpal_arteries_70802_ID","Right_common_palmar_digital_arteries_70802_ID"],70803:["right_common_palmar_digital_arteries_70803_ID","Right_proper_palmar_digital_arteries_70803_ID","left_common_palmar_digital_arteries_70803_ID"],70804:["left_proper_palmar_digital_arteries_70804_ID","right_proper_palmar_digital_arteries_70804_ID","left_common_palmar_digital_arteries_70804_ID"],70809:["Set_of_Jejunal_arteries_70809_ID"],70810:["Set_of_ileal_arteries_70810_ID"],70815:["Perforating_arteries_of_left_deep_fibular_artery_70815_ID","Perforating_arteries_of_right_deep_fibular_artery_70815_ID"],70889:["Left_lumbar_vein_70889_ID","Right_lumbar_vein_70889_ID"],70917:["Right_palmar_digital_veins_70917_ID"],70918:["right_palmar_digital_veins_70918_ID","left_palmar_digital_veins_70918_ID"],70922:["Right_distal_perforating_veins_70922_ID","Perforating_veins_of_right_deep_femoral_artery_70922_ID","Perforating_veins_of_left_deep_femoral_artery_70922_ID","Left_distal_perforating_veins_70922_ID"],70927:["Set_of_jejunal_veins_70927_ID"],70928:["Set_of_ileal_veins_70928_ID"],71132:["Gastrointestinal_Tract_71132_ID"],71211:["Right_lateral_thoracic_vein_71211_ID"],71212:["Left_lateral_thoracic_vein_71212_ID","Right_lateral_thoracic_vein_71212_ID"],71214:["Right_thoracodorsal_vein_71214_ID","Left_thoracodorsal_vein_71214_ID"],71215:["Right_thoracodorsal_vein_71215_ID"],71287:["Muscles_of_the_Head_and_Neck_71287_ID"],71291:["Muscles_of_the_Back_71291_ID"],71293:["Muscles_of_the_Thorax_71293_ID"],71310:["Left_Intertransversarii_71310_ID","Right_Intertransversarii_71310_ID"],71398:["Left_Radiate_Sternocostal_Ligaments_71398_ID","Right_Radiate_Sternocostal_Ligaments_71398_ID"],71894:["Right_carpal_bones_71894_ID","Left_carpal_bones_71894_ID"],71898:["Right_metacarpal_bones_of_hand_71898_ID","Left_metacarpal_bones_of_hand_71898_ID"],71900:["Phalanges_of_right_hand_71900_ID","Phalanges_of_left_hand_71900_ID"],72063:["Set_of_cervical_vertebrae_72063_ID"],72064:["Set_of_thoracic_vertebrae_72064_ID"],72065:["Set_of_lumbar_vertebrae_72065_ID"],72309:["Right_Stylohyoid_Ligament_72309_ID"],72311:["Left_Stylohyoid_Ligament_72311_ID"],72316:["Set_of_intervertebral_discs_72316_ID"],72826:["right_caudate_nucleus_72826_ID"],72827:["left_caudate_nucleus_72827_ID"],72828:["right_putamen_72828_ID"],72829:["left_putamen_72829_ID"],72832:["right_amygdaloid_body_72832_ID"],72833:["left_amygdaloid_body_72833_ID"],72856:["right_lateral_globus_pallidus_72856_ID"],72857:["left_lateral_globus_pallidus_72857_ID"],72858:["right_medial_globus_pallidus_72858_ID"],72859:["left_medial_globus_pallidus_72859_ID"],74048:["Right_stapes_74048_ID"],74049:["Left_stapes_74049_ID"],74050:["Right_Incus_74050_ID"],74051:["Left_Incus_74051_ID"],74052:["Right_malleus_74052_ID"],74053:["Left_malleus_74053_ID"],74073:["Right_Levatores_costarum_74073_ID"],74074:["Left_Levatores_costarum_74074_ID"],74075:["Right_Levatores_costarum_longi_74075_ID"],74076:["Left_Levatores_costarum_longi_74076_ID"],74079:["Right_Subcostales_74079_ID"],74080:["Left_Subcostales_74080_ID"],74525:["Occipital_74525_ID"],75150:["Teeth_75150_ID"],75398:["Superficial_dorsal_vein_of_penis_75398_ID"],75492:["Right_common_plantar_digital_nerves_75492_ID"],75493:["Left_common_plantar_digital_nerves_75493_ID"],76767:["Anterior_cardiac_vein_76767_ID"],76829:["Right_Zonula_Fibers_76829_ID","Left_Zonula_Fibers_76829_ID"],77161:["Intermediate_Hepatic_Vein_77161_ID"],77380:["Right_popliteal_artery_77380_ID"],77381:["Left_popliteal_artery_77381_ID"],77596:["Hypogastric_nerve_77596_ID"],77949:["Right_circumflex_scapular_vein_77949_ID"],77950:["Right_circumflex_scapular_vein_77950_ID","Left_circumflex_scapular_vein_77950_ID"],78023:["Right_lateral_brachial_vein_78023_ID"],78024:["right_lateral_brachial_vein_78024_ID","left_lateral_brachial_vein_78024_ID"],78209:["trunk_of_Hepatic_portal_vein_78209_ID"],78508:["Right_tarsal_bones_78508_ID"],78509:["Left_tarsal_bones_78509_ID"],78510:["Right_metatarsal_bones_78510_ID"],79468:["Right_accessory_meningeal_artery_79468_ID"],79469:["Left_accessory_meningeal_artery_79469_ID"],82695:["trunk_of_Hepatic_portal_vein_82695_ID"],82933:["Right_Nerve_to_levator_ani_82933_ID"],82934:["Left_Nerve_to_levator_ani_82934_ID"],85274:["External_Urethral_Sphincter_85274_ID"],86233:["Lymphatics_of_the_Upper_Limb_86233_ID"],86917:["Muscles_of_the_Abdomen_86917_ID"],87217:["Descending_aorta_thoracic_87217_ID","Descending_thoracic_aorta_87217_ID"],228738:["Muscles_of_the_Throat_228738_ID"],231317:["Phalanges_of_the_right_foot_231317_ID"],231319:["Phalanges_of_the_left_foot_231319_ID"],258714:["right_thalamus_258714_ID"],258716:["left_thalamus_258716_ID"],258847:["Right_Calcaneal_Tendon__aka_Achilles_Tendon_258847_ID"],258848:["Left_Calcaneal_Tendon__aka_Achilles_Tendon_258848_ID"],268668:["Right_interosseous_recurrent_artery_268668_ID"],268669:["right_interosseous_recurrent_artery_268669_ID","left_interosseous_recurrent_artery_268669_ID"]},function(){"use strict";var e=Human.clients={};e.numConnections=0,e.addClient=function(t){t({connected:function(){e.numConnections++,Human.events.fire("clients.connected",{})},disconnected:function(){e.numConnections--,Human.events.fire("clients.disconnected",{})}})}}(),Human.clients.addClient((function(e){"use strict";var t,r,a=[];function i(e){var i=JSON.stringify(e);t?t.postMessage(i,r):a.push(i)}Human.events.on("started",(function(){i({message:"status",status:"ready"})})),window.addEventListener?(Human.events.on("error",(function(e){i({error:e})})),Human.rpc.onResult((function(e,t){var r={};r[e]=Human.rpc.filterUnsafeProperties(t),i({results:r})})),addEventListener("message",(function(n){var o;try{o=JSON.parse(n.data)}catch(s){return}"connect"===o.action?t||(Human.log.info("Human.clients.windowClient","Client connected"),e.connected(),t=n.source,r=n.origin,i({message:"connected"}),function(){for(;a.length>0;)t.postMessage(a.pop(),r)}()):o.call&&function(e){!function(e){if(Human.rpc.windowClientEnabled)try{Human.rpc.call(e.id,e.call,e.params),Human.rpc.log(e.call)}catch(s){Human.log.error("Human.clients.windowClient","Error executing RPC call [callId: "+e.id+", procedure: "+e.call+"]: "+s)}}(e)}(o)}),!1)):Human.log.error("Human.clients.windowClient","Browser does not support cross-window messaging")})),function(){"use strict";var e=Human.cookies={};e.setCookie=function(e,t,r){var a;if(r){var i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3),a="; expires="+i.toGMTString()}else a="";document.cookie=e+"="+t+a+"; path=/"},e.getCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var i=r[a];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null},e.eraseCookie=function(t){e.setCookie(t,"",-1)}}(),function(){"use strict";var e=Human.init={};e.bookmark={},e.cameraBookmark={},e.saveReset=function(){var t=Human.bookmarks.capture(),r=t.modules;if(r){var a=r.active;a&&a.length>1&&(r.active=[r.active[0]])}e.bookmark=t,Human.timeline.activeRoot&&(e.bookmark.camera=Human.timeline.activeRoot._chapters[0].camera.location)},e.reset=function(t){if(!e.bookmark)return Human.log.error("Human.init.reset","Bookmark for reset was not captured"),void(t&&t());Human.renderer.lights.restoreDefaults(),Human.bookmarks.restore(e.bookmark,(function(){Human.events.fire("init.reset"),t&&t()}),(function(e){Human.log.error("Human.init.reset","Reset failed: "+e),t&&t()}))},e.resetCamera=function(t){var r=Human.timeline.getCurrentChapterCamera();if(r)Human.renderer.camera.fly.flyTo(r,t);else{var a,i,n=Human.modules.activeModules;for(var o in n)n.hasOwnProperty(o)&&(i=n[o]).camera&&i.timeActivated>0&&(a=i);if(!a)return e.bookmark?void Human.renderer.camera.fly.flyTo(e.bookmark.camera,t):(Human.log.error("Human.init.resetCamera","Bookmark for reset was not captured"),void(t&&t()));Human.renderer.camera.fly.flyTo(a.camera,t)}},e.init=function(e){Human.renderer.init(),Human.assets.init(),Human.events.fire("loaded"),e&&e()},e.start=function(){e.saveReset(),Human.events.fire("started")}}(),function(){"use strict";var e,t,r,a=!1,i=Human.renderer={highlightColor:new Float32Array([1.5,1.5,.5]),xrayBGColor:new Float32Array([.2,.2,.3]),frameRateThrottled:!1,testContextLoss:!1,viewportDirty:!0,lastFrameStats:{cpuTime:0}},n={alpha:SceneJS.TRANSPARENCY_FLAGS.ALPHA,improvedAlpha:SceneJS.TRANSPARENCY_FLAGS.IMPROVED_ALPHA,addAlpha:SceneJS.TRANSPARENCY_FLAGS.ADD_ALPHA,alphaToCoverage:SceneJS.TRANSPARENCY_FLAGS.ALPHA_TO_COVERAGE,weightedOIT:SceneJS.TRANSPARENCY_FLAGS.WEIGHTED_OIT},o=!1,s=!1,l=!1,c=SceneJS.DISPLAY_FLAGS.FOG_LINEAR,u=.01,_=0,h=1e3,f=0,d=1,p=new Float32Array([1,1,1]),m=0,g=0,y=1,v=0,S={timeStarted:0,timeLast:0,timeNow:0,tick:0},b={frameStart:0,lastFrameStart:0},E={frameStart:0,frameEnd:0,lastFrameEnd:0},I=mat4.create(),x=mat4.create(),C=vec3.create(),T=vec4.create();Human.properties.subscribe({propId:"highlight.color",value:i.highlightColor,callback:function(e){i.highlightColor=e,o=!0}}),Human.properties.subscribe({propId:"fog.enabled",value:l,callback:function(e){l=e,o=!0}}),Human.properties.subscribe({propId:"fog.mode",value:c,callback:function(e){c=e,o=!0}}),Human.properties.subscribe({propId:"fog.start",value:_,callback:function(e){_=e,o=!0}}),Human.properties.subscribe({propId:"fog.end",value:h,callback:function(e){h=e,o=!0}}),Human.properties.subscribe({propId:"fog.min",value:f,callback:function(e){f=e,o=!0}}),Human.properties.subscribe({propId:"fog.max",value:d,callback:function(e){d=e,o=!0}}),Human.properties.subscribe({propId:"fog.density",value:u,callback:function(e){u=e,o=!0}}),Human.properties.subscribe({propId:"fog.color",value:p,callback:function(e){p=e,o=!0}}),i.init=function(){SceneJS.WEBGL_INFO.SOFTWARE_RENDERER&&Human.log.error("This browser is using a software renderer for WebGL. Expect substantially reduced rendering performance.");var t=Date.now(),r=t,n=0;SceneJS.setMaxPointSize(255),e=this.graph.init(),this.postprocess.init(e),this.canvas.init(),this.lights.init(),this.setXrayBGColor(this.xrayBGColor),requestAnimationFrame((function I(){if(requestAnimationFrame(I),!(s||++v<y)){v=0;var x=Human.timer.now();b.frameStart=Human.timer.now(),Human.events.fire("frameStart",b),b.lastFrameStart=b.frameStart,o&&(e.setFogEnabled(l),e.setFogMode(c),e.setFogStart(_),e.setFogEnd(h),e.setFogMin(f),e.setFogMax(d),e.setFogDensity(u),e.setFogColor(p[0],p[1],p[2]),o=!1),i.viewportDirty&&(e.setViewport(0,0,i.canvas.width,i.canvas.height),i.viewportDirty=!1);var C=Human.timer.now();S.timeStarted=t,S.timeLast=r,S.timeNow=C,S.tick=n,Human.events.fire("tick",S),r=C,n++,i.frameRateThrottled||(g+=e.stats.frame.cpuTime,100==++m&&(g/m>14&&(i.setTicksPerRender(2),i.frameRateThrottled=!0),g=0,m=0)),i.prepareFrame(S),a&&e.render(),E.frameStart=b.frameStart,E.frameEnd=Human.timer.now(),Human.events.fire("frameEnd",E),E.lastFrameEnd=E.frameEnd,i.lastFrameStats.cpuTime=Human.timer.now()-x}}))},i.prepareFrame=function(){Human.timeline.onFrame(),Human.renderer.lights.onFrame(),Human.renderer.clip.onFrame(),Human.renderer.camera.onFrame(),Human.scene.onFrame(),Human.scene.markers.onFrame(),Human.events.fire("cull",S),Human.scene.cull()},i.updateDisplayForBG=function(){o=!0},i.pushPause=function(){i._pauses=i._pauses?i._pauses+1:1,1===i._pauses&&(s=!0)},i.popPause=function(){i._pauses&&0==--i._pauses&&(s=!1,e.render())},i.pauseCompilation=function(){e.pauseCompilation()},i.resumeCompilation=function(){e.resumeCompilation()},i.setTicksPerRender=function(e){y=e,v=0},i.resetFrameThrottling=function(){i.frameRateThrottled&&(i.setTicksPerRender(1),i.frameRateThrottled=!1)},i.setTransparencyMode=function(t){var r=n[t];void 0!==r?(e.setTransparencyMode(r),"alphaToCoverage"===t?Human.renderer.postprocess.disable():Human.renderer.postprocess.enable()):Human.log.error("Unrecognized transparency mode: "+t)},i.setDepthSort=function(t){e.setDepthSort(t)},i.onTasksComplete=function(e){null!=i._pauses&&i._pauses>0&&Human.log.error("Human.renderer.onTaskComplete","Renderer deadlock: Human.renderer.pushPause has paused renderer. Renderer needs to be unpaused in order to complete pending tasks.");var t=Human.renderer.getScene().getStatus().numTasks;if(t&&0!==t){if(i.__checkLoaded)throw"Human.renderer.onTasksComplete: already blocking";i.__checkLoaded=window.setInterval((function(){var t=Human.renderer.getScene().getStatus().numTasks;t&&0!==t||(window.clearInterval(i.__checkLoaded),i.__checkLoaded=null,e())}),200)}else e()},Human.renderer.canIRender=function(){return a},i.enableRender=function(){a=!0},i.disableRender=function(){a=!1},i.compile=function(){e.compile()},i.forceRenderFrame=function(t){(t=t||{}).force=!0,e.render(t)},i.getScene=function(){return e},i.getLibraryRoot=function(){return e},i.getNode=function(t){return e.findNode(t)},i.nodeExists=function(t){return null!=e.findNode(t)},i.loseContext=function(){e.loseWebGLContext()},i.getViewMat=function(){return e.getViewMatrix()},i.getProjMat=function(){return e.getProjectionMatrix()},i.checkWebGLExtension=function(e){return SceneJS.checkExtension(e)},i.setXrayBGColor=function(t){this.xrayBGColor.set(t),e.setXrayColor(t[0],t[1],t[2])},i.viewPositionToCanvas=function(e,t){var r=i.getProjMat();T.set(e),T[3]=1,vec4.transformMat4(T,T,r);var a=T[3];return t[0]=.5*this.canvas.width*(1+T[0]/a),t[1]=.5*this.canvas.height*(1-T[1]/a),t},i.worldPositionToCanvas=function(e,t){return vec3.transformMat4(C,e,i.getViewMat()),i.viewPositionToCanvas(C,t)},i.getResolutionScalingSupported=(t=!1,r=!1,function(){var e,a,n,o,s,l,c;return t||(e=Element.prototype,a=Function.call.bind(Array.prototype.slice),n=Function.call.bind(e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector||e.oMatchesSelector),o=function(e,t){return e in t.style&&""!==t.style[e]},s=a(document.styleSheets).reduce((function(e,t){return e.concat(a(t.cssRules))}),[]).filter((function(e,t){return n(e,t.selectorText)}).bind(null,i.canvas.canvas)),l=o.bind(null,"width"),c=o.bind(null,"height"),r=s.some(l)&&s.some(c),t=!0),r}),i.setResolutionScaling=function(t){t<1&&(t=1),e.setResolutionScaling(t)},i.canvasPositionToWorldRay=function(e,t,r,a){var i=2*e/Human.renderer.canvas.width-1,n=1-2*t/Human.renderer.canvas.height,o=Human.renderer.camera.eye;r[0]=o.x,r[1]=o.y,r[2]=o.z,a[0]=i,a[1]=n,a[2]=.5;var s=mat4.invert(I,this.getProjMat()),l=mat4.invert(x,this.getViewMat());vec3.transformMat4(a,a,s),vec3.transformMat4(a,a,l),vec3.subtract(a,a,r),vec3.normalize(a,a)};var N=vec3.create(),A=vec3.create(),D=vec3.create(),M=vec3.create(),P=vec3.create(),w=vec3.create();i.canvasCircleToWorldSphereRadius=function(e,t,r,a){this.canvasPositionToWorldRay(e,t+r,P,w);var i=Human.renderer.camera.getLookDir(C),n=vec3.dot(i,w);if(n>.001){vec3.subtract(N,a,P);var o=vec3.dot(N,i)/n;return vec3.scale(D,w,o),vec3.add(A,P,D),vec3.subtract(M,A,a),vec3.length(M)}return 0}}(),function(){"use strict";var e,t={xform:1,properties:2,texture:3,material:3,cubemap:3,fresnel:3,billboard:3,morphGeometry:4,geometry:5},r=Human.renderer.graph={libraryRootNode:null},a={type:"scene",canvasId:Human.canvasId,transparent:!0,contextAttr:{preserveDrawingBuffer:!1,antialias:!0}};r.init=function(){return a.canvasId=Human.canvasId,e=SceneJS.createScene(a,{simulateWebGLContextLost:Human.renderer.testContextLoss}),this.libraryRootNode=e.addNode({type:"library"}),e.setCamera({eye:[0,0,55],look:[0,0,0],up:[0,1,0]}),e.setProjection({type:"perspective",fov:60,near:.01,far:400,fovAxis:"y",pan:{x:0,y:0,z:0}}),e},r.createSubtree=function(t){return e.addNode(t)},r.insertNode=function(e,r){r instanceof SceneJS.Node?r.parent&&"library"===r.parent.type?r.disconnect():r={type:r.type,coreId:r.getCoreId()}:"reflect"===r.type&&(r.type="cubemap");for(var a=t[r.type],i=e;i;){if(a<(t[i.type]?t[i.type]:0)){var n=i.parent;return i.disconnect(),(r=n.addNode(r)).addNode(i),r}if(0===i.nodes.length)return i.addNode(r);i=i.nodes[0]}},r.disconnectNode=function(e){var t=e.parent,r=e.disconnectNodes();e.disconnect(),t.addNodes(r)},r.destroySubtree=function(e){e.destroy()}}(),function(){"use strict";var e=Human.renderer.bg={},t=null;e.getBGColor=function(){var e=null;if(t){e=[];for(var r=0;r<t.length;r++)e.push(t[r])}return e},e.setBGColor=function(e){Array.isArray(e)&&(t=e)}}(),function(){"use strict";function e(){var e=Human.renderer.canvas.canvas,t=Human.renderer.canvas.annotationCanvas,r=e.parentNode,a=r.clientWidth,i=r.clientHeight;Human.renderer.canvas.width=a,Human.renderer.canvas.height=i,e.width=a,e.height=i,t.width=a,t.height=i,Human.renderer.viewportDirty=!0,Human.renderer.camera.updateCanvas(),Human.renderer.postprocess.updateCanvas(),Human.renderer.draw.updateCanvas(),Human.events.fire("canvas.resized",{canvasWidth:a,canvasHeight:i})}Human.renderer.canvas={canvas:null,annotationCanvas:null,context2D:null,width:0,height:0},Human.renderer.canvas.init=function(){this.canvas=document.getElementById(Human.canvasId),this.annotationCanvas=document.getElementById(Human.annotationCanvasId),this.context2D=this.annotationCanvas.getContext("2d"),this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,e()},Human.renderer.resize=e,window.addEventListener("resize",e)}(),function(){"use strict";var e=Human.renderer.camera={FRUSTUM_TOP:0,FRUSTUM_BOTTOM:1,FRUSTUM_LEFT:2,FRUSTUM_RIGHT:3,FRUSTUM_NEAR:4,FRUSTUM_FAR:5,autoSetNearFar:!0,nearFarDirty:!1},t=vec3.create(),r=vec3.create(),a=vec3.create(),i=vec3.create(),n=vec3.create(),o=vec3.create(),s=vec3.create(),l=vec3.create(),c=vec3.create(),u=vec3.create(),_=vec3.create(),h=vec3.create(),f=mat4.create(),d=[{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0}],p=!0;e.eye={x:0,y:0,z:-80},e.look={x:0,y:0,z:0},e.up={x:0,y:1,z:0},e.rotationCenter=vec3.create(),e.lookDistance=80,e._screenPan={x:0,y:0,z:0},e._startcamera={eye:e.eye,look:e.look,up:e.up};var m=!0,g=!0,y=!1;e.lock=!1,e.aspect=1,e.fovy=55,Human.properties.subscribe({propId:"camera.optics.fov",value:e.fovy,callback:function(t){e.fovy=t,g=!0}}),e.near=.1,e.far=5e3,e.minZoom=.01,e.maxZoom=150,Human.properties.subscribe({propId:"camera.zoomLimits",value:{min:.01,max:150},callback:function(t){t.min<.01?Human.log.error("Human.renderer.camera","Property 'camera.zoomLimits.min' too small - should be >= 0.01"):t.min>=t.max?Human.log.error("Human.renderer.camera","Property 'camera.zoomLimits.min' should be less than camera.zoomLimits.max"):(e.minZoom=t.min,e.maxZoom=t.max,m=!0)}}),e.updateCanvas=function(){e.setAspect(Human.renderer.canvas.width/Human.renderer.canvas.height)},e.setLookAt=function(a){var i=a.look||e.look,n=a.up||e.up;e.eye=a.eye||e.eye,e.look=i,e.up=n,Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),e.lookDistance=vec3.distance(t,r),a.look&&!a.preserveCenter&&this.setRotationCenter(a.look.x,a.look.y,a.look.z),m=!0},e.setRotationCenter=function(t,r,a){e.rotationCenter[0]=t,e.rotationCenter[1]=r,e.rotationCenter[2]=a},e.getLookAt=function(){return{eye:e.eye,look:e.look,up:e.up}},e.getLookDir=function(e){var t=this.eye,r=this.look;return e[0]=r.x-t.x,e[1]=r.y-t.y,e[2]=r.z-t.z,vec3.normalize(e,e),e},e.setScreenPan=function(t){e._screenPan.x=t.x||0,e._screenPan.y=t.y||0,e._screenPan.z=t.z||0,g=!0},e.getScreenPan=function(){return e._screenPan},e._reset={eye:{x:e.eye.x,y:e.eye.y,z:e.eye.z},look:{x:e.look.x,y:e.look.y,z:e.look.z},up:{x:e.up.x,y:e.up.y,z:e.up.z}},e.reset=function(){e.yaw=0,e.pitch=90,e._eye={x:e._reset.eye.x,y:e._reset.eye.y,z:e._reset.eye.z},e._look={x:e._reset.look.x,y:e._reset.look.y,z:e._reset.look.z},e._up={x:e._reset.up.x,y:e._reset.up.y,z:e._reset.up.z},e.rotationCenter.set([e._reset.look.x,e._reset.look.y,e._reset.look.z]),m=!0},e.rotateY=function(i){if(!e.lock){Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),Human.math.vec3ObjToArray(e.up,a),vec3.subtract(t,t,e.rotationCenter),vec3.subtract(r,r,e.rotationCenter);var n=Human.math.sign(a[1])||1;mat4.fromRotation(f,n*i*.0174532925,Human.math.Y_AXIS),vec3.transformMat4(t,t,f),vec3.transformMat4(r,r,f),vec3.transformMat4(a,a,f),vec3.add(t,t,e.rotationCenter),vec3.add(r,r,e.rotationCenter),e.setLookAt({eye:{x:t[0],y:t[1],z:t[2]},look:{x:r[0],y:r[1],z:r[2]},up:{x:a[0],y:a[1],z:a[2]},preserveCenter:!0})}},e.rotateX=function(n){e.lock||(Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),Human.math.vec3ObjToArray(e.up,a),vec3.subtract(t,t,e.rotationCenter),vec3.subtract(r,r,e.rotationCenter),vec3.subtract(c,r,t),vec3.normalize(c,c),vec3.normalize(u,a),vec3.cross(i,u,c),mat4.fromRotation(f,.0174532925*n,i),vec3.transformMat4(t,t,f),vec3.transformMat4(r,r,f),vec3.transformMat4(a,a,f),vec3.add(t,t,e.rotationCenter),vec3.add(r,r,e.rotationCenter),e.setLookAt({eye:{x:t[0],y:t[1],z:t[2]},look:{x:r[0],y:r[1],z:r[2]},up:{x:a[0],y:a[1],z:a[2]},preserveCenter:!0}))};var v=vec3.create();e.pan=function(n){if(!e.lock){if(Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),Human.math.vec3ObjToArray(e.up,a),vec3.subtract(v,t,r),l[0]=l[1]=l[2]=0,void 0!==n.x){vec3.normalize(c,v),vec3.normalize(u,a);var o=vec3.cross(i,v,a);vec3.normalize(o,vec3.cross(i,v,a)),vec3.scale(h,o,n.x),l[0]+=h[0],l[1]+=h[1],l[2]+=h[2]}void 0!==n.y&&(vec3.normalize(u,a),vec3.scale(h,u,n.y),l[0]+=h[0],l[1]+=h[1],l[2]+=h[2]),void 0!==n.z&&(vec3.normalize(c,t),vec3.scale(h,c,n.z),l[0]+=h[0],l[1]+=h[1],l[2]+=h[2]),vec3.add(t,t,l),vec3.add(r,r,l),e.setLookAt({eye:{x:t[0],y:t[1],z:t[2]},look:{x:r[0],y:r[1],z:r[2]},preserveCenter:!0})}},e.setAspect=function(t){e.aspect=t,g=!0},e.viewRight=function(){if(!e.lock){var t=Human.init.bookmark.camera.eye,r=t.y;e.setLookAt({look:{x:0,y:r,z:0},eye:{x:-t.z,y:r,z:0},up:{x:0,y:1,z:0}})}},e.viewLeft=function(){if(!e.lock){var t=Human.init.bookmark.camera.eye,r=t.y;e.setLookAt({look:{x:0,y:r,z:0},eye:{x:t.z,y:r,z:0},up:{x:0,y:1,z:0}})}},e.viewPosterior=function(){if(!e.lock){var t=Human.init.bookmark.camera.eye,r=t.y;e.setLookAt({look:{x:0,y:r,z:0},eye:{x:0,y:r,z:-t.z},up:{x:0,y:1,z:0}})}},e.viewAnterior=function(){if(!e.lock){var t=Human.init.bookmark.camera.eye,r=t.y;e.setLookAt({look:{x:0,y:r,z:0},eye:{x:0,y:r,z:t.z},up:{x:0,y:1,z:0}})}},e.viewSuperior=function(){if(!e.lock){var t=Human.init.bookmark.camera.eye,r=t.y;e.setLookAt({look:{x:0,y:r,z:0},eye:{x:0,y:-t.z+r,z:0},up:{x:0,y:0,z:1}})}},e.viewInferior=function(){if(!e.lock){var t=Human.init.bookmark.camera.eye,r=t.y;e.setLookAt({look:{x:0,y:r,z:0},eye:{x:0,y:t.z+r,z:0},up:{x:0,y:0,z:-1}})}},e.zoom=function(a){if(!e.lock){Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),vec3.subtract(t,t,r);var i=Math.abs(vec3.length(t)),n=Math.abs(i+a);e.minZoom&&e.maxZoom&&(a=40*a*(i/e.maxZoom*.6),(n=Math.abs(i+a))<e.minZoom?n=e.minZoom:n>e.maxZoom&&(n=e.maxZoom)),vec3.normalize(c,t),vec3.scale(t,c,n),vec3.add(t,r,t),e.setLookAt({eye:{x:t[0],y:t[1],z:t[2]},preserveCenter:!0})}},e.setZoom=function(a){e.lock||(Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),vec3.subtract(t,t,r),vec3.normalize(c,t),vec3.scale(t,c,e.minZoom+(1-a)*(e.maxZoom-e.minZoom)),vec3.add(t,r,t),e.setLookAt({eye:{x:t[0],y:t[1],z:t[2]},preserveCenter:!0}))},e.getZoom=function(){return Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),vec3.subtract(t,t,r),1-(Math.abs(vec3.length(t))-e.minZoom)/e.maxZoom},e.setZoomPercent=function(a){e.lock||(Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),vec3.subtract(t,t,r),vec3.normalize(c,t),vec3.scale(t,c,e.minZoom+.01*(100-a)*(e.maxZoom-e.minZoom)),e.setLookAt({eye:{x:r[0]+t[0],y:r[1]+t[1],z:r[2]+t[2]},preserveCenter:!0}))},e.getZoomPercent=function(){return Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),vec3.subtract(t,t,r),100-(Math.abs(vec3.length(t))-e.minZoom)/e.maxZoom*100},e.getFrustum=function(){return p&&(function(){var i=e,l=i.near,c=i.far,u=i.aspect,f=i.fovy*Math.PI/180;t[0]=i.eye.x,t[1]=i.eye.y,t[2]=i.eye.z,r[0]=i.look.x,r[1]=i.look.y,r[2]=i.look.z,a[0]=i.up.x,a[1]=i.up.y,a[2]=i.up.z;var p=Math.tan(.5*f)*l,m=p*u;vec3.subtract(_,r,t),vec3.normalize(_,_),vec3.cross(n,_,a),vec3.normalize(n,n),vec3.cross(a,n,_),vec3.scale(h,_,l),vec3.add(o,t,h),vec3.scale(h,_,c),vec3.add(s,t,h),vec3.scale(d[i.FRUSTUM_NEAR].n,_,-1),d[i.FRUSTUM_NEAR].d=-vec3.dot(o,d[i.FRUSTUM_NEAR].n),d[i.FRUSTUM_FAR].n.set(_),d[i.FRUSTUM_FAR].d=-vec3.dot(s,d[i.FRUSTUM_FAR].n),vec3.scale(h,n,m),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(d[i.FRUSTUM_RIGHT].n,h,a),d[i.FRUSTUM_RIGHT].d=-vec3.dot(t,d[i.FRUSTUM_RIGHT].n),vec3.scale(h,n,-m),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(d[i.FRUSTUM_LEFT].n,a,h),d[i.FRUSTUM_LEFT].d=-vec3.dot(t,d[i.FRUSTUM_LEFT].n),vec3.scale(h,a,p),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(d[i.FRUSTUM_TOP].n,n,h),d[i.FRUSTUM_TOP].d=-vec3.dot(t,d[i.FRUSTUM_TOP].n),vec3.scale(h,a,-p),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(d[i.FRUSTUM_BOTTOM].n,h,n),d[i.FRUSTUM_BOTTOM].d=-vec3.dot(t,d[i.FRUSTUM_BOTTOM].n)}(),p=!1),d},e.getSubRegionFrustum=function(i,l,c,u){var f=e,d=f.near,p=f.far,m=f.aspect,g=f.fovy*Math.PI/180;t[0]=f.eye.x,t[1]=f.eye.y,t[2]=f.eye.z,r[0]=f.look.x,r[1]=f.look.y,r[2]=f.look.z,a[0]=f.up.x,a[1]=f.up.y,a[2]=f.up.z,vec3.subtract(_,r,t),vec3.normalize(_,_),vec3.cross(n,_,a),vec3.normalize(n,n),vec3.cross(a,n,_),vec3.normalize(a,a),vec3.scale(h,_,d),vec3.add(o,t,h);var y=[{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0},{n:vec3.create(),d:0}],v=Math.tan(.5*g)*d,S=v*m,b=Human.renderer.canvas.width/2,E=Human.renderer.canvas.height/2,I=(i-b)/b,x=I+c/b,C=(E-l)/E,T=C-u/E;return y[e.FRUSTUM_NEAR].n.set(_),y[e.FRUSTUM_NEAR].d=-vec3.dot(y[e.FRUSTUM_NEAR].n,o),vec3.scale(h,_,p),vec3.add(s,t,h),y[e.FRUSTUM_FAR].n.set([-_[0],-_[1],-_[2]]),y[e.FRUSTUM_FAR].d=-vec3.dot(y[e.FRUSTUM_FAR].n,s),vec3.scale(h,n,I*S),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(h,h,a),vec3.normalize(h,h),y[e.FRUSTUM_LEFT].n.set(h),y[e.FRUSTUM_LEFT].d=-vec3.dot(h,t),vec3.scale(h,n,x*S),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(h,a,h),vec3.normalize(h,h),y[e.FRUSTUM_RIGHT].n.set(h),y[e.FRUSTUM_RIGHT].d=-vec3.dot(h,t),vec3.scale(h,a,T*v),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(h,n,h),vec3.normalize(h,h),y[e.FRUSTUM_BOTTOM].n.set(h),y[e.FRUSTUM_BOTTOM].d=-vec3.dot(h,t),vec3.scale(h,a,C*v),vec3.add(h,o,h),vec3.subtract(h,h,t),vec3.normalize(h,h),vec3.cross(h,h,n),vec3.normalize(h,h),y[e.FRUSTUM_TOP].n.set(h),y[e.FRUSTUM_TOP].d=-vec3.dot(h,t),y},e.onFrame=function(){if(m?(Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),Human.math.vec3ObjToArray(e.up,a),Human.renderer.getScene().setCamera({eye:t,look:r,up:a}),vec3.subtract(h,t,r),Human.events.fire("camera.updated",{eye:e.eye,look:e.look,up:e.up,dist:Math.abs(vec3.length(h))}),y=!1,m=!1,p=!0,e.nearFarDirty=!0):y||(y=!0,Human.math.vec3ObjToArray(e.eye,t),Human.math.vec3ObjToArray(e.look,r),vec3.subtract(h,t,r),Human.events.fire("camera.rested",{eye:e.eye,look:e.look,up:e.up,dist:Math.abs(vec3.length(h))})),e.autoSetNearFar&&e.nearFarDirty){var i=Human.scene.getBoundary(),n=Human.particles.getBoundary(),o=Math.min(i.xmin,n.xmin),s=Math.min(i.ymin,n.ymin),l=Math.min(i.zmin,n.zmin),c=Math.max(i.xmax,n.xmax),u=Math.max(i.ymax,n.ymax),_=Math.max(i.zmax,n.zmax),f=Human.renderer.getViewMat(),d=f[2],v=f[6],S=f[10],b=f[14],E=c-o,I=u-s,x=_-l,C=Math.sqrt(E*E+I*I+x*x),T=o*d+s*v+l*S+b;isFinite(T)&&(T=Math.max(T,c*d+s*v+l*S+b),T=Math.max(T,o*d+u*v+l*S+b),T=Math.max(T,o*d+s*v+_*S+b),T=Math.max(T,c*d+u*v+l*S+b),T=Math.max(T,c*d+s*v+_*S+b),T=Math.max(T,o*d+u*v+_*S+b),T=Math.max(T,c*d+u*v+_*S+b),e.near=Math.max(-T,.1),e.far=e.near+C,e.nearFarDirty=!1,g=!0)}g&&(Human.renderer.getScene().setProjection({type:"perspective",fov:e.fovy,near:e.near,far:e.far,aspect:e.aspect,pan:e._screenPan}),g=!1,p=!0,Human.renderer.postprocess.updateProjection())}}(),function(){"use strict";(Human.renderer.pick={}).pick=function(e,t,r){var a=Human.renderer.getScene();if(!a)return null;var i={objectId:null},n=null,o=a.pick(e,t,r)||null;if(o){n=Human.scene.objects[o.name];var s=o.objectId;if(i=Human.utils.apply(o,i),n&&(i.objectId=n.objectId,s))for(var l=0,c=n.renderables.length;l<c;++l){var u=n.renderables[l].getRenderObject();if(u&&u.id===s){i.renderableIndex=l;break}}}return n?Human.events.fire("pick.picked",i):Human.events.fire("pick.missed",i),i}}(),function(){"use strict";var e=Human.renderer.clip={};e.LEFT=0,e.RIGHT=1,e.BOTTOM=2,e.TOP=3,e.FRONT=4,e.BACK=5;var t=[{n:new Float32Array([-1,0,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([1,0,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,-1,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,1,0]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,0,-1]),d:0,fade:!1,fadeDistance:0},{n:new Float32Array([0,0,1]),d:0,fade:!1,fadeDistance:0}],r={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,zmin:1/0,zmax:-1/0},a=new Array(t.length),i=new Float32Array(t.length),n=new Array(t.length),o=[],s=!0,l={left:e.LEFT,right:e.RIGHT,bottom:e.BOTTOM,top:e.TOP,front:e.FRONT,back:e.BACK},c=null,u=null,_=mat4.create(),h=mat4.create(),f=mat4.create(),d=mat4.create(),p=vec3.create(),m=vec3.fromValues(1,1,1);e.setClip=function(r){var o=void 0!==l[r.clipId]?l[r.clipId]:r.clipId,c=t[o],u=n[o]=r.boundary||Human.scene.getBoundary();if(void 0!==r.enabled&&(a[o]=r.enabled),void 0!==r.fade&&(c.fade=r.fade),void 0!==r.fadeDistance&&(c.fadeDistance=r.fadeDistance),void 0!==r.progress){var _=i[o]=r.progress,h=0,f=0;o!==e.LEFT&&o!==e.RIGHT||(f=u.xmin+.5*(h=u.xmax-u.xmin)),o!==e.TOP&&o!==e.BOTTOM||(f=u.ymin+.5*(h=u.ymax-u.ymin)),o!==e.FRONT&&o!==e.BACK||(f=u.zmin+.5*(h=u.zmax-u.zmin)),o!==e.LEFT&&o!==e.BOTTOM&&o!==e.FRONT||(f*=-1),_=1-_,c.d=-((_-=.5)*h+f)}s=!0,Human.events.fire("clip.updated",{clipId:o,progress:r.progress||this.getProgress(o),enabled:!!a[o],fade:c.fade,fadeDistance:c.fadeDistance})},e.getActiveClips=function(){return o},e.isEnabled=function(e){return!!a[l[e]||e]},e.getProgress=function(e){return i[l[e]||e]},e.serialize=function(){for(var e={},r=0,o=t.length;r<o;++r)e[r]={clipId:r,enabled:!!a[r],progress:i[r],fade:t[r].fade,fadeDistance:t[r].fadeDistance,boundary:n[r]};return e},e.show=function(r){c||(c=Human.renderer.getScene().addNode({type:"properties",properties:{enabled:!1,backfaces:!0,clipping:!1,picking:!1,noDepthMask:!0}}),(u=c.addNode({type:"xform"})).addNode({type:"material",emit:.9,baseColor:{r:.3,g:.3,b:.4},specularColor:{r:.3,g:.3,b:.4},specular:0,shine:100,alpha:.2,nodes:[{type:"geometry/plane"}]}));var a=t[r],i=Human.scene.getBoundary(),n=i.xmax-i.xmin,o=i.ymax-i.ymin,s=i.zmax-i.zmin,l=.5*(i.xmin+i.xmax),g=.5*(i.ymin+i.ymax),y=.5*(i.zmin+i.zmax);c.setEnabled(!0),r!==e.LEFT&&r!==e.RIGHT||(mat4.fromYRotation(h,.5*Math.PI),p[0]=-a.d*a.n[0],p[1]=g,p[2]=y,m[0]=s,m[1]=o),r!==e.TOP&&r!==e.BOTTOM||(mat4.fromXRotation(h,.5*Math.PI),p[0]=l,p[1]=-a.d*a.n[1],p[2]=y,m[0]=n,m[1]=s),r!==e.FRONT&&r!==e.BACK||(mat4.identity(h),p[0]=l,p[1]=g,p[2]=-a.d*a.n[2],m[0]=n,m[1]=o),mat4.fromScaling(f,m),mat4.fromTranslation(_,p),mat4.multiply(d,h,f),mat4.multiply(d,_,d),u.setElements(d)},e.hide=function(){c&&c.setEnabled(!1)},e.reset=function(){for(var e=0,r=t.length;e<r;++e)a[e]=!1;s=!0,Human.events.fire("CrossSections.Reset")},e.onFrame=function(){if(s){o.length=0;for(var e=0,r=t.length;e<r;++e)a[e]&&o.push(t[e]);Human.renderer.getScene().setClips(o),s=!1}},e.getBoundary=function(){return r.xmin=a[e.LEFT]?t[e.LEFT].d:-1/0,r.xmax=a[e.RIGHT]?-t[e.RIGHT].d:1/0,r.ymin=a[e.BOTTOM]?t[e.BOTTOM].d:-1/0,r.ymax=a[e.TOP]?-t[e.TOP].d:1/0,r.zmin=a[e.BACK]?t[e.BACK].d:-1/0,r.zmax=a[e.FRONT]?-t[e.FRONT].d:1/0,r}}(),function(){"use strict";var e=Human.renderer.lights={};e.lights={},e.defaultLightIds=[];var t=[],r=!0,a=!0;e.init=function(){e.addLight({lightId:"light0",enabled:!0,params:{mode:"ambient",color:{r:.2,g:.2,b:.2,diffuse:!0}}}),e.addLight({lightId:"light1",enabled:!0,params:{mode:"dir",dir:{x:1,y:0,z:-.5},color:{r:.1,g:.1,b:.2},diffuse:!0,specular:!0,space:"view"}}),e.addLight({lightId:"light2",enabled:!0,params:{mode:"dir",dir:{x:-1,y:0,z:1},color:{r:.55,g:.5,b:.5},diffuse:!0,specular:!0,space:"view"}}),e.addLight({lightId:"light3",enabled:!0,params:{mode:"dir",dir:{x:.25,y:0,z:-1},color:{r:.9,g:.9,b:.9},diffuse:!0,specular:!1,space:"view"}}),e.defaultLightIds.push("light0"),e.defaultLightIds.push("light1"),e.defaultLightIds.push("light2"),e.defaultLightIds.push("light3")},e.addLight=function(i){e.lights.hasOwnProperty(i.lightId)?Human.log.warn("Human.renderer.lights.addLights","The lightId already exists: "+i.lightId):(e.lights[i.lightId]={lightId:i.lightId,enabled:!!i.enabled,params:i.params,index:t.length},r=!0,a=!0)},e.addLights=function(t){for(var r in t)t.hasOwnProperty(r)&&e.addLight(t[r])},e.removeLight=function(t){e.lights[t]&&(delete e.lights[t],r=!0,a=!0)},e.removeAllLights=function(){e.lights={},t.length=0,a=!0},e.removeCustomLights=function(){for(var t in e.lights)e.lights.hasOwnProperty(t)&&e.defaultLightIds.indexOf(t)<0&&(delete e.lights[t],a=!0)},e.setEnabled=function(t){var i=!1;for(var n in t){var o=e.lights[n];if(o){var s=!!t[n];o.enabled!==s&&(o.enabled=s,i=!0)}else Human.log.error("Human.renderer.lights.setEnabled","Light not found: "+n)}i&&(r=!0,a=!0)},e.clearEnabled=function(){var t=!1;for(var i in e.lights)e.lights[i].enabled=!1,t=!0;t&&(r=!0,a=!0)},e.setLight=function(t){var r=t.lightId,i=e.lights[r];i?(void 0!==t.mode&&(i.params.mode=t.mode),void 0!==t.color&&(i.params.color=t.color),void 0!==t.dir&&(i.params.dir=t.dir),void 0!==t.pos&&(i.params.pos=t.pos),void 0!==t.diffuse&&(i.params.diffuse=t.diffuse),void 0!==t.specular&&(i.params.specular=t.specular),void 0!==t.innerCone&&(i.params.innerCone=t.innerCone),void 0!==t.outerCone&&(i.params.outerCone=t.outerCone),void 0!==t.constantAttenuation&&(i.params.constantAttenuation=t.constantAttenuation),void 0!==t.linearAttenuation&&(i.params.linearAttenuation=t.linearAttenuation),void 0!==t.quadraticAttenuation&&(i.params.quadraticAttenuation=t.quadraticAttenuation),void 0!==t.space&&(i.params.space=t.space),a=!0):Human.log.error("Light "+r+" does not exist")},e.restoreDefaults=function(){var t={};e.defaultLightIds.forEach((function(e){t[e]=!0})),e.clearEnabled(),e.setEnabled(t)},e.onFrame=function(){if(r){var i=0;for(var n in t.length=0,e.lights){var o=e.lights[n];o.enabled&&(t.push(o.params),o.index=i++)}r=!1,a=!0}a&&(Human.renderer.getScene().setLights(t),a=!1)}}(),function(){"use strict";var e=Human.renderer.reflections={};e.setEnabled=function(e){var t=Human.assets.reflections.reflections[e];t?function(e){var t=Human.renderer.getScene();t&&function e(t,r){for("cubemap"!==t.type&&"reflection"!==t.applyTo||function(e,t){if(e.getCoreId()!==t.node.getCoreId()){var r=e.getParent(),a=e.disconnectNodes();e.destroy(),e._engine._doDestroyNodes(),r.addNode({type:"cubemap",coreId:t.node.getCoreId()}).addNodes(a)}}(t,r);t.nodes&&t.nodes.length>0;)e(t.nodes[0],r)}(t,e)}(t):Human.log.error("Human.renderer.reflections.setEnabled","reflection not found: "+e)},e.clearEnabled=function(){}}(),function(){"use strict";var e=Human.renderer.lightmaps={};e.setEnabled=function(e){var t=Human.assets.reflections.reflections[e];t?function(e){var t=Human.renderer.getScene();t&&function e(t,r){for("cubemap"!==t.type&&"lightmap"!==t.applyTo||function(e,t){if(e.getCoreId()!==t.node.getCoreId()){var r=e.getParent(),a=e.disconnectNodes();e.destroy(),e._engine._doDestroyNodes(),r.addNode({type:"cubemap",coreId:t.node.getCoreId()}).addNodes(a)}}(t,r);t.nodes&&t.nodes.length>0;)e(t.nodes[0],r)}(t,e)}(t):Human.log.error("Human.renderer.lightmaps.setEnabled","reflection not found: "+e)},e.clearEnabled=function(){}}(),function(){"use strict";var e=Human.renderer.postprocess={scene:null,framebuffersInitialized:!1,enabled:!0,effects:{},currentConfig:[]};e.init=function(e){for(var t in this.scene=e,e.createPostProcessType("blit",["precision highp float;","varying vec2 vUV;","uniform sampler2D uColorBuffer;","void main() {","gl_FragColor = texture2D(uColorBuffer, vUV);","}"].join("\n")),this.effects)this.effects[t].init(e)},e.enable=function(){this.enabled||(this.enabled=!0,e.parse(this.currentConfig))},e.disable=function(){this.enabled&&(this.destroyPipeline(),this.enabled=!1)},e.parse=function(t){if(this.destroyPipeline(),this.currentConfig=t,this.enabled){for(var r=[],a=0,i=t.length;a<i;++a){var n=t[a];Human.renderer.postprocess.effects[n.effect]?(r.push(n.effect),Human.renderer.postprocess.effects[n.effect].configure(n)):Human.log.error("Unknown postprocess effect: ",n.effect)}!function(t){if(e.enabled){var r,a,i,n,o,s={opaquePipeline:[],transparentPipeline:[],finalPipeline:[],pipelineFramebuffers:{opaque:{read:"__MAIN",write:"__BDS_COLOR1"},transparent:{read:"__MAIN",write:"__BDS_COLOR1"},final:{read:"__MAIN",write:"__BDS_COLOR1"}},getIOFramebuffers:function(e){var t=this.pipelineFramebuffers[e],r={read:t.read,write:t.write};return"__BDS_COLOR1"===t.write?(t.read="__BDS_COLOR1",t.write="__BDS_COLOR2"):(t.read="__BDS_COLOR2",t.write="__BDS_COLOR1"),r}};for(n=0,o=t.length;n<o;++n){var l=e.effects[t[n]];l?l.addStage(s):Human.log.error("Unknown effect: "+t[n])}if(0!==s.opaquePipeline.length||0!==s.transparentPipeline.length||0!==s.finalPipeline.length){if(e.framebuffersInitialized||(e.scene.createFramebuffer("__BDS_COLOR1",{depthAttachment:!1}),e.scene.createFramebuffer("__BDS_COLOR2",{depthAttachment:!1}),e.framebuffersInitialized=!0),s.opaquePipeline.length>0){for(var c in i=!1,a=(r=s.opaquePipeline[s.opaquePipeline.length-1]).textures)if("__MAIN"===a[c].framebuffer){i=!0;break}i?s.opaquePipeline.push({type:"blit",id:"blitOpaqueToMain",textures:{uColorBuffer:{framebuffer:r.framebuffer,target:"color"}},framebuffer:"__MAIN"}):r.framebuffer="__MAIN",e.scene.postProcessOpaque(s.opaquePipeline)}s.finalPipeline.length>0?(r=s.finalPipeline[s.finalPipeline.length-1]).framebuffer=!1:s.finalPipeline.push({type:"blit",id:"blitToScreen",textures:{uColorBuffer:{framebuffer:"__MAIN",target:"color"}},framebuffer:!1}),e.scene.postProcessFinal(s.finalPipeline)}}}(r)}},e.destroyPipeline=function(){this.scene.postProcessOpaque(null),this.scene.postProcessFinal(null)},e.updateProjection=function(){for(var e in this.effects)this.effects[e].updateProjection&&this.effects[e].updateProjection()},e.updateCanvas=function(){for(var e in this.effects)this.effects[e].updateCanvas&&this.effects[e].updateCanvas()}}(),function(){"use strict";var e=Human.renderer.draw={initalized:!1,erase:!1,brushRadius:20,brushColor:vec3.fromValues(1,0,0),brushColorCSS:null},t=null,r=null,a=null,i={},n=!1,o=vec3.create(),s=0,l={},c=0,u=0,_=-1,h=-1;e.init=function(){this.initalized||(Human.renderer.getScene(),r=document.createElement("canvas"),a=r.getContext("2d"),t=new GrowingPacker,this.initalized=!0,this.setBrushColor(this.brushColor[0],this.brushColor[1],this.brushColor[2]),this.updateCanvas())},e.setBrushColor=function(e,t,r){this.brushColor[0]=e,this.brushColor[1]=t,this.brushColor[2]=r,this.brushColorCSS=Human.utils.floatRGBToHexString(e,t,r)},e.beginStroke=function(t,r){var a;(a=Human.renderer.canvas.context2D).lineWidth=2*e.brushRadius,a.lineJoin="round",a.lineCap="round",e.erase?(a.strokeStyle="#FFFFFF",a.fillStyle="#FFFFFF"):(a.strokeStyle=e.brushColorCSS,a.fillStyle=e.brushColorCSS),Human.renderer.canvas.context2D.beginPath(),Human.renderer.canvas.context2D.arc(t,r,this.brushRadius,0,2*Math.PI,!1),Human.renderer.canvas.context2D.fill(),Human.renderer.canvas.context2D.beginPath(),Human.renderer.canvas.context2D.moveTo(t,r),v(t,r),_=t,h=r},e.strokeTo=function(e,t){Human.renderer.canvas.context2D.lineTo(e,t),Human.renderer.canvas.context2D.stroke();var r=2*this.brushRadius,a=e-_,i=t-h,n=Math.sqrt(a*a+i*i);if(n>r)for(var o=Math.floor(n/r),s=r*(a/n),l=r*(i/n),c=1;c<=o;++c)v(_+c*s,h+c*l);v(e,t),_=e,h=t},e.record=function(){for(var r in n&&(function(){var r,n;for(r in S.length=0,l)n=i[r],S.push(l[r].getRenderObject());Human.renderer.forceRenderFrame({custom:{renderMode:"drawTexture",objects:S}});var o=Human.renderer.canvas.canvas,_=Human.renderer.canvas.annotationCanvas,h=Human.renderer.canvas.context2D;a.globalCompositeOperation="source-over",a.drawImage(o,0,0),a.globalCompositeOperation=e.erase?"destination-out":"source-over",a.drawImage(_,0,0);var f,d,p,m=a.getImageData(0,0,c,u);for(r in a.clearRect(0,0,c,u),l){var g=l[r],y=(n=i[r]).bb;if(y.min[0]!==1/0){h.putImageData(m,0,0);var v=h.getImageData(y.min[0]*c,y.min[1]*u,(y.max[0]-y.min[0])*c,(y.max[1]-y.min[1])*u);h.clearRect(0,0,c,u);var E=n.patches;for(p in E[s]={w:v.width,h:v.height,imageData:v},b.length=0,E)b.push(E[p]);b.sort((function(e,t){return t.h-e.h})),t.fit(b);var I=Math.min(Human.math.nextPowerOf2(t.root.w),4096),x=Math.min(Human.math.nextPowerOf2(t.root.h),4096);for(_.width=Math.max(_.width,I),_.height=Math.max(_.height,x),f=0,d=b.length;f<d;++f)h.putImageData(b[f].imageData,b[f].fit.x,b[f].fit.y);var C=h.getImageData(0,0,I,x);g.drawTexture.setImage(C);var T=n.triangleUVs,N=g.geometryNode.getUVs(),A=N[N.length-1],D={};for(var M in T){var P=T[M];if(P.patchId===s){var w=y.min[0],F=y.min[1],R=y.max[0]-y.min[0],L=y.max[1]-y.min[1];for(f=0;f<3;++f){var O=P.uvs[f];O[0]=(O[0]-w)/R,O[1]=(O[1]-F)/L}}var H=E[P.patchId],J=P.uvs[0],B=P.uvs[1],U=P.uvs[2],k=H.fit.x/I,V=H.fit.y/x,j=H.w/I,G=H.h/x;A[3*M*2]=J[0]*j+k,A[3*M*2+1]=1-J[1]*G+1-V,A[2*(3*M+1)]=B[0]*j+k,A[2*(3*M+1)+1]=1-B[1]*G+1-V,A[2*(3*M+2)]=U[0]*j+k,A[2*(3*M+2)+1]=1-U[1]*G+1-V,D[P.patchId]=!0}for(p in E)D[p]||delete E[p];g.geometryNode.setUV(N.length-1,A),_.width=c,_.height=u}else Human.console.error("Draw mesh data invalid.")}}(),++s),i){var o=i[r];o.bb.min[0]=o.bb.min[1]=1/0,o.bb.max[0]=o.bb.max[1]=-1/0}l={},Human.renderer.canvas.context2D.clearRect(0,0,c,u),a.clearRect(0,0,c,u),n=!1},e.updateCanvas=function(){if(this.initalized){var e=Human.renderer.canvas;r.width=c=e.width,r.height=u=e.height}};var f=vec4.create(),d=vec3.create(),p=vec3.create(),m=vec3.create(),g=mat4.create(),y=vec3.create();function v(t,r){var a=Human.renderer.pick.corePick(t,r,{rayPick:!0});if(a&&a.worldPos){var c=a.objectId+"---"+a.renderableIndex,u=Human.scene.objects[a.objectId],_=u.renderables[a.renderableIndex];i[c]||function(e,t){var r=e.geometryNode,a={type:"geometry",primitive:"triangles",id:t+"_draw_geometry",positionDecodeMat:r.getPositionDecodeMat()},n=r.getPositions(),o=r.getNormals(),s=r.getUVs(),l=r.getIndices(),c=l.length;if(a.positions=new(0,n.constructor)(3*c),o&&(a.normals=r.hasCompressedNormals()?new Int8Array(2*c):new Float32Array(3*c)),s){a.uvs=new Array(s.length+1);for(var u=0,_=s.length;u<_;u++)a.uvs[u]=new Float32Array(2*c);a.uvs[u]=new Float32Array(2*c)}else a.uvs=[new Float32Array(2*c)];for(var h=a.positions,f=a.normals,d=a.uvs,p=0,m=l.length;p<m;p+=3){var g=l[p],y=l[p+1],v=l[p+2];if(h[3*p]=n[3*g],h[3*p+1]=n[3*g+1],h[3*p+2]=n[3*g+2],h[3*p+3]=n[3*y],h[3*p+4]=n[3*y+1],h[3*p+5]=n[3*y+2],h[3*p+6]=n[3*v],h[3*p+7]=n[3*v+1],h[3*p+8]=n[3*v+2],f&&(r.hasCompressedNormals()?(f[2*p]=o[2*g],f[2*p+1]=o[2*g+1],f[2*p+2]=o[2*y],f[2*p+3]=o[2*y+1],f[2*p+4]=o[2*v],f[2*p+5]=o[2*v+1]):(f[3*p]=o[3*g],f[3*p+1]=o[3*g+1],f[3*p+2]=o[3*g+2],f[3*p+3]=o[3*y],f[3*p+4]=o[3*y+1],f[3*p+5]=o[3*y+2],f[3*p+6]=o[3*v],f[3*p+7]=o[3*v+1],f[3*p+8]=o[3*v+2])),d){var S,b,E=0;if(s)for(var T=s.length;E<T;E++){b=d[E],I[0]=(S=s[E])[2*g],I[1]=S[2*g+1],x[0]=S[2*y],x[1]=S[2*y+1],C[0]=S[2*v],C[1]=S[2*v+1];var N=r.getUVDecodeMat(E);N&&(Human.math.decompressUV(I,I,N),Human.math.decompressUV(x,x,N),Human.math.decompressUV(C,C,N)),b[2*p]=I[0],b[2*p+1]=I[1],b[2*p+2]=x[0],b[2*p+3]=x[1],b[2*p+4]=C[0],b[2*p+5]=C[1]}(b=d[E])[2*p]=-1,b[2*p+1]=-1,b[2*p+2]=-1,b[2*p+3]=-1,b[2*p+4]=-1,b[2*p+5]=-1}}i[t]={triangleUVs:{},patches:{},bb:{min:vec2.fromValues(1/0,1/0),max:vec2.fromValues(-1/0,-1/0)}};var A=0;s&&(A=s.length),e.attachDrawTexture({type:"texture",applyFrom:"uv"+A,applyTo:"color",blendMode:"conditionalAlpha",drawTexture:!0});var D=t+"-draw-mesh";Human.assets.geometries.createGeometry(D,{geometry:a}),e.setGeometry(D)}(_,c);var h=Human.renderer.canvasCircleToWorldSphereRadius(t,r,e.brushRadius,a.worldPos),v=a.worldPos,S=_.geometryNode,b=_.getRenderObject();mat4.invert(g,u.worldMatrix),vec3.transformMat4(y,v,g);var T,N,A=i[c],D=A.triangleUVs,M=Human.math.intersections.spherePolyhedron(S,y,h);if(0!==M.length){var P={};if(e.erase){var w=Human.math.intersections.sphereInPolyhedron(S,y,h);for(T=0,N=w.length;T<N;++T)P[w[T]]=!0}var F,R,L=Human.renderer.camera.getLookDir(o);for(T=0,N=M.length;T<N;++T)P[F=M[T]]&&D[F]?delete D[F]:(b.getTrianglePositionOnSurface(3*F,d,p,m),Human.math.triangleNormal(d,p,m,f),vec4.transformMat4(f,f,u.worldMatrix),vec3.dot(f,L)>0||(b.getPointInWorldSpace(d,d),b.getPointInWorldSpace(p,p),b.getPointInWorldSpace(m,m),D[F]?D[F].patchId!==s&&(D[F].patchId=s,E(d,p,m,D[F].uvs)):(R=new Array(3),E(d,p,m,R),D[F]={patchId:s,uvs:R})));var O=A.bb;for(F in D){var H=(R=D[F].uvs)[0],J=R[1],B=R[2];O.min[0]=Math.min(O.min[0],H[0]),O.min[0]=Math.min(O.min[0],J[0]),O.min[0]=Math.min(O.min[0],B[0]),O.max[0]=Math.max(O.max[0],H[0]),O.max[0]=Math.max(O.max[0],J[0]),O.max[0]=Math.max(O.max[0],B[0]),O.min[1]=Math.min(O.min[1],H[1]),O.min[1]=Math.min(O.min[1],J[1]),O.min[1]=Math.min(O.min[1],B[1]),O.max[1]=Math.max(O.max[1],H[1]),O.max[1]=Math.max(O.max[1],J[1]),O.max[1]=Math.max(O.max[1],B[1])}l[c]=_,n=!0}}}var S=[],b=[];function E(e,t,r,a){var i=vec2.create();Human.renderer.worldPositionToCanvas(e,i),i[0]/=c,i[1]/=u,a[0]=i;var n=vec2.create();Human.renderer.worldPositionToCanvas(t,n),n[0]/=c,n[1]/=u,a[1]=n;var o=vec2.create();Human.renderer.worldPositionToCanvas(r,o),o[0]/=c,o[1]/=u,a[2]=o}var I=vec2.create(),x=vec2.create(),C=vec2.create()}(),function(){"use strict";Human.renderer.camera.CurvePath=function(){var e,t,r=[],a=0,i=vec3.create(),n=Human.math.bezier;this.init=function(o){r=[],a=0,t=(e=o.length)-1,e<2&&Human.log.error("curvePath init no enough points");var s,l,c,u,_=vec3.create(),h=vec3.create();vec3.subtract(i,o[0],o[1]),vec3.scale(i,i,.25),vec3.add(_,o[0],i),vec3.subtract(i,o[e-1],o[e-2]),vec3.scale(i,i,.25),vec3.add(h,o[e-1],i);var f,d=vec3.create(),p=vec3.create();for(s=1;s<e;++s)u=l=o[s-1],f=c=o[s],s<=1?vec3.subtract(i,l,_):(vec3.subtract(i,c,o[s-2]),vec3.scale(i,i,.25)),vec3.add(d,u,i),s>=e-1?vec3.subtract(i,h,c):(vec3.subtract(i,o[s+1],l),vec3.scale(i,i,.25)),vec3.subtract(p,f,i),r.push(new n(u[0],u[1],u[2],d[0],d[1],d[2],p[0],p[1],p[2],f[0],f[1],f[2]));for(s=0;s<t;++s)a+=r[s].length()},this.getPosition=function(e){var t=this.getParameter(e);return{position:r[t.i].compute(t.t01),i:t.i,t01:t.t01}},this.getParameter=function(t){var r,a;return a=t*(e-1),a=Human.math.clamp(a,0,e-1),(r=Math.floor(a))>=e-1&&(r-=1),{i:r,t01:a-=r}},this.getPathLength=function(){return a}}}(),function(){"use strict";var e=Human.renderer.camera.fly={};e.flyTimeScale=1,e.velocity=1,e.cylindricalArcScale=1,e.cylindricalView=!1,e.cylindricalOnly=!1,e.cylindricalRotationLerpMin=Math.PI/6,e.cylindricalRotationLerpMax=Math.PI/2,e.cylindricalRadiusLerpMin=.2,e.cylindricalRadiusLerpMax=1;var t=[],r=null,a=new Human.renderer.camera.CurvePath,i=new Human.renderer.camera.CurvePath;function n(e,a){Human.renderer.camera.lock=!0,a&&t.push(a),e=e||{},(r=new Human.renderer.camera.fly.Animation({animationDuration:e.animationDuration,velocity:e.velocity,target:e.target,arc:e.arc,backOff:e.backOff,constrainUp:e.constrainUp,onComplete:o,cylindricalView:e.cylindricalView,easeIn:e.easeIn,easeOut:e.easeOut})).update(Date.now())}function o(){for(r=null;t.length>0;)t.pop()();Human.renderer.camera.lock=!1}e.onFrame=function(){r&&r.update(Date.now())},e.cancelAnimation=function(){r&&(o(),r=null)},e.flyAlongCurvePath=function(e,n,s){n=n||function(){},s=s||function(e){Human.log.error("Human.renderer.camera.fly.flyAlongCurvePath",e),n()},e||(s("params must be defined"),n());var l,c,u=void 0!==e.velocity?e.velocity:1,_=[],h=[],f=[];for(l=0,c=e.points.length;l<c;++l)_.push(Human.math.vec3ObjToArray(e.points[l].eye||e.points[l].position)),h.push(Human.math.vec3ObjToArray(e.points[l].look||e.points[l].target)),f.push(Human.math.vec3ObjToArray(e.points[l].up));a.init(_),i.init(h),function(e,a){Human.renderer.camera.lock=!0,a&&t.push(a),e=e||{},(r=new Human.renderer.camera.fly.CurvePathAnimation({eyeCurvePath:e.eyeCurvePath,lookCurvePath:e.lookCurvePath,upVecs:e.upVecs,velocity:e.velocity,constrainUp:e.constrainUp,easeIn:e.easeIn,easeOut:e.easeOut,onComplete:o})).update(Date.now())}({eyeCurvePath:a,lookCurvePath:i,upVecs:f,velocity:u,constrainUp:e.constrainUp,easeIn:e.easeIn,easeOut:e.easeOut},n)},e.flyTo=function(e,t,r){var a,i,o;if(t=t||function(){},r=r||function(e){Human.log.error("Human.renderer.camera.fly",e),t()},e.objectId){if(o=e.objectId,!(a=Human.scene.objects[o]))return void r("No scene object found for the given ID: '"+o+"'");(i=a.getBoundary())?n({target:{boundary:i},arc:e.arc,backOff:e.backOff,cylindricalView:e.cylindricalView,animationDuration:e.animationDuration,velocity:e.velocity,easeIn:e.easeIn,easeOut:e.easeOut},t):t()}else n(e.boundary?{target:{boundary:i=e.boundary},arc:e.arc,backOff:e.backOff,cylindricalView:e.cylindricalView,animationDuration:e.animationDuration,velocity:e.velocity,easeIn:e.easeIn,easeOut:e.easeOut}:e.eye||e.look?{target:{eye:e.eye,look:e.look,up:e.up},arc:e.arc,backOff:e.backOff,animationDuration:e.animationDuration,velocity:e.velocity,constrainUp:!1,cylindricalView:e.cylindricalView,easeIn:e.easeIn,easeOut:e.easeOut}:{target:{eye:{x:0,y:6,z:-70},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},arc:e.arc,backOff:e.backOff,cylindricalView:e.cylindricalView,animationDuration:e.animationDuration,velocity:e.velocity,easeIn:e.easeIn,easeOut:e.easeOut},t)},e.jumpTo=function(e,t,r){var a,i,n,s;if(t=t||function(){},r=r||function(e){Human.log.error("Human.renderer.camera.fly",e),t()},e.objectId){if(n=e.objectId,!(a=Human.scene.objects[n]))return void r("No scene object found for the given ID: '"+n+"'");(i=a.getBoundary())&&(s={target:{boundary:i},backOff:e.backOff})}else if(e.boundary)s=function(e){var t=e.backOff||0;t<0?t=0:t>1&&(t=1),t=1-t;var r=Human.math.vec3ObjToArray(Human.renderer.camera.look),a=Human.math.vec3ObjToArray(Human.renderer.camera.eye),i=vec3.create();vec3.subtract(i,a,r),vec3.normalize(i,i);var n=e.boundary,o=Human.math.getBoundaryCenter(n),s=e.stopFOV,l=vec3.length(i),c=Human.math.getBoundaryDiag(n),u=Math.abs(c/(1+.8*t)/Math.tan(s/2));return vec3.scale(i,i,u/l),vec3.add(i,o,i),{target:{eye:{x:i[0],y:i[1],z:i[2]},look:{x:o[0],y:o[1],z:o[2]},up:{x:0,y:1,z:0}}}}(e);else if(e.eye||e.look){if(!e.eye&&!e.look)return void r("incomplete parameter configuration: both 'eye' and 'look' expected");s={target:{eye:e.eye,look:e.look,up:e.up}}}else s={target:{eye:{x:0,y:6,z:-70},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},backOff:e.backOff};s&&(o(),s.target.boundary?(s.target.stopFOV=55,Human.renderer.camera.fly.jumpTo(s.target)):Human.renderer.camera.setLookAt(s.target)),t()},e.cancel=o}(),function(){"use strict";var e=vec3.create(),t=vec3.create(),r=vec3.create();Human.renderer.camera.fly.Animation=function(a){var i=a.target,n=void 0!==a.cylindricalView?a.cylindricalView:Human.renderer.camera.fly.cylindricalView;if(this.arc=n?void 0===a.arc?1:a.arc:0,this.scaleArc=void 0===a.scaleArc?Human.renderer.camera.fly.cylindricalArcScale:a.scaleArc,this.easeIn=!!a.easeIn,this.easeOut=!1!==a.easeOut,this.constrainUp=void 0!==a.constrainUp&&a.constrainUp,!i)return Human.log.error("Human.renderer.camera.fly.Animation config missing: target"),void(a.onComplete&&a.onComplete());var o=Human.renderer.camera;this._look1=Human.math.vec3ObjToArray(o.look),this._eye1=Human.math.vec3ObjToArray(o.eye),this._up1=Human.math.vec3ObjToArray(o.up),vec3.subtract(e,this._eye1,this._look1),this._vec=vec3.create(),vec3.normalize(this._vec,e);var s=a.backOff||0;if(s<0?s=0:s>1&&(s=1),s=1-s,i.boundary){var l=i.boundary,c=i.dist||2.5,u=Math.abs(vec3.length(this._vec)),_=Human.math.getBoundaryDiag(l),h=Math.abs(_/(1+.8*s)/Math.tan(27.5))/u*c;this._look2=Human.math.getBoundaryCenter(l),i.offset&&(this._look2[0]+=i.offset[0],this._look2[1]+=i.offset[1],this._look2[2]+=i.offset[2]);var f=Human.renderer.camera.fly.cylindricalOnly;if(n){this.arc=1,Human.math.cartesianToCylindrical(this._look1,t),Human.math.cartesianToCylindrical(this._look2,r);var d=Human.math.getShortRotation(t[1],r[1]),p=r[0],m=function(e,t){var r=Human.renderer.camera.fly,a=Human.math.clamp((e-r.cylindricalRotationLerpMin)/(r.cylindricalRotationLerpMax-r.cylindricalRotationLerpMin),0,1),i=Human.math.clamp((t-r.cylindricalRadiusLerpMin)/(r.cylindricalRadiusLerpMax-r.cylindricalRadiusLerpMin),0,1);return Math.min(a,i)}(Math.abs(d),p);f?(r[0]=r[0]+h,this._eye2=Human.math.cylindricalToCartesian(r)):(r[0]=h,r[2]=0,this._eye2=Human.math.cylindricalToCartesian(r),vec3.scale(e,this._vec,h),Human.math.lerpVec3(m,0,1,e,this._eye2,e),vec3.normalize(e,e),vec3.scale(e,e,h),vec3.add(this._eye2,this._look2,e))}else vec3.scale(e,this._vec,h),this._eye2=vec3.add(vec3.create(),this._look2,e);this._up2=vec3.create(),this.constrainUp?(this._up2[0]=o.up.x,this._up2[1]=o.up.y,this._up2[2]=o.up.z):i.up?(this._up2[0]=i.up.x||0,this._up2[1]=i.up.y||0,this._up2[2]=i.up.z||0):this._up2[1]=1}else{var g=i.look,y=i.eye,v=i.up,S=Human.renderer.camera.eye,b=Human.renderer.camera.look,E=Human.renderer.camera.up;this._look2=vec3.create(),this._eye2=vec3.create(),this._up2=vec3.create(),g?(this._look2[0]=g.x||0,this._look2[1]=g.y||0,this._look2[2]=g.z||0):(this._look2[0]=b.x,this._look2[1]=b.y,this._look2[2]=b.z),y?(this._eye2[0]=y.x||0,this._eye2[1]=y.y||0,this._eye2[2]=y.z||0):(this._eye2[0]=S.x,this._eye2[1]=S.y,this._eye2[2]=S.z),v&&!this.constrainUp?(this._up2[0]=v.x||0,this._up2[1]=v.y||0,this._up2[2]=v.z||0):(this._up2[0]=E.x,this._up2[1]=E.y,this._up2[2]=E.z)}vec3.subtract(e,this._look2,this._look1);var I=Math.abs(vec3.length(e));vec3.subtract(e,this._eye2,this._eye1);var x=Math.abs(vec3.length(e));if(this.arc>0){Human.math.cartesianToCylindrical(this._eye1,t),Human.math.cartesianToCylindrical(this._eye2,r);var C=Human.math.getShortRotation(t[1],r[1]),T=(t[0]+r[0])*Math.abs(C),N=r[2]-t[1],A=Math.sqrt(T*T+N*N);x=(1-this.arc)*x+this.arc*A}this._dist=I>x?I:x,this._animationDuration=a.animationDuration?1e3*a.animationDuration:1e3*Human.renderer.camera.fly.flyTimeScale*(this._dist/(200*(a.velocity||Human.renderer.camera.fly.velocity))+1),this._onComplete=a.onComplete};var a=vec3.create(),i=vec3.create();Human.renderer.camera.fly.Animation.prototype.update=function(n){if(void 0===this._time1&&(this._time1=n,this._time2=this._time1+this._animationDuration),this._done||n>this._time2)return this._done||Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(this._look2),eye:Human.math.vec3ArrayToObj(this._eye2),up:Human.math.vec3ArrayToObj(this._up2)}),this._done=!0,void this._onComplete(this);var o,s=(n-this._time1)/this._animationDuration;if(o=this.easeIn&&this.easeOut?Human.math.easeInOut(s,0,1,1):this.easeIn?Human.math.easeIn(s,0,1,1):this.easeOut?Human.math.easeOut(s,0,1,1):s,Human.math.lerpVec3(o,0,1,this._look1,this._look2,i),this.arc>0){if(Human.math.lerpVec3Cylindrical(o,0,1,t,r,e),1!==this.scaleArc){var l=e[0],c=this.scaleArc*l;l=o<.5?Human.math.lerpScalar(o,0,.5,l,c):Human.math.lerpScalar(o,.5,1,c,l),e[0]=l}Human.math.cylindricalToCartesian(e,a),this.arc<1&&(Human.math.lerpVec3(o,0,1,this._eye1,this._eye2,e),Human.math.lerpVec3(this.arc,0,1,e,a,a))}else Human.math.lerpVec3(o,0,1,this._eye1,this._eye2,a);if(this.constrainUp)Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(i),eye:Human.math.vec3ArrayToObj(a)});else{var u=Human.math.lerpVec3(o,0,1,this._up1,this._up2,[]);Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(i),eye:Human.math.vec3ArrayToObj(a),up:Human.math.vec3ArrayToObj(u)})}},Human.renderer.camera.fly.Animation.prototype.stop=function(){}}(),function(){"use strict";var e=1,t=vec3.create();Human.properties.subscribe({propId:"camera.flyCurvePath",value:{velocity:1},callback:function(t){e=t.velocity||1}}),Human.renderer.camera.fly.CurvePathAnimation=function(t){this.easeIn=!!t.easeIn,this.easeOut=!1!==t.easeOut,this.constrainUp=void 0!==t.constrainUp&&t.constrainUp,this._eyeCurvePath=t.eyeCurvePath,this._lookCurvePath=t.lookCurvePath,this._upVecs=t.upVecs;var r=Human.renderer.camera,a=this._lookCurvePath.getParameter(1).i;this._look2=Human.math.vec3ObjToArray(this._lookCurvePath.getPosition(1).position),this._eye2=Human.math.vec3ObjToArray(this._eyeCurvePath.getPosition(1).position),this._up2=this.constrainUp?Human.math.vec3ObjToArray(r.up):this._upVecs[a+1];var i=this._eyeCurvePath.getPathLength(),n=this._lookCurvePath.getPathLength();this._dist=Math.max(i,n),this._duration=1e3*Human.renderer.camera.fly.flyTimeScale*(this._dist/(200*(t.velocity||e))+1),this._onComplete=t.onComplete},Human.renderer.camera.fly.CurvePathAnimation.prototype.update=function(e){if(void 0===this._time1&&(this._time1=e,this._time2=this._time1+this._duration),this._done||e>this._time2)return this._done||Human.renderer.camera.setLookAt({look:Human.math.vec3ArrayToObj(this._look2),eye:Human.math.vec3ArrayToObj(this._eye2),up:Human.math.vec3ArrayToObj(this._up2)}),this._done=!0,void this._onComplete(this);var r,a=(e-this._time1)/this._duration;r=this.easeIn&&this.easeOut?Human.math.easeInOut(a,0,1,1):this.easeIn?Human.math.easeIn(a,0,1,1):this.easeOut?Human.math.easeOut(a,0,1,1):a;var i=this._lookCurvePath.getPosition(r).position,n=this._eyeCurvePath.getPosition(r).position;if(this.constrainUp)Human.renderer.camera.setLookAt({look:i,eye:n});else{var o=this._lookCurvePath.getParameter(r);Human.math.lerpVec3(o.t01,0,1,this._upVecs[o.i],this._upVecs[o.i+1],t),Human.renderer.camera.setLookAt({look:i,eye:n,up:Human.math.vec3ArrayToObj(t)})}}}(),function(){"use strict";var e=["precision highp float;","#define MAX_BLUR 20.0","varying vec2 vUV;","uniform float uFocusStart;","uniform float uFocusEnd;","uniform float uBlurCoefficient;","uniform sampler2D uTexture;","uniform sampler2D uDepth;","uniform vec2 uTexelOffset;","uniform vec2 uDepthRange;","void main() {","float ndc = 2.0 * texture2D(uDepth, vUV).r - 1.0;","float depth = -(2.0 * uDepthRange.y * uDepthRange.x) / (ndc * (uDepthRange.y - uDepthRange.x) - uDepthRange.y - uDepthRange.x);","float deltaDepth = max(depth - uFocusEnd, 0.0) + max(uFocusStart - depth, 0.0);","vec4 color = vec4(0.0);","if (ndc < 1.0 && deltaDepth > 0.0) {","float blurRadius = min(floor(uBlurCoefficient * deltaDepth), MAX_BLUR);","float halfBlur = blurRadius * 0.5;","float count = 0.0;","for (float i = 0.0; i <= MAX_BLUR; ++i) {","if (i > blurRadius) {","break;","}","color += texture2D(uTexture, vUV + ((i - halfBlur) * uTexelOffset));","++count;","}","color /= count;","} else {","color = texture2D(uTexture, vUV);","}","gl_FragColor = color;","}"].join("\n"),t={type:"dof",id:"dofHorizontal",uniforms:{uFocusStart:90,uFocusEnd:130,uBlurCoefficient:.1,uTexelOffset:new Float32Array([1/window.innerWidth,0]),uDepthRange:new Float32Array([.1,1e4])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"},uDepth:{framebuffer:"__MAIN",target:"depth"}},framebuffer:"---SET_ME---"},r={type:"dof",id:"dofVertical",uniforms:{uTexelOffset:new Float32Array([0,1/window.innerHeight])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"},uDepth:{framebuffer:"__MAIN",target:"depth"}},framebuffer:"---SET_ME---"},a=Human.renderer.postprocess.effects.dof={scene:null,supported:SceneJS.WEBGL_INFO.depthTexturesSupported,focusStart:90,focusEnd:130,blurCoefficient:.1};a.init=function(t){this.scene=t,this.supported&&t.createPostProcessType("dof",e)},a.addStage=function(e){if(this.supported){var a=e.getIOFramebuffers("final");t.uniforms.uFocusStart=this.focusStart,t.uniforms.uFocusEnd=this.focusEnd,t.uniforms.uBlurCoefficient=this.blurCoefficient,t.uniforms.uDepthRange[0]=Human.renderer.camera.near,t.uniforms.uDepthRange[1]=Human.renderer.camera.far,t.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,t.textures.uTexture.framebuffer=a.read,t.framebuffer=a.write,a=e.getIOFramebuffers("final"),r.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height,r.textures.uTexture.framebuffer=a.read,r.framebuffer=a.write,e.finalPipeline.push(t),e.finalPipeline.push(r)}},a.setFocusStart=function(e){this.focusStart=t.uniforms.uFocusStart=e;var r=this.scene.getPostProcessStage("dofHorizontal");r&&r.setUniform("uFocusStart",this.focusStart)},a.setFocusEnd=function(e){this.focusEnd=t.uniforms.uFocusEnd=e;var r=this.scene.getPostProcessStage("dofHorizontal");r&&r.setUniform("uFocusEnd",this.focusEnd)},a.setBlurCoefficient=function(e){this.blurCoefficient=t.uniforms.uBlurCoefficient=e;var r=this.scene.getPostProcessStage("dofHorizontal");r&&r.setUniform("uBlurCoefficient",this.blurCoefficient)},a.configure=function(e){(e=e||{}).focusStart=void 0===e.focusStart?90:e.focusStart,e.focusEnd=void 0===e.focusEnd?130:e.focusEnd,e.blur=void 0===e.blur?.1:e.blur,this.setFocusStart(e.focusStart),this.setFocusEnd(e.focusEnd),this.setBlurCoefficient(e.blur)},a.updateProjection=function(){t.uniforms.uDepthRange[0]=Human.renderer.camera.near,t.uniforms.uDepthRange[1]=Human.renderer.camera.far;var e=this.scene.getPostProcessStage("dofHorizontal");e&&e.setUniform("uDepthRange",t.uniforms.uDepthRange)},a.updateCanvas=function(){var e=Human.renderer.canvas;t.uniforms.uTexelOffset[0]=1/e.width,r.uniforms.uTexelOffset[1]=1/e.height;var a=this.scene.getPostProcessStage("dofHorizontal"),i=this.scene.getPostProcessStage("dofVertical");a&&i&&(a.setUniform("uTexelOffset",t.uniforms.uTexelOffset),i.setUniform("uTexelOffset",r.uniforms.uTexelOffset))}}(),function(){"use strict";var e=["precision highp float;","#define MAX_BLUR 20.0","varying vec2 vUV;","uniform float uBlurCoefficient;","uniform sampler2D uTexture;","uniform vec2 uTexelOffset;","void main() {","vec4 color = vec4(0.0);","float blurRadius = min(floor(uBlurCoefficient * 100.0), MAX_BLUR);","float halfBlur = blurRadius * 0.5;","float count = 0.0;","for (float i = 0.0; i <= MAX_BLUR; ++i) {","if (i > blurRadius) {","break;","}","color += texture2D(uTexture, vUV + ((i - halfBlur) * uTexelOffset));","++count;","}","color /= count;","gl_FragColor = color;","}"].join("\n"),t={type:"blur",id:"blurHorizontal",uniforms:{uBlurCoefficient:.1,uTexelOffset:new Float32Array([1/window.innerWidth,0])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},r={type:"blur",id:"blurVertical",uniforms:{uTexelOffset:new Float32Array([0,1/window.innerHeight])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},a=Human.renderer.postprocess.effects.blur={scene:null,blurCoefficient:.1};a.init=function(t){this.scene=t,t.createPostProcessType("blur",e)},a.addStage=function(e){var a=e.getIOFramebuffers("final");t.uniforms.uBlurCoefficient=this.blurCoefficient,t.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,t.textures.uTexture.framebuffer=a.read,t.framebuffer=a.write,a=e.getIOFramebuffers("final"),r.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height,r.textures.uTexture.framebuffer=a.read,r.framebuffer=a.write,e.finalPipeline.push(t),e.finalPipeline.push(r)},a.setBlurCoefficient=function(e){this.blurCoefficient=t.uniforms.uBlurCoefficient=e;var r=this.scene.getPostProcessStage("blurHorizontal");r&&r.setUniform("uBlurCoefficient",this.blurCoefficient)},a.configure=function(e){(e=e||{}).blur=void 0===e.blur?.1:e.blur,this.setBlurCoefficient(e.blur)},a.updateCanvas=function(){var e=Human.renderer.canvas,a=this.scene.getPostProcessStage("blurHorizontal"),i=this.scene.getPostProcessStage("blurVertical");a&&i&&(t.uniforms.uTexelOffset[0]=1/e.width,r.uniforms.uTexelOffset[1]=1/e.height,a.setUniform("uTexelOffset",t.uniforms.uTexelOffset),i.setUniform("uTexelOffset",r.uniforms.uTexelOffset))}}(),function(){"use strict";var e=new Float32Array([0,0]),t=new Float32Array(4),r=new Float32Array(3),a=new Float32Array(3),i=["precision highp float;","#define MAX_BLUR 20.0","varying vec2 vUV;","uniform sampler2D uTexture;","uniform vec4 uBlurParams;","uniform vec3 uTexelParams;","void main() {","vec2 center = uBlurParams.xy;","float radius = uBlurParams.z;","float blurCoefficient = uBlurParams.w;","vec2 texelOffset = uTexelParams.xy;","float aspect = uTexelParams.z;","vec2 pos = vUV * 2.0 - 1.0;","pos.x *= aspect;","float r = length(pos - center);","float deltaR = max(r - radius, 0.0);","vec4 color = vec4(0.0);","if (deltaR > 0.0) {","float blurRadius = min(floor(blurCoefficient * 100.0 * deltaR), MAX_BLUR);","float halfBlur = blurRadius * 0.5;","float count = 0.0;","for (float i = 0.0; i <= MAX_BLUR; ++i) {","if (i > blurRadius) {","break;","}","color += texture2D(uTexture, vUV + ((i - halfBlur) * texelOffset));","++count;","}","color /= count;","} else {","color = texture2D(uTexture, vUV);","}","gl_FragColor = color;","}"].join("\n"),n={type:"radialBlur",id:"radialBlurHorizontal",uniforms:{uBlurParams:t,uTexelParams:r},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},o={type:"radialBlur",id:"radialBlurVertical",uniforms:{uTexelParams:a},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},s=Human.renderer.postprocess.effects.radialBlur={scene:null,radius:.2,center:new Float32Array(e),blurCoefficient:.1};s.init=function(e){this.scene=e,e.createPostProcessType("radialBlur",i)},s.addStage=function(e){var i=e.getIOFramebuffers("final");t.set(this.center),t[2]=this.radius,t[3]=this.blurCoefficient;var s=Human.renderer.canvas.width/Human.renderer.canvas.height;r[0]=s/Human.renderer.canvas.width,r[2]=s,a[1]=1/Human.renderer.canvas.height,a[2]=s,n.textures.uTexture.framebuffer=i.read,n.framebuffer=i.write,i=e.getIOFramebuffers("final"),o.textures.uTexture.framebuffer=i.read,o.framebuffer=i.write,e.finalPipeline.push(n),e.finalPipeline.push(o)},s.setRadius=function(e){this.radius=t[2]=e;var r=this.scene.getPostProcessStage("radialBlurHorizontal");r&&r.setUniform("uBlurParams",t)},s.setCenter=function(e,r){this.center[0]=e,this.center[1]=r,t.set(this.center);var a=this.scene.getPostProcessStage("radialBlurHorizontal");a&&a.setUniform("uBlurParams",t)},s.setBlurCoefficient=function(e){this.blurCoefficient=t[3]=e;var r=this.scene.getPostProcessStage("radialBlurHorizontal");r&&r.setUniform("uBlurParams",t)},s.configure=function(t){(t=t||{}).radius=void 0===t.radius?.2:t.radius,t.center=void 0===t.center?e:t.center,t.blur=void 0===t.blur?.1:t.blur,this.setRadius(t.radius),this.setCenter(t.center[0],t.center[1]),this.setBlurCoefficient(t.blur)},s.updateCanvas=function(){var e=Human.renderer.canvas,t=e.width/e.height;r[0]=t/e.width,r[2]=t,a[1]=1/e.height,a[2]=t;var i=this.scene.getPostProcessStage("radialBlurHorizontal"),n=this.scene.getPostProcessStage("radialBlurVertical");i&&n&&(i.setUniform("uTexelParams",r),n.setUniform("uTexelParams",a))}}(),function(){"use strict";var e=!1,t=["precision highp float;","varying vec2 vUV;","uniform float uGamma;","uniform bool uToneMap;","uniform sampler2D uTexture;","vec3 toneMapReinhard(vec3 color) {","    return color / (color + 1.0);","}","void main() {","   vec4 color = texture2D(uTexture, vUV);","   if (uToneMap) {","       color.rgb = toneMapReinhard(color.rgb);","   }","   color.rgb = pow(color.rgb, vec3(1.0 / uGamma));","   gl_FragColor = color;","}"].join("\n"),r={type:"gammaCorrect",id:"gammaCorrect",uniforms:{uGamma:2.2,uToneMap:e},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},a=Human.renderer.postprocess.effects.gammaCorrect={scene:null,gamma:2.2,toneMap:e};a.init=function(e){this.scene=e,e.createPostProcessType("gammaCorrect",t)},a.addStage=function(e){var t=e.getIOFramebuffers("final");r.uniforms.uGamma=this.gamma,r.uniforms.uToneMap=this.toneMap,r.textures.uTexture.framebuffer=t.read,r.framebuffer=t.write,e.finalPipeline.push(r)},a.setGamma=function(e){this.gamma=r.uniforms.uGamma=e;var t=this.scene.getPostProcessStage("gammaCorrect");t&&t.setUniform("uGamma",this.gamma)},a.setToneMap=function(e){this.toneMap=r.uniforms.uToneMap=e;var t=this.scene.getPostProcessStage("gammaCorrect");t&&t.setUniform("uToneMap",this.toneMap)},a.configure=function(t){(t=t||{}).gamma=void 0===t.gamma?2.2:t.gamma,t.toneMap=void 0===t.toneMap?e:t.toneMap,this.setGamma(t.gamma),this.setToneMap(t.toneMap)}}(),function(){"use strict";var e=["precision highp float;","uniform sampler2D uTexture;","uniform vec2 uTexelOffset;","varying vec2 vUV;","const float fxaaQualitySubpix = 0.75;","const float fxaaQualityEdgeThreshold = 0.125;","const float fxaaQualityEdgeThresholdMin = 0.0;","#define FXAA_QUALITY_PRESET 25","#if (FXAA_QUALITY_PRESET == 10)","#define FXAA_QUALITY_PS 3","#define FXAA_QUALITY_P0 1.5","#define FXAA_QUALITY_P1 3.0","#define FXAA_QUALITY_P2 12.0","#endif","#if (FXAA_QUALITY_PRESET == 11)","#define FXAA_QUALITY_PS 4","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 3.0","#define FXAA_QUALITY_P3 12.0","#endif","#if (FXAA_QUALITY_PRESET == 12)","#define FXAA_QUALITY_PS 5","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 4.0","#define FXAA_QUALITY_P4 12.0","#endif","#if (FXAA_QUALITY_PRESET == 13)","#define FXAA_QUALITY_PS 6","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 4.0","#define FXAA_QUALITY_P5 12.0","#endif","#if (FXAA_QUALITY_PRESET == 14)","#define FXAA_QUALITY_PS 7","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 4.0","#define FXAA_QUALITY_P6 12.0","#endif","#if (FXAA_QUALITY_PRESET == 15)","#define FXAA_QUALITY_PS 8","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 4.0","#define FXAA_QUALITY_P7 12.0","#endif","#if (FXAA_QUALITY_PRESET == 20)","#define FXAA_QUALITY_PS 3","#define FXAA_QUALITY_P0 1.5","#define FXAA_QUALITY_P1 2.0","#define FXAA_QUALITY_P2 8.0","#endif","#if (FXAA_QUALITY_PRESET == 21)","#define FXAA_QUALITY_PS 4","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 8.0","#endif","#if (FXAA_QUALITY_PRESET == 22)","#define FXAA_QUALITY_PS 5","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 8.0","#endif","#if (FXAA_QUALITY_PRESET == 23)","#define FXAA_QUALITY_PS 6","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 8.0","#endif","#if (FXAA_QUALITY_PRESET == 24)","#define FXAA_QUALITY_PS 7","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 3.0","#define FXAA_QUALITY_P6 8.0","#endif","#if (FXAA_QUALITY_PRESET == 25)","#define FXAA_QUALITY_PS 8","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 4.0","#define FXAA_QUALITY_P7 8.0","#endif","#if (FXAA_QUALITY_PRESET == 26)","#define FXAA_QUALITY_PS 9","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 4.0","#define FXAA_QUALITY_P8 8.0","#endif","#if (FXAA_QUALITY_PRESET == 27)","#define FXAA_QUALITY_PS 10","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 4.0","#define FXAA_QUALITY_P9 8.0","#endif","#if (FXAA_QUALITY_PRESET == 28)","#define FXAA_QUALITY_PS 11","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 2.0","#define FXAA_QUALITY_P9 4.0","#define FXAA_QUALITY_P10 8.0","#endif","#if (FXAA_QUALITY_PRESET == 29)","#define FXAA_QUALITY_PS 12","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.5","#define FXAA_QUALITY_P2 2.0","#define FXAA_QUALITY_P3 2.0","#define FXAA_QUALITY_P4 2.0","#define FXAA_QUALITY_P5 2.0","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 2.0","#define FXAA_QUALITY_P9 2.0","#define FXAA_QUALITY_P10 4.0","#define FXAA_QUALITY_P11 8.0","#endif","#if (FXAA_QUALITY_PRESET == 39)","#define FXAA_QUALITY_PS 12","#define FXAA_QUALITY_P0 1.0","#define FXAA_QUALITY_P1 1.0","#define FXAA_QUALITY_P2 1.0","#define FXAA_QUALITY_P3 1.0","#define FXAA_QUALITY_P4 1.0","#define FXAA_QUALITY_P5 1.5","#define FXAA_QUALITY_P6 2.0","#define FXAA_QUALITY_P7 2.0","#define FXAA_QUALITY_P8 2.0","#define FXAA_QUALITY_P9 2.0","#define FXAA_QUALITY_P10 4.0","#define FXAA_QUALITY_P11 8.0","#endif","#define FxaaBool bool","#define FxaaFloat float","#define FxaaFloat2 vec2","#define FxaaFloat3 vec3","#define FxaaFloat4 vec4","#define FxaaHalf float","#define FxaaHalf2 vec2","#define FxaaHalf3 vec3","#define FxaaHalf4 vec4","#define FxaaInt2 vec2","#define FxaaTex sampler2D","#define FxaaSat(x) clamp(x, 0.0, 1.0)","#define FxaaTexTop(t, p) texture2D(t, p)","#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))","FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","FxaaFloat4 FxaaPixelShader(","FxaaFloat2 pos,","FxaaTex tex,","FxaaFloat2 fxaaQualityRcpFrame,","FxaaFloat fxaaQualitySubpix,","FxaaFloat fxaaQualityEdgeThreshold,","FxaaFloat fxaaQualityEdgeThresholdMin",") {","FxaaFloat2 posM;","posM.x = pos.x;","posM.y = pos.y;","FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","#define lumaM rgbyM.y","FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","FxaaFloat maxSM = max(lumaS, lumaM);","FxaaFloat minSM = min(lumaS, lumaM);","FxaaFloat maxESM = max(lumaE, maxSM);","FxaaFloat minESM = min(lumaE, minSM);","FxaaFloat maxWN = max(lumaN, lumaW);","FxaaFloat minWN = min(lumaN, lumaW);","FxaaFloat rangeMax = max(maxWN, maxESM);","FxaaFloat rangeMin = min(minWN, minESM);","FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","FxaaFloat range = rangeMax - rangeMin;","FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","FxaaBool earlyExit = range < rangeMaxClamped;","if(earlyExit)","return rgbyM;","FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","FxaaFloat lumaNS = lumaN + lumaS;","FxaaFloat lumaWE = lumaW + lumaE;","FxaaFloat subpixRcpRange = 1.0/range;","FxaaFloat subpixNSWE = lumaNS + lumaWE;","FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","FxaaFloat lumaNESE = lumaNE + lumaSE;","FxaaFloat lumaNWNE = lumaNW + lumaNE;","FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","FxaaFloat lumaNWSW = lumaNW + lumaSW;","FxaaFloat lumaSWSE = lumaSW + lumaSE;","FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","FxaaBool horzSpan = edgeHorz >= edgeVert;","FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","if(!horzSpan) lumaN = lumaW;","if(!horzSpan) lumaS = lumaE;","if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","FxaaFloat gradientN = lumaN - lumaM;","FxaaFloat gradientS = lumaS - lumaM;","FxaaFloat lumaNN = lumaN + lumaM;","FxaaFloat lumaSS = lumaS + lumaM;","FxaaBool pairN = abs(gradientN) >= abs(gradientS);","FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","if(pairN) lengthSign = -lengthSign;","FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","FxaaFloat2 posB;","posB.x = posM.x;","posB.y = posM.y;","FxaaFloat2 offNP;","offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","if(!horzSpan) posB.x += lengthSign * 0.5;","if( horzSpan) posB.y += lengthSign * 0.5;","FxaaFloat2 posN;","posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","FxaaFloat2 posP;","posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","FxaaFloat subpixE = subpixC * subpixC;","FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","if(!pairN) lumaNN = lumaSS;","FxaaFloat gradientScaled = gradient * 1.0/4.0;","FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","FxaaFloat subpixF = subpixD * subpixE;","FxaaBool lumaMLTZero = lumaMM < 0.0;","lumaEndN -= lumaNN * 0.5;","lumaEndP -= lumaNN * 0.5;","FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","FxaaBool doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","#if (FXAA_QUALITY_PS > 3)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","#if (FXAA_QUALITY_PS > 4)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","#if (FXAA_QUALITY_PS > 5)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","#if (FXAA_QUALITY_PS > 6)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","#if (FXAA_QUALITY_PS > 7)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","#if (FXAA_QUALITY_PS > 8)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","#if (FXAA_QUALITY_PS > 9)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","#if (FXAA_QUALITY_PS > 10)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","#if (FXAA_QUALITY_PS > 11)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","#if (FXAA_QUALITY_PS > 12)","if(doneNP) {","if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","doneN = abs(lumaEndN) >= gradientScaled;","doneP = abs(lumaEndP) >= gradientScaled;","if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","doneNP = (!doneN) || (!doneP);","if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","#endif","}","FxaaFloat dstN = posM.x - posN.x;","FxaaFloat dstP = posP.x - posM.x;","if(!horzSpan) dstN = posM.y - posN.y;","if(!horzSpan) dstP = posP.y - posM.y;","FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","FxaaFloat spanLength = (dstP + dstN);","FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","FxaaFloat spanLengthRcp = 1.0/spanLength;","FxaaBool directionN = dstN < dstP;","FxaaFloat dst = min(dstN, dstP);","FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","FxaaFloat subpixG = subpixF * subpixF;","FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","return FxaaTexTop(tex, posM);","}","void main() {","gl_FragColor = FxaaPixelShader(","vUV,","uTexture,","uTexelOffset,","fxaaQualitySubpix,","fxaaQualityEdgeThreshold,","fxaaQualityEdgeThresholdMin);","}"].join("\n"),t={type:"fxaa",id:"fxaa",uniforms:{uTexelOffset:new Float32Array([1/window.innerWidth,1/window.innerHeight])},textures:{uTexture:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"---SET_ME---"},r=Human.renderer.postprocess.effects.fxaa={scene:null};r.init=function(t){this.scene=t,t.createPostProcessType("fxaa",e)},r.addStage=function(e){var r=e.getIOFramebuffers("final");t.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,t.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height,t.textures.uTexture.framebuffer=r.read,t.framebuffer=r.write,e.finalPipeline.push(t)},r.configure=function(){},r.updateCanvas=function(){t.uniforms.uTexelOffset[0]=1/Human.renderer.canvas.width,t.uniforms.uTexelOffset[1]=1/Human.renderer.canvas.height;var e=this.scene.getPostProcessStage("fxaa");e&&e.setUniform("uTexelOffset",t.uniforms.uTexelOffset)}}(),function(){"use strict";var e=["#extension GL_OES_standard_derivatives : require","precision highp float;","#define PI2 6.283185","#define TAU (PI2 * 2.0)","#define NUM_SAMPLES 16.0","#define SAMPLE_WEIGHT (1.0 / NUM_SAMPLES)","#define EPSILON 0.0001","varying vec2 vUV;","uniform float uSampleRadius;","uniform float uIntensity;","uniform float uContrast;","uniform float uBias;","uniform vec2 uTexelOffset;","uniform vec3 uDepthParams;","uniform vec3 uXYParams;","uniform sampler2D uDepthBuffer;","vec3 getPosition(float fragDepth, vec2 uv) {","vec2 clipCoord = uv * 2.0 - 1.0;","float zView = uDepthParams.x / (fragDepth * uDepthParams.y + uDepthParams.z);","return vec3(","clipCoord.x * zView * uXYParams.x * uXYParams.y,","clipCoord.y * zView * uXYParams.y,","zView",");","}","vec2 packDepth(float viewZ) {","    float d = viewZ / -uDepthParams.z;","float temp = floor(d * 256.0);","return vec2(","    temp / 256.0,","    d * 256.0 - temp",");","}","void main() {","float fragDepth = texture2D(uDepthBuffer, vUV).x;","if (fragDepth == 1.0) { discard; }","vec3 position = getPosition(fragDepth, vUV);","vec3 normal = normalize(cross(dFdx(position), dFdy(position)));","float ssRadius = min((uXYParams.z * uSampleRadius) / (position.z + EPSILON), 32.0);","if (ssRadius < 4.0) { discard; }","float occlusion = 0.0;","for (int i = 0; i < int(NUM_SAMPLES); ++i) {","   float a = (float(i) + 0.5) * SAMPLE_WEIGHT;","   float h = ssRadius * a;","   float theta = a * TAU;","   vec2 u = vec2(cos(theta), sin(theta));","   vec2 uv = vUV + h * u * uTexelOffset;","   fragDepth = texture2D(uDepthBuffer, uv).x;","   vec3 samplePosition = getPosition(fragDepth, uv);","   vec3 dir = samplePosition - position;","   float len2 = dot(dir, dir);","   float f = max(0.0, uSampleRadius * uSampleRadius - len2);","   occlusion += f * f * f * max(0.0, dot(dir, normal) - uBias) / (len2 + EPSILON);","}","occlusion = max(0.0, occlusion * 2.0 * uIntensity * SAMPLE_WEIGHT);","vec2 odd = mod(gl_FragCoord.xy, 2.0);","if (abs(dFdx(position.z)) < 0.02) {","    occlusion -= dFdx(occlusion) * (odd.x - 0.5);","}","if (abs(dFdy(position.z)) < 0.02) {","    occlusion -= dFdy(occlusion) * (odd.y - 0.5);","}","gl_FragColor.r = occlusion;","gl_FragColor.gb = packDepth(position.z);","}"].join("\n"),t=["precision highp float;","varying vec2 vUV;","uniform sampler2D uColorBuffer;","uniform vec2 uTexelOffset;","float unpackDepth(vec2 p) {","    return p.x + p.y / 256.0;","}","void main() {","float gaussian[5];","gaussian[0] = 0.153170;","gaussian[1] = 0.144893;","gaussian[2] = 0.122649;","gaussian[3] = 0.092902;","gaussian[4] = 0.062970;","vec3 centerValue = texture2D(uColorBuffer, vUV).rgb;","float totalWeight = gaussian[0];","float sum = centerValue.r * totalWeight;","float centerDepth = unpackDepth(centerValue.gb);","for (int r = 1; r <= 4; ++r) {","    vec2 uv = vUV + uTexelOffset * float(r) * 2.0;","    vec3 sampleValue = texture2D(uColorBuffer, uv).rgb;","    float sampleDepth = unpackDepth(sampleValue.gb);","    float weight = gaussian[r];","    weight *= max(0.0, 1.0 - 10.0 * abs(sampleDepth - centerDepth));","    sum += sampleValue.r * weight;","    totalWeight += weight;","}","for (int r = 1; r <= 4; ++r) {","    vec2 uv = vUV + uTexelOffset * -float(r) * 2.0;","    vec3 sampleValue = texture2D(uColorBuffer, uv).rgb;","    float sampleDepth = unpackDepth(sampleValue.gb);","    float weight = gaussian[r];","    weight *= max(0.0, 1.0 - 10.0 * abs(sampleDepth - centerDepth));","    sum += sampleValue.r * weight;","    totalWeight += weight;","}","gl_FragColor.r = sum / (totalWeight + 0.0001);","}"].join("\n"),r=["precision highp float;","varying vec2 vUV;","uniform sampler2D uColorBuffer;","uniform sampler2D uOcclusionBuffer;","uniform float uOcclusionScale;","uniform float uOcclusionCutoff;","void main() {","vec4 color = texture2D(uColorBuffer, vUV);","float ambient = 1.0 - smoothstep(uOcclusionCutoff, 1.0, texture2D(uOcclusionBuffer, vUV).r) * uOcclusionScale;","gl_FragColor = vec4(color.rgb * ambient, color.a);","}"].join("\n"),a={type:"sao",id:"sao",uniforms:{uSampleRadius:.4,uIntensity:8,uBias:.001,uTexelOffset:new Float32Array([1/window.innerWidth,1/window.innerHeight]),uXYParams:new Float32Array(3),uDepthParams:new Float32Array(3)},textures:{uDepthBuffer:{framebuffer:"__MAIN",target:"depth"}},framebuffer:"__BDS_SAO"},i={type:"saoblur",id:"saohblur",uniforms:{uTexelOffset:new Float32Array([1/window.innerWidth,0])},textures:{uColorBuffer:{framebuffer:"__BDS_SAO",target:"color"}},framebuffer:"---SET_ME---"},n={type:"saoblur",id:"saovblur",uniforms:{uTexelOffset:new Float32Array([0,1/window.innerHeight])},textures:{uColorBuffer:{framebuffer:"---SET_ME---",target:"color"}},framebuffer:"__BDS_SAO"},o={type:"saoblend",id:"saoblend",uniforms:{uOcclusionScale:.9,uOcclusionCutoff:.3},textures:{uColorBuffer:{framebuffer:"---SET_ME---",target:"color"},uOcclusionBuffer:{framebuffer:"__BDS_SAO",target:"color"}},framebuffer:"--SET_ME---"},s=Human.renderer.postprocess.effects.sao={scene:null,supported:SceneJS.WEBGL_INFO.depthTexturesSupported,fbInitialized:!1,sampleRadius:.9,intensity:50,bias:.1,scale:.9};s.init=function(a){this.scene=a,this.supported&&(a.createPostProcessType("sao",e),a.createPostProcessType("saoblur",t),a.createPostProcessType("saoblend",r))},s.addStage=function(e){if(this.supported){this.fbInitialized||this.scene.createFramebuffer("__BDS_SAO",{depthAttachment:!1});var t=this.scene.getProjection(),r=t.aspect,s=t.fov*Math.PI/180,l=t.near,c=t.far,u=-Math.tan(.5*s),_=-Human.renderer.canvas.height/(2*Math.tan(.5*s)),h=Human.renderer.canvas.width,f=Human.renderer.canvas.height,d=e.getIOFramebuffers("opaque"),p=d.read,m=d.write;a.uniforms.uSampleRadius=this.sampleRadius,a.uniforms.uIntensity=this.intensity,a.uniforms.uBias=this.bias,a.uniforms.uTexelOffset[0]=1/h,a.uniforms.uTexelOffset[1]=1/f,a.uniforms.uXYParams[0]=r,a.uniforms.uXYParams[1]=u,a.uniforms.uXYParams[2]=_,a.uniforms.uDepthParams[0]=-l*c,a.uniforms.uDepthParams[1]=l-c,a.uniforms.uDepthParams[2]=c,i.uniforms.uTexelOffset[0]=1/h,i.uniforms.uTexelOffset[1]=0,i.framebuffer=m,n.uniforms.uTexelOffset[0]=0,n.uniforms.uTexelOffset[1]=1/f,n.textures.uColorBuffer.framebuffer=m,o.uniforms.uOcclusionScale=this.scale,o.textures.uColorBuffer.framebuffer=p,o.framebuffer=m,e.opaquePipeline.push(a),e.opaquePipeline.push(i),e.opaquePipeline.push(n),e.opaquePipeline.push(o)}},s.setSampleRadius=function(e){this.sampleRadius=a.uniforms.uSampleRadius=e;var t=this.scene.getPostProcessStage("sao");t&&t.setUniform("uSampleRadius",this.sampleRadius)},s.setIntensity=function(e){this.intensity=a.uniforms.uIntensity=e;var t=this.scene.getPostProcessStage("sao");t&&t.setUniform("uIntensity",this.intensity)},s.setBias=function(e){this.bias=a.uniforms.uBias=e;var t=this.scene.getPostProcessStage("sao");t&&t.setUniform("uBias",this.bias)},s.setOcclusionScale=function(e){this.scale=o.uniforms.uOcclusionScale=e;var t=this.scene.getPostProcessStage("saoblend");t&&t.setUniform("uOcclusionScale",this.scale)},s.setOcclusionCutoff=function(e){this.cutoff=o.uniforms.uOcclusionCutoff=e;var t=this.scene.getPostProcessStage("saoblend");t&&t.setUniform("uOcclusionCutoff",this.cutoff)},s.configure=function(e){(e=e||{}).sampleRadius=void 0===e.sampleRadius?.9:e.sampleRadius,e.intensity=void 0===e.intensity?50:e.intensity,e.bias=void 0===e.bias?.1:e.bias,e.scale=void 0===e.scale?.9:e.scale,e.cutoff=void 0===e.cutoff?.3:e.cutoff,this.setSampleRadius(e.sampleRadius),this.setIntensity(e.intensity),this.setBias(e.bias),this.setOcclusionScale(e.scale),this.setOcclusionCutoff(e.cutoff)},s.updateProjection=function(){var e=this.scene.getProjection(),t=e.aspect,r=e.fov*Math.PI/180,i=e.near,n=e.far,o=-Math.tan(.5*r),s=-Human.renderer.canvas.height/(2*Math.tan(.5*r));a.uniforms.uXYParams[0]=t,a.uniforms.uXYParams[1]=o,a.uniforms.uXYParams[2]=s,a.uniforms.uDepthParams[0]=-i*n,a.uniforms.uDepthParams[1]=i-n,a.uniforms.uDepthParams[2]=n;var l=this.scene.getPostProcessStage("sao");l&&(l.setUniform("uXYParams",a.uniforms.uXYParams),l.setUniform("uDepthParams",a.uniforms.uDepthParams))},s.updateCanvas=function(){var e=Human.renderer.canvas.width,t=Human.renderer.canvas.height,r=this.scene.getProjection(),o=r.aspect,s=r.fov*Math.PI/180,l=-Math.tan(.5*s),c=-Human.renderer.canvas.height/(2*Math.tan(.5*s));a.uniforms.uTexelOffset[0]=1/e,a.uniforms.uTexelOffset[1]=1/t,a.uniforms.uXYParams[0]=o,a.uniforms.uXYParams[1]=l,a.uniforms.uXYParams[2]=c,i.uniforms.uTexelOffset[0]=1/e,n.uniforms.uTexelOffset[1]=1/t;var u=this.scene.getPostProcessStage("sao"),_=this.scene.getPostProcessStage("saohblur"),h=this.scene.getPostProcessStage("saovblur");u&&_&&h&&(u.setUniform("uXYParams",a.uniforms.uXYParams),u.setUniform("uTexelOffset",a.uniforms.uTexelOffset),_.setUniform("uTexelOffset",i.uniforms.uTexelOffset),h.setUniform("uTexelOffset",n.uniforms.uTexelOffset))}}(),function(){"use strict";var e,t,r,a,i=1,n=[0,0,0],o=0,s={},l={0:"0",.1:"1",.2:"2",.3:"3",.4:"4",.5:"5",.6:"6",.7:"7",.8:"8",.9:"9",1:"10"};function c(e){var t=l[e.toString()];return(window.localBaseDirectory||"/")+"assets/images/blur/blur_"+t+".png"}function u(e,t){var r=mat4.create(),a=mat4.create();return mat4.fromXRotation(a,.0174532925*-90),mat4.translate(r,r,e),mat4.mul(r,r,a),mat4.scale(r,r,[t,t,t]),r}var _=Human.renderer.groundShadow={};_.init=function(){if(!t){var s={type:"material",baseColor:{r:0,g:0,b:0},nodes:[{type:"texture",id:"shadowTexture",src:c(e||.5),applyTo:"alpha",blendMode:"add",nodes:[{type:"xform",id:"shadowTransform",nodes:[{id:"shadowPlane",type:"geometry/plane"}]}]}]},l=Human.renderer.getScene();t=l.addNode(s),(r=l.getNode("shadowTransform")).setElements(u(n,o)),l.getNode("shadowPlane").nodes[0].setBackfaces(!1),(a=l.getNode("shadowTexture")).setBlendFactor(i)}},_.destroy=function(){t&&(t.destroy(),t=null,r=null,a=null)},_.update=function(t){if(i=t.opacity,r.setElements(u(n=t.translation,o=t.scale)),a.setBlendFactor(i),e!==t.blurAmount){var l=function(e){var t=c(e);if(s[t])return s[t];var r=new Image;return r.src=t,s[t]=r,r}(t.blurAmount);switch(l.complete){case!0:a.setImage(l);break;case!1:l.onload=function(){a.setImage(l)}}}e=t.blurAmount}}(),function(){"use strict";var e=new Human.utils.selection.GraphMatcher,t=Human.scene={};function r(e,t){var a,i,n=e.matrixDirty,o=n||t,s=o;if(n&&e.buildMatrix(),o&&(e.parent?mat4.multiply(e.worldMatrix,e.parent.worldMatrix,e.localMatrix):e.worldMatrix.set(e.localMatrix),e.matrixDirty=!1),e.isLeaf())return o?(e.compileXform(),!0):!!e.geoDirty&&(e.compileBoundary(),e.geoDirty=!1,!0);for(a=0,i=e.objects.length;a<i;++a)r(e.objects[a],o)&&(s=!0);if(s){for(e.boundary.xmin=Number.POSITIVE_INFINITY,e.boundary.ymin=Number.POSITIVE_INFINITY,e.boundary.zmin=Number.POSITIVE_INFINITY,e.boundary.xmax=Number.NEGATIVE_INFINITY,e.boundary.ymax=Number.NEGATIVE_INFINITY,e.boundary.zmax=Number.NEGATIVE_INFINITY,a=0,i=e.objects.length;a<i;++a){var l=e.objects[a].getBoundary();e.boundary.xmin=Math.min(e.boundary.xmin,l.xmin),e.boundary.ymin=Math.min(e.boundary.ymin,l.ymin),e.boundary.zmin=Math.min(e.boundary.zmin,l.zmin),e.boundary.xmax=Math.max(e.boundary.xmax,l.xmax),e.boundary.ymax=Math.max(e.boundary.ymax,l.ymax),e.boundary.zmax=Math.max(e.boundary.zmax,l.zmax)}e.center[0]=.5*(e.boundary.xmin+e.boundary.xmax),e.center[1]=.5*(e.boundary.ymin+e.boundary.ymax),e.center[2]=.5*(e.boundary.zmin+e.boundary.zmax)}return s}t.rootObjects=[],t.modelObjects={},t.objects={},t.colorModPriorities={__HIGHLIGHT:Number.POSITIVE_INFINITY},t.objectsByFMAID={},t.objectsForTags={},t._kdTree=null,t.kdTreeDirty=!0,t.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},t.center=vec3.create(),t.enabledObjects={},t._leavesCache={},t.createObject=function(e){if(e.objectId){if(!t.objects[e.objectId]){var r=e.parentObjectId?t.objects[e.parentObjectId]:null,a=e.modelId;e.tags=e.tags||[];var i,n=r?t._inheritTags(e.tags,r):e.tags;return e.modelId=a,e.parent=r,e.tags=n,r&&(e.reflectedX=r.reflectedX,e.reflectedY=r.reflectedY,e.reflectedZ=r.reflectedZ),i=e.group?new Human.scene.Group(e):new Human.scene.Object(e),t.objects[e.objectId]=i,i.fmaId&&(t.objectsByFMAID[i.fmaId]=i),r?r.objects.push(i):t.rootObjects.push(i),(t.modelObjects[a]=t.modelObjects[a]||{})[e.objectId]=i,t._registerObjectForTags(i),Human.events.fire("scene.objectCreated",{moduleId:e.moduleId,modelId:a,objectId:i.objectId,name:i.displayName,description:i.description,displayName:i.displayName,fmaId:i.fmaId,tags:i.tags,parentObjectId:r?r.objectId:null}),void 0!==e.shown&&(i.show(e.shown),e.shown&&(t.enabledObjects[e.objectId]=i)),t._leavesCache={},i}Human.log.error("Scene.createObject","Param: objectId already in use")}else Human.log.error("Scene.createObject","Param expected: objectId")},t._inheritTags=function(e,t){var r,a=e||[],i=t.tags,n=[];if(a){for(var o=0,s=i.length;o<s;o++){r=i[o];for(var l=!0,c=0,u=a.length;c<u;c++)a[c]===r&&(l=!1);l&&n.push(r)}return a.concat(n)}return a},t._registerObjectForTags=function(e){for(var r,a,i=e.tags,n=0,o=i.length;n<o;n++)(a=t.objectsForTags[r=i[n]])||(a=t.objectsForTags[r]={}),a[e.objectId]=e},t._deregisterObjectForTags=function(e){for(var r,a=e.tags,i=0,n=a.length;i<n;i++)(r=t.objectsForTags[a[i]])&&delete r[e.objectId]},t.setEnabledObjects=function(e){var r={},a=e.fetchAssets?[]:null;t.setEnabledSubtree(Human.scene.rootObjects,e.objects||e.objectIds,!e.replace&&void 0,a,r),a&&Human.scene.graph.attachAssetSetsToSubtree(a),Human.utils.isEmpty(r)||Human.events.fire("scene.objectsShown",{enabledObjectsUpdate:r})},t.setEnabledSubtree=function(e,r,a,i,n){for(var o=0,s=e.length;o<s;++o){var l=e[o],c=void 0!==r[l.objectId]?r[l.objectId]:a;l.isLeaf()?!0===c?t.enabledObjects[l.objectId]||(t.enabledObjects[l.objectId]=l,n[l.objectId]=!0,l.show(!0),i&&!l.isRenderable()&&i.push(l)):!1===c&&t.enabledObjects[l.objectId]&&(delete t.enabledObjects[l.objectId],n[l.objectId]=!1,l.show(!1)):t.setEnabledSubtree(l.objects,r,c,i,n)}},t.setColorModPriority=function(e,t){this.colorModPriorities[e]=t;for(var r=this.getLeaves(),a=0,i=r.length;a<i;++a)Human.scene.objects[r[a]].colorModPrioritiesDirty()},t.getLeaves=function(e){var r=t._leavesCache[e];if(!r){if(r=[],e){var a=t.objects[e];a&&t._getLeaves([a],r)}else t._getLeaves(Human.scene.rootObjects,r);t._leavesCache[e]=r}return r},t._getLeaves=function(e,r){for(var a,i=0,n=e.length;i<n;i++)0===(a=e[i]).objects.length?r.push(a.objectId):t._getLeaves(a.objects,r)},t.getEnabledLeaves=function(e){var r;if(e){var a=t.objects[e];r=[],a&&t._getEnabledLeaves([a],r)}else r=Object.keys(t.enabledObjects);return r},t._getEnabledLeaves=function(e,r){for(var a,i=0,n=e.length;i<n;i++)0===(a=e[i]).objects.length?t.enabledObjects.hasOwnProperty(a.objectId)&&r.push(a.objectId):t._getEnabledLeaves(a.objects,r)},t._getKeys=function(e,t){for(var r in e)e.hasOwnProperty(r)&&(r[r]=t);return{}},t.destroyObject=function(e){var r=t.objects[e];if(r&&!r._destroyed){var a,i;for(a=0,i=t.rootObjects.length;a<i;a++)if(t.rootObjects[a].objectId===e){t.rootObjects.splice(a,1);break}delete t.objects[e],r.fmaId&&delete t.objectsByFMAID[r.fmaId],delete t.enabledObjects[e],r.parent&&r.parent._removeObject(e);var n=r.objects.slice(0);for(a=0,i=n.length;a<i;a++)t.destroyObject(n[a].objectId);r.isLeaf()&&r.destroyNodes(),delete t.modelObjects[r.modelId][r.objectId],t._deregisterObjectForTags(r),t._leavesCache={},Human.events.fire("scene.objectDestroyed",{objectId:e})}},t.getBoundary=function(e){if(!e)return this.boundary;var r,a,i,n;if((e=e||{}).objectIds){i={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY};for(var o=e.objectIds,s=0,l=o.length;s<l;s++)(r=t.objects[o[s]])&&0===r.objects.length&&((n=r.getBoundary()).xmin<i.xmin&&(i.xmin=n.xmin),n.ymin<i.ymin&&(i.ymin=n.ymin),n.zmin<i.zmin&&(i.zmin=n.zmin),n.xmax>i.xmax&&(i.xmax=n.xmax),n.ymax>i.ymax&&(i.ymax=n.ymax),n.zmax>i.zmax&&(i.zmax=n.zmax))}else if(e.objects){i={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY};var c=e.objects;for(a in c)c[a]&&t.objects[a]&&0===(r=t.objects[a]).objects.length&&((n=r.getBoundary()).xmin<i.xmin&&(i.xmin=n.xmin),n.ymin<i.ymin&&(i.ymin=n.ymin),n.zmin<i.zmin&&(i.zmin=n.zmin),n.xmax>i.xmax&&(i.xmax=n.xmax),n.ymax>i.ymax&&(i.ymax=n.ymax),n.zmax>i.zmax&&(i.zmax=n.zmax))}else i=e.clipped?Human.utils.deepClone(this.boundary):this.boundary;if(e.clipped){var u=Human.renderer.clip.getBoundary();i.xmin=Math.max(i.xmin,u.xmin),i.xmax=Math.min(i.xmax,u.xmax),i.ymin=Math.max(i.ymin,u.ymin),i.ymax=Math.min(i.ymax,u.ymax),i.zmin=Math.max(i.zmin,u.zmin),i.zmax=Math.min(i.zmax,u.zmax)}return i},t.getKdTree=function(){if(this.kdTreeDirty){for(var e=Human.scene.rootObjects,t=[],r=function(e){e.shown&&0===e.objects.length&&t.push(e)},i=0,n=e.length;i<n;++i)e[i].traverseDown(r);this._kdTree=function e(t,r,i){var n,o,s,l,c=vec3.create(),u=vec3.create(),_={objects:t,left:null,right:null,bb:{min:c,max:u}};if(0===t.length)return _;for(c[0]=c[1]=c[2]=Number.POSITIVE_INFINITY,u[0]=u[1]=u[2]=Number.NEGATIVE_INFINITY,s=0,l=t.length;s<l;++s)(o=(n=t[s]).getBoundary()).xmin<c[0]&&(c[0]=o.xmin),o.xmax>u[0]&&(u[0]=o.xmax),o.ymin<c[1]&&(c[1]=o.ymin),o.ymax>u[1]&&(u[1]=o.ymax),o.zmin<c[2]&&(c[2]=o.zmin),o.zmax>u[2]&&(u[2]=o.zmax);if(i>10)return _;var h=a[r],f=(c[r]+u[r])/2,d=new Array(t.length),p=0,m=new Array(t.length),g=0;for(s=0,l=t.length;s<l;++s)(o=(n=t[s]).getBoundary())[h]<=f?d[p++]=n:m[g++]=n;return p<1||g<1||(d.length=p,m.length=g,_.left=e(d,(r+1)%3,i+1),_.right=e(m,(r+1)%3,i+1)),_}(t,0,0),this.kdTreeDirty=!1}return this._kdTree},t.access=function(e){return t.getLeaves(e)},t.select=function(r){return e.match(t,r)},t.setObjectProperties=function(e){e=e||{};var r={},a={},i={},n={transform:!0},o=Human.scene.rootObjects;function s(o){var s=r[o.objectId]=e[o.objectId]||{};if(o.parent){var l=r[o.parent.objectId];for(var c in l)void 0!==s[c]||n[c]||(s[c]=l[c]);s.glassFactor=o.glassFactor,s.murkiness=o.murkiness}s.hasOwnProperty("shown")&&o.shown!==s.shown&&o.isLeaf()&&(a[o.objectId]=s.shown),o.isLeaf()&&(s.shown?(i[o.objectId]=o,t.enabledObjects[o.objectId]=o):delete t.enabledObjects[o.objectId],o.clearColorModifiers(),o.clearOpacityModifiers(),o.setProperties(s))}for(var l=0,c=o.length;l<c;l++)o[l].traverseDown(s);Human.events.fire("scene.objectsShown",{enabledObjectsUpdate:a,showSelectedObjects:t.showSelectedObjects}),Human.events.fire("scene.objectPropertiesSet",{instructions:e})},t.onFrame=function(){var e,t,a=!1;for(e=0,t=this.rootObjects.length;e<t;++e)r(this.rootObjects[e],!1)&&(a=!0);if(a){for(this.boundary.xmin=Number.POSITIVE_INFINITY,this.boundary.ymin=Number.POSITIVE_INFINITY,this.boundary.zmin=Number.POSITIVE_INFINITY,this.boundary.xmax=Number.NEGATIVE_INFINITY,this.boundary.ymax=Number.NEGATIVE_INFINITY,this.boundary.zmax=Number.NEGATIVE_INFINITY,e=0,t=this.rootObjects.length;e<t;++e){var i=this.rootObjects[e].getBoundary();this.boundary.xmin=Math.min(this.boundary.xmin,i.xmin),this.boundary.ymin=Math.min(this.boundary.ymin,i.ymin),this.boundary.zmin=Math.min(this.boundary.zmin,i.zmin),this.boundary.xmax=Math.max(this.boundary.xmax,i.xmax),this.boundary.ymax=Math.max(this.boundary.ymax,i.ymax),this.boundary.zmax=Math.max(this.boundary.zmax,i.zmax)}this.center[0]=.5*(this.boundary.xmin+this.boundary.xmax),this.center[1]=.5*(this.boundary.ymin+this.boundary.ymax),this.center[2]=.5*(this.boundary.zmin+this.boundary.zmax)}},t.cull=function(){!function e(t,r,a){var i,n,o=t.bb.min,s=t.bb.max,c=1,u=1;if(r&&(c=Human.math.intersections.planesAabb(r,o,s)),a&&(u=Human.math.intersections.planesAabb(a,o,s)),-1!==u)if(-1!==c)if(1===c&&(r=null),1===u&&(a=null),0===c||0===u)if(t.left)e(t.left,r,a),e(t.right,r,a);else for(i=0,n=t.objects.length;i<n;++i)l(t.objects[i],r,a);else for(i=0,n=t.objects.length;i<n;++i)t.objects[i].frustumCull(!1),t.objects[i].clipCull(!1);else for(i=0,n=t.objects.length;i<n;++i)t.objects[i].frustumCull(!0);else for(i=0,n=t.objects.length;i<n;++i)t.objects[i].clipCull(!0)}(this.getKdTree(),Human.renderer.camera.getFrustum(),Human.renderer.clip.getActiveClips())};var a=["xmin","ymin","zmin"],i=vec3.create(),n=vec3.create(),o=new Array(6),s=[];function l(e,t,r){var a=e.getBoundary();i[0]=a.xmin,i[1]=a.ymin,i[2]=a.zmin,n[0]=a.xmax,n[1]=a.ymax,n[2]=a.zmax;var l=1,c=1,u=!1;if(t&&(l=Human.math.intersections.planesAabb(t,i,n,o)),r){s.length=r.length,c=Human.math.intersections.planesAabb(r,i,n,s);for(var _=0,h=s.length;_<h&&void 0!==s[_];++_)if(0===s[_]&&r[_].fade){u=!0;break}}e.frustumCull(-1===l),e.clipCull(-1===c),-1!==l&&-1!==c&&(e.clipFade(u),e.setVisiblyClipped(0===l&&0===o[Human.renderer.camera.FRUSTUM_NEAR]||0===c))}}(),function(){"use strict";Human.scene.Group=function(e){this.modelId=e.modelId,this.objectId=e.objectId,this.fmaId=e.fmaId,this.layer=e.layer,this.displayName=e.displayName,this.description=e.description,this.parent=e.parent,this.tags=e.tags,this.anonymous=e.anonymous,this.objects=[],this.reflectedX=e.reflectedX||!1,this.reflectedY=e.reflectedY||!1,this.reflectedZ=e.reflectedZ||!1,this.localMatrix=mat4.create(),this.worldMatrix=mat4.create(),this._worldToObjectMatrix=mat4.create(),this.matrixDirty=!1,this.geoDirty=!1,this.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this.center=vec3.create(),this.transformId=e.transformId,this.transformInitialized=!e.transformId,this.transformAssetAttached=!1,this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1},this.rotate={x:0,y:0,z:0},this._transformNode=null,(e.pivot||e.translate||e.scale||e.rotate)&&this.setTransform(e)},Human.scene.Group.prototype.checkRenderable=function(){for(var e=0,t=this.objects.length;e<t;++e)this.objects[e].checkRenderable()},Human.scene.Group.prototype.isVisible=function(){var e=this.getLeafObjects().length;return this.getShownObjects().length===e&&this.getRenderableObjects().length===e},Human.scene.Group.prototype.isLeaf=function(){return!1},Human.scene.Group.prototype.setTransform=function(e){null===this.pivot&&(this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.rotate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1}),e.pivot&&(void 0!==e.pivot.x&&(this.pivot.x=e.pivot.x),void 0!==e.pivot.y&&(this.pivot.y=e.pivot.y),void 0!==e.pivot.z&&(this.pivot.z=e.pivot.z)),e.translate&&(void 0!==e.translate.x&&(this.translate.x=e.translate.x),void 0!==e.translate.y&&(this.translate.y=e.translate.y),void 0!==e.translate.z&&(this.translate.z=e.translate.z)),e.scale&&(void 0!==e.scale.x&&(this.scale.x=e.scale.x),void 0!==e.scale.y&&(this.scale.y=e.scale.y),void 0!==e.scale.z&&(this.scale.z=e.scale.z),e.scale.x<0&&this.setReflectedX(!0),e.scale.y<0&&this.setReflectedY(!0),e.scale.z<0&&this.setReflectedZ(!0)),e.rotate&&(void 0!==e.rotate.x&&(this.rotate.x=e.rotate.x),void 0!==e.rotate.y&&(this.rotate.y=e.rotate.y),void 0!==e.rotate.z&&(this.rotate.z=e.rotate.z)),this.transformInitialized||(this.transformInitialized=!0,this.checkRenderable()),this.matrixDirty=!0};var e=mat4.create(),t=mat4.create(),r=mat4.create(),a=mat4.create(),i=mat4.create(),n=mat4.create();Human.scene.Group.prototype.buildMatrix=function(){var o=this.pivot,s=this.translate;mat4.fromTranslation(e,[-o.x,-o.y,-o.z]);var l=this.scale;mat4.fromScaling(t,[l.x,l.y,l.z]),mat4.fromTranslation(r,[s.x+o.x,s.y+o.y,s.z+o.z]);var c=this.rotate;mat4.fromRotation(a,c.z*Math.PI/180,Human.math.Z_AXIS),mat4.fromRotation(i,c.y*Math.PI/180,Human.math.Y_AXIS),mat4.fromRotation(n,c.x*Math.PI/180,Human.math.X_AXIS),mat4.identity(this.localMatrix),mat4.multiply(this.localMatrix,e,this.localMatrix),mat4.multiply(this.localMatrix,t,this.localMatrix),mat4.multiply(this.localMatrix,n,this.localMatrix),mat4.multiply(this.localMatrix,i,this.localMatrix),mat4.multiply(this.localMatrix,a,this.localMatrix),mat4.multiply(this.localMatrix,r,this.localMatrix),this.matrixDirty=!1},Human.scene.Group.prototype.reflectedTransform=function(){var e=0;return this.reflectedX&&++e,this.reflectedY&&++e,this.reflectedZ&&++e,e%2==1},Human.scene.Group.prototype.getBoundary=function(){return this.boundary},Human.scene.Group.prototype.getWorldMatrix=function(){return this.worldMatrix},Human.scene.Group.prototype.getWorldToObjectMatrix=function(){return this.parent&&mat4.invert(this._worldToObjectMatrix,this.parent.worldMatrix),this._worldToObjectMatrix},Human.scene.Group.prototype.getCenter=function(){return this.center},Human.scene.Group.prototype.setReflectedX=function(e){this.reflectedX=e;for(var t=0,r=this.objects.length;t<r;++t)this.objects[t].setReflectedX(e)},Human.scene.Group.prototype.setReflectedY=function(e){this.reflectedY=e;for(var t=0,r=this.objects.length;t<r;++t)this.objects[t].setReflectedY(e)},Human.scene.Group.prototype.setReflectedZ=function(e){this.reflectedZ=e;for(var t=0,r=this.objects.length;t<r;++t)this.objects[t].setReflectedZ(e)},Human.scene.Group.prototype._removeObject=function(e){for(var t=0,r=this.objects.length;t<r;t++)if(this.objects[t].objectId===e)return void this.objects.splice(t,1)},Human.scene.Group.prototype.isRenderable=function(){for(var e=0,t=this.objects.length;e<t;++e)if(!this.objects[e].isRenderable())return!1;return!0},Human.scene.Group.prototype.isPinnable=function(){for(var e=0,t=this.objects.length;e<t;++e)if(!this.objects[e].isPinnable())return!1;return!0},Human.scene.Group.prototype.getDefaultProperties=function(){return{shown:!1,pickable:!0,backfaces:!1,glassFactor:0,murkiness:1,opacity:1}},Human.scene.Group.prototype.traverseUp=function(e){e(this),this.parent&&this.parent.traverseUp(e)},Human.scene.Group.prototype.traverseDown=function(e){e(this);for(var t=0,r=this.objects.length;t<r;t++)this.objects[t].traverseDown(e)},Human.scene.Group.prototype.getLeafObjects=function(e){var t=[];return this.traverseDown((function(r){r.isLeaf()&&(t.push(r),e&&e(r))})),t},Human.scene.Group.prototype.getRenderableObjects=function(e){var t=[];return this.getLeafObjects((function(r){r.isRenderable()&&(t.push(r),e&&e(r))})),t},Human.scene.Group.prototype.getShownObjects=function(e){var t=[];return this.getLeafObjects((function(r){r.shown&&(t.push(r),e&&e(r))})),t}}(),function(){"use strict";var e=window.ColorFresnel,t=window.ScalarFresnel;function r(r,a){var i=r.constructor.name;return i===a.constructor.name&&("Number"===i||"Boolean"===i?r===a:"Array"===i||"Float32Array"===i?r.reduce((function(e,t,r){return e&&t===a[r]}),!0):"ScalarFresnel"===i?t.prototype.isEqual(r,a):"ColorFresnel"===i&&e.prototype.isEqual(r,a))}function a(r){var a=r.constructor.name;return"Array"===a?r.slice(0):"ColorFresnel"===a?new e(r.center,r.edge,r.centerBias,r.edgeBias,r.power):"ScalarFresnel"===a?new t(r.center,r.edge,r.centerBias,r.edgeBias,r.power):r}Human.scene.Object=function(e){if(this.modelId=e.modelId,this.objectId=e.objectId,this.anonymous=e.anonymous,this.fmaId=e.fmaId,this.layer=parseInt(e.layer,10)||0,this.displayName=e.displayName,this.description=e.description,this.parent=e.parent,this.shown=!1,this.culledByFrustum=!1,this.culledByClip=!1,this.fadeByClip=!1,this.pickable=!0,this.clippable=!0,this.xray=!1,this.opacity=void 0!==e.opacity?e.opacity:1,this.glassFactor=1,this.murkiness=1,this.highlight=!1,this.tintColor=new Float32Array([1,1,1]),this.saturation=0,this.contrast=0,this.brightness=0,this.colorModifiers={},this.colorModifierList=[],this.colorModifierConfigs=[],this.opacityModifiers={},this.opacityModifierConfigs=[],this.backfaces=!1,this.visiblyClipped=!1,this.windingOrder="ccw",this.tags=e.tags,this.objects=[],this.reflectedX=e.reflectedX||!1,this.reflectedY=e.reflectedY||!1,this.reflectedZ=e.reflectedZ||!1,this.localMatrix=mat4.create(),this.worldMatrix=mat4.create(),this._worldToObjectMatrix=mat4.create(),this.matrixDirty=!1,this.geoDirty=!1,this.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this.center=vec3.create(),this.transformId=e.transformId,this.transformInitialized=!e.transformId,this.transformAssetAttached=!1,this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1},this.rotate={x:0,y:0,z:0},this._transformNode=null,this._rootNode=null,this._renderableRoot=null,this.renderables=[],this.anonymousIdToRenderableIndex=e.anonymousIdToRenderableIndex||{},e.renderables){this.initRenderables();for(var t=0,r=e.renderables.length;t<r;++t)this.addRenderable(e.renderables[t])}(e.geometryId||e.morphId)&&(this.initRenderables(),this.addRenderable(e)),(e.pivot||e.translate||e.scale||e.rotate)&&this.setTransform(e),this._checkFlippedWinding(),this._propertiesNode&&this._propertiesNode.setSolidColor(e.capColor||{r:.7,g:.7,b:.7})},Human.scene.Object.prototype.initRenderables=function(){if(!this._rootNode){this._rootNode=this._transformNode=Human.renderer.graph.createSubtree({type:"xform"});var e=this.getDefaultFlags();this._xrayBackfaces=!1,e.enabled=!1,e.pickable=!0,e.solid=Human.scene.enableSolidObjects,e.layer=this.layer||0,e.name=this.objectId,e.xray=!1,e.highlight=!1,e.opacity=this.opacity,e.glassFactor=this.glassFactor,e.murkiness=this.murkiness,e.xrayEnabled=!0,this._renderableRoot=this._propertiesNode=Human.renderer.graph.insertNode(this._rootNode,{type:"properties",properties:e})}},Human.scene.Object.prototype.addRenderable=function(e){this.renderables.push(new Human.scene.Renderable(this,e))},Human.scene.Object.prototype.detachAsset=function(e){var t,r;switch(e){case"geometry":for(t=0,r=this.renderables.length;t<r;++t)this.renderables[t].detachGeometry();break;case"material":for(t=0,r=this.renderables.length;t<r;++t)this.renderables[t].detachMaterial();break;case"morph":for(t=0,r=this.renderables.length;t<r;++t)this.renderables[t].detachMorph()}},Human.scene.Object.prototype.checkRenderable=function(){this.isRenderable()&&Human.events.fire("scene.objectRenderable",{objectId:this.objectId})},Human.scene.Object.prototype.isRenderable=function(){for(var e=0,t=this.renderables.length;e<t;++e)if(!this.renderables[e].isRenderable())return!1;for(var r=this;r;){if(r.transformId&&!r.transformInitialized)return!1;r=r.parent}return!0},Human.scene.Object.prototype.isVisible=function(){return this.shown&&this.isRenderable()},Human.scene.Object.prototype.isLeaf=function(){return!0},Human.scene.Object.prototype.setTransform=function(e){null===this.pivot&&(this.pivot={x:0,y:0,z:0},this.translate={x:0,y:0,z:0},this.rotate={x:0,y:0,z:0},this.scale={x:1,y:1,z:1}),e.pivot&&(void 0!==e.pivot.x&&(this.pivot.x=e.pivot.x),void 0!==e.pivot.y&&(this.pivot.y=e.pivot.y),void 0!==e.pivot.z&&(this.pivot.z=e.pivot.z)),e.translate&&(void 0!==e.translate.x&&(this.translate.x=e.translate.x),void 0!==e.translate.y&&(this.translate.y=e.translate.y),void 0!==e.translate.z&&(this.translate.z=e.translate.z)),e.scale&&(void 0!==e.scale.x&&(this.scale.x=e.scale.x),void 0!==e.scale.y&&(this.scale.y=e.scale.y),void 0!==e.scale.z&&(this.scale.z=e.scale.z),e.scale.x<0&&this.setReflectedX(!0),e.scale.y<0&&this.setReflectedY(!0),e.scale.z<0&&this.setReflectedZ(!0)),e.rotate&&(void 0!==e.rotate.x&&(this.rotate.x=e.rotate.x),void 0!==e.rotate.y&&(this.rotate.y=e.rotate.y),void 0!==e.rotate.z&&(this.rotate.z=e.rotate.z)),this.transformInitialized||(this.transformInitialized=!0,this.checkRenderable()),this.matrixDirty=!0};var i=mat4.create(),n=mat4.create(),o=mat4.create(),s=mat4.create(),l=mat4.create(),c=mat4.create();Human.scene.Object.prototype.buildMatrix=function(){var e=this.pivot,t=this.translate;mat4.fromTranslation(i,[-e.x,-e.y,-e.z]);var r=this.scale;mat4.fromScaling(n,[r.x,r.y,r.z]),mat4.fromTranslation(o,[t.x+e.x,t.y+e.y,t.z+e.z]);var a=this.rotate;mat4.fromRotation(s,a.z*Math.PI/180,Human.math.Z_AXIS),mat4.fromRotation(l,a.y*Math.PI/180,Human.math.Y_AXIS),mat4.fromRotation(c,a.x*Math.PI/180,Human.math.X_AXIS),mat4.identity(this.localMatrix),mat4.multiply(this.localMatrix,i,this.localMatrix),mat4.multiply(this.localMatrix,n,this.localMatrix),mat4.multiply(this.localMatrix,c,this.localMatrix),mat4.multiply(this.localMatrix,l,this.localMatrix),mat4.multiply(this.localMatrix,s,this.localMatrix),mat4.multiply(this.localMatrix,o,this.localMatrix),this.matrixDirty=!1},Human.scene.Object.prototype.compileXform=function(){this._transformNode&&(this._transformNode.setElements(this.worldMatrix),this.compileBoundary())},Human.scene.Object.prototype.compileBoundary=function(){Human.scene.kdTreeDirty=!0,Human.renderer.camera.nearFarDirty=!0;var e=this._getBoundary(this.worldMatrix);this.boundary.xmin=e.xmin,this.boundary.ymin=e.ymin,this.boundary.zmin=e.zmin,this.boundary.xmax=e.xmax,this.boundary.ymax=e.ymax,this.boundary.zmax=e.zmax,this.center[0]=.5*(this.boundary.xmin+this.boundary.xmax),this.center[1]=.5*(this.boundary.ymin+this.boundary.ymax),this.center[2]=.5*(this.boundary.zmin+this.boundary.zmax)},Human.scene.Object.prototype.reflectedTransform=function(){var e=0;return this.reflectedX&&++e,this.reflectedY&&++e,this.reflectedZ&&++e,e%2==1},Human.scene.Object.prototype._checkFlippedWinding=function(){if(this._propertiesNode){var e=this.reflectedTransform();this._propertiesNode.setFrontface(e?"ccw"===this.windingOrder?"cw":"ccw":this.windingOrder)}},Human.scene.Object.prototype.getBoundary=function(){return this.boundary},Human.scene.Object.prototype.getWorldMatrix=function(){return this.worldMatrix},Human.scene.Object.prototype.getWorldToObjectMatrix=function(){return this.parent&&mat4.invert(this._worldToObjectMatrix,this.parent.worldMatrix),this._worldToObjectMatrix},Human.scene.Object.prototype.getCenter=function(){return this.center};var u=vec3.create(),_=vec3.create();function h(e,t){e._propertiesNode&&(e.tintColor=t,e.setColorModifier("__TINT_COLOR",{applyTo:"tintColor",value:e.tintColor}))}Human.scene.Object.prototype._getBoundary=function(e){for(var t,r,a,i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,h=0,f=this.renderables.length;h<f;++h){var d=this.renderables[h],p=d.boundary;if(d.isRenderable()){if(this._propertiesNode.getSkybox()){var m=Human.renderer.camera.eye;_[0]=m.x,_[1]=m.y,_[2]=m.z}else _[0]=0,_[1]=0,_[2]=0;for(var g=0;g<8;g++)u[0]=1&g?p.xmin:p.xmax,u[1]=2&g?p.ymin:p.ymax,u[2]=4&g?p.zmin:p.zmax,vec3.transformMat4(u,u,e),(t=u[0]-_[0])<i&&(i=t),(r=u[1]-_[1])<n&&(n=r),(a=u[2]-_[2])<o&&(o=a),t>s&&(s=t),r>l&&(l=r),a>c&&(c=a)}}return{xmin:i,ymin:n,zmin:o,xmax:s,ymax:l,zmax:c}},Human.scene.Object.prototype.show=function(e){this.shown!==e&&(this.shown=e,this._propertiesNode&&(p(this),Human.scene.kdTreeDirty=!0,Human.events.fire("scene.object"+(this.shown?"Shown":"Hidden"),{objectId:this.objectId})))},Human.scene.Object.prototype.frustumCull=function(e){this.culledByFrustum!==e&&this._propertiesNode&&(this.culledByFrustum=e,p(this))},Human.scene.Object.prototype.clipCull=function(e){this.culledByClip!==e&&this._propertiesNode&&(this.culledByClip=e,p(this))},Human.scene.Object.prototype.clipFade=function(e){this.fadeByClip!==e&&this._propertiesNode&&(this.fadeByClip=e,this._propertiesNode.setProperties({forceTransparent:e,partiallyOpaque:e}))},Human.scene.Object.prototype.setOpacity=function(e){!1!==e?(e=a(e),Array.isArray(e)&&5===e.length&&(e=new t(e)),r(this.opacity,e)||(this.opacity=e,this._propertiesNode&&this.setOpacityModifier("__OPACITY",{value:this.opacity}))):this.clearOpacityModProperties({opacity:!0})},Human.scene.Object.prototype.setXRay=function(e){this.setXRayColors(e),this.xray=e},Human.scene.Object.prototype.setXRayColors=function(e){this._propertiesNode&&(this._propertiesNode.setProperties({xray:e}),m(this))},Human.scene.Object.prototype.setGlassFactor=function(e){this.glassFactor=e,this._propertiesNode&&this._propertiesNode.setProperties({glassFactor:e})},Human.scene.Object.prototype.setMurkiness=function(e){this.murkiness=e,this._propertiesNode&&this._propertiesNode.setProperties({murkiness:e})},Human.scene.Object.prototype.setPickable=function(e){this.pickable!==e&&(this._propertiesNode&&this._propertiesNode.setPicking(e),this.pickable=e)},Human.scene.Object.prototype.setClippable=function(e){this.clippable!==e&&(this._propertiesNode&&this._propertiesNode.setClipping(e),this.clippable=e)},Human.scene.Object.prototype.setColorModifier=function(e,t){if(this._propertiesNode){var r=!1;if(null===t)delete this.colorModifiers[e],r=!0;else if(this.colorModifiers[e]){var a=this.colorModifiers[e];void 0!==t.applyTo&&(a.params.applyTo=t.applyTo),void 0!==t.value&&(a.params.value=t.value),a.params.range=void 0!==t.range?t.range:null}else this.colorModifiers[e]={priority:Human.scene.colorModPriorities[e]||0,params:{applyTo:t.applyTo,value:t.value,range:t.range||null}},r=!0;r&&y(this),this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs})}},Human.scene.Object.prototype.clearColorModifiers=function(){this._propertiesNode&&(this.colorModifiers={},y(this),this.tintColor=new Float32Array(f.tintColor.value),this.brightness=f.brightness.value,this.saturation=f.saturation.value,this.contrast=f.contrast.value,this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs}))},Human.scene.Object.prototype.clearColorModProperties=function(e){this._propertiesNode&&(e&&!e.tintColor||(delete this.colorModifiers.__TINT_COLOR,this.tintColor=new Float32Array(f.tintColor.value)),e&&!e.brightness||(delete this.colorModifiers.__BRIGHTNESS,this.brightness=f.brightness.value),e&&!e.saturation||(delete this.colorModifiers.__SATURATION,this.saturation=f.saturation.value),e&&!e.contrast||(delete this.colorModifiers.__CONTRAST,this.contrast=f.contrast.value),y(this),this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs}))},Human.scene.Object.prototype.setOpacityModifier=function(e,t){if(this._propertiesNode){var r=!1;if(null===t)delete this.opacityModifiers[e],r=!0;else if(this.opacityModifiers[e]){var a=this.opacityModifiers[e];void 0!==t.value&&(a.value=t.value),a.range=void 0!==t.range?t.range:null}else this.opacityModifiers[e]={value:t.value,range:t.range||null},r=!0;r&&v(this),this._propertiesNode.setProperties({opacityModifiers:this.opacityModifierConfigs})}},Human.scene.Object.prototype.clearOpacityModifiers=function(){this._propertiesNode&&(this.opacityModifiers={},this.opacity=f.opacity.value,v(this),this._propertiesNode.setProperties({opacityModifiers:this.opacityModifierConfigs}))},Human.scene.Object.prototype.clearOpacityModProperties=function(e){this._propertiesNode&&(e&&!e.opacity||(delete this.opacityModifiers.__OPACITY,this.opacity=f.opacity.value),v(this),this._propertiesNode.setProperties({opacityModifiers:this.opacityModifierConfigs}))},Human.scene.Object.prototype.colorModPrioritiesDirty=function(){for(var e in this.colorModifiers)this.colorModifiers[e].priority=Human.scene.colorModPriorities[e]||0;y(this),this._propertiesNode.setProperties({colorModifiers:this.colorModifierConfigs})},Human.scene.Object.prototype.setHighlight=function(e){if(this._propertiesNode){if(e){var t=Human.renderer.highlightColor;this.setColorModifier("__HIGHLIGHT",{applyTo:"tintColor",value:t})}else this.setColorModifier("__HIGHLIGHT",{applyTo:"tintColor",value:Human.math.VEC3_ONES});this.highlight=e}},Human.scene.Object.prototype.setTintColor=function(t){var i;!1!==t?(3===arguments.length?i=[arguments[0],arguments[1],arguments[2]]:(i=a(arguments[0]),Array.isArray(i)&&5===i.length&&(i=new e(i))),r(this.tintColor,i)||h(this,i)):this.clearColorModProperties({tintColor:!0})},Human.scene.Object.prototype.setContrast=function(e){!1!==e?(e=a(e),Array.isArray(e)&&5===e.length&&(e=new t(e)),this._propertiesNode&&!r(this.contrast,e)&&(this.contrast=e,this.setColorModifier("__CONTRAST",{applyTo:"contrast",value:this.contrast}))):this.clearColorModProperties({contrast:!0})},Human.scene.Object.prototype.setSaturation=function(e){!1!==e?(e=a(e),Array.isArray(e)&&5===e.length&&(e=new t(e)),this._propertiesNode&&!r(this.saturation,e)&&(this.saturation=e,this.setColorModifier("__SATURATION",{applyTo:"saturation",value:this.saturation}))):this.clearColorModProperties({saturation:!0})},Human.scene.Object.prototype.setBrightness=function(e){!1!==e?(e=a(e),Array.isArray(e)&&5===e.length&&(e=new t(e)),this._propertiesNode&&!r(this.brightness,e)&&(this.brightness=e,this.setColorModifier("__BRIGHTNESS",{applyTo:"brightness",value:this.brightness}))):this.clearColorModProperties({brightness:!0})},Human.scene.Object.prototype.setPartiallyOpaque=function(e){this._propertiesNode&&this._propertiesNode.setProperties({partiallyOpaque:e})},Human.scene.Object.prototype.setBackfaces=function(e){this.backfaces!==e&&(this.backfaces=e,m(this))},Human.scene.Object.prototype.setVisiblyClipped=function(e){this.visiblyClipped!==e&&this.hasRenderObjects()&&(this.visiblyClipped=e,m(this))},Human.scene.Object.prototype.setReflectedX=function(e){this.reflectedX=e,this._checkFlippedWinding()},Human.scene.Object.prototype.setReflectedY=function(e){this.reflectedY=e,this._checkFlippedWinding()},Human.scene.Object.prototype.setReflectedZ=function(e){this.reflectedZ=e,this._checkFlippedWinding()},Human.scene.Object.prototype.destroyNodes=function(){this._rootNode&&(Human.renderer.graph.destroySubtree(this._rootNode),this.renderables.length=0,this._rootNode=null)};var f={shown:{setter:Human.scene.Object.prototype.show,value:!1,keyable:!0,type:"boolean"},pickable:{setter:Human.scene.Object.prototype.setPickable,value:!0,keyable:!1,type:"boolean"},backfaces:{setter:Human.scene.Object.prototype.setBackfaces,value:!1,keyable:!1,type:"boolean"},glassFactor:{setter:Human.scene.Object.prototype.setGlassFactor,value:0,keyable:!1,type:"number"},murkiness:{setter:Human.scene.Object.prototype.setMurkiness,value:1,keyable:!1,type:"number"},opacity:{setter:Human.scene.Object.prototype.setOpacity,value:1,keyable:!0,type:"number"},tintColor:{setter:Human.scene.Object.prototype.setTintColor,value:new Float32Array([1,1,1]),keyable:!1,type:"Float32Array"},saturation:{setter:Human.scene.Object.prototype.setSaturation,value:0,keyable:!1,type:"number"},brightness:{setter:Human.scene.Object.prototype.setBrightness,value:0,keyable:!1,type:"number"},contrast:{setter:Human.scene.Object.prototype.setContrast,value:0,keyable:!1,type:"number"}},d=Object.keys(f);function p(e){e._propertiesNode.setEnabled(e.shown&&!e.culledByFrustum&&!e.culledByClip)}function m(e){for(var t=e.renderables,r=0,a=t.length;r<a;++r)t[r].setBackfaces(!1)}function g(e,t){return e.priority-t.priority}function y(e){for(var t in e.colorModifierList.length=0,e.colorModifiers)e.colorModifierList.push(e.colorModifiers[t]);e.colorModifierList.sort(g),e.colorModifierConfigs.length=e.colorModifierList.length;for(var r=0,a=e.colorModifierList.length;r<a;++r)e.colorModifierConfigs[r]=e.colorModifierList[r].params}function v(e){for(var t in e.opacityModifierConfigs.length=0,e.opacityModifiers)e.opacityModifierConfigs.push(e.opacityModifiers[t])}Human.scene.Object.prototype.getDefaultFlags=function(){return{picking:this.pickable,enabled:!1,specular:!0,backfaces:!1,reflection:!0,solid:Human.scene.enableSolidObjects}},Human.scene.Object.prototype.getDefaultProperties=function(){for(var e={},t=0,r=d.length;t<r;t++){var a=d[t];e[a]=f[a].value}return e},Human.scene.Object.prototype.getProperties=function(){for(var e={},t=0,r=d.length;t<r;t++){var a=d[t];e[a]=this[a]}return e},Human.scene.Object.prototype.setProperties=function(e){var t,a,i,n;for(e=e||{},this.clearColorModifiers(),this.clearOpacityModifiers(),i=0,n=d.length;i<n;i++){var o=d[i];t=f[o],r(this[o],a=void 0!==e[o]?e[o]:t.value)||t.setter.call(this,a)}var s,l=Human.scene.colorRecipes.getRecipes();for(i=0;i<l.length;i++)s=l[i],Human.scene.colorRecipes.setObjectRecipe(this.objectId,s,e[s]||!1)},Human.scene.Object.prototype.barycentricToModelSpace=function(e,t,r,a){if(this.renderables.length<=e)return!1;var i=this.renderables[e].getRenderObject();return!!i&&(i.barycentricToCartesian(t,r,a),a)},Human.scene.Object.prototype.barycentricToWorldSpace=function(e,t,r,a){return this.barycentricToModelSpace(e,t,r,a),!!a&&(vec3.transformMat4(a,a,this.getWorldMatrix()),a)},Human.scene.Object.prototype.isPinnable=function(){return this.hasRenderObjects()},Human.scene.Object.prototype.hasRenderObjects=function(){for(var e=0,t=this.renderables.length;e<t;++e)if(!this.renderables[e].getRenderObject())return!1;return!0},Human.scene.Object.prototype.serialize=function(){var a={};for(var i in f)if(!r(f[i].value,this[i])){var n,o=this[i];n=o instanceof t||o instanceof e?JSON.parse(JSON.stringify([o.center,o.edge,o.centerBias,o.edgeBias,o.power])):JSON.parse(JSON.stringify(o)),a[i]=n}return a},Human.scene.Object.prototype.traverseUp=function(e){e(this),this.parent&&this.parent.traverseUp(e)},Human.scene.Object.prototype.traverseDown=function(e){e(this)},Human.scene.Object.prototype.getLeafObjects=function(e){return e&&e(this),[this]}}(),function(){"use strict";var e=0,t=Human.scene.Renderable=function(t,r){this.id=e++,this.object=t,this.rootNode=t._renderableRoot.addNode(),this.geometryId=r.geometryId||null,this.materialId=r.materialId||null,this.morphId=r.morphId||null,this.drawTexture=null,this.geometryAttached=!1,this.materialAttached=!1,this.morphAttached=!1,this.geometryNode=null,this.materialNode=null,this.textureNodes=null,this.fresnelNodes=null,this.reflectionNode=null,this.lightMapNode=null,this.boundary={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},this.backfaces=!1,this.addBlend=!1,this.layer=r.layer||0};t.prototype.attachAsset=function(e,t){var r=this.isRenderable();this[e+"Attached"]=!0,r!==this.isRenderable()?(this.compileMaterial(),this.compileGeometry(),this.morphAttached&&this.compileMorph(),this.setBackfaces(this.backfaces),this.setAddBlend(this.addBlend),this.setLayer(this.layer),this.object.checkRenderable()):this.isRenderable()&&this.compileMorph(),("morph"===e||"geometry"===e&&!this.morph)&&(this.boundary=t.boundary)},t.prototype.detachGeometry=function(){this.geometryNode&&(this.geometryNode.splice(),this.geometryNode.destroy(),this.geometryNode=null,this.geometryAttached=!1,Human.assets.putAsset(this.geometryId))},t.prototype.detachMaterial=function(){if(this.materialNode&&(this.materialNode.splice(),this.materialNode.destroy(),this.materialNode=null),this.textureNodes){for(var e=0,t=this.textureNodes.length;e<t;++e)this.textureNodes[e].splice(),this.textureNodes[e].destroy();this.textureNodes=null}if(this.fresnelNodes){for(var r in this.fresnelNodes)this.fresnelNodes[r].splice(),this.fresnelNodes[r].destroy();this.fresnelNodes=null}this.reflectionNode&&(this.reflectionNode.splice(),this.reflectionNode.destroy(),this.reflectionNode=null),this.lightMapNode&&(this.lightMapNode.splice(),this.lightMapNode.destroy(),this.lightMapNode=null),this.materialAttached=!1,Human.assets.putAsset(this.materialId)},t.prototype.detachMorph=function(){this.morphNode&&(this.morphNode.splice(),this.morphNode.destroy(),this.morphNode=null,this.morphAttached=!1,Human.assets.putAsset(this.morphId))},t.prototype.disconnectGeometry=function(){this.geometryNode&&(Human.renderer.graph.disconnectNode(this.geometryNode),this.geometryNode=null,this.geometryAttached=!1)},t.prototype.disconnectMaterial=function(){if(this.materialNode&&(Human.renderer.graph.disconnectNode(this.materialNode),this.materialNode=null),this.textureNodes){for(var e=0,t=this.textureNodes.length;e<t;++e)Human.renderer.graph.disconnectNode(this.textureNodes[e]);this.textureNodes=null}if(this.fresnelNodes){for(var r in this.fresnelNodes)Human.renderer.graph.disconnectNode(this.fresnelNodes[r]);this.fresnelNodes=null}this.reflectionNode&&(Human.renderer.graph.disconnectNode(this.reflectionNode),this.reflectionNode=null),this.lightMapNode&&(Human.renderer.graph.disconnectNode(this.lightMapNode),this.lightMapNode=null),this.materialAttached=!1},t.prototype.disconnectMorph=function(){this.morphNode&&(Human.renderer.graph.disconnectNode(this.morphNode),this.morphNode=null,this.morphAttached=!1)},t.prototype.isRenderable=function(){return!(!this.materialAttached||!this.geometryAttached)},t.prototype.getRenderObject=function(){return this.geometryNode?this.geometryNode.getObject():null},t.prototype.isTransparent=function(){var e=this.getRenderObject();return!!e&&e.isTransparent()},t.prototype.setBackfaces=function(e){e=e&&!this.isTransparent(),this.backfaces=e,this.geometryNode&&this.geometryNode.setBackfaces(this.backfaces)},t.prototype.setAddBlend=function(e){this.addBlend=e,this.geometryNode&&this.geometryNode.setAddBlend(this.addBlend)},t.prototype.setLayer=function(e){this.layer=e,this.geometryNode&&this.geometryNode.setLayer(this.layer)},t.prototype.setGeometry=function(e){this.disconnectGeometry(),this.geometryId=e,this.geometryAttached=!0,this.compileGeometry()},t.prototype.setMaterial=function(e){this.disconnectMaterial(),this.materialId=e,this.materialAttached=!0,this.compileMaterial()},t.prototype.attachDrawTexture=function(e){this.drawTexture=Human.renderer.graph.insertNode(this.rootNode,e)},t.prototype.compileGeometry=function(){var e=Human.assets.geometries.geometries[this.geometryId];if(e){this.geometryNode=Human.renderer.graph.insertNode(this.rootNode,{type:"geometry",coreId:e.geometry.getCoreId()});var t=this;this.geometryNode.onObjectCreate=function(e){t.isTransparent()&&t.setBackfaces(t.backfaces),e.sortTieBreaker=t.id},this.object.geoDirty=!0}},t.prototype.compileMaterial=function(){var e=Human.assets.materials.materials[this.materialId];if(e){if(e.textures){var t,r,a=e.textures;for(this.textureNodes=[],t=0,r=a.length;t<r;t++)a[t]&&this.textureNodes.push(Human.renderer.graph.insertNode(this.rootNode,{type:"texture",coreId:a[t].getCoreId()}))}if(e.material&&(this.materialNode=Human.renderer.graph.insertNode(this.rootNode,{type:"material",coreId:e.material.getCoreId()})),e.flags){var i=Human.utils.apply(e.flags,this.object._propertiesNode.getProperties());void 0!==i.frontface&&(this.object.windingOrder=i.frontface),void 0!==i.backfaces&&this.setBackfaces(i.backfaces),void 0!==i.addBlend&&this.setAddBlend(i.addBlend),this.object._propertiesNode.setProperties(i)}if(e.reflection&&(this.reflectionNode=Human.renderer.graph.insertNode(this.rootNode,{type:"cubemap",coreId:e.reflection.getCoreId()})),e.lightmap&&(this.lightMapNode=Human.renderer.graph.insertNode(this.rootNode,{type:"cubemap",coreId:e.lightmap.getCoreId()})),e.fresnels){var n=e.fresnels;for(var o in this.fresnelNodes={},n)n.hasOwnProperty(o)&&(this.fresnelNodes[o]=Human.renderer.graph.insertNode(this.rootNode,{type:"fresnel",coreId:n[o].getCoreId()}))}void 0!==e.glassFactor&&this.object.setGlassFactor(e.glassFactor),void 0!==e.murkiness&&this.object.setMurkiness(e.murkiness)}},t.prototype.compileMorph=function(){var e=Human.assets.morphs.morphs[this.morphId];e&&(this.morphNode=Human.renderer.graph.insertNode(this.rootNode,{type:"morphGeometry",coreId:e.morphGeometry.getCoreId()}),this.object.geoDirty=!0)},t.prototype.isAttached=function(){return this.object.renderables.indexOf(this)>-1}}(),function(){"use strict";var e=Human.scene.sets={},t=function(e,t){var r=[null,void 0];return r.indexOf(t)<0?t:r.indexOf(e)<0?e:null},r=function(e,t){return t===e};e.keys=function(e,t){t=t||!1;var r=Object.keys(e),a=[];return t?r.forEach((function(e){t(e)&&a.push(e)})):a=r,a},e.filterKeys=function(t,r){var a;if(r instanceof RegExp)a=r;else try{a=new RegExp(r)}catch(i){return{}}return e.keys(t).filter((function(e){return a.test(e)}))},e.keysWhere=function(e,t){var r=[];for(var a in e)e.hasOwnProperty(a)&&t(e[a])&&r.push(a);return r},e.hasKey=function(t,r){return e.keys(t).indexOf(r)>=0},e.getSetIterator=function(t){var r=0,a=e.keys(t),i=a.length;return{next:function(){if(!this.hasNext())return null;var e=a[r];return r++,{key:e,value:t[e]}},hasNext:function(){return r<i},rewind:function(){return r=0,t[a[0]]},current:function(){return t[a[r]]}}},e.values=function(t){var r=e.keys(t),a=[];return r.forEach((function(e){a.push(t[e])})),a},e.jointKeys=function(t,r){var a={},i=function(e){a[e]=!0},n=e.keys(t),o=e.keys(r);return n.forEach(i),o.forEach(i),e.keys(a)},e.commonKeys=function(t,r){var a={},i=e.keys(t),n=e.keys(r);return i.forEach((function(e){a[e]=1})),n.forEach((function(e){a[e]=(a[e]||0)+1})),e.keysWhere(a,(function(e){return e>1}))},e.uniqueKeys=function(t,r){var a={},i=e.keys(t),n=e.keys(r);return i.forEach((function(e){a[e]=1})),n.forEach((function(e){a[e]=0})),e.keysWhere(a,(function(e){return e>0}))},e.union=function(r,a,i){var n={},o=null;return i||(i=t),e.jointKeys(r,a).forEach((function(e){null!==(o=i(r[e],a[e]))&&(n[e]=o)})),n},e.intersection=function(r,a,i){var n={},o=null;return i||(i=t),e.commonKeys(r,a).forEach((function(e){null!==(o=i(r[e],a[e]))&&(n[e]=o)})),n},e.difference=function(r,a,i){var n=e.uniqueKeys(r,a),o=null;i||(i=t);var s={};return n.forEach((function(e){null!==(o=i(r[e]))&&(s[e]=o)})),s},e.isin=function(t,a,i){i||(i=r);for(var n,o=!1,s=e.getSetIterator(a);s.hasNext()&&!o;)o=i(t,(n=s.next()).key,n.value);return o}}(),function(){"use strict";var e=Human.scene.graph={},t={},r=0,a=0,i=0,n={};function o(e,t){var r=e.objectId,a=e.geometryId||null,i=e.morphId||null,n=e.materialId||null,o=e.transformId||null;if(Human.scene.objects[r])return null;void 0===e.layer&&(e.layer=t?t.layer:0),e.objectId=r,e.parent=t,e.parentObjectId=t?t.objectId:null,e.materialId=n,e.geometryId=a,e.morphId=i,e.transformId=o,e.tags=e.tags||[],e.capColor=function(e,t,r){return r?null!=t[e]?t[e]:r[e]:t[e]}("capColor",e,t),e.modelId=e.objectId.split("-")[0];var s=Human.scene.createObject(e);return void 0!==e.opacity&&s.setOpacity(e.opacity),void 0!==e.shown&&s.show(e.shown),s}function s(e){n.geometryId&&e.detachAsset("geometry"),n.materialId&&e.detachAsset("material"),n.transformId&&e.detachAsset("transform"),n.morphId&&e.detachAsset("morph")}function l(e,t,r){for(var a=0,i=t.length;a<i;a++){var n=t[a];if("transform"===n){var o=e.transformId;o&&!e.transformAssetAttached&&(r.transform=r.transform||{},(r.transform[o]=r.transform[o]||[]).push(e))}else if(e.renderables)for(var s=0,l=e.renderables.length;s<l;++s){var c=e.renderables[s],u=c[n+"Id"];u&&!c[n+"Attached"]&&(r[n]=r[n]||{},(r[n][u]=r[n][u]||[]).push(c))}}return r}function c(e,i,n,o){0===r&&Human.events.fire("graph.assetAttach.start"),r++,Human.assets.getAsset(e,i,(function(s){if(s)for(var l=0,c=n.length;l<c;l++)if("transform"===i){var u=n[l];Human.scene.objects[u.objectId]&&(u.setTransform(s),u.transformAssetAttached=!0)}else n[l].attachAsset(i,s);(function(e,i,n,o){a++,Human.events.fire("graph.assetAttach.progress",{assetId:e,targetObjects:n,assetType:i,nullAsset:o}),t[i]||(t[i]=[]),o||t[i].push(e),r===a&&(Human.events.fire("graph.assetAttach.finish",t),t={},r=0,a=0)})(e,i,n,!s),o(s)}))}function u(e){if(e.objects&&e.objectId){for(var t,r=0,a=e.objects.length;r<a;++r)if(!e.objects[r].objectId){t=[];break}t&&function e(t){if(!t.objects)return!0;for(var r=0,a=t.objects.length;r<a;++r){var i=t.objects[r];if(i.transformId||i.objectId||i.pivot||i.translate||i.scale||i.rotate||!e(i))return!1}return!0}(e)&&(e.anonymousIdToRenderableIndex={},function e(t,r,a){if(t.objects)for(var n=0,o=t.objects.length;n<o;++n){var s=t.objects[n];void 0===s.layer&&(s.layer=t.layer),s.geometryId?(a.anonymousIdToRenderableIndex[a.objectId+i++]=r.length,r.push({geometryId:s.geometryId,materialId:s.materialId,morphId:s.morphId,layer:s.layer})):(i++,e(s,r,a))}}(e,t,e),e.renderables=t,e.objects.length=0)}}e.buildGraph=function(t,r){if(t){var a,n;r||(i=0);for(var s=0;s<t.length;s++)u(a=t[s]),a.objectId||(a.objectId=r.objectId+i++,a.anonymous=!0),a.group=a.objects&&a.objects.length>0,null!==(n=o(a,r))&&a.objects&&e.buildGraph(a.objects,n)}},e.gatherAssetIdsFromObject=function(e,t,r){Array.isArray(e)||(e=[e]),t=t||["geometry","material","transform","morph"],r=r||{};for(var a=0,i=e.length;a<i;a++)l(e[a],t,r);return r},e.attachAssetsToObject=function(t,r,a){"function"==typeof r&&(a=r,r=null),Array.isArray(t)||(t=[t]),r=r||["geometry","material","transform","morph"];var i=0;function n(){0==--i&&a&&a()}for(var o=0,s=t.length;o<s;o++){var l=e.gatherAssetIdsFromObject(t[o],r);i++,e.attachAssets(l,n)}},e.attachAssetSetsToSubtree=function(t,r,a){"function"==typeof r&&(a=r,r=null),Array.isArray(t)||(t=[t]),r=r||[["geometry","material","transform"],["morph"]];var i,n,o={},s=[],l={};function c(e){l[e.objectId]=e}function u(e){o[e.objectId]||(s.push(e),o[e.objectId]=!0)}for(var _=0;_<t.length;_++)t[_].getLeafObjects(c);for(i in l)l.hasOwnProperty(i)&&(n=l[i])&&n.traverseUp(u);!function t(r,a,i,n){var o=a.shift();!function(t,r,a){var i=t.length;if(0!==i)for(var n=0,o=i;n<o;n++)e.attachAssetsToObject(t[n],r,s);else a&&a();function s(){0==--i&&a&&a()}}(r,o,(function(){if(n){for(var e={},s=0,l=o.length;s<l;s++)e[o[s]]=!0;n(e,i,!a.length)}a.length&&t(r,a,i+1,n)}))}(s,r,0,a)},e.attachAssets=function(e,t){var r=0;function a(){0==--r&&t&&t()}var i=Object.keys(e);if(0!==i.length)for(var n=0,o=i.length;n<o;n++){var s=i[n],l=e[s];if(l)for(var u in l)l.hasOwnProperty(u)&&(r++,c(u,s,l[u],a))}else t&&t()},e.destroySubtree=function(e){var t,r;for(Array.isArray(e)||(e=[e]),t=0,r=e.length;t<r;t++)Human.scene.destroyObject(e[t].objectId)},e.unloadSubtree=function(e,t,r){var a,i;for(Array.isArray(e)||(e=[e]),n={},t.indexOf("geometries")>=0&&(n.geometryId=!0),t.indexOf("transforms")>=0&&(n.transformId=!0),t.indexOf("morphs")>=0&&(n.morphId=!0),t.indexOf("materials")>=0&&(n.materialId=!0),t.indexOf("morph")>=0&&(n.morphId=!0),a=0,i=e.length;a<i;a++)e[a].getLeafObjects(s);r&&r()}}(),function(){"use strict";var e=Human.scene.markers={},t=0,r=0;e.markers={};var a={},i=!1,n=vec3.fromValues(.33,.33,.33),o=vec3.create(),s=vec3.create(),l=mat4.create(),c=vec3.create(),u=function(e){var r,o,s,l=this;if(l.id=e.id||(r="marker_"+t,t++,r),l.pos=vec3.create(),this.viewPos=vec3.create(),l.dir=vec3.create(),e.pos&&(l.pos[0]=e.pos[0],l.pos[1]=e.pos[1],l.pos[2]=e.pos[2]),e.dir&&(l.dir[0]=e.dir[0],l.dir[1]=e.dir[1],l.dir[2]=e.dir[2],vec3.normalize(l.dir,l.dir)),l.viewAngle=0,l.canvasPos=vec2.fromValues(0,0),l.built=!1,l.occluded=!1,l.objectCentered=!1,l.renderableIndex=-1,l.primitiveIndex=-1,l.barycentric=null,e.objectId&&Human.scene.objects[e.objectId]){if(l.object=Human.scene.objects[e.objectId],l.modelPos=vec3.create(),void 0!==e.primitiveIndex){l.renderableIndex=void 0!==e.renderableIndex?e.renderableIndex:0,l.primitiveIndex=e.primitiveIndex;var c=e.barycentric||n;l.barycentric=vec3.fromValues(c[0],c[1],c[2])}else e.pos||(l.objectCentered=!0);l.object.isRenderable()?l.build():(s=l,a[o=e.objectId]?a[o].push(s):a[o]=[s],i=!0)}else{if(!e.pos)return void Human.log.error("Human.scene.marker","marker configuration requires 'objectId' or 'pos' parameter.");l.build()}};u.prototype.build=function(){var e=this;if(!e.built){if(-1!==e.primitiveIndex)e.object.barycentricToModelSpace(e.renderableIndex,e.primitiveIndex,e.barycentric,e.modelPos),vec3.transformMat4(e.pos,e.modelPos,e.object.getWorldMatrix());else if(e.object&&!e.objectCentered)mat4.invert(l,e.object.getWorldMatrix()),vec3.transformMat4(e.modelPos,e.pos,l);else if(e.objectCentered){var t=e.object.getCenter();e.pos[0]=t[0],e.pos[1]=t[1],e.pos[2]=t[2],mat4.invert(l,e.object.getWorldMatrix()),vec3.transformMat4(e.modelPos,e.pos,l)}e.updatePosition(),e.updateViewAngle(),e.updateOcclusion(),e.built=!0}},u.prototype.updatePosition=function(){var e=this;-1!==e.primitiveIndex&&e.object.barycentricToModelSpace(e.renderableIndex,e.primitiveIndex,e.barycentric,e.modelPos),e.modelPos&&vec3.transformMat4(e.pos,e.modelPos,e.object.getWorldMatrix()),vec3.transformMat4(e.viewPos,e.pos,Human.renderer.getViewMat()),Human.renderer.worldPositionToCanvas(e.pos,e.canvasPos)},u.prototype.updateViewAngle=function(){if(this.objectCentered)this.viewAngle=0;else{var e=Human.renderer.camera.eye;c.set([e.x,e.y,e.z]),vec3.subtract(o,c,this.pos),vec3.normalize(o,o);var t=Math.min(vec3.dot(o,this.dir),1);this.viewAngle=57.2957795*Math.acos(t)}},u.prototype.updateOcclusion=function(){this.occluded=this.isOccludedByObject()||this.isOffScreen()},u.prototype.isOccludedByObject=function(){return!this.objectCentered&&(e=Human.renderer.camera.eye,o[0]=e.x,o[1]=e.y,o[2]=e.z,vec3.sub(s,this.pos,o),t=vec3.length(s),r=Math.min(.1*t,.5),s[0]*=a=1/t,s[1]*=a,s[2]*=a,!!((i=Human.math.intersections.rayScene(o,s,(function(e){return e.shown&&!e.culled}),(function(e){return!e.isTransparent()})))&&i.length&&i[0].t+r<t));var e,t,r,a,i},u.prototype.isOffScreen=function(){var e=this.canvasPos,t=Human.renderer.canvas.width,r=Human.renderer.canvas.height;return e[0]<0||e[0]>t||e[1]<0||e[1]>r},e.create=function(t){var r=new u(t);return e.markers[r.id]=r,Human.events.fire("scene.markers.added",{id:r.id}),r.built&&Human.events.fire("scene.markers.built",{id:[r.id]}),r},e.delete=function(t){delete e.markers[t],Human.events.fire("scene.markers.deleted",{id:t})},e.buildByObjectId=function(e){var t=[];if(a[e]){var r,i;for(r=0;r<a[e].length;r++)(i=a[e][r]).build(),t.push(i.id);delete a[e]}Human.events.fire("scene.markers.built",{id:t})},e.onFrame=function(){var t;r=(r+1)%2,i&&function(){var e,t,r,n,o=0;for(e in a)if(++o,n=a[e],(t=Human.scene.objects[e])&&t.isVisible()){for(r=0;r<n.length;r++)n[r].build();delete a[e],--o}i=o>0}();var n=0;for(var o in e.markers)(t=e.markers[o])&&t.built&&(t.updatePosition(),t.updateViewAngle(),0===r&&t.updateOcclusion(),++n);n>0&&Human.events.fire("scene.markers.updated")}}(),function(){"use strict";var e=Human.scene.colorRecipes={},t=window.ColorFresnel,r=window.ScalarFresnel,a={};function i(e){var t=0,r=[];return e.colorMods.forEach((function(e){"tintColor"===e.applyTo?(t+=16,e.value.forEach((function(e){r.push(e)}))):"saturation"===e.applyTo?(t+=8,r.push(e.value[0])):"contrast"===e.applyTo?(t+=4,r.push(e.value[0])):"brightness"===e.applyTo&&(t+=2,r.push(e.value[0]))})),e.opacityMods.forEach((function(e){"opacity"===e.applyTo&&(t+=1,r.push(e.value[0]))})),{channels:t,mods:r}}function n(e,t){return e+"_"+t}e.createConfigFromMods=function(e){return i(e)},e.getRecipes=function(){return Object.keys(a)},e.getRecipeMods=function(e){return a.hasOwnProperty(e)?Human.utils.shallowClone(a[e]):void Human.log.error("Human.scene.color-recipes","No such color recipe : "+e)},e.registerRecipe=function(e,i){a.hasOwnProperty(e)?Human.log.error("Human.scene.color-recipes","Color mod recipe already exists : "+e):a[e]=function(e){var a=e.channels,i=e.mods,n=e.fresnelChannels,o=e.fresnelMods,s=[],l=[],c=0;if(null!=a&&(16&a&&s.push({applyTo:"tintColor",value:i.slice(c,c+=3)}),8&a&&s.push({applyTo:"saturation",value:i.slice(c,c+=1)[0]}),4&a&&s.push({applyTo:"contrast",value:i.slice(c,c+=1)[0]}),2&a&&s.push({applyTo:"brightness",value:i.slice(c,c+=1)[0]}),1&a&&l.push({applyTo:"opacity",value:i.slice(c,c+=1)[0]})),c=0,null!=n){if(16&n){var u=o.slice(c,c+=9);s.push({applyTo:"tintColor",value:new t([u[0],u[1],u[2]],[u[3],u[4],u[5]],u[6],u[7],u[8])})}if(8&n){var _=o.slice(c,c+=5);s.push({applyTo:"saturation",value:new r(_[0],_[1],_[2],_[3],_[4])})}if(4&n){var h=o.slice(c,c+=5);s.push({applyTo:"contrast",value:new r(h[0],h[1],h[2],h[3],h[4])})}if(2&n){var f=o.slice(c,c+=5);s.push({applyTo:"brightness",value:new r(f[0],f[1],f[2],f[3],f[4])})}if(1&n){var d=o.slice(c,c+=5);l.push({applyTo:"opacity",value:new r(d[0],d[1],d[2],d[3],d[4])})}}return{colorMods:s,opacityMods:l}}(i)},e.clearRecipes=function(){a={}},e.removeRecipe=function(e){delete a[e]},e.setObjectRecipe=function(e,t,r){var i,o,s,l=Human.scene.objects[e],c=a[t];if(l&&c){for(i=0;i<c.colorMods.length;i++)s=n(t,(o=c.colorMods[i]).applyTo),l.setColorModifier(s,r?o:null);for(i=0;i<c.opacityMods.length;i++)s=n(t,(o=c.opacityMods[i]).applyTo),r?l.setOpacityModifier(s,o):!r&&l.opacityModifiers[s]&&l.setOpacityModifier(s,null)}},e.hasTarget=function(e,t){var r=Human.scene.objects[t];if(r&&a[e]){var i=Object.keys(r.colorModifiers).reduce((function(t,r){return t||r.startsWith(e)}),!1);return Object.keys(r.opacityModifiers).reduce((function(t,r){return t||r.startsWith(e)}),i)}},e.serializeRecipe=function(t){return i(e.getRecipeMods(t))}}(),function(){"use strict";var e,t,r,a,i=Human.timeline={objectVisibilityUpdates:{}};i.animations={},i.leafTimelines={},i.branchTimelines={},i.rootTimelines={},i.activeRoot=null,i.FRAME_LENGTH=.033,i.TIME_CONSTANT=.001,i.borderConditions={start:{which:"second",direction:i.direction},middle:{which:"both",direction:i.direction},end:{which:"first",direction:i.direction}},i.playing=!1,i.playfree=!0,i._lastWorldTime=0,i._time1=0,i._time2=0,i._freeTime=0,i.time=0,i.playQueue=[],i.loop=!1,i.scale=1,i.direction="forwards",i._waiting=!1,i._playParams=null,i._scrubParams=null,i.chapters={},i.addAnimation=function(e,t){t.update?(i.animations[e]&&i.removeAnimation(e),i.animations[e]=t,Human.events.fire("Timeline.Loaded")):Human.log.error("Human.timeline.addAnimation","Param expected: update")},i.removeAnimation=function(e){var t=i.animations[e];t?(delete i.animations[e],t.destroy&&t.destroy(),Human.utils.isEmpty(i.animations)&&Human.events.fire("Timeline.Empty")):Human.log.warn("Human.timeline.removeAnimation","Animation not found: "+e)};var n=function(){return"forwards"===i.direction?i._time1:i._time2};i.initTransparencies=function(){Human.log.error("timeline.initTransparencies() is deprecated and no longer required for loading")},Human.timeline.enableAnimation=function(){i._waiting&&(i._lastWorldTime=(new Date).getTime(),i._waiting=!1)},i.onFrame=function(){if(null!=(e=i.activeRoot)&&!i._waiting){if(t=(new Date).getTime(),r=(t-i._lastWorldTime)*i.TIME_CONSTANT/i.FRAME_LENGTH,i._lastWorldTime=t,i.time>i._time2?i.time=i._time2:i.time<i._time1&&(i.time=i._time1),i.playfree&&(e.updateFreeAnimations(i._freeTime),i._freeTime+=i.scale*r*i.FRAME_LENGTH),i.playing){a=i.borderConditions.middle;var o=!0;i.time===("forwards"===i.direction?i._time2:i._time1)?!0===i.loop?(a=i.borderConditions.start,i.time=n()):(a=i.borderConditions.end,o=!1):(s=n(),i.time===s&&(a=i.borderConditions.start)),e.update(i.time,a),o?(i.playing=!0,Human.events.fire("timeline.playing",{time:i.time}),i.time+=i.scale*r*i.FRAME_LENGTH):(Human.events.fire("timeline.completed"),i.playing=!1,Human.events.fire("timeline.stopped",{time:i.time}))}var s;Human.renderer.camera.fly.onFrame(),Human.utils.isEmpty(i.objectVisibilityUpdates)||(Human.events.fire("TweenVisibilityUpdate",i.objectVisibilityUpdates),i.objectVisibilityUpdates={})}},Human.events.on("timeline.stopped",(function(){i.playQueue.shift(),i.playQueue.length>0?i._play(i.playQueue[0]):Human.events.fire("timeline.paused",{time:Human.timeline.time})})),i.parsePlayInstruction=function(e){var t,r,a,n,s,l,c=(e=e||{}).root||i.activeRoot,u="forwards";c.getTimeFrame();var _=null,h=null,f=null,d=!e.hasOwnProperty("align")||e.align,p=null,m=!1;switch(i._playParams=e,t=o(["nextChapter","prevChapter","startChapterId","startTime"],e)[0]||"default",r=o(["nextChapter","prevChapter","finishChapterId","finishTime","numChapters"],e)[0]||"default",t){case"nextChapter":n=0,a=c.getNeighborChapter(c._nowBranch,"next");break;case"prevChapter":n=0,a=c.getNeighborChapter(c._nowBranch,"previous");break;case"startChapterId":if(n=0,a=c.getBranch({id:e.startChapterId}),Human.utils.isEmpty(a))return void Human.log.warn("timeline.play","Invalid chapter id: "+e.startChapterId);break;case"startTime":a=(p=c.mapGlobalTime(e.startTime,{tie:"later"})).branch,n=p.time;break;case"default":a=c._chapters[0],n=0}switch(r){case"nextChapter":case"prevChapter":l=(s=a).getTimeFrame().lastTime;break;case"finishChapterId":if(s=c.getBranch({id:e.finishChapterId}),Human.utils.isEmpty(s))return void Human.log.warn("timeline.play","Invalid chapter id: "+e.finishChapterId);l=s.getTimeFrame().lastTime;break;case"finishTime":0===e.finishTime?(s=c._chapters[0],l=0):(s=(p=c.mapGlobalTime(e.finishTime,{tie:"earlier"})).branch,l=p.time);break;case"numChapters":var g=c.whereIsBranch(a,{chapters:!0}),y=e.numChapters||1;y=Math.min(y,c._chapters.length-g),l=(s=c._chapters[g+y-1]).getTimeFrame().lastTime;break;case"default":s=c._chapters[c._chapters.length-1],l="end"}return(_=c.mapBranchTime(a,n))<=(h=c.mapBranchTime(s,l))?(u="forwards",f=_):(p=_,_=h,f=h=p,u="backwards"),d&&("forwards"===u?(_=c.mapBranchTime(a,0),h=c.mapBranchTime(s,"end")):"backwards"===u&&(_=c.mapBranchTime(s,0),h=c.mapBranchTime(a,"end"))),e.hasOwnProperty("loop")?m=e.loop:["startChapterId","nextChapter","prevChapter"].indexOf(t)>=0&&["numChapters","nextChapter","finishChapterId"].indexOf(r)>=0&&a.id===s.id&&(m=a.animation.loop),{t:f,t1:_,t2:h,loop:m,direction:u}},i.play=function(e){(e=e||{}).queue&&i.playing?i.playQueue.push(e):(i.playQueue=[e],i._play(e))},i._play=function(e){var t=i.parsePlayInstruction(e||{});i._time1=t.t1,i._time2=t.t2,i.time=t.t,i.loop=t.loop,function(e){var t={},r="backwards"===e?-1:1;if(["forwards","backwards"].indexOf(e)<0)return Human.log.warn("timeline.setBorderConditions","invalid direction :"+e),null;t.start={which:"second",direction:e},t.middle={which:"both",direction:e},t.end={which:"first",direction:e},i.direction=e,i.borderConditions=t,i.scale=r*Math.abs(i.scale)}(t.direction),i._waiting=0==t.t1&&t.t2-t.t1>1&&0==i._lastWorldTime,i.playing=!0,i._lastWorldTime=i._waiting?0:(new Date).getTime(),Human.events.fire("timeline.played",{time:i.time})};var o=function(e,t){var r=Object.keys(t);return e.filter((function(e){return r.indexOf(e)>=0}))};i.stop=function(){i.playing=!1,i.playQueue=[],Human.events.fire("timeline.stopped",{time:i.time})},i.scrub=function(e){var t,r=i.activeRoot,a=0,n={which:"first",direction:"forwards"};if(i.playQueue=[],i._scrubParams=e,e.hasOwnProperty("time"))a=e.time;else if(e.hasOwnProperty("chapterId")){var o=r.getBranch({id:e.chapterId});o?(a=r.mapBranchTime(o,0),n={which:"second",direction:"forwards"}):a=i.time}else a=i.time;if(e.hasOwnProperty("borderCondition")){var s=e.borderCondition;["first","both","second"].indexOf(s.which)>=0&&(n.which=s.which),["forwards","backwards"].indexOf(s.direction)>=0&&(n.direction=s.direction)}0===a?n={which:"second",direction:"forwards"}:a===r.getTimeFrame.lastTime&&(n={which:"first",direction:"forwards"}),(a<i._time1||a>i._time2)&&(t=r.mapGlobalTime(a,n),i._time1=r.mapBranchTime(t.branch,0),i._time2=r.mapBranchTime(t.branch,"end")),i.playing=!1,i.time=a,r.update(a,n),Human.events.fire("timeline.scrubbed",{time:i.time})},i.next=function(){var e=i.activeRoot,t=Human.properties.properties["timeline.prevNextMode"],r=e._nowBranch,a=e.getNeighborChapter(r,"next");if(e.isLast(r))Human.log.warn("timeline.next","can't proceed beyond last chapter");else{var n,o=e.mapBranchTime(r,"end")+.001;"play"===t?(n=a.animation.loop?{startTime:e.mapBranchTime(a,0),align:!0,finishTime:e.mapBranchTime(a,"end"),loop:a.animation.loop,queue:!1}:{startTime:i.time,align:!1,finishTime:o,loop:!1,queue:!1},i.play(n)):i.scrub({time:o})}},i.prev=function(){var e=i.activeRoot,t=Human.properties.properties["timeline.prevNextMode"],r=e._nowBranch;if(e.isFirst(r))Human.log.warn("timeline.next","can't go to chapter before first chapter");else{var a,n=e.getNeighborChapter(r,"previous"),o=e.mapBranchTime(n,"start")+.001;"play"===t?(a=r.animation.loop?{startTime:e.mapBranchTime(n,"start"),align:!0,finishTime:e.mapBranchTime(n,"end"),loop:n.animation.loop,queue:!1}:{startTime:e.mapBranchTime(n,"end"),align:!1,finishTime:e.mapBranchTime(n,"start"),loop:!1,queue:!1},i.play(a)):i.scrub({time:o})}},i.getBookmark=function(){var e={};return Human.timeline.activeRoot&&(e.rootName=Human.timeline.activeRoot.id),i.playing?(e.play=i._playParams,e.play.root&&delete e.play.root):e.scrub=i._scrubParams,e},i.setBookmark=function(e){if(e.rootName&&i.rootTimelines.hasOwnProperty(e.rootName))i.activeRoot=i.rootTimelines[e.rootName];else if(e.modules&&e.modules.activeModules){var t=e.modules.activeModules;(t=t.filter((function(e){return Human.timeline.rootTimelines.hasOwnProperty(e)}))).length>1&&(t=t.filter((function(e){return!Human.modules.isBaseModule(e)}))),Human.timeline.activeRoot=Human.timeline.rootTimelines[t[0]]}else Human.log.warn("Human.timeline.setBookmark: Unable to set appropriate root timeline")},i.pause=function(){i.playing=!1,Human.events.fire("timeline.paused",{time:i.time})},i.unpause=function(){i.play({startTime:i.time,numChapters:1,loop:i.loop}),Human.events.fire("timeline.unpaused",{time:i.time})},i.playFreeAnimations=function(){i.playfree=!0},i.pauseFreeAnimations=function(){i.playfree=!1},i.getTimeFrame=function(){return Human.utils.isEmpty(i.activeRoot)?0:i.activeRoot.getTimeFrame()},i.getCurrentChapterCamera=function(){return Human.timeline.activeRoot._nowBranch.getCamera(0)},i._convertPlayParams=function(e){var t=e;return e.hasOwnProperty("endTime")&&(t.finishTime=t.endTime),e.hasOwnProperty("endChapterId")&&(t.finishChapterId=e.endChapterId),t},i.query=function(){return i.activeRoot?{chapters:i.activeRoot._assembleQueryChapters(),time:i.time,timeFrame:i.getTimeFrame(),playing:i.playing,paused:!i.playing}:{}},i.destroyChapterSet=function(e){if(i.stop(),i.rootTimelines.hasOwnProperty(e))i.rootTimelines[e].destroy();else if(e)for(var t in i.rootTimelines)i.rootTimelines.hasOwnProperty(t)&&(Human.modules.isBaseModule(t)||i.rootTimelines[t].destroy());else Human.log.warn("timeline.destoryChapterSet","Invalid argument: "+e)},Human.events.on("timeline.chapters.updated",(function(e){var t=0;if(i.chapters={},null!==i.activeRoot)for(t=0;t<e.length;t++)i.chapters[i.activeRoot._chapters[t].id]=e[t]}))}(),function(){"use strict";Human.timeline.TweenAnimation=function(e){var t;this._options=e.options||{},this._tweens=e.tweens,this.timeline=e.timeline,this.firstTime=1e6,this.lastTime=-1e6;for(var r=0,a=this._tweens.length;r<a;r++)(t=this._tweens[r]).firstTime<this.firstTime&&(this.firstTime=t.firstTime),t.lastTime>this.lastTime&&(this.lastTime=t.lastTime)},Human.timeline.TweenAnimation.prototype.update=function(e,t){for(var r=0,a=this._tweens.length;r<a;r++)this._tweens[r].update(e,t)},Human.timeline.TweenAnimation.prototype.destroy=function(){for(var e,t=0,r=this._tweens.length;t<r;t++)(e=this._tweens[t]).destroy&&e.destroy()}}(),function(){"use strict";function e(e){for(var t in e)if(e.hasOwnProperty(t)&&!Human.utils.isObject(e[t]))return!1;return!0}Human.timeline.Tween=function(t){this._control=t.control,this._tweenList=[];for(var r,a,i,n,o,s={},l=0,c=t.targets.length;l<c;l++)for(var u in r=t.targets[l],a=t.keys[l],Human.utils.isObject(r.attr)&&e(r.attr)&&(r=r.attr),i=r)i.hasOwnProperty(u)&&(n=i[u],(o=s[u])||(o=new Human.timeline.TweenAttr(this._control.attr[u],t.options),s[u]=o,this._tweenList.push(o)),o.addTarget(a,n));this.firstTime=t.keys[0],this.lastTime=t.keys[t.keys.length-1]},Human.timeline.Tween.prototype._run=function(e,t){for(var r=0,a=this._tweenList,i=0,n=a.length;i<n;i++)a[i].update(e,t)&&r++;return r},Human.timeline.Tween.prototype.query=function(e,t){return this._run(e,t),this._control.attr},Human.timeline.Tween.prototype.update=function(e,t){this._run(e,t)>0&&this._control.update(e)}}(),function(){"use strict";function e(e,t,r,a){"number"!=typeof r&&(r=r.value);var i=e.controlPoints,n=Math.floor(50*(t-a));e.bezier=new Human.math.bezier(a,r,i.x[0],i.y[0],i.x[1],i.y[1],t,e.value),e.lookUp=e.bezier.getLUT(n)}function t(e,t,r,a,i){return a+(e-t)/(r-t)*(i-a)}function r(e,r){var a,i,n,o=r.lookUp,s=0,l=o.length-1;if(e<=o[s].x)return o[s].y;if(e>=o[l].x)return o[l].y;for(;s<=l;){if(n=o[(a=Math.floor((s+l)/2))+1],(i=o[a]).x<=e&&n.x>=e)return t(e,i.x,n.x,i.y,n.y);i.x>e?l=a-1:s=a+1}}Human.timeline.TweenAttr=function(e,t){this.attr=e,this.attrNames=null,t=t||{},this.keys=[],this.attrTargetLists={},this._tweens=[],this._key1=0,this._key2=1,this._firstKey=null,this._lastKey=null,this._keyDiff=null,this._loop=!!t.loop,this._timeOffset=t.timeOffset||0,this._paddingDirty=!0},Human.timeline.TweenAttr.prototype.addTarget=function(t,r){this.keys.push(t+=this._timeOffset);var a,i,n,o,s,l=this.keys.length-1;for(var c in r)if(r.hasOwnProperty(c)){if(!(a=this.attrTargetLists[c])){if(this.keys.length>1)throw"First target in tween must contain a value for each animated attribute on target";a=this.attrTargetLists[c]=[]}if(a[l]=n=r[c],"number"!=typeof n&&e(n,t,a[l-1],this.keys[l-1]),l>0)for(i=!1,o=l-1;!i&&o>=0;)void 0===(s=a[o])&&null===s?(a[o]=n,o--):i=!0}(null===this._firstKey||this._firstKey>t)&&(this._firstKey=t),(null===this._lastKey||this._lastKey<t)&&(this._lastKey=t),this._keyDiff=this._lastKey-this._firstKey,this._paddingDirty=!1},Human.timeline.TweenAttr.prototype._padTargets=function(){var e,t,r,a=this.attrTargetLists,i=this.keys.length;for(e in a)if(a.hasOwnProperty(e)){if((t=a[e]).length===i)continue;for(r=t[t.length-1];t.length<i;)t.push(r)}this._paddingDirty=!1},Human.timeline.TweenAttr.prototype.update=function(e,a){this._paddingDirty&&this._padTargets();var i=this.keys,n=this.attrNames?this.attrNames:this.attrNames=Object.keys(this.attrTargetLists);if(this._loop)a=this._firstKey+a%this._keyDiff;else{if(a<=i[0])return this._key1=0,this._key2=1,this._clampToTarget(n,0),!0;if(a>i[i.length-1])return this._key1=i.length-2,this._key2=this._key1+1,this._clampToTarget(n,this.keys.length-1),!0}for(;i[this._key1]>a;)this._key1--,this._key2--;for(;i[this._key2]<a;)this._key1++,this._key2++;var o,s,l,c,u,_,h=this.attrTargetLists,f=this._key1,d=this._key2,p=this.attr,m=!1;for(c=0,u=n.length;c<u;c++)"number"!=typeof(s=(o=h[_=n[c]])[f])&&(s=s.value),l="number"==typeof o[d]?t(a,i[f],i[d],s,o[d]):r(a,o[d]),p[_]=l,m=!0;return m},Human.timeline.TweenAttr.prototype._clampToTarget=function(e,t){var r,a,i,n,o=this.attr,s=this.attrTargetLists;for(a=0,i=e.length;a<i;a++)"number"!=typeof(r=s[n=e[a]][t])&&(r=r.value),o[n]=r}}(),function(){"use strict";Human.timeline.Switch=function(e){this._keys=e.keys,this._targets=e.targets,this._control=e.control,this._options=e.options||{},this._key=0,this._lastKey=null,this.firstTime=e.keys[0],this.lastTime=e.keys[e.keys.length-1]},Human.timeline.Switch.prototype.query=function(e,t){return this._findTarget(t),this._targets[this._key]},Human.timeline.Switch.prototype.update=function(e,t){switch(this._findTarget(t)){case 1:return}this._control.attr=this._targets[this._key],this._control.update(e),this._lastKey=this._key},Human.timeline.Switch.prototype._findTarget=function(e){if(e<this._keys[0])return this._key=0,1;if(e===this._keys[0])return this._key=0,2;if(e>this._keys[this._keys.length-1])return this._key=this._keys.length-1,3;for(;this._keys[this._key]>e;)this._key--;for(;null!=this._keys[this._key+1]&&this._keys[this._key+1]<e;)this._key++;return 4}}(),function(){"use strict";Human.timeline.CameraControl=function(){this.attr={up:{x:0,y:1,z:0},eye:{x:0,y:0,z:0},look:{x:0,y:0,z:0}}},Human.timeline.CameraControl.prototype.update=function(e){if(!1!==e.cameraEnabled)return Human.renderer.camera.setLookAt(this.attr),!0}}(),function(){"use strict";Human.timeline.MaterialControl=function(e){var t;this._materialId=e.modelId+"/"+e.materialId,this.attr={},e.attributes.hasOwnProperty("attr")&&(e.attributes=e.attributes.attr);var r={r:0,g:0,b:0,a:1},a={r:1,g:1,b:1},i={r:0,g:0,b:0},n={float:1};for(t in e.attributes)e.attributes.hasOwnProperty(t)&&("baseColor"===t?this.attr.baseColor=r:"specularColor"===t?this.attr.specularColor=a:"emitColor"===t?this.attr.emitColor=i:"alphaColor"===t&&(this.attr.alphaColor=n))},Human.timeline.MaterialControl.prototype.update=function(){var e=Human.assets.materials.materials[this._materialId];if(e){if(e.material){var t=e.material,r=this.attr;return r.baseColor&&t.setBaseColor(r.baseColor),r.specularColor&&t.setSpecularColor(r.specularColor),r.emitColor&&t.setEmitColor(r.emitColor),r.alphaColor&&t.setAlpha(r.alphaColor.float),!0}}else this._targetMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find material: "+this._materialId),this._targetMissing=!0)}}(),function(){"use strict";Human.timeline.ObjectControl=function(e){for(var t=null,r=0,a=(t=e.objectId?[e.objectId]:e.objectIds).length;r<a;++r){var i=t[r];i.indexOf(".")<0&&i.indexOf("-")<0&&(t[r]=e.modelId+"-"+i)}this._objectIds=t,this.id=e.id,this.attr={attr:{},tnt:{},cst:{},sat:{},brt:{},o:{}}},Human.timeline.ObjectControl.prototype.update=function(){for(var e=0,t=this._objectIds.length;e<t;++e){var a=this._objectIds[e],i=Human.scene.objects[a];if(!i)return void(this._targetMissing||(Human.log.warn("Human.timeline.TweenAnimation","'lerp:objectAttr' tween can't find object: "+a),this._targetMissing=!0));var n=Human.timeline.activeRoot._nowBranch.synchronization[a];n&&!1===n.shown||r(i,this.attr,this.id)}};var e={applyTo:null,value:0,range:null},t={value:0,range:null};function r(a,i,n){var o=i.attr,s=i.tnt,l=i.cst,c=i.sat,u=i.brt,_=i.o;if(o&&(void 0!==o.pickable&&a.setPickable(o.pickable),void 0!==o.opacity&&a.setOpacity(o.opacity),void 0!==o.shown&&(Human.timeline.objectVisibilityUpdates[a.objectId]=o.shown)),_&&void 0!==_.val&&(t.value=_.val,void 0!==_.x&&(t.range={center:[_.x,_.y,_.z],minRadius:_.rmin,maxRadius:_.rmax}),a.setOpacityModifier("__OPACITY_TWEEN_"+n,t)),s&&void 0!==s.r&&(e.applyTo="tintColor",e.value=[s.r,s.g,s.b],void 0!==s.x&&(e.range={center:[s.x,s.y,s.z],minRadius:s.rmin,maxRadius:s.rmax}),a.setColorModifier("__TINT_COLOR_TWEEN_"+n,e)),l&&void 0!==l.val&&(e.applyTo="contrast",e.value=l.val,void 0!==l.x&&(e.range={center:[l.x,l.y,l.z],minRadius:l.rmin,maxRadius:l.rmax}),a.setColorModifier("_CONTRAST_TWEEN_"+n,e)),c&&void 0!==c.val&&(e.applyTo="saturation",e.value=c.val,void 0!==c.x&&(e.range={center:[c.x,c.y,c.z],minRadius:c.rmin,maxRadius:c.rmax}),a.setColorModifier("__SATURATION_TWEEN_"+n,e)),u&&void 0!==u.val&&(e.applyTo="brightness",e.value=u.val,void 0!==u.x&&(e.range={center:[u.x,u.y,u.z],minRadius:u.rmin,maxRadius:u.rmax}),a.setColorModifier("__BRIGHTNESS_TWEEN_"+n,e)),a.objects.length>0)for(var h=a.objects,f=0,d=h.length;f<d;f++)r(h[f],i,n)}}(),function(){"use strict";Human.timeline.ObjectTransformControl=function(e){var t=e.objectId,r=e.initial;t.indexOf(".")<0&&t.indexOf("-")<0&&(t=e.modelId+"-"+e.objectId),this._objectId=t;var a=this.attr={};["translate","rotate","scale","pivot"].forEach((function(e){var t="scale"===e?1:0;void 0!==r[e]&&(a[e]={},void 0!==r[e].x&&(a[e].x=t),void 0!==r[e].y&&(a[e].y=t),void 0!==r[e].z&&(a[e].z=t))}))},Human.timeline.ObjectTransformControl.prototype.update=function(){var e=Human.scene.objects[this._objectId];e?e.setTransform(this.attr):this._targetMissing||(Human.log.warn("Human.timeline.ObjectTransformControl","Can't find object: "+this._objectId),this._targetMissing=!0)}}(),function(){"use strict";Human.timeline.TextureControl=function(e){this._material=e.modelId+"/"+e.materialId,null!=e.targetLayer?(this._targetLayer=e.targetLayer,this.attr={rotate:{z:0},translate:{x:0,y:0},scale:{x:1,y:1},blend:{factor:1}}):Human.log.error("Human.timeline.TweenAnimation","'texture' tween attribute expected: 'targetLayer'")},Human.timeline.TextureControl.prototype.update=function(){var e=Human.assets.materials.materials[this._material];if(e){var t=e.textures;if(this._targetLayer>=0&&this._targetLayer<t.length){var r=t[this._targetLayer],a=this.attr;a.scale&&r.setScale(a.scale),a.translate&&r.setTranslate(a.translate),null!=a.rotate&&r.setRotate(a.rotate.z),null!=a.blend&&r.setBlendFactor(a.blend.factor)}}else this._targetMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find material: "+this._material),this._targetMissing=!0)}}(),function(){"use strict";Human.timeline.FresnelControl=function(e){this._materialId=e.modelId+"/"+e.materialId,this._fresnelType=e.fresnelType,"baseFresnel"===this._fresnelType&&(this._fresnelType="colorFresnel"),this.attr={bias:{edge:0,center:.7,power:1},edge:{r:.8,g:.7,b:.7},center:{r:.05,g:.05,b:.09}}},Human.timeline.FresnelControl.prototype.update=function(){if(!this._fresnel){var e=Human.assets.materials.materials[this._materialId];if(!e)return void(this._materialMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find material: "+this._materialId),this._materialMissing=!0));var t=this._fresnelType.length<=7?this._fresnelType:this._fresnelType.substring(0,this._fresnelType.length-7);if(this._fresnel=e.fresnels[t],!this._fresnel)return void(this._fresnelMissing||(Human.log.error("Human.timeline.TweenAnimation","'material' tween can't find fresnel type: "+this._fresnelType),this._fresnelMissing=!0))}var r=this.attr.bias;return this._fresnel.setEdgeBias(r.edge),this._fresnel.setCenterBias(r.center),this._fresnel.setPower(r.power),this._fresnel.setEdgeColor(this.attr.edge),this._fresnel.setCenterColor(this.attr.center),!0}}(),function(){"use strict";Human.timeline.tweenParticleLookup=function(e){var t=Human.timeline.activeRoot._nowBranch.id,r=Object.keys(Human.modules.moduleData),a=Human.modules.moduleData[r[r.length-1]].tweenParticleLookup,i=a&&a[t]&&a[t][e]?a[t][e]:e,n=Human.timeline.activeRoot._nowBranch.id+"/"+i;return Human.particles.systems[i]||Human.particles.systems[n]}}(),function(){"use strict";Human.timeline.ParticleSystemControl=function(e){this.particleSystemId=e.particleSystemId,this.attr={attr:{}},this._targetMissing=!1},Human.timeline.ParticleSystemControl.prototype.update=function(){var e=Human.timeline.tweenParticleLookup(this.particleSystemId);if(e){var t=this.attr.attr;e.enabled&&t&&(void 0!==t.emissionAverage&&(e.emissionAverage=t.emissionAverage),void 0!==t.emissionVariance&&(e.emissionVariance=t.emissionVariance))}else this._targetMissing||(Human.log.warn("ParticleSystemControl: can't find system: ",this.particleSystemId),this._targetMissing=!0)}}(),function(){"use strict";var e=vec3.create(),t=vec3.create();Human.timeline.ParticleComponentControl=function(e){this.particleSystemId=e.particleSystemId,this.componentId=e.componentId,this.attr={attr:{},position:{},translate:{},scale:{},rotate:{},directionAverage:{},shapeTranslate:{},shapeScale:{},shapeRotate:{}},this._targetMissing=!1},Human.timeline.ParticleComponentControl.prototype.update=function(){var r=Human.timeline.tweenParticleLookup(this.particleSystemId);if(r){var a=r.components[this.componentId];if(a){var i=a.shape;if(r.enabled){var n=this.attr.attr,o=this.attr.position,s=this.attr.translate,l=this.attr.scale,c=this.attr.rotate,u=this.attr.directionAverage,_=this.attr.shapeTranslate,h=this.attr.shapeRotate,f=this.attr.shapeScale;if(n&&(void 0!==n.average&&(a.average=n.average),void 0!==n.variance&&(a.variance=n.variance),void 0!==n.forceAverage&&(a.forceAverage=n.forceAverage),void 0!==n.forceVariance&&(a.forceVariance=n.forceVariance),void 0!==n.frequency&&(a.frequency=n.frequency),void 0!==n.friction&&(a.friction=1-n.friction),void 0!==n.radius&&(a.radius=n.radius),void 0!==n.directionVariance&&(a.directionVariance=n.directionVariance)),o&&void 0!==o.x&&(e[0]=o.x,e[1]=o.y,e[2]=o.z,a.position.set(e)),s&&void 0!==s.x&&(e[0]=s.x,e[1]=s.y,e[2]=s.z,a.translate.set(e)),(l||c)&&a.xform){var d=null,p=null;l&&void 0!==l.x&&((d=e)[0]=l.x,d[1]=l.y,d[2]=l.z),c&&void 0!==c.x&&((p=t)[0]=c.x,p[1]=c.y,p[2]=c.z),Human.math.buildRotationScaleMat3(a.xform,p,d)}u&&void 0!==u.x&&(e[0]=u.x,e[1]=u.y,e[2]=u.z,vec3.normalize(a.directionAverage,e)),i&&(_&&void 0!==_.x&&(e[0]=_.x,e[1]=_.y,e[2]=_.z,i.translate.set(e)),h&&void 0!==h.x&&(e[0]=h.x,e[1]=h.y,e[2]=h.z,i.rotate.set(e)),f&&void 0!==f.x&&(e[0]=f.x,e[1]=f.y,e[2]=f.z,i.scale.set(e)),i.updateXform())}}else this._targetMissing||(Human.log.warn("ParticleComponentControl: can't find component: "+this.componentId),this._targetMissing=!0)}else this._targetMissing||(Human.log.warn("ParticleComponentControl: can't find system: ",this.particleSystemId),this._targetMissing=!0)}}(),function(){"use strict";var e=Human.timeline.LeafTimeline=function(e,t){var r=this;t=t||{},r.level="leaf",r.id=e,r.animations={},r.timelineAnimations={},r.freeAnimations={},r.cameraTween=null,r.animationCtx={cameraEnabled:!0},Human.timeline.leafTimelines[r.id]=r};e.prototype.addAnimation=function(e,t){var r=this;if(t)if(t.update){if(r.animations[e]&&r.removeAnimation(e),r.animations[e]=t,!1===t.timeline?r.freeAnimations[e]=t:r.timelineAnimations[e]=t,!r.cameraTween){var a,i,n,o=!1,s=t._tweens||[],l=Human.timeline.CameraControl;for(a=0,i=s.length;a<i&&!o;a++)(n=s[a])._control&&n._control instanceof l&&(o=!0,r.cameraTween=n)}Human.events.fire("Timeline.Loaded")}else Human.log.error("LeafTimeline.addAnimation","Param expected: update");else Human.log.error("LeafTimeline.addAnimation","null or undefined animation object")},e.prototype.removeAnimation=function(e){var t=this,r=t.animations[e];r?(e in t.freeAnimations?delete t.freeAnimations[e]:delete t.timelineAnimations[e],delete t.animations[e],r.destroy&&r.destroy()):Human.log.warn("Human.timeline.LeafTimeline.removeAnimation","Animation not found: "+e)},e.prototype.getTimeFrame=function(){var e=0,t=this.timelineAnimations;for(var r in t)t.hasOwnProperty(r)&&(e=Math.max(e,t[r].lastTime));return{firstTime:0,lastTime:e}},e.prototype.update=function(e,t,r){r=r||{};var a,i={cameraEnabled:!1===e?e:this.animationCtx.cameraEnabled},n=this.timelineAnimations;for(var o in n)n.hasOwnProperty(o)&&("lerp:camera"===(a=n[o]).type?a.update(t):a.update(i,t))},e.prototype.destroy=function(){var e=this;e.animations={},e.freeAnimations={},e.timelineAnimations={},e.cameraTween=null,delete Human.timeline.leafTimelines[e.id]},e.prototype.unload=function(e){var t,r=this,a="tweens"===e?Human.timeline.TweenAnimation:Human.assets.morphs.Animation;for(t in r.animations)r.animations.hasOwnProperty(t)&&r.animations[t]instanceof a&&(delete r.animations[t],Human.timeline.removeAnimation(t))},e.prototype.getCamera=function(e){var t=this;return null==t.cameraTween?null:t.cameraTween.query(t.cameraTween._control,e)}}(),function(){"use strict";Human.timeline.forceRefreshLightsForChapter=function(e){Human.renderer.lights.clearEnabled();var t=unpackChapterLights(e);Human.renderer.lights.setEnabled(t)};var e=Human.timeline.BranchTimeline=function(e){var t=this;for(var r in t._onEndOptions=["loop","freeze"],t.level="branch",t.timeRange=null,t.id=e.id,t.maps={},e.timelineMap.forEach((function(e,r){t.makeMapComponent(e,r)})),t.media={},e.media)e.media.hasOwnProperty(r)&&t.addClip(r,e.media[r]);t.info={displayName:e.displayName||"",description:e.description||""},t.synchronization=e.synchronization,t.properties=e.properties||{},t.annotations=e.annotations||[],t.hotspots=e.hotspots||[],"alphaToCoverage"===e.transparencyMode&&(e.transparencyMode=null),t.transparencyMode=e.transparencyMode||"alpha","weightedOIT"!==t.transparencyMode||SceneJS.WEBGL_INFO.floatTexturesSupported||(t.transparencyMode=e.fallbackTransparency||"alpha"),t.viewModes=e.viewModes||{},t.options=e.options||{},e.hasOwnProperty("xray")&&(t.viewModes.xray=e.xray),t.camera={},e.camera?t.camera=e.camera:(e.jumpTo?(t.camera.action="jumpTo",t.camera.location=e.jumpTo,e.jumpTo.hasOwnProperty("screenPan")&&(t.camera.screenPan=e.jumpTo.screenPan),e.jumpTo.hasOwnProperty("rotationCenter")&&(t.camera.rotationCenter=e.jumpTo.rotationCenter)):e.flyTo&&(t.camera.action="flyTo",t.camera.location=e.flyTo,e.flyTo.hasOwnProperty("screenPan")&&(t.camera.screenPan=e.flyTo.screenPan),e.flyTo.hasOwnProperty("rotationCenter")&&(t.camera.rotationCenter=e.flyTo.rotationCenter)),e.options&&e.options.screenPan?t.camera.screenPan=e.options.screenPan:e.hasOwnProperty("screenPan")&&(t.camera.screenPan=e.screenPan)),t.animation={loop:!1},e.loop&&(t.animation.loop=!0),t.background=e.background||{},t.clippingPlanes=e.clippingPlanes||{},t.effects=e.effects,t.ui=e.ui||{},t.lights=e.lights;var a=e.environment||e;a.reflectionMap&&a.reflectionMap.length>0&&(t.reflection=a.reflectionMap[0]),a.lightMap&&a.lightMap.length>0&&(t.lightmap=a.lightMap[0]),t.graph=e.graph||{},t.firstUpdate=!0,t.initializedCamera=!1,t.initializedAnnotations=!1,t.initializedProperties=!1,t.initializedGraph=!1,t.initializedHotspots=!1,t.initializedParticles=!1,t.initializedClippingPlanes=!1,t.initializedPostprocess=!1,t.initializedTransparencyMode=!1,t.customData=e.customData||{},t.particleSystems=t.customData.particleSystems||[],t.ssaa=!!t.customData.ssaa,t.postprocess=t.customData.postprocess||[],window.localContentOnly&&t.postprocess.push({effect:"fxaa"}),t.translations=t.translations||{},Human.timeline.branchTimelines[t.id]=t};e.prototype.addClip=function(e,t){var r=this;r.media.hasOwnProperty(e)&&delete r.media[e],r.media[e]={data:t,published:!1,publish:function(){Human.events.fire(t.streamType+".suggestedClipInfo",this.data),Human.events.fire(t.streamType+".suggestedClips",[this.data.clipId],!0),this.published=!0},update:function(e){this.data.time1<=e&&e<=this.data.time2&&(this.published||this.publish())}}},e.prototype.makeMapComponent=function(e,t){var r,a,i=this,n={};if(n.mapId=e.data.timeline+"_"+t,n.start=e.start,n.end=e.end,n.data=e.data,Human.timeline.leafTimelines.hasOwnProperty(e.data.timeline))n.data.timeline=Human.timeline.leafTimelines[e.data.timeline];else{var o=new Human.timeline.LeafTimeline(e.data.timeline);n.data.timeline=o}n.data.fit?(r=(n.data.end-n.data.start)/(n.end-n.start),a=n.data.start,n.calcChildTime=function(e){return r*(e-n.start)+a}):(r=1,a=n.data.start,"freeze"===n.data.onEnd?n.calcChildTime=function(e){return Math.min(r*(e-n.start)+a,n.data.end)}:"loop"===n.data.onEnd?n.calcChildTime=function(e){var t=n.data.end-n.data.start,r=e-n.start;return r-t*Math.floor(r/t)+a}:Human.log.warn("WARNING: invalid onEnd property for branch timeline map data.")),i.maps[n.mapId]=n,i.timeRange=i.getTimeFrame()},e.prototype._getAudio=function(){var e=this,t=[];for(var r in e.media)e.media.hasOwnProperty(r)&&"audio"===e.media[r].data.streamType&&t.push(e.media[r].data);return t},e.prototype.getTimeFrame=function(){var e=this,t=0;for(var r in e.maps)e.maps.hasOwnProperty(r)&&e.maps[r].end>t&&(t=e.maps[r].end);return 0===t&&(t=2),{firstTime:0,lastTime:t}},e.prototype.getCamera=function(e){var t=this;"end"===e?e=t.getTimeFrame().lastTime:"start"===e&&(e=0);var r=t.getAnimatedCamera(e);if(r)return r.screenPan=r.screenPan||t.options.screenPan,r;if(!Human.utils.isEmpty(t.camera))return(r=t.camera.location).screenPan=t.options.screenPan,r;var a=Human.renderer.camera._startcamera;return a.screenPan=t.options.screenPan,a},e.prototype.getAnimatedCamera=function(e){var t=this.getTimeFrame();"start"===e||e<t.startTime?e=t.startTime:("end"===e||"last"===e||e>t.lastTime)&&(e=t.lastTime);var r=this.whichCameraMap(0);if(null==r)return null;if(!(e>=r.start&&e<=r.end))return null;var a=r.data.timeline,i=r.calcChildTime(e),n=a.getCamera(i);return null!=n?n:void 0},e.prototype.whichCameraMap=function(e){var t,r=this.whichMaps(e);for(t=0;t<r.length;t++)if(r[t].map.data.timeline.cameraTween)return r[t].map;return null},e.prototype.reset=function(){var e=this;e.firstUpdate=!0,e.initializedGraph=!1,e.initializedCamera=!1,e.initializedHotspots=!1,e.initializedProperties=!1,e.initializedAnnotations=!1,e.initializedParticles=!1,e.initializedClippingPlanes=!1,e.initializedPostprocess=!1,e.initializedTransparencyMode=!1;var t,r=e.media;for(t in r)r.hasOwnProperty(t)&&(r[t].published=!1)},e.prototype.whichMaps=function(e){var t=this,r=[],a=[];for(var i in"start"===e?e=0:"end"===e&&(e=t.getTimeFrame().lastTime),t.maps)if(t.maps.hasOwnProperty(i)){var n=t.maps[i];e>=n.start&&e<=n.end&&r.push(i)}return r.every((function(e){var r=t.maps[e],i={map:r};return"leaf"===r.data.timeline.level?(i.camera=!0,a.push(i)):(i.camera=!1,a.unshift(i)),!0})),a},e.prototype.getChildLeafTimelines=function(e){var t=this.whichMaps(e),r={};return t.every((function(t){var a=t.map.data.timeline.id,i=t.map.calcChildTime(e);return r[a]=i,!0})),r},e.prototype.getUniqueLeafTimelines=function(){var e=this,t={};for(var r in e.maps)if(e.maps.hasOwnProperty(r)){var a=e.maps[r];t[a.data.timeline.id]=a.data.timeline}return t},e.prototype.initCamera=function(e,t){var r=this,a=r.whichCameraMap(e);a||r.camera.ignore?a?"flyTo"===r.camera.action?Human.renderer.camera.fly.flyTo(r.getCamera(e),(function(){if(r.camera.rotationCenter){var e=r.camera.rotationCenter;Human.renderer.camera.setRotationCenter(e[0],e[1],e[2])}t()})):Human.renderer.camera.fly.jumpTo(r.getCamera(e),(function(){if(r.camera.rotationCenter){var e=r.camera.rotationCenter;Human.renderer.camera.setRotationCenter(e[0],e[1],e[2])}t()})):t&&t():(r.camera.screenPan&&Human.renderer.camera.setScreenPan(r.camera.screenPan),"flyTo"===r.camera.action?Human.renderer.camera.fly.flyTo(r.camera.location,(function(){if(r.camera.rotationCenter){var e=r.camera.rotationCenter;Human.renderer.camera.setRotationCenter(e[0],e[1],e[2])}t()})):Human.renderer.camera.fly.jumpTo(r.camera.location,(function(){if(r.camera.rotationCenter){var e=r.camera.rotationCenter;Human.renderer.camera.setRotationCenter(e[0],e[1],e[2])}t()})))},e.prototype.initAnnotations=function(e){var t=this;Human.view&&(Human.view.annotations.clearAnnotations(),e.forEach((function(e,r){var a="___"+t.id+"."+r;if(!e.pos&&e.objectId){var i=Human.scene.objects[e.objectId];i&&(e.pos=i.getCenter())}e.annotationId=a,e.title=e.title||"",e.description=e.description||"",e.dir=e.pinVec||e.dir,e.type=e.type||"default",e.enabled="secondary"!==e.type,e.shown="secondary"!==e.type,e.labelShown="secondary"!==e.type,e.labelOffset=e.labelOffset||null,e.saved=!0,Human.view.annotations.createAnnotation(e)})))},e.prototype.initGraph=function(e){Human.scene.setObjectProperties(e)},e.prototype.initProperties=function(){var e=this;Human.renderer.lights.clearEnabled(),Human.renderer.lights.setEnabled(unpackChapterLights(e.lights));var t=Human.renderer.getScene();t.deactivateReflection(),e.reflection&&t.activateReflection(e.reflection),t.deactivateLightmap(),e.lightmap&&t.activateLightmap(e.lightmap),Human.view&&Human.view.setViewModes(e.viewModes),Human.properties.applyDefaults(),Human.properties.set(e.properties)},e.prototype.initParticles=function(){for(var e=0,t=this.particleSystems.length;e<t;++e)Human.particles.enable(this.particleSystems[e])},e.prototype.initClippingPlanes=function(){var e;for(e in Human.renderer.clip.reset(),this.clippingPlanes.clips)if(this.clippingPlanes.clips.hasOwnProperty(e)){var t=Human.utils.shallowClone(this.clippingPlanes.clips[e]);t.boundary=this.clippingPlanes.boundary,Human.renderer.clip.setClip(t)}},e.prototype.initPostprocess=function(){var e=this.postprocess.filter((function(e){return"groundShadow"!==e.effect}));Human.renderer.postprocess.parse(e);for(var t=0;t<this.postprocess.length;t++)if("groundShadow"===this.postprocess[t].effect){var r=this.postprocess[t];return Human.renderer.groundShadow.init(),void Human.renderer.groundShadow.update({blurAmount:r.blur,opacity:r.opacity,translation:[r.xPos,r.yPos,r.zPos],scale:r.size})}Human.renderer.groundShadow.destroy()},e.prototype.initTransparencyMode=function(){Human.renderer.setTransparencyMode(this.transparencyMode)},e.prototype.init=function(e,t,r){var a=this;Human.events.fire("timeline.chapters.activate.start",{chapterId:a.id,params:t}),a.timeRange=a.getTimeFrame(),t.camera&&!a.initializedCamera&&(a.initializedCamera=!0,a.initCamera(e,t.cameraCallback||function(){})),t.graph&&!a.initializedGraph&&(a.initializedGraph=!0,a.initGraph(a.synchronization)),t.properties&&!a.initializedProperties&&(a.initializedProperties=!0,a.initProperties()),t.particles&&!a.initializedParticles&&(Human.particles.disableAll(),Human.particles.resetAll(),a.initializedParticles=!0,a.initParticles()),t.clipping&&!a.initializedClippingPlanes&&(a.initializedClippingPlanes=!0,a.initClippingPlanes()),t.postprocess&&!a.initializedPostprocess&&(a.initializedPostprocess=!0,a.initPostprocess()),t.transparencyMode&&!a.initializedTransparencyMode&&(a.initializedTransparencyMode=!0,a.initTransparencyMode()),a.ssaa?Human.renderer.getResolutionScalingSupported()&&Human.renderer.setResolutionScaling(2):Human.renderer.setResolutionScaling(1),Human.events.fire("timeline.chapters.initializing",{chapterId:a.id,params:t}),r&&r(),Human.events.fire("timeline.chapters.activate.finish",{chapterId:a.id})},e.prototype.uninit=function(e,t){Human.events.fire("timeline.chapter.deactivate.start"),this.initGraph({}),this.initAnnotations([]),t&&t(),Human.events.fire("timeline.chapter.deactivate.finish")},e.prototype.update=function(e,t,r){t=t||{};var a=this;a.firstUpdate&&(a.firstUpdate=!1,t.hasOwnProperty("camera")||(t.camera=!a.initializedCamera),t.hasOwnProperty("annotations")||(t.annotations=!a.initializedAnnotations),t.hasOwnProperty("properties")||(t.properties=!a.initializedProperties),t.hasOwnProperty("graph")||(t.graph=!a.initializedGraph),t.hasOwnProperty("particles")||(t.particles=!a.initializedParticles),t.hasOwnProperty("clipping")||(t.clipping=!a.initializedClippingPlanes),t.hasOwnProperty("postprocess")||(t.postprocess=!a.initializedPostprocess),t.hasOwnProperty("transparencyMode")||(t.transparencyMode=!a.initializedTransparencyMode),a.init(e,t,(function(){}))),a._update2(e),r&&r()},e.prototype._update2=function(e){var t=this;null==t.timeRange&&(t.timeRange=t.getTimeFrame());var r=t.timeRange;"start"===e||e<r.startTime?e=r.startTime:("end"===e||"last"===e||e>r.lastTime)&&(e=r.lastTime);var a=t.whichMaps(e);for(var i in a.forEach((function(t){var r=t.map,a=t.camera,i=r.data.timeline,n=r.calcChildTime(e);return i.update(a,n),!0})),t.media)t.media.hasOwnProperty(i)&&t.media[i].update(e)},e.prototype.destroy=function(){var e=this.getUniqueLeafTimelines();for(var t in e)e.hasOwnProperty(t)&&"dummy"!==t&&e[t].destroy();delete Human.timeline.branchTimelines[this.id]}}(),function(){"use strict";var e=Human.timeline.RootTimeline=function(e,t){t=t||{};var r=this;r.id=e,r.level="root",r.animationOptions={},r._theQueue=[],r._chapters=[],r._times=[],r._timeFrame=null,r.freeAnimations={},r._firstUpdate=!0,r._prevBranch=null,r._prevTime=null,r._nowBranch=null,r._nowTime=null};e.prototype.setAnimationOptions=function(e,t){t=t||{},e.animation&&(this.animationOptions=e.animation)},e.prototype.addChapter=function(e,t){var r=this,a=!(t=t||{}).hasOwnProperty("rebuild")||t.rebuild,i=t.position||r._chapters.length;(i<0||i>r._chapters.length)&&Human.log.warn("RootTimeline.addChapter(): Invalid index "+i+"position"),r._chapters.splice(i,0,e),a&&r.build()},e.prototype.activate=function(e,t,r){var a=this;Human.timeline.activeRoot=a;var i=a.mapGlobalTime(e,{which:"second",direction:"forwards"});Human.events.fire("timeline.chapters.updated",a._assembleChaptersUpdated()),Human.events.fire("timeline.timeFrame.updated",{firstTime:a._timeFrame.firstTime,lastTime:a._timeFrame.lastTime}),Human.timeline.stop(),i.branch.init(i.time,t,(function(){})),Human.timeline.activeRoot.update(e,{which:"second",direction:"forwards"}),Human.timeline.time=e,Human.timeline._time1=e,Human.timeline._time2=e,Human.timeline._freeTime=e,r()},e.prototype.deactivate=function(e,t){null!==Human.timeline.activeRoot&&Human.timeline.activeRoot.id===this.id&&(Human.events.fire("timeline.chapters.updated",[]),Human.events.fire("timeline.timeFrame.updated",{firstTime:0,lastTime:0}),Human.timeline.activeRoot=null,Human.timeline.stop(),Human.timeline.time=0,Human.timeline._time1=0,Human.timeline._time2=0,Human.timeline._freeTime=0,this._nowBranch.uninit(e,t))},e.prototype.getDescendentLeaves=function(){var e={};return this._chapters.forEach((function(t){var r=t.getChildLeafTimelines(0);for(var a in r)r.hasOwnProperty(a)&&(e.hasOwnProperty(a)||(e[a]=Human.timeline.leafTimelines[a]))})),e},e.prototype.getTimeFrame=function(e){e=e||{};var t=0;return this._chapters.forEach((function(e){t+=e.getTimeFrame().lastTime})),{firstTime:0,lastTime:t}},e.prototype.whereIsBranch=function(e,t){var r,a=0,i=!1,n=null;for(r=!0===(t=t||{}).chapters?this._chapters:this._theQueue;!i&&a<r.length;)(i=r[a].id===e.id)?n=a:a++;return n},e.prototype.getBranch=function(e){var t=this;e=e||{};var r,a,i=!1,n=0,o={};if(Human.utils.isEmpty(e))return null;for(Object.keys(e).length>1&&Human.log.warn("timeline.RootTimeline.getBranch","too many parameters, using only the first."),a=e[r=Object.keys(e)[0]];!i&&n<t._theQueue.length;)o=t._theQueue[n],t._theQueue[n][r]===a&&(i=!0),n++;return i?o:null},e.prototype.mapGlobalTime=function(e,t){var r=this;t=t||{},"end"===e?e=r.getTimeFrame().lastTime:"start"===e&&(e=0),e<0?e=0:e>r.getTimeFrame().lastTime&&(e=r.getTimeFrame().lastTime);var a="earlier";t.tie?a=t.tie:t.which&&t.direction&&("forwards"===t.direction?a="second"===t.which?"later":"earlier":"backwards"===t.direction&&(a="first"===t.which?"later":"earlier"));var i={branch:null,time:null,index:null},n=r._times.indexOf(e);if(n>=0){var o="later"!==a?n-1:n;i.branch=r._theQueue[o=(o=o<0?r._theQueue.length-1:o)>=r._times.length-1?0:o],i.time="later"!==a?e-r._times[o]:0,i.index=o}else{var s=Human.utils.binarySearch(r._times,e);i.branch=r._theQueue[s.index1],i.time=e-s.value1,i.index=s.index1}return i},e.prototype.mapBranchTime=function(e,t,r){r=r||{};var a=this.whereIsBranch(e);return"end"===t?t=e.getTimeFrame().lastTime:"start"===t&&(t=0),null===a?null:this._times[a]+t},e.prototype.getNeighborChapter=function(e,t,r){var a=this;r=r||{};var i,n=null;if(t="previous"===t?"previous":"next",e instanceof Human.timeline.BranchTimeline)n=e;else{if("number"!=typeof e)return Human.log.warn("timeline.root.getNeighborChapter","invalid 'now' argument :"+JSON.stringify(e)),null;n=a.mapGlobalTime(e,{tie:"later"===r.tie?"later":"earlier"})}if(0===(i=a.whereIsBranch(n))&&"previous"===t)return null;if(i===a._theQueue.length-1&&"next"===t)return null;var o=i;return"next"===t?o++:o--,a._theQueue[o]},e.prototype.isFirst=function(e){return e.id===this._theQueue[0].id},e.prototype.isLast=function(e){return e.id===this._theQueue[this._theQueue.length-1].id},e.prototype.buildFreeAnimations=function(e){var t=this;e=e||{};var r=t.getDescendentLeaves();for(var a in r)if(r.hasOwnProperty(a)){var i=r[a].freeAnimations;for(var n in i)i.hasOwnProperty(n)&&!t.freeAnimations.hasOwnProperty(n)&&(t.freeAnimations[n]=i[n])}},e.prototype.buildQueue=function(e){var t=this;e=e||{},t._theQueue=[];var r=0;t._times=[r],t._chapters.forEach((function(e){r+=e.getTimeFrame().lastTime,t._theQueue.push(e),t._times.push(r)}))},e.prototype.build=function(e){var t=this;e=e||{},t._theQueue=[],t._times=[],t.buildFreeAnimations(),t.buildQueue(),Human.timeline.rootTimelines[t.id]&&delete Human.timeline.rootTimelines[t.id],Human.timeline.rootTimelines[t.id]=t,t._timeFrame=t.getTimeFrame(),null===t._nowBranch?(t._nowBranch=t._theQueue[0],t._nowTime=0,t._prevBranch=t._nowBranch,t._prevTime=0):null===t.whereIsBranch(t._nowBranch)&&(t._nowBranch=t._theQueue[0],t._nowTime=0,(null===t._prevBranch||null===t.whereIsBranch(t._prevBranch))&&(t._prevBranch=t._nowBranch,t._prevTime=t._nowTime)),Human.events.fire("timeline.chapters.updated",t._assembleChaptersUpdated()),Human.events.fire("timeline.timeFrame.updated",{firstTime:t._timeFrame.firstTime,lastTime:t._timeFrame.lastTime})},e.prototype.destroy=function(){var e=this;e._theQueue.forEach((function(e){Human.timeline.branchTimelines.hasOwnProperty(e.id)&&e.destroy()})),Human.timeline.rootTimelines.hasOwnProperty(e.id)&&delete Human.timeline.rootTimelines[e.id]},e.prototype.updateFreeAnimations=function(e){var t=this;for(var r in t.freeAnimations)t.freeAnimations.hasOwnProperty(r)&&t.freeAnimations[r].update({cameraEnabled:!1},e);for(var a=t._nowBranch.particleSystems,i=0,n=a.length;i<n;++i)Human.particles.update(a[i],e)},e.prototype.update=function(e,t,r){var a=this,i={},n=[];"function"!=typeof r&&(r=function(){}),i={which:"both",direction:"forwards"},(t=t||{}).hasOwnProperty("which")&&(i.which=t.which),t.hasOwnProperty("direction")&&(i.direction=t.direction),e<0?(e=0,Human.log.warn("Time violates lower bound. Updating to time = 0.0")):e>a._timeFrame.lastTime&&(e=a._timeFrame.lastTime,Human.log.warn("Time violates upper bound. Updating to time = "+e)),n=a._getBranchesToUpdate(e,i),a._firstUpdate&&(a._nowBranch=n[0].branch,a._nowTime=n[0].time,a._firstUpdate=!1);var o=!1;n.forEach((function(e){a._prevBranch=a._nowBranch,a._prevTime=a._nowTime,o=e.branch.firstUpdate,a._nowBranch=e.branch,a._nowTime=e.time,e.branch.update(e.time,{},r),o&&Human.events.fire("timeline.chapters.activated",a._assembleChaptersActivated())})),a._prevBranch.id!==a._nowBranch.id&&a._prevBranch.reset()},e.prototype._getBranchesToUpdate=function(e,t){var r=this;return r._times.indexOf(e)>=0?r._getBorderBranches(e,t):[r.mapGlobalTime(e,{tie:"earlier"})]},e.prototype._getBorderBranches=function(e,t){var r=this.mapGlobalTime(e,{tie:"earlier"}),a=this.mapGlobalTime(e,{tie:"later"}),i=[r,a];return"backwards"===t.direction&&(i=[a,r]),"first"===t.which?i.splice(1,1):"second"===t.which&&i.splice(0,1),i},e.prototype._assembleChaptersUpdated=function(){var e,t,r,a,i=[],n=this._chapters;for(e=0,t=n.length;e<t;e++)a={chapterId:(r=n[e]).id,time:this.mapBranchTime(r,0),duration:r.getTimeFrame().lastTime,displayName:r.info.displayName,description:r.info.description,loop:r.animation.loop,index:e},i.push(a);return i},e.prototype._assembleChaptersActivated=function(){var e=this,t={};return t.oldChapterIndex=e.whereIsBranch(e._prevBranch,{chapters:!0}),t.newChapterIndex=e.whereIsBranch(e._nowBranch,{chapters:!0}),t.time=e.mapBranchTime(e._nowBranch,e._nowTime),t.loop=e._nowBranch.animation.loop||!1,t.branchID=e._nowBranch.id,t},e.prototype._assembleQueryChapters=function(){var e,t,r,a=this,i=[],n=a._chapters;for(e=0,t=n.length;e<t;e++)i.push({chapterId:(r=n[e]).id,time:a.mapBranchTime(r,0),displayName:r.info.displayName,description:r.info.description,type:"branch",tags:r.tags||[],annotations:r.annotations,hotspots:null,flyTo:r.camera.location,active:a._nowBranch.id===r.id,sounds:r._getAudio(),translations:r.translations||null});return i}}(),function(){"use strict";var e=0,t=Human.particles={creators:{},updaters:{},constraints:{},shapes:{},systems:{}},r={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY};function a(r,a){var i=r.id||"ps"+e++,n=r.numParticles,o={properties:r.properties,material:r.material,textures:r.textures,spriteRows:r.spriteRows||0,spriteCols:r.spriteCols||0,spriteStartFrame:r.spriteStartFrame||0,spriteEndFrame:r.spriteEndFrame||0};0===o.spriteEndFrame&&o.spriteRows>0&&o.spriteCols>0&&(o.spriteEndFrame=o.spriteRows*o.spriteCols-1);var s,l,c,u,_,h,f,d,p=[],m=[],g=[],y={},v=0,S=r.creators||[],b=r.updaters||[],E=r.constraints||[],I=0,x=null,C=null;for(l=0,c=S.length;l<c;++l)_=(f=S[l]).id||"__CR"+ ++v,y[_]?Human.log.error("Component "+_+" already exists. Skipping."):(h=new t.creators[u=f.type](f,o),p.push(h),y[_]=h,"Lifetime"===u?o.lifetimes=!0:"SolidColor"===u?o.colors=!0:"RandomScale"===u||"RandomRotation"===u?o.scaleRotations=!0:"RandomRotationSpeed"===u?(o.scaleRotations=!0,o.rotationSpeeds=!0):"SpriteAnimationDuration"===u&&(o.uvTranslates=!0,o.spriteFrameDuration=!0,o.spriteFrameCounter=!0,o.spriteCurrentTime=!0));var T=null,N=null;for(l=0,c=b.length;l<c;++l)if(_=(d=b[l]).id||"__UP"+ ++v,y[_])Human.log.error("Component "+_+" already exists. Skipping.");else{if(u=d.type,d.shape&&(x=new t.shapes[(s=d.shape).type](s),C=s.direction||"in"),T=new t.updaters[u](d,o),"AgeColorBlend"===u)o.colors=!0,o.lifetimes=!0;else if("Path"===u){N=T;for(var A=d.nodes,D=0;D<A.length;++D)T.addNode(A[D]);o.paths=!0}else"SpriteAnimation"===u&&(o.uvTranslates=!0);x&&(T.shape=x,T.shapeDirection=C),m.push(T),y[_]=T}var M=null;for(l=0,c=E.length;l<c;++l)if(_=(f=E[l]).id||"__CN"+ ++v,y[_])Human.log.error("Component "+_+" already exists. Skipping.");else{var P;switch(u=f.type,f.shape&&(x=new t.shapes[(s=f.shape).type](s),C=s.direction||"in"),f.trap?(P=I++,o.traps=!0):P=-1,u){case"LifetimeKill":case"LifetimeStop":M=new t.constraints[u](o);break;case"PathKill":case"PathRadius":case"PathStop":M=new t.constraints[u](N,o);break;case"ShapeBounce":case"ShapeStop":case"ShapeKill":M=new t.constraints[u](x,C,P,o)}g.push(M),y[_]=M}var w=o.textures||[];for(l=0,c=w.length;l<c;++l)w[l].src=window.localBaseDirectory+"content/states/"+w[l].src.replace(/^\/+/,"");Human.assets.textures.load(w,(function(){var e=new t.ParticleSystem(n,o);e.creators=p,e.updaters=m,e.constraints=g,e.components=y,void 0!==r.emissionAverage&&(e.emissionAverage=r.emissionAverage),void 0!==r.emissionVariance&&(e.emissionVariance=r.emissionVariance),void 0!==r.maxSpeed&&(e.maxSpeed=r.maxSpeed),void 0!==r.pointSize&&e.pointSize(r.pointSize),t.systems[i]=e,a&&a()}))}t.parse=function(e,t){var r=(e=Human.utils.deepClone(e)).length;if(0!==r)for(var i=0,n=e.length;i<n;++i)a(e[i],o);else t&&t();function o(){0==--r&&t&&t()}},t.getBoundary=function(){for(var e in r.xmin=Number.POSITIVE_INFINITY,r.ymin=Number.POSITIVE_INFINITY,r.zmin=Number.POSITIVE_INFINITY,r.xmax=Number.NEGATIVE_INFINITY,r.ymax=Number.NEGATIVE_INFINITY,r.zmax=Number.NEGATIVE_INFINITY,t.systems){var a=t.systems[e].getBoundary();r.xmin=Math.min(r.xmin,a.xmin),r.ymin=Math.min(r.ymin,a.ymin),r.zmin=Math.min(r.zmin,a.zmin),r.xmax=Math.max(r.xmax,a.xmax),r.ymax=Math.max(r.ymax,a.ymax),r.zmax=Math.max(r.zmax,a.zmax)}return r},t.update=function(e,r){t.systems[e]&&(t.systems[e].update(r),Human.renderer.camera.nearFarDirty=!0)},t.updateAll=function(e){for(var r in t.systems)t.systems.hasOwnProperty(r)&&t.update(r,e)},t.enable=function(e){t.systems[e].enable()},t.enableAll=function(){for(var e in t.systems)t.systems.hasOwnProperty(e)&&t.enable(e)},t.disable=function(e){t.systems[e].disable()},t.disableAll=function(){for(var e in t.systems)t.systems.hasOwnProperty(e)&&t.disable(e)},t.reset=function(e){t.systems[e].reset()},t.resetAll=function(){for(var e in t.systems)t.systems.hasOwnProperty(e)&&t.reset(e)},t.destroy=function(e){t.systems[e]&&(t.systems[e].destroy(),delete t.systems[e])},t.destroyAll=function(){for(var e in t.systems)t.systems.hasOwnProperty(e)&&t.destroy(e)}}(),function(){"use strict";var e=new Float32Array(3),t=new Float32Array(3),r=new Uint8Array(4),a=new Float32Array(2),i=new Float32Array(1),n=new Float32Array(2),o={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},s=Human.particles.ParticleSystem=function(e,t){var r,a=(t=t||{}).material,i=t.textures,n=t.properties||{},o=n.layer||0,s=n.addBlend||!1,l=!!t.colors,c=!!t.lifetimes,u=!!t.paths,_=!!t.traps,h=Human.renderer.getScene(),f=!!t.scaleRotations,d=!!t.rotationSpeeds,p=!!t.uvTranslates,m=!!t.spriteFrameDuration,g=!!t.spriteFrameCounter,y=!!t.spriteCurrentTime;if(this.activeParticlesBegin=0,this.numParticles=0,this.maxSpeed=0,this.maxNumParticles=e,this.spriteRows=t.spriteRows||0,this.spriteCols=t.spriteCols||0,this.spriteStartFrame=t.spriteStartFrame||0,this.spriteEndFrame=t.spriteEndFrame||0,this.attributes={stopped:new Array(e),dead:new Array(e),positions:new Float32Array(3*e),velocities:new Float32Array(3*e),colors:l?new Uint8Array(4*this.maxNumParticles):null,lifetimes:c?new Float32Array(this.maxNumParticles):null,ages:c?new Float32Array(this.maxNumParticles):null,paths:u?new Uint8Array(this.maxNumParticles):null,traps:_?new Uint32Array(this.maxNumParticles):null,scaleRotations:f?new Float32Array(2*e):null,rotationSpeeds:d?new Float32Array(e):null,uvTranslates:p?new Float32Array(2*e):null,spriteFrameDuration:m?new Float32Array(e):null,spriteFrameCounter:g?new Uint8Array(e):null,spriteCurrentTime:y?new Float32Array(e):null},this.rootNode=null,this.properties=null,this.material=null,this.geometry=null,n.enabled=!1,n.picking=!1,!1===n.depthMask&&(n.noDepthMask=!0),this.rootNode=this.properties=r=h.addNode({type:"properties",properties:n}),a&&(a.type="material",this.material=r=r.addNode(a)),i)for(var v=0,S=i.length;v<S;++v)i[v].type="texture",i[v].src=window.localBaseDirectory+"content/states/"+i[v].src,r=r.addNode(i[v]);var b=null;this.spriteRows>0&&this.spriteCols>0&&(b=new Float32Array([1/this.spriteCols,1/this.spriteRows])),this.geometry=r.addNode({type:"geometry",positions:this.attributes.positions,colors:this.attributes.colors,pointScaleRotations:this.attributes.scaleRotations,pointUVTranslates:this.attributes.uvTranslates,pointUVScale:b,layer:o,addBlend:s,primitive:"points"}),this.enabled=!1,this.emissionAverage=0,this.emissionVariance=0,this.creators=[],this.updaters=[],this.constraints=[],this.components={},this.previousTime=null};s.prototype.pointSize=function(e){this.geometry.setPointSize(e)},s.prototype.getBoundary=function(){return o},s.prototype.update=function(e){if(this.enabled){o.xmin=Number.POSITIVE_INFINITY,o.ymin=Number.POSITIVE_INFINITY,o.zmin=Number.POSITIVE_INFINITY,o.xmax=Number.NEGATIVE_INFINITY,o.ymax=Number.NEGATIVE_INFINITY,o.zmax=Number.NEGATIVE_INFINITY;var r=Math.max,a=Math.min,i=Math.sqrt,n=Math.floor,s=Math.random;this.previousTime=this.previousTime||e;var l=a(e-this.previousTime,.04);l<0&&(this.previousTime=e,l=0);var c,u,_,h,f,d,p,m,g=this.attributes,y=g.positions,v=g.velocities,S=g.ages,b=g.lifetimes,E=!!S,I=this.maxSpeed*l,x=I*I,C=g.scaleRotations,T=g.rotationSpeeds;if(this.numParticles<this.maxNumParticles){var N=this.emissionVariance*l,A=r(this.emissionAverage*l+2*s()*N-N,0);A=A>=1?n(A):s()<A?1:0;var D=a(this.numParticles+A,this.maxNumParticles);for(c=this.numParticles;c<D;++c)m=2*c,y[_=3*c]=0,y[_+1]=0,y[_+2]=0,v[_]=0,v[_+1]=0,v[_+2]=0,g.dead[c]=!1,g.stopped[c]=!1,g.paths&&(g.paths[c]=0),g.traps&&(g.traps[c]=0),g.traps&&(g.traps[c]=0),g.scaleRotations&&(g.scaleRotations[m]=1,g.scaleRotations[m+1]=0),g.rotationSpeeds&&(g.rotationSpeeds[c]=0),g.uvTranslates&&(g.uvTranslates[m]=this.spriteStartFrame%this.spriteCols*1/this.spriteCols,g.uvTranslates[m+1]=1*(this.spriteRows-1-n(this.spriteStartFrame/this.spriteCols))/this.spriteRows),g.spriteFrameCounter&&(g.spriteFrameCounter[c]=0),g.spriteFrameDuration&&(g.spriteFrameDuration[c]=0),g.spriteCurrentTime&&(g.spriteCurrentTime[c]=0);for(u=0,h=this.creators.length;u<h;++u)this.creators[u].create(this.numParticles,D,g);this.numParticles=D}for(u=0,h=this.updaters.length;u<h;++u)this.updaters[u].update(this.activeParticlesBegin,this.numParticles,g,l);for(c=this.activeParticlesBegin;c<this.numParticles;++c){if(m=2*c,d=1+(_=3*c),p=_+2,t[0]=v[f=_]*l,t[1]=v[d]*l,t[2]=v[p]*l,x>0){var M=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(M>x){var P=I/i(M);t[0]*=P,t[1]*=P,t[2]*=P,v[f]=t[0],v[d]=t[1],v[p]=t[2]}}y[f]+=t[0],y[d]+=t[1],y[p]+=t[2],T&&(C[m+1]+=T[c]*l),o.xmin=a(o.xmin,y[f]),o.ymin=a(o.ymin,y[d]),o.zmin=a(o.zmin,y[p]),o.xmax=r(o.xmax,y[f]),o.ymax=r(o.ymax,y[d]),o.zmax=r(o.zmax,y[p]),E&&S[c]<b[c]&&(S[c]=a(S[c]+l,b[c]))}for(c=0;c<this.activeParticlesBegin;++c)d=1+(_=3*c),p=_+2,o.xmin=a(o.xmin,y[f=_]),o.ymin=a(o.ymin,y[d]),o.zmin=a(o.zmin,y[p]),o.xmax=r(o.xmax,y[f]),o.ymax=r(o.ymax,y[d]),o.zmax=r(o.zmax,y[p]);for(u=0,h=this.constraints.length;u<h;++u)this.constraints[u].constrain(this.activeParticlesBegin,this.numParticles,g);var w=g.stopped,F=g.dead;for(c=this.activeParticlesBegin;c<this.numParticles;++c)F[c]?(this.kill(c),--c):w[c]&&this.stop(c);this.geometry.setPositions(g.positions.subarray(0,3*this.numParticles)),g.colors&&this.geometry.setColors(g.colors.subarray(0,4*this.numParticles)),g.scaleRotations&&this.geometry.setPointScaleRotations(g.scaleRotations.subarray(0,2*this.numParticles)),g.uvTranslates&&this.geometry.setPointUVTranslates(g.uvTranslates.subarray(0,2*this.numParticles)),this.properties.setEnabled(this.numParticles>0),this.previousTime=e}},s.prototype.kill=function(e){var t=this.attributes,r=2*e,a=3*e,i=4*e,n=e,o=2*(this.numParticles-1),s=3*(this.numParticles-1),l=4*(this.numParticles-1),c=this.numParticles-1,u=t.positions,_=t.velocities,h=t.colors,f=t.ages,d=t.lifetimes,p=t.paths,m=t.dead,g=t.stopped,y=t.traps,v=t.scaleRotations,S=t.rotationSpeeds,b=t.uvTranslates;u[a]=u[s],u[a+1]=u[s+1],u[a+2]=u[s+2],_[a]=_[s],_[a+1]=_[s+1],_[a+2]=_[s+2],m[n]=m[c],g[n]=g[c],h&&(h[i]=h[l],h[i+1]=h[l+1],h[i+2]=h[l+2],h[i+3]=h[l+3]),v&&(v[r]=v[o],v[r+1]=v[o+1]),S&&(S[n]=S[c]),b&&(b[r]=b[o],b[r+1]=b[o+1]),d&&(f[n]=f[c],d[n]=d[c]),p&&(p[n]=p[c]),y&&(y[n]=y[c]),this.numParticles--},s.prototype.stop=function(o){var s,l=this.attributes,c=2*o,u=3*o,_=4*o,h=o,f=2*this.activeParticlesBegin,d=3*this.activeParticlesBegin,p=4*this.activeParticlesBegin,m=this.activeParticlesBegin,g=l.positions,y=l.velocities,v=l.colors,S=l.ages,b=l.lifetimes,E=l.paths,I=l.stopped,x=l.traps,C=l.scaleRotations,T=l.rotationSpeeds,N=l.uvTranslates;e[0]=g[d],e[1]=g[d+1],e[2]=g[d+2],g[d]=g[u],g[d+1]=g[u+1],g[d+2]=g[u+2],g[u]=e[0],g[u+1]=e[1],g[u+2]=e[2],t[0]=y[d],t[1]=y[d+1],t[2]=y[d+2],y[d]=y[u],y[d+1]=y[u+1],y[d+2]=y[u+2],y[u]=t[0],y[u+1]=t[1],y[u+2]=t[2],v&&(r[0]=v[p],r[1]=v[p+1],r[2]=v[p+2],r[3]=v[p+3],v[p]=v[_],v[p+1]=v[_+1],v[p+2]=v[_+2],v[p+3]=v[_+3],v[_]=r[0],v[_+1]=r[1],v[_+2]=r[2],v[_+3]=r[3]),C&&(a[0]=C[f],a[1]=C[f+1],C[f]=C[c],C[f+1]=C[c+1],C[c]=a[0],C[c+1]=a[1]),T&&(i[0]=T[m],T[m]=T[o],T[o]=i[0]),N&&(n[0]=N[f],n[1]=N[f+1],N[f]=N[c],N[f+1]=N[c+1],N[c]=n[0],N[c+1]=n[1]),b&&(s=S[m],S[m]=S[h],S[h]=s,s=b[m],b[m]=b[h],b[h]=s),E&&(s=E[m],E[m]=E[h],E[h]=s),x&&(s=x[m],x[m]=x[h],x[h]=s),I[h]=!1,this.activeParticlesBegin++},s.prototype.reset=function(){this.numParticles=0,this.activeParticlesBegin=0},s.prototype.enable=function(){this.properties.setEnabled(!0),this.enabled=!0},s.prototype.disable=function(){this.properties.setEnabled(!1),this.enabled=!1},s.prototype.destroy=function(){this.rootNode.destroy()}}(),function(){"use strict";var e=new Float32Array(3);(Human.particles.creators.DirectionalVelocity=function(e){this.directionAverage=new Float32Array(e.directionAverage),this.directionVariance=e.directionVariance||0,this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0,vec3.normalize(this.directionAverage,this.directionAverage)}).prototype.create=function(t,r,a){for(var i=a.velocities,n=Math.random,o=vec3.normalize,s=t;s<r;++s){var l=3*s,c=this.forceAverage+2*n()*this.forceVariance-this.forceVariance;e[0]=this.directionAverage[0]+2*n()*this.directionVariance-this.directionVariance,e[1]=this.directionAverage[1]+2*n()*this.directionVariance-this.directionVariance,e[2]=this.directionAverage[2]+2*n()*this.directionVariance-this.directionVariance,o(e,e),i[l]=e[0]*c,i[l+1]=e[1]*c,i[l+2]=e[2]*c}}}(),function(){"use strict";(Human.particles.creators.Lifetime=function(e){this.average=e.average,this.variance=e.variance||0}).prototype.create=function(e,t,r){for(var a=r.ages,i=r.lifetimes,n=Math.random,o=e;o<t;++o)a[o]=0,i[o]=this.average,this.variance>0&&(i[o]+=2*n()*this.variance-this.variance)}}(),function(){"use strict";(Human.particles.creators.PointPosition=function(e){this.position=new Float32Array(e.position)}).prototype.create=function(e,t,r){for(var a=r.positions,i=e;i<t;++i){var n=3*i;a[n]=this.position[0],a[n+1]=this.position[1],a[n+2]=this.position[2]}}}(),function(){"use strict";var e=new Float32Array(3);(Human.particles.creators.RandomVelocity=function(e){this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0}).prototype.create=function(t,r,a){for(var i=a.velocities,n=Math.random,o=vec3.normalize,s=t;s<r;++s){var l=3*s,c=this.forceAverage;this.forceVariance>0&&(c+=2*n()*this.forceVariance-this.forceVariance),e[0]=2*n()-1,e[1]=2*n()-1,e[2]=2*n()-1,o(e,e),i[l]=e[0]*c,i[l+1]=e[1]*c,i[l+2]=e[2]*c}}}(),function(){"use strict";var e=vec3.create();(Human.particles.creators.SpherePosition=function(e){this.translate=null,this.xform=null,e.translate&&(this.translate=new Float32Array(e.translate)),(e.scale||e.rotate)&&(this.xform=mat3.create(),Human.math.buildRotationScaleMat3(this.xform,e.rotate,e.scale))}).prototype.create=function(t,r,a){for(var i=a.positions,n=Math.random,o=Math.PI,s=Math.sin,l=Math.cos,c=t;c<r;++c){var u=3*c,_=n()*o,h=n()*o*2,f=n();e[0]=f*s(_)*s(h),e[1]=f*l(_),e[2]=f*s(_)*l(h),this.xform&&vec3.transformMat3(e,e,this.xform),this.translate&&(e[0]+=this.translate[0],e[1]+=this.translate[1],e[2]+=this.translate[2]),i[u]=e[0],i[u+1]=e[1],i[u+2]=e[2]}}}(),function(){"use strict";var e=vec3.create();(Human.particles.creators.CubePosition=function(e){this.translate=null,this.xform=null,e.translate&&(this.translate=new Float32Array(e.translate)),(e.scale||e.rotate)&&(this.xform=mat3.create(),Human.math.buildRotationScaleMat3(this.xform,e.rotate,e.scale))}).prototype.create=function(t,r,a){for(var i=a.positions,n=Math.random,o=t;o<r;++o){var s=3*o;e[0]=n()-.5,e[1]=n()-.5,e[2]=n()-.5,this.xform&&vec3.transformMat3(e,e,this.xform),this.translate&&(e[0]+=this.translate[0],e[1]+=this.translate[1],e[2]+=this.translate[2]),i[s]=e[0],i[s+1]=e[1],i[s+2]=e[2]}}}(),function(){"use strict";var e=vec3.create();(Human.particles.creators.CylinderPosition=function(e){this.translate=null,this.xform=null,e.translate&&(this.translate=new Float32Array(e.translate)),(e.scale||e.rotate)&&(this.xform=mat3.create(),Human.math.buildRotationScaleMat3(this.xform,e.rotate,e.scale))}).prototype.create=function(t,r,a){for(var i=a.positions,n=Math.random,o=Math.PI,s=Math.sin,l=Math.cos,c=t;c<r;++c){var u=3*c,_=n()*o*2,h=n(),f=2*n()-1;e[0]=h*l(_),e[1]=f,e[2]=h*s(_),this.xform&&vec3.transformMat3(e,e,this.xform),this.translate&&(e[0]+=this.translate[0],e[1]+=this.translate[1],e[2]+=this.translate[2]),i[u]=e[0],i[u+1]=e[1],i[u+2]=e[2]}}}(),function(){"use strict";(Human.particles.creators.RandomScale=function(e){this.average=e.average,this.variance=e.variance||0}).prototype.create=function(e,t,r){for(var a=r.scaleRotations,i=Math.random,n=2*t,o=2*e;o<n;o+=2){var s=this.average;this.variance>0&&(s+=2*i()*this.variance-this.variance),a[o]=s}}}(),function(){"use strict";(Human.particles.creators.RandomRotation=function(e){this.average=e.average*Human.math.TO_RADIANS,this.variance=(e.variance||0)*Human.math.TO_RADIANS}).prototype.create=function(e,t,r){for(var a=r.scaleRotations,i=Math.random,n=2*t+1,o=2*e+1;o<n;o+=2){var s=this.average;this.variance>0&&(s+=2*i()*this.variance-this.variance),a[o]=s}}}(),function(){"use strict";(Human.particles.creators.RandomRotationSpeed=function(e){this.average=e.average*Human.math.TO_RADIANS,this.variance=(e.variance||0)*Human.math.TO_RADIANS}).prototype.create=function(e,t,r){for(var a=r.rotationSpeeds,i=Math.random,n=e;n<t;n++){var o=this.average;this.variance>0&&(o+=2*i()*this.variance-this.variance),a[n]=o}}}(),function(){"use strict";(Human.particles.creators.SpriteAnimationDuration=function(e,t){this.rows=t.spriteRows,this.cols=t.spriteCols,this.startFrame=t.spriteStartFrame,this.endFrame=t.spriteEndFrame,this.average=e.average,this.variance=e.variance}).prototype.create=function(e,t,r){for(var a=r.spriteFrameDuration,i=Math.random,n=Math.max,o=e;o<t;o++){var s=this.average;this.variance>0&&(s+=2*i()*this.variance-this.variance),a[o]=n(s/(this.endFrame-this.startFrame),0)}}}(),function(){"use strict";var e=new Float32Array(3);(Human.particles.updaters.BrownianMotion=function(e){this.frequency=e.frequency,this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0,this.shape=null,this.shapeDirection="in"}).prototype.update=function(t,r,a,i){for(var n=a.positions,o=a.velocities,s=Math.random,l=vec3.normalize,c=!!this.shape,u=this.frequency*i,_=this.forceAverage*i,h=this.forceVariance*i,f=t;f<r;++f)if((!c||this.shape[this.shapeDirection](n,f))&&s()<u){var d=3*f,p=_;h>0&&(p+=2*s()*h-h),e[0]=2*s()-1,e[1]=2*s()-1,e[2]=2*s()-1,l(e,e),o[d]+=e[0]*p,o[d+1]+=e[1]*p,o[d+2]+=e[2]*p}}}(),function(){"use strict";(Human.particles.updaters.Friction=function(e){this.friction=1-e.friction,this.shape=null,this.shapeDirection="in"}).prototype.update=function(e,t,r,a){for(var i=r.positions,n=r.velocities,o=!!this.shape,s=Math.pow(this.friction,a),l=e;l<t;++l)if(!o||this.shape[this.shapeDirection](i,l)){var c=3*l;n[c]*=s,n[c+1]*=s,n[c+2]*=s}}}(),function(){"use strict";var e=new Float32Array(3);(Human.particles.updaters.UniformForce=function(e){this.directionAverage=new Float32Array(e.directionAverage),this.directionVariance=e.directionVariance||0,this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0,this.shape=null,this.shapeDirection="in",vec3.normalize(this.directionAverage,this.directionAverage)}).prototype.update=function(t,r,a,i){for(var n=a.positions,o=a.velocities,s=Math.random,l=vec3.normalize,c=!!this.shape,u=this.forceAverage*i,_=this.forceVariance*i,h=t;h<r;++h)if(!c||this.shape[this.shapeDirection](n,h)){var f=3*h,d=u;_>0&&(d+=2*s()*_-_),e[0]=this.directionAverage[0],e[1]=this.directionAverage[1],e[2]=this.directionAverage[2],this.directionVariance&&(e[0]+=2*s()*this.directionVariance-this.directionVariance,e[1]+=2*s()*this.directionVariance-this.directionVariance,e[2]+=2*s()*this.directionVariance-this.directionVariance,l(e,e)),o[f]+=e[0]*d,o[f+1]+=e[1]*d,o[f+2]+=e[2]*d}}}(),function(){"use strict";var e=new Float32Array(3);(Human.particles.updaters.RadialForce=function(e){this.position=new Float32Array(e.position),this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0,this.shape=null,this.shapeDirection="in"}).prototype.update=function(t,r,a,i){for(var n=a.positions,o=a.velocities,s=Math.random,l=vec3.normalize,c=!!this.shape,u=this.forceAverage*i,_=this.forceVariance*i,h=t;h<r;++h)if(!c||this.shape[this.shapeDirection](n,h)){var f=3*h,d=u;_&&(d+=2*s()*_-_),e[0]=n[f]-this.position[0],e[1]=n[f+1]-this.position[1],e[2]=n[f+2]-this.position[2],l(e,e),o[f]+=e[0]*d,o[f+1]+=e[1]*d,o[f+2]+=e[2]*d}}}(),function(){"use strict";(Human.particles.updaters.AgeColorBlend=function(e){this.colors=new Array(e.colors.length);for(var t=0,r=e.colors.length;t<r;++t)this.colors[t]=new Uint8Array(e.colors[t]);this.shape=null,this.shapeDirection="in"}).prototype.update=function(e,t,r){for(var a=r.positions,i=r.ages,n=r.lifetimes,o=r.colors,s=!!this.shape,l=this.colors.length-1,c=Math.floor,u=e;u<t;++u)if(!s||this.shape[this.shapeDirection](a,u)){var _=4*u,h=i[u]/n[u]*l,f=c(h),d=this.colors[f],p=this.colors[f+1]||this.colors[f],m=h-f,g=1-m;o[_]=g*d[0]+m*p[0],o[_+1]=g*d[1]+m*p[1],o[_+2]=g*d[2]+m*p[2],o[_+3]=g*d[3]+m*p[3]}}}(),function(){"use strict";var e=new Float32Array(3),t=new Float32Array(3),r=new Float32Array(3),a=Human.particles.updaters.Path=function(){this.nodes=[],this.shape=null,this.shapeDirection="in"};a.prototype.addNode=function(e){if(e.first=0===this.nodes.length,e.position=new Float32Array(e.position),e.forceVariance=e.forceVariance||0,this.nodes.push(e),e.first)e.vec=null,e.dir=null,e.length=null;else{var t=this.nodes[this.nodes.length-2];e.vec=vec3.subtract(vec3.create(),e.position,t.position),e.dir=vec3.normalize(vec3.create(),e.vec),e.length=vec3.length(e.vec)}},a.prototype.updateNode=function(e,t){var r=this.nodes[e];if(t.position&&(r.position=t.position,r.first||(vec3.subtract(r.vec,r.position,this.nodes[e-1].position),vec3.normalize(r.dir,r.vec),r.length=vec3.length(r.vec)),e<this.nodes.length-1)){var a=this.nodes[e+1];vec3.subtract(a.vec,a.position,r.position),vec3.normalize(a.dir,a.vec),a.length=vec3.length(a.vec)}t.radius&&(r.radius=t.radius),t.forceAverage&&(r.forceAverage=t.forceAverage)},a.prototype.update=function(a,i,n,o){for(var s,l=n.positions,c=n.velocities,u=n.paths,_=!!this.shape,h=Math.random,f=vec3.distance,d=vec3.normalize,p=vec3.subtract,m=vec3.dot,g=vec3.length,y=vec3.scale,v=a;v<i;++v)if((!_||this.shape[this.shapeDirection](l,v))&&(s=this.nodes[u[v]])){var S,b=3*v;if(e[0]=l[b],e[1]=l[b+1],e[2]=l[b+2],s.first){if(f(e,s.position)<s.radius&&(u[v]++,!(s=this.nodes[u[v]])))continue;d(S=p(r,s.position,e),S)}else{if(m(p(r,e,this.nodes[u[v]-1].position),s.dir)>s.length){if(u[v]++,!(s=this.nodes[u[v]]))continue;t[0]=c[b],t[1]=c[b+1],t[2]=c[b+2];var E=g(t);y(t,s.dir,E),c[b]=t[0],c[b+1]=t[1],c[b+2]=t[2]}S=s.dir}var I=s.forceVariance*o,x=s.forceAverage*o;I>0&&(x+=2*h()*I-I),c[b]+=S[0]*x,c[b+1]+=S[1]*x,c[b+2]+=S[2]*x}}}(),function(){"use strict";var e=new Float32Array(3);(Human.particles.updaters.Gravity=function(e){this.position=new Float32Array(e.position),this.radius=e.radius,this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0,this.shape=null,this.shapeDirection="in"}).prototype.update=function(t,r,a,i){for(var n=a.positions,o=a.velocities,s=Math.random,l=Math.max,c=vec3.length,u=!!this.shape,_=this.forceAverage*i,h=this.forceVariance*i,f=t;f<r;++f)if(!u||this.shape[this.shapeDirection](n,f)){var d=3*f,p=_;h&&(p+=2*s()*h-h),e[0]=this.position[0]-n[d],e[1]=this.position[1]-n[d+1],e[2]=this.position[2]-n[d+2];var m=l(c(e),this.radius);e[0]/=m,e[1]/=m,e[2]/=m,o[d]+=e[0]*(p/=m*m),o[d+1]+=e[1]*p,o[d+2]+=e[2]*p}}}(),function(){"use strict";(Human.particles.updaters.SpriteAnimation=function(e,t){this.rows=t.spriteRows,this.cols=t.spriteCols,this.startFrame=t.spriteStartFrame,this.endFrame=t.spriteEndFrame}).prototype.update=function(e,t,r,a){for(var i=r.uvTranslates,n=r.spriteFrameCounter,o=r.spriteFrameDuration,s=r.spriteCurrentTime,l=e;l<t;l++)s[l]+=a,s[l]>=o[l]&&(s[l]=0,n[l]++,i[2*l]+=1/this.cols,1===i[2*l]&&(i[2*l]=0,i[2*l+1]-=1/this.rows),i[2*l+1]===-1/this.rows&&(i[2*l]=this.startFrame%this.cols*1/this.cols,i[2*l+1]=1*(this.rows-1-Math.floor(this.startFrame/this.cols))/this.rows),n[l]>this.endFrame&&(n[l]=this.startFrame,i[2*l]=this.startFrame%this.cols*1/this.cols,i[2*l+1]=1*(this.rows-1-Math.floor(this.startFrame/this.cols))/this.rows))}}(),function(){"use strict";var e=new Float32Array(3),t=new Float32Array(3),r=new Float32Array(3),a=new Float32Array(3),i=new Float32Array(3);(Human.particles.updaters.AxisForce=function(e){this.position=new Float32Array(e.position),vec3.normalize(e.direction,e.direction),this.direction=new Float32Array(e.direction),this.forceAverage=e.forceAverage,this.forceVariance=e.forceVariance||0,this.shape=null,this.shapeDirection="in"}).prototype.update=function(n,o,s,l){for(var c=s.positions,u=s.velocities,_=Math.random,h=!!this.shape,f=this.forceAverage*l,d=this.forceVariance*l,p=n;p<o;++p)if(!h||this.shape[this.shapeDirection](c,p)){var m=3*p,g=f;d&&(g+=2*_()*d-d),t[0]=c[m],t[1]=c[m+1],t[2]=c[m+2],vec3.sub(r,t,this.position);var y=vec3.dot(r,this.direction);vec3.scale(a,this.direction,y),vec3.add(i,a,this.position),vec3.sub(e,t,i),vec3.normalize(e,e),u[m]+=e[0]*g,u[m+1]+=e[1]*g,u[m+2]+=e[2]*g}}}(),function(){"use strict";(Human.particles.constraints.LifetimeKill=function(){}).prototype.constrain=function(e,t,r){for(var a=r.ages,i=r.lifetimes,n=r.dead,o=e;o<t;++o)a[o]>=i[o]&&(n[o]=!0)}}(),function(){"use strict";(Human.particles.constraints.LifetimeStop=function(){}).prototype.constrain=function(e,t,r){for(var a=r.ages,i=r.lifetimes,n=r.stopped,o=e;o<t;++o)a[o]>=i[o]&&(n[o]=!0)}}(),function(){"use strict";(Human.particles.constraints.ShapeKill=function(e,t,r){this.shape=e,this.direction=t,r>=0?(this.trap=!0,this.trapMask=1<<r):(this.trap=!1,this.trapMask=0)}).prototype.constrain=function(e,t,r){for(var a=r.positions,i=r.dead,n=r.traps,o=this.trap,s=this.trapMask,l=e;l<t;++l)if(this.shape[this.direction](a,l)){if(o&&0==(n[l]&s))continue;i[l]=!0}else o&&(n[l]|=s)}}(),function(){"use strict";(Human.particles.constraints.ShapeStop=function(e,t,r){this.shape=e,this.direction=t,r>=0?(this.trap=!0,this.trapMask=1<<r):(this.trap=!1,this.trapMask=0)}).prototype.constrain=function(e,t,r){for(var a=r.positions,i=r.stopped,n=r.traps,o=this.trap,s=this.trapMask,l=e;l<t;++l)if(this.shape[this.direction](a,l)){if(o&&0==(n[l]&s))continue;i[l]=!0}else o&&(n[l]|=s)}}(),function(){"use strict";var e=new Float32Array(3),t=new Float32Array(3),r=new Float32Array(3),a=new Float32Array(3),i=new Float32Array(3);(Human.particles.constraints.PathRadius=function(e){this.nodes=e.nodes}).prototype.constrain=function(n,o,s){for(var l=s.positions,c=s.paths,u=vec3.normalize,_=vec3.subtract,h=vec3.dot,f=vec3.length,d=vec3.scale,p=n;p<o;++p){var m=3*p;if(!(c[p]<1)){var g=this.nodes[c[p]];if(g){e[0]=l[m],e[1]=l[m+1],e[2]=l[m+2];var y=_(t,e,this.nodes[c[p]-1].position),v=h(y,g.dir),S=d(r,g.dir,v),b=_(a,y,S),E=f(b);if(E>g.radius){u(b,b);var I=d(i,b,g.radius-E);l[m]+=I[0],l[m+1]+=I[1],l[m+2]+=I[2]}}}}}}(),function(){"use strict";(Human.particles.constraints.PathKill=function(e){this.nodes=e.nodes}).prototype.constrain=function(e,t,r){for(var a=this.nodes.length,i=r.paths,n=r.dead,o=e;o<t;++o)i[o]>=a&&(n[o]=!0)}}(),function(){"use strict";(Human.particles.constraints.PathStop=function(e){this.nodes=e.nodes}).prototype.constrain=function(e,t,r){for(var a=this.nodes.length,i=r.paths,n=r.stopped,o=e;o<t;++o)i[o]>=a&&(n[o]=!0)}}(),function(){"use strict";var e=new Float32Array(3),t=new Float32Array(3),r=new Float32Array(3),a=new Float32Array(3),i=new Float32Array(3);(Human.particles.constraints.ShapeBounce=function(e,t,r){this.shape=e,this.direction=t,r>=0?(this.trap=!0,this.trapMask=1<<r):(this.trap=!1,this.trapMask=0)}).prototype.constrain=function(n,o,s){for(var l=s.positions,c=s.velocities,u=s.traps,_=this.trap,h=this.trapMask,f=vec3.subtract,d=vec3.dot,p=vec3.length,m=vec3.scale,g=n;g<o;++g)if(this.shape[this.direction](l,g)){if(_&&0==(u[g]&h))continue;var y=3*g;this.shape.surfaceProjection(l,g,a,i),l.set(a,y),e[0]=c[y],e[1]=c[y+1],e[2]=c[y+2];var v=p(e);e[0]/=v,e[1]/=v,e[2]/=v;var S=d(e,i),b=m(t,i,2*S),E=f(r,e,b);m(E,E,v),c[y]=E[0],c[y+1]=E[1],c[y+2]=E[2]}else _&&(u[g]|=h)}}(),function(){"use strict";var e=vec3.create(),t=Human.particles.shapes.Sphere=function(e){this.translate=null,this.rotate=null,this.scale=null,this.xform=null,this.inverseXform=null,this.normalXform=null,e.translate&&(this.translate=new Float32Array(e.translate)),(e.scale||e.rotate)&&(this.xform=mat3.create(),this.inverseXform=mat3.create(),this.normalXform=mat3.create(),e.rotate&&(this.rotate=new Float32Array(e.rotate)),e.scale&&(this.scale=new Float32Array(e.scale)),this.updateXform())};t.prototype.updateXform=function(){this.xform&&(Human.math.buildRotationScaleMat3(this.xform,this.rotate,this.scale),mat3.invert(this.inverseXform,this.xform),mat3.transpose(this.normalXform,this.inverseXform))},t.prototype.in=function(t,r){var a=3*r;e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],this.translate&&(e[0]-=this.translate[0],e[1]-=this.translate[1],e[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(e,e,this.inverseXform);var i=e[0],n=e[1],o=e[2];return i*i+n*n+o*o<=1},t.prototype.out=function(t,r){var a=3*r;e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],this.translate&&(e[0]-=this.translate[0],e[1]-=this.translate[1],e[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(e,e,this.inverseXform);var i=e[0],n=e[1],o=e[2];return i*i+n*n+o*o>=1},t.prototype.surfaceProjection=function(e,t,r,a){var i=3*t;r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],this.translate&&(r[0]-=this.translate[0],r[1]-=this.translate[1],r[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(r,r,this.inverseXform),vec3.normalize(r,r),a.set(r),this.xform&&(vec3.transformMat3(r,r,this.xform),vec3.transformMat3(a,a,this.normalXform),vec3.normalize(a,a)),this.translate&&(r[0]+=this.translate[0],r[1]+=this.translate[1],r[2]+=this.translate[2])}}(),function(){"use strict";var e=new Float32Array(3),t=new Float32Array(3),r=mat3.create(),a=new Float32Array([0,1,0]),i=Human.particles.shapes.Plane=function(e){this.translate=new Float32Array(e.translate||Human.math.VEC3_ZEROS),this.rotate=new Float32Array(e.rotate||Human.math.VEC3_ZEROS),this.normal=vec3.create(),this.distance=0};i.prototype.updateXform=function(){this.normal.set(a),Human.math.buildRotationScaleMat3(r,this.rotate,null),vec3.transformMat3(this.normal,this.normal,r),this.distance=vec3.dot(this.translate,this.normal)},i.prototype.in=function(e,t){var r=3*t;return e[r]*this.normal[0]+e[r+1]*this.normal[1]+e[r+2]*this.normal[2]<=this.distance},i.prototype.out=function(e,t){var r=3*t;return e[r]*this.normal[0]+e[r+1]*this.normal[1]+e[r+2]*this.normal[2]>=this.distance},i.prototype.surfaceProjection=function(r,a,i,n){var o=3*a;e[0]=r[o],e[1]=r[o+1],e[2]=r[o+2],n[0]=this.normal[0],n[1]=this.normal[1],n[2]=this.normal[2],vec3.scale(t,n,this.distance-vec3.dot(e,n)),vec3.add(i,e,t)}}(),function(){"use strict";var e=vec3.create(),t=Human.particles.shapes.Cube=function(e){this.translate=null,this.rotate=null,this.scale=null,this.xform=null,this.inverseXform=null,this.normalXform=null,e.translate&&(this.translate=new Float32Array(e.translate)),(e.scale||e.rotate)&&(this.xform=mat3.create(),this.inverseXform=mat3.create(),this.normalXform=mat3.create(),e.rotate&&(this.rotate=new Float32Array(e.rotate)),e.scale&&(this.scale=new Float32Array(e.scale)),this.updateXform())};t.prototype.updateXform=function(){this.xform&&(Human.math.buildRotationScaleMat3(this.xform,this.rotate,this.scale),mat3.invert(this.inverseXform,this.xform),mat3.transpose(this.normalXform,this.inverseXform))},t.prototype.in=function(t,r){var a=3*r;e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],this.translate&&(e[0]-=this.translate[0],e[1]-=this.translate[1],e[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(e,e,this.inverseXform);var i=e[0],n=e[1],o=e[2];return i>=-.5&&i<=.5&&n>=-.5&&n<=.5&&o>=-.5&&o<=.5},t.prototype.out=function(t,r){var a=3*r;e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],this.translate&&(e[0]-=this.translate[0],e[1]-=this.translate[1],e[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(e,e,this.inverseXform);var i=e[0],n=e[1],o=e[2];return i<=-.5||i>=.5||n<=-.5||n>=.5||o<=-.5||o>=.5},t.prototype.surfaceProjection=function(e,t,r,a){var i=3*t,n=Math.abs;r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],this.translate&&(r[0]-=this.translate[0],r[1]-=this.translate[1],r[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(r,r,this.inverseXform);var o=r[0],s=r[1],l=r[2],c=n(o+.5),u=n(o-.5),_=n(s+.5),h=n(s-.5),f=n(l+.5),d=n(l-.5);c<u&&c<_&&c<h&&c<f&&c<d?(o=-.5,a[0]=-1,a[1]=0,a[2]=0):u<_&&u<h&&u<f&&u<d?(o=.5,a[0]=1,a[1]=0,a[2]=0):_<h&&_<f&&_<d?(s=-.5,a[0]=0,a[1]=-1,a[2]=0):h<f&&h<d?(s=.5,a[0]=0,a[1]=1,a[2]=0):f<d?(l=-.5,a[0]=0,a[1]=0,a[2]=-1):(l=.5,a[0]=0,a[1]=0,a[2]=1),o<-.5?o=-.5:o>.5&&(o=.5),s<-.5?s=-.5:s>.5&&(s=.5),l<-.5?l=-.5:l>.5&&(l=.5),r[0]=o,r[1]=s,r[2]=l,this.xform&&(vec3.transformMat3(r,r,this.xform),vec3.transformMat3(a,a,this.normalXform),vec3.normalize(a,a)),this.translate&&(r[0]+=this.translate[0],r[1]+=this.translate[1],r[2]+=this.translate[2])}}(),function(){"use strict";var e=vec3.create(),t=Human.particles.shapes.Cylinder=function(e){this.translate=null,this.rotate=null,this.scale=null,this.xform=null,this.inverseXform=null,this.normalXform=null,e.translate&&(this.translate=new Float32Array(e.translate)),(e.scale||e.rotate)&&(this.xform=mat3.create(),this.inverseXform=mat3.create(),this.normalXform=mat3.create(),e.rotate&&(this.rotate=new Float32Array(e.rotate)),e.scale&&(this.scale=new Float32Array(e.scale)),this.updateXform())};t.prototype.updateXform=function(){this.xform&&(Human.math.buildRotationScaleMat3(this.xform,this.rotate,this.scale),mat3.invert(this.inverseXform,this.xform),mat3.transpose(this.normalXform,this.inverseXform))},t.prototype.in=function(t,r){var a=3*r;e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],this.translate&&(e[0]-=this.translate[0],e[1]-=this.translate[1],e[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(e,e,this.inverseXform);var i=e[0],n=e[1],o=e[2];return i*i+o*o<=1&&n>=-1&&n<=1},t.prototype.out=function(t,r){var a=3*r;e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],this.translate&&(e[0]-=this.translate[0],e[1]-=this.translate[1],e[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(e,e,this.inverseXform);var i=e[0],n=e[1],o=e[2];return i*i+o*o>=1||n<=-1||n>=1},t.prototype.surfaceProjection=function(e,t,r,a){var i=3*t;r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],this.translate&&(r[0]-=this.translate[0],r[1]-=this.translate[1],r[2]-=this.translate[2]),this.inverseXform&&vec3.transformMat3(r,r,this.inverseXform);var n,o,s=r[0],l=r[1],c=r[2];l<-1?(a[0]=0,a[1]=-1,a[2]=0):l>1?(a[0]=0,a[1]=1,a[2]=0):(o=s*s+c*c,n=Math.sqrt(o),a[0]=s/n,a[1]=0,a[2]=c/n),l<-1&&(l=-1),l>1&&(l=1),(o=o||s*s+c*c)>1&&(s/=n=n||Math.sqrt(n),c/=n),r[0]=s,r[1]=l,r[2]=c,this.xform&&(vec3.transformMat3(r,r,this.xform),vec3.transformMat3(a,a,this.normalXform),vec3.normalize(a,a)),this.translate&&(r[0]+=this.translate[0],r[1]+=this.translate[1],r[2]+=this.translate[2])}}(),Human.media=Human.media||{},Human.media.Clips=function(e){"use strict";this._streamType=e,this.clips={},this.clipsList=[],this.libraries={},this.suggestedClips=[],Human.events.fire(this._streamType+".clips",this.clipsList,!0),this.getClipById=function(e){var t=null;return this.clipsList.forEach((function(r){r.clipId===e&&(t=r)})),t},this.createLibrary=function(e,t){if(this.libraries[e])Human.log.warn("Human.media."+this._streamType+".createLibrary","Library already loaded: "+e);else{for(var r,a,i=e.split("/"),n=i[0],o=i[1],s=this.libraries[e]={libraryId:e,clips:{}},l=0,c=t.length;l<c;l++)if((r=t[l]).clipId)if(r.type)if(r.src){null==r.time1&&(r.time1=null),null==r.time2&&(r.time2=null),this.clips[r.clipId]&&Human.log.error("Human.media."+this._streamType+".createLibrary","Clip 'clipId' clashes with another clip: '"+r.clipId+"' - replacing existing clip");var u=[n,this._streamType,o,r.src].join("/");s.clips[r.clipId]=a={clipId:r.clipId,modelId:n,streamType:this._streamType,subasset:o,displayName:r.displayName,description:r.description||"",time1:r.time1,time2:r.time2,type:r.type||"",src:r.src,fullUrl:u,alternatives:r.alternatives||[],length:r.length||0,suggested:!1,status:"closed"},this.clips[r.clipId]=a}else Human.log.error("Human.media."+this._streamType+".createLibrary","Clip property missing: src");else Human.log.error("Human.media."+this._streamType+".createLibrary","Clip property missing: type");else Human.log.error("Human.media."+this._streamType+".createLibrary","Clip property missing: clipId");this._rebuildClipList()}},this._rebuildClipList=function(){for(var e in this.clipsList=[],this.clips)this.clips.hasOwnProperty(e)&&this._insertClipIntoList(this.clipsList,this.clips[e]);Human.events.fire(this._streamType+".clips",this.clipsList,!0)},this._insertClipIntoList=function(e,t){if(0===e.length)e.push(t);else{for(var r=e.length-1;r>=0;r--)if(e[r].time1<t.time1)return void e.splice(r+1,0,t);e.splice(0,0,t)}},this.destroyLibrary=function(e){var t=this.libraries[e];if(t){for(var r in t.clips)t.clips.hasOwnProperty(r)&&(delete this.clips[r],Human.events.fire(this._streamType+".status",{clipId:r,status:"destroyed"}));delete this.libraries[e],this._rebuildClipList()}else Human.log.warn("Human.media."+this._streamType+".destroyLibrary","Library not found: "+e)},this.open=function(e,t){Human.events.fire(this._streamType+".status",{clipId:e,status:"open"},!0),t()},this.play=function(e){Human.events.fire(this._streamType+".status",{clipId:e,status:"playing"},!0)},this.scrub=function(e,t){Human.events.fire(this._streamType+".scrubbed",{clipId:e,time:t})},this.pause=function(e){Human.events.fire(this._streamType+".status",{clipId:e,status:"paused"},!0)},this.stop=function(e){Human.events.fire(this._streamType+".status",{clipId:e,status:"stopped"},!0)},this.close=function(e){Human.events.fire(this._streamType+".status",{clipId:e,status:"closed"},!0)},this.reset=function(){for(var e in this.libraries)this.libraries.hasOwnProperty(e)&&this.destroyLibrary(e)}},Human.media.audio=new Human.media.Clips("audio"),Human.media.videos=new Human.media.Clips("videos"),function(){"use strict";var e=Human.assets={loadedAssets:{},nullAssets:{},assetUseCounts:{},libUseCounts:{},requestedAssets:0},t={geometry:"geometries",audio:"audio",videos:"video"},r={},a={},i={},n=0,o=0;function s(t){void 0!==e.libUseCounts[t]?e.libUseCounts[t]++:e.libUseCounts[t]=1}function l(t){void 0!==e.assetUseCounts[t]?e.assetUseCounts[t]++:e.assetUseCounts[t]=1}function c(e){return t[e]||e+"s"}function u(t,r,a,s){if(function(t,r){n++;var a=Math.floor(n/e.requestedAssets*100);o!==a&&(o=a,Human.events.fire("assets.load.progress",{assetId:t,assetType:r,requestedAssets:e.requestedAssets,receivedAssets:n})),n===e.requestedAssets&&(Human.events.fire("assets.load.finish"),e.requestedAssets=0,n=0,Human.stats.loadSequence.assetsLoaded=Human.timer.now(),Human.stats.loadTimes.assetDownload=Human.stats.loadSequence.assetsLoaded-Human.stats.loadSequence.assetsRequested,Human.renderer.resetFrameThrottling())}(r,t),a&&a!==e.server.TIMEOUT)try{if(s){var u="morph"===t||"geometry"===t,_=new XMLHttpRequest;_.open("PUT","/assets/"+r,!0),_.send(u?a:JSON.stringify(a))}if("transform"===t){for(f=0,d=(h=i[r]).length;f<d;f++)h[f](a);window.localContentOnly||(delete e.loadedAssets[r],delete i[r])}else Human.assets[c(t)].parseAsset(r,a,(function(t){for(e.loadedAssets[r]=t,f=0,d=(h=i[r]).length;f<d;f++)l(r),h[f](t);delete i[r]}))}catch(p){Human.log.error("Error parsing asset: "+r+" - "+p.message),e.loadedAssets[r]=null,e.nullAssets[r]=!0;for(var h,f=0,d=(h=i[r]).length;f<d;f++)h[f](null);delete i[r]}else{for(a||(e.nullAssets[r]=!0),e.loadedAssets[r]=null,f=0,d=(h=i[r]).length;f<d;f++)h[f](null);delete i[r]}}e.init=function(){this.server.init(),this.geometries.init(),this.materials.init(),this.morphs.init(),this.reflections.init()},e.getAsset=function(t,r,a){if(e.nullAssets[t])a&&a(null);else if("LOADING"!==e.loadedAssets[t]){if(e.loadedAssets[t])return Human.events.fire("native.debugMessage","asset already loaded "+t),void function(t,r,a,n){l(t),"transform"===r&&!0===Human.unpackAssets.transformJson?(i[t]=[],n&&i[t].push(n),u(r,t,a.asset,!1)):"geometry"===r&&!0===Human.unpackAssets.geometryJson&&a instanceof ArrayBuffer?(i[t]=[],n&&i[t].push(n),u(r,t,a,!1)):n&&n(e.loadedAssets[t])}(t,r,e.loadedAssets[t],a);if(0===e.requestedAssets&&e.assetLoadStart(),e.requestedAssets++,e.loadedAssets[t]="LOADING",i[t]=[],a&&i[t].push(a),window.localContentOnly||Human.mobile.iOS||Human.mobile.android){var n="morph"===r||"geometry"===r,o=t;window.localContentOnly&&(t=t.replace(/\|/g,"/").replace(/:/g,";"),"transform"!==r&&(t+=".bda"));var s=new XMLHttpRequest;s.responseType=n?"arraybuffer":"text",s.open("GET",window.localBaseDirectory+"assets/"+t,!0),void 0===window.sdkOffline&&(window.sdkOffline=!1),s.onerror=function(){window.localContentOnly||window.sdkOffline?(u(r,o,null,!1),Human.events.fire("native.debugMessage","fail gracefully on missing asset")):e.server.getAsset(r,o,(function(e){u(r,o,e,!0)}))},s.onload=function(){if(200===s.status||window.localContentOnly){var a=s.response,i=n?a:JSON.parse(a);window.localContentOnly&&!n&&(i=i.asset),u(r,o,i,!1)}else window.sdkOffline?(u(r,o,null,!1),Human.events.fire("native.debugMessage","fail gracefully on missing asset")):e.server.getAsset(r,t,(function(e){u(r,t,e,!0)}))},s.send(null)}else e.server.getAsset(r,t,(function(e){u(r,t,e,!1)}))}else a&&i[t].push(a)},e.getAssetLibrary=function(t,i,n,o,l,u){if(!a[n])return e.libUseCounts[n]?(s(n),void u()):void e.server.getAssetLibrary(i,n,o,(function(i){var o;if(!i)return a[n]=!0,void(u&&u());if(e.libUseCounts[n])return s(n),void(u&&u());if("animation"===t){if("binary"===i.format)return void(u&&u());o=Human.assets.tweens}else o=Human.assets[c(t)];o?o.parseLibrary(n,i,l,(function(){s(n),r[n]=o,u&&u()})):(Human.log.error("Unknown asset library type: "+t),u&&u())}));u()},e.putAssetLibrary=function(t){if(void 0!==e.libUseCounts[t]&&--e.libUseCounts[t]<=0){delete e.libUseCounts[t];var a=r[t];a&&a.unloadLibrary&&a.unloadLibrary(t),delete r[t]}},e.putAsset=function(t){void 0!==this.assetUseCounts[t]&&--this.assetUseCounts[t]<=0&&(Human.assets[c(e.loadedAssets[t].type)].destroyAsset(t),delete e.loadedAssets[t],delete this.assetUseCounts[t])},e.assetLoadStart=function(){Human.events.fire("assets.load.start"),Human.stats.loadSequence.assetsRequested=Human.timer.now(),Human.stats.loadTimes.preAsset=Human.stats.loadSequence.assetsRequested-Human.stats.loadSequence.startTime,o=0}}(),function(){"use strict";var e,t,r,a,i=Human.assets.server={TIMEOUT:1},n="true"===Human.request.getSearchParam("__bdh_engine_draco"),o=[],s={},l=[],c={geometry:"geometry"},u={},_={},h=!1;function f(){var t=new WebSocket(a);return t.binaryType="arraybuffer",t.addEventListener("open",(function(){t.send(JSON.stringify({open:"sesame!"}));for(var e=0,r=o.length;e<r;e++)o[e]();o.length=0})),t.addEventListener("close",(function(e){Human.log.log("Socket closed",e.code,e.reason)})),t.addEventListener("error",(function(){Human.log.error("Socket error")})),t.addEventListener("message",(function(t){var r,a,i=t.data;if(e=Date.now(),"string"==typeof i){if(""===i)return;var n=JSON.parse(i);d(a=n.id,i),n.error?(Human.log.error("Asset not found: "+a),r=null):n.asset?r=n.asset:(Human.log.error("Null asset: "+a),r=null)}else{r=i;var o,l,c=new DataView(r);17===c.getUint32(0,!0)?(l=new Uint32Array(r,0,2)[1],o=11*Uint32Array.BYTES_PER_ELEMENT):(l=c.getUint32(4,!0),o=c.getUint32(12,!0)),function(e,t){if(Human.stats.trackingDownloadSize){var r=Human.utils.binaryGzipSize(t);Human.stats.geometryDownloadSizes[e]=r,Human.stats.geometryDownloadTotal+=r}}(a=Human.utils.atos(r,o,l).trim(),i)}var u=s[a];if(u){for(var _=0,h=u.length;_<h;_++)u[_](r);delete s[a]}})),t}function d(e,t){if(Human.stats.trackingDownloadSize){var r=Human.utils.textGzipSize(t);Human.stats.jsonDownloadSizes[e]=r,Human.stats.jsonDownloadTotal+=r}}Human.properties.subscribe({propId:"assetDomain",value:"assets-human.biodigital.com",callback:function(e){t=e}}),i.init=function(){if(!h&&""!==t){var c="https:"===window.location.protocol?"wss:":"ws:";(Human.mobile.android||Human.mobile.iOS)&&(c="wss:"),a=c+"//"+t+"/assets/ws"+(n?4:3),r=f(),setInterval((function(){if(0!==l.length&&(e=Date.now(),r.readyState===WebSocket.OPEN?(r.send(JSON.stringify({assets:l})),l.length=0):(o.push((function(){r.send(JSON.stringify({assets:l})),l.length=0})),(r.readyState===WebSocket.CLOSING||r.readyState===WebSocket.CLOSED)&&(r=f()))),Date.now()-e>12e4)for(var t in s)if(s.hasOwnProperty(t)){Human.log.error("Server timeout on asset: "+t);for(var a=s[t],n=0,c=a.length;n<c;n++)a[n](i.TIMEOUT);delete s[t]}}),100),h=!0}},i.cacheModuleDefinition=function(e,t){u[e]||(t?u[e]=JSON.stringify(t):i.getModuleDefinition(e))},i.getModuleDefinition=function(e,t,r){u[e]?t&&t(JSON.parse(u[e])):(Human.stats.loadSequence.moduleRequest=Human.timer.now(),Human.stats.loadTimes.preModule=Human.stats.loadSequence.moduleRequest-Human.stats.loadSequence.startTime,Human.utils.getText(window.localBaseDirectory+"content/modules/"+e,(function(r){d(e,r),u[e]=r,Human.stats.loadSequence.moduleLoaded=Human.timer.now(),Human.stats.loadTimes.moduleDownload=Human.stats.loadSequence.moduleLoaded-Human.stats.loadSequence.moduleRequest,t&&t(JSON.parse(r))}),(function(t,a,i){Human.events.fire("net.error",{id:e,type:"modules",status:t.status,statusText:t.statusText}),r&&r(i)})))},i.cacheStateIndex=function(e,t){_[e]||(t?_[e]=JSON.stringify(t):Human.utils.getText(window.localBaseDirectory+"content/states/"+e+"/index?v="+Human.VERSION+"&locale="+Human.locale,(function(t){d(e+"/index",t),_[e]=t})))},i.getStateIndex=function(e,t,r){_[e]?t&&t(JSON.parse(_[e])):Human.utils.getText(window.localBaseDirectory+"content/states/"+e+"/index?v="+Human.VERSION+"&locale="+Human.locale,(function(r){d(e+"/index",r),t(JSON.parse(r))}),r)},i.getAnimationManifest=function(e,t,r){var a=e.split("/");Human.utils.getText(window.localBaseDirectory+"content/states/"+a[0]+"/animations/"+a[1]+"/manifest",(function(r){d(e,r),t(JSON.parse(r))}),r)},i.getAsset=function(e,t,r){var a=t.split("/"),i=a[2],n=a[0]+"/"+(c[e]||e+"s")+"/"+a[1];i&&(n+="/"+i),s[n]?s[n].push(r):(s[n]=[r],l.push(n))},i.getAssetLibrary=function(e,t,r,a){var i=t.split("/"),n=(void 0!==window.localBaseDirectory?window.localBaseDirectory:"/")+"content/states/"+i[0]+"/"+e+"/"+i[1]+"/"+r;void 0!==window.requiresFileExtensions&&(n+=".json"),Human.utils.getJSON(n,a,(function(){Human.log.error("Asset library not found: "+t),a(null)}))}}(),function(){"use strict";var e=Human.assets.textures={},t=SceneJS.checkExtension("WEBGL_compressed_texture_s3tc"),r=SceneJS.checkExtension("WEBGL_compressed_texture_pvrtc"),a=SceneJS.checkExtension("WEBGL_compressed_texture_etc1"),i={add:"over",hack_add:"add"};function n(e,t){return function(r){if(Human.stats.trackingDownloadSize){var a=Human.utils.binaryGzipSize(r);Human.stats.textureDownloadSizes[e.compressedSrc]=a,Human.stats.textureDownloadTotal+=a}e.type="texture",e.compressedImage=r,e.src=null,t()}}function o(e,t){return function(){e.compressedSrc=null,e.swizzledNormals=null,s(e,t)}}function s(e,t){if(Human.stats.trackingDownloadSize){var r=e.src;Human.utils.getBinary(r,(function(e){Human.stats.textureDownloadSizes[r]=e.byteLength,Human.stats.textureDownloadTotal+=e.byteLength}))}var a=new Image;a.onload=function(e,t,r){return function(){t.type="texture",t.image=e,r()}}(a,e,t),a.onerror=t,a.src=e.src,e.src=null}function l(e){var i=e.src.replace(/(\.jpg|\.jpeg|\.png)$/,"");if(!t)return r?(e.compressedSrc=i+"-pvrtc.pvr",void(e.containerFormat="pvr")):a?(e.compressedSrc=i+"-etc1.pvr",void(e.containerFormat="pvr")):void 0;"normals"===e.applyTo&&!0===e.swizzledNormals?(e.compressedSrc=i+"-sw-dxt5.dds",e.containerFormat="dds"):(e.compressedSrc=i+"-dxt1.dds",e.containerFormat="dds")}function c(e){return e.image||e.compressedImage}e.load=function(e,t){var r=(e=e||[]).length;if(0!==r)for(var a=0;a<r;++a){var u=e[a];e[a]=u={src:u.src||u.uri,applyTo:u.applyTo,blendMode:i[u.blendMode]||u.blendMode,blendFactor:u.blendFactor,preloadColor:u.preloadColor,preloadSrc:u.preloadSrc,swizzledNormals:u.swizzledNormals||!1},l(u),u.compressedSrc?Human.utils.getBinary(u.compressedSrc,n(u,_),o(u,_)):s(u,_)}else t();function _(){0==--r&&(Human.utils.filterInPlace(e,c),t())}}}(),function(){"use strict";var e=Human.unpackAssets={blocksWaiting:0,loading:!1,transformJson:!1,geometryJson:!1},t={},r={};function a(){0===Human.assets.requestedAssets&&Human.assets.assetLoadStart(),Human.assets.requestedAssets++}Human.events.on("scene.setBaseDirectory",(function(e){window.localBaseDirectory=e})),Human.events.on("native.setSdkOffline",(function(e){window.sdkOffline=!0===e,Human.events.fire("native.debugMessage","got set sdkOffline "+window.sdkOffline)})),Human.events.on("modules.fetch.start",(function(i){void 0===window.localBaseDirectory||"/"===window.localBaseDirectory?(window.localBaseDirectory="/",window.localContentOnly=!1):(window.localContentOnly=!0,e.transformJson=!1,e.geometryJson=!1,e.loading=!0,t={},r={},e.blocksWaiting=0,function(t){var r=new XMLHttpRequest;r.responseType="text";var i=window.localBaseDirectory+"transforms/modules/"+t+".json";r.open("GET",i,!0),r.onerror=function(){console.log("error getting "+i)},r.onload=function(){if(200===r.status||window.localContentOnly){e.transformJson=!0;var t=JSON.parse(r.response);Object.keys(t).forEach((function(e){Human.assets.loadedAssets[e]=t[e],a()}))}},r.send(null)}(i),function(i){var n=new XMLHttpRequest;n.responseType="text";var o=window.localBaseDirectory+"blocks/geometry/modules/"+i+"/index.json";n.open("GET",o,!0),n.onerror=function(){console.log("error getting "+o),e.loading=!1},n.onload=function(){if(200===n.status||window.localContentOnly){e.geometryJson=!0;var o=JSON.parse(n.response);Object.keys(o).forEach((function(n){var s=o[n],l=s.block;void 0===t[l]&&(t[l]="Loading",function(i,n){e.blocksWaiting++,e.loading=!1;var o=new XMLHttpRequest;o.responseType="arraybuffer";var s=window.localBaseDirectory+"blocks/geometry/modules/"+i+"/"+n;o.open("GET",s,!0),o.onerror=function(){console.log("error getting "+s)},o.onload=function(){(200===o.status||window.localContentOnly)&&(t[n]=o.response,e.blocksWaiting--,r[n].forEach((function(e){Human.assets.loadedAssets[e.assetId]=function(e){var r=t[e.block],a=e.offlen,i=new ArrayBuffer(a[1]),n=new Uint8Array(i,0,a[1]),o=new Uint8Array(r,a[0],a[1]);return n.set(o),i}(e.geometry),a()})))},o.send(null)}(i,l),r[l]=[]),r[l].push({assetId:n,geometry:s})}))}else e.loading=!1},n.send(null)}(i))}))}(),function(){"use strict";var e=Human.assets.geometries={};e.geometries={};var t,r={1:Uint8Array,2:Uint16Array,4:Uint32Array},a="true"===Human.request.getSearchParam("__bdh_engine_draco"),i={},n=new Array(2),o=0;function s(t){var r=t.data[1];1===t.data[0]?i[r](e.createGeometry(r,t.data[2])):Human.log.error("Human.assets.geometries",t.data[2]+" : "+r),delete i[r]}e.init=function(){a&&function(){for(var e=0;e<2;e++){var t=Human.workers.loadWorker("draco/worker.js");t.onmessage=s,n[e]=t}}(),t=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Geometry library"})},e.parseAsset=function(t,a,s){var l=new Uint32Array(a,0,1)[0],c={geometry:{primitive:"triangles"},draco:19===l,compressed:17!==l};c.draco?function(e,t,r,a){var s=new DataView(e),l=s.getUint32(12,!0),c=s.getUint32(4,!0),u=s.getUint32(8,!0),_=s.getUint8(22,!0),d=16*_,p=l+c+u,m=p+24,g=m+_*d,y=s.getUint32(16,!0),v=new Int8Array(e,g,y/Int8Array.BYTES_PER_ELEMENT);h(t,new Float32Array(e,p,24/Float32Array.BYTES_PER_ELEMENT)),_>0&&f(t,new Float32Array(e,m,d/Float32Array.BYTES_PER_ELEMENT),_),i[r]=a,n[o%2].postMessage([v,r,t],[v.buffer]),o++}(a,c,t,s):c.compressed?function(t,a,i,n){var o,s,l=new DataView(t),c=l.getUint32(4,!0),u=l.getUint32(8,!0),_=l.getUint32(12,!0),d=l.getUint32(16,!0),p=l.getUint32(20,!0),g=l.getUint32(24,!0),y=l.getUint32(28,!0),v=l.getUint16(32,!0),S=l.getUint8(34),b=l.getUint8(35),E=new Array(b);for(s=0,o=36;s<b;s++,o+=6)E[s]={uvSize:l.getUint32(o,!0),uvDecodeSize:l.getUint16(o+4,!0)};if(o=_+c+u,v>0&&(h(a,new Float32Array(t,o,v/Float32Array.BYTES_PER_ELEMENT)),o+=v),b>0&&(f(a,new Float32Array(t,o,4*b),b),o+=16*b),p>0&&(a.geometry.positions=new Uint16Array(t,o,p/Uint16Array.BYTES_PER_ELEMENT),a.boundary=m(a.geometry.positions,a.positionScale,a.positionTranslate),o+=p),b>0)for(a.geometry.uvs=new Array(b),s=0;s<b;s++)a.geometry.uvs[s]=new Uint16Array(t,o,E[s].uvSize/Uint16Array.BYTES_PER_ELEMENT),o+=E[s].uvSize;if(g>0&&(a.geometry.normals=new Int8Array(t,o,g/Int8Array.BYTES_PER_ELEMENT),o+=g),y>0){var I=r[S];a.geometry.indices=new I(t,d,y/I.BYTES_PER_ELEMENT)}n(e.createGeometry(i,a))}(a,c,t,s):function(t,r,a,i){var n=new Uint32Array(t,0,11),o=n[3],s=n[4],l=n[5],c=n[6],u=11*Uint32Array.BYTES_PER_ELEMENT+n[1]+n[2],_=u+o,h=_+s,f=h+l,d=0;o>0&&(r.geometry.positions=new Float32Array(t,u,o/Float32Array.BYTES_PER_ELEMENT),r.boundary=m(r.geometry.positions),d=r.geometry.positions.length/3),s>0&&(r.geometry.normals=new Float32Array(t,_,s/Float32Array.BYTES_PER_ELEMENT)),c>0&&(r.geometry.uv=new Float32Array(t,f,c/Float32Array.BYTES_PER_ELEMENT)),l>0&&(r.geometry.indices=new Uint32Array(t,h,l/Uint32Array.BYTES_PER_ELEMENT),d<=256?r.geometry.indices=new Uint8Array(r.geometry.indices):d<=65536&&(r.geometry.indices=new Uint16Array(r.geometry.indices))),i(e.createGeometry(a,r))}(a,c,t,s)},e.createGeometry=function(r,a){if(e.geometries[r]){if(!window.localContentOnly)return void Human.log.error("Human.assets.geometries.createGeometry","Geometry already loaded: "+r);e.geometries[r]=null}if(a.geometry){a.geometry.type="geometry";var i={geometry:t.addNode(a.geometry),type:"geometry",compressed:a.compressed},n=a.boundary;if(!n){var o=null,s=null;if(a.geometry.positionDecodeMat){var l=a.geometry.positionDecodeMat;o=new Float32Array([l[0],l[5],l[10]]),s=new Float32Array([l[12],l[13],l[14]])}n=m(a.geometry.positions,o,s)}return i.boundary=n,i.center=[.5*(n.xmax+n.xmin),.5*(n.ymax+n.ymin),.5*(n.zmax+n.zmin)],i.axisBoundary=new Float32Array([n.xmin,n.ymin,n.zmin,n.xmax,n.ymax,n.zmax]),e.geometries[r]=i,i}Human.log.error("Human.assets.geometries.createGeometry","Mandatory attribute 'geometryId' expected on geometry: "+r)},e.getCompressionStats=function(){var t={compressed:0,uncompressed:0};for(var r in e.geometries)e.geometries.hasOwnProperty(r)&&(e.geometries[r].compressed?t.compressed++:t.uncompressed++);return t},e.destroyAsset=function(t){t?(e.geometries[t].geometry.destroy(),delete e.geometries[t]):e.reset()},e.reset=function(){for(var t in e.geometries)e.geometries.hasOwnProperty(t)&&e.destroyAsset(t)};var l=mat4.create(),c=mat4.create(),u=mat3.create(),_=mat3.create();function h(e,t){var r=t.subarray(0,3),a=t.subarray(3,6),i=mat4.create();return mat4.fromScaling(l,a),mat4.fromTranslation(c,r),mat4.multiply(i,c,l),e.positionTranslate=r,e.positionScale=a,e.geometry.positionDecodeMat=i,e}function f(e,t,r){e.geometry.uvDecodeMats=new Array(r),e.uvTranslates=new Array(r),e.uvScales=new Array(r);for(var a=0;a<r;a++){var i=4*a,n=e.uvTranslates[a]=t.subarray(i,i+2),o=e.uvScales[a]=t.subarray(i+2,i+4);mat3.fromScaling(u,o),mat3.fromTranslation(_,n),e.geometry.uvDecodeMats[a]=mat3.create(),mat3.multiply(e.geometry.uvDecodeMats[a],_,u)}return e}var d=vec3.fromValues(0,0,0),p=vec3.fromValues(1,1,1);function m(e,t,r){t=t||p,r=r||d;for(var a,i,n,o=1e5,s=1e5,l=1e5,c=-1e5,u=-1e5,_=-1e5,h=0,f=e.length-2;h<f;h+=3)(a=e[h]*t[0]+r[0])<o&&(o=a),(i=e[h+1]*t[1]+r[1])<s&&(s=i),(n=e[h+2]*t[2]+r[2])<l&&(l=n),a>c&&(c=a),i>u&&(u=i),n>_&&(_=n);return{xmin:o,ymin:s,zmin:l,xmax:c,ymax:u,zmax:_}}}(),function(){"use strict";var e,t=Human.assets.materials={};t.materials={},t.init=function(){e=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Materials library"})},t.parseAsset=function(e,r,a){var i=e.split("/"),n=i[0],o=i[1].split(".")[0],s=void 0!==window.localBaseDirectory?window.localBaseDirectory:"/";t.createMaterial(e,function e(t,r,a,i){var n,o;switch(i=i||{},r.id&&(r.id=null),r.type){case"texture":var s;for(n=0,o=r.layers.length;n<o;n++)(s=r.layers[n]).src=s.uri||s.src,s.src=a+s.src,s.preloadURI=s.preloadURI||s.preloadSrc,s.preloadURI&&(s.preloadURI=a+s.preloadURI+"?v="+Human.VERSION),s.blendMode=s.blendMode||"over","add"===s.blendMode?s.blendMode="over":"forceAdd"===s.blendMode&&(s.blendMode="add");i&&(i.texture=r);break;case"material":var l,c,u,_;i&&(i.material=r,r.reflectionId&&(l=r.reflectionId,Human,(u=[[t,"reflections"].join("/"),l].join("."))&&(_=Human.assets.reflections.reflections[u])?i.reflection=_.node:Human.log.error("Human.assets.materials.parseManifest","Reflection not found: "+l)),r.lightmapId&&(c=r.lightmapId,Human,(u=[[t,"reflections"].join("/"),c].join("."))&&(_=Human.assets.reflections.reflections[u])?i.lightmap=_.node:Human.log.error("Human.assets.materials.parseManifest","Lightmap not found: "+l)));break;case"flags":i&&(i.flags=r)}if(r.nodes){for(n=0,o=r.nodes.length;n<o;n++)e(t,r.nodes[n],a,i);r.nodes=null}return i}(n,r,s+"content/states/"+n+"/materials/"+o+"/"),a)},t.findMaterial=function(e){return t.materials[e]||null},t.createMaterial=function(r,a,i){if(t.materials[r])Human.log.warn("Human.assets.materials.createMaterial","Material already loaded: "+r);else{var n,o,s,l={type:"material",textureCompressionStats:{compressed:0,uncompressed:0},hasAlphaTexture:!1,hasAlphaFresnel:!1,partiallyOpaque:!1};a.material?(l.material=e.addNode({type:"material",workflow:a.material.workflow,baseColor:a.material.baseColor,specularColor:a.material.specularColor,emitColor:a.material.emitColor,shine:a.material.shine,alpha:a.material.alpha,emit:a.material.emit,metallic:a.material.metallic,roughness:a.material.roughness,specularf0:a.material.specularf0}),l.glassFactor=null!=a.material.glassFactor?a.material.glassFactor:1,l.murkiness=null!=a.material.murkiness?a.material.murkiness:1,a.material.baseFresnel&&(n=a.material.baseFresnel,l.fresnels=l.fresnels||{},l.fresnels.color=e.addNode({type:"fresnel",applyTo:"color",edgeBias:n.biasEdge,centerBias:n.biasCenter,power:n.power||1,edgeColor:o=void 0!==n.edge?n.edge:{r:1,g:1,b:1},centerColor:s=void 0!==n.center?n.center:{r:0,g:0,b:0},blendMode:n.blendMode||"multiply"})),a.material.alphaFresnel&&(n=a.material.alphaFresnel,l.fresnels=l.fresnels||{},l.fresnels.alpha=e.addNode({type:"fresnel",applyTo:"alpha",edgeBias:n.biasEdge,centerBias:n.biasCenter,power:n.power||1,edgeColor:{r:o=void 0!==n.edge?n.edge:0,g:o,b:o},centerColor:{r:s=void 0!==n.center?n.center:1,g:s,b:s},blendMode:n.blendMode||"multiply"}),l.hasAlphaFresnel=!0),a.material.transparencyFresnel&&(n=a.material.transparencyFresnel,l.fresnels=l.fresnels||{},l.fresnels.transparency=e.addNode({type:"fresnel",applyTo:"transparency",edgeBias:n.biasEdge,centerBias:n.biasCenter,power:n.power||1,edgeColor:{r:o=void 0!==n.edge?n.edge:0,g:o,b:o},centerColor:{r:s=void 0!==n.center?n.center:1,g:s,b:s},blendMode:n.blendMode||"multiply"}),l.hasAlphaFresnel=!0),a.material.reflectionFresnel&&(n=a.material.reflectionFresnel,l.fresnels=l.fresnels||{},l.fresnels.reflect=e.addNode({type:"fresnel",applyTo:"reflect",centerBias:n.biasCenter,edgeBias:n.biasEdge,power:n.power||1,edgeColor:{r:o=void 0!==n.edge?n.edge:1,g:o,b:o},centerColor:{r:s=void 0!==n.center?n.center:0,g:s,b:s},blendMode:n.blendMode||"multiply"})),a.material.specularFresnel&&(n=a.material.specularFresnel,l.fresnels=l.fresnels||{},l.fresnels.specular=e.addNode({type:"fresnel",applyTo:"specular",centerBias:n.biasCenter,edgeBias:n.biasEdge,power:n.power||1,edgeColor:o=void 0!==n.edge?n.edge:{r:0,g:0,b:0},centerColor:s=void 0!==n.center?n.center:{r:1,g:1,b:1},blendMode:n.blendMode||"multiply"})),a.material.emitFresnel&&(n=a.material.emitFresnel,l.fresnels=l.fresnels||{},l.fresnels.emit=e.addNode({type:"fresnel",applyTo:"emit",centerBias:n.biasCenter,edgeBias:n.biasEdge,power:n.power||1,edgeColor:o=void 0!==n.edge?n.edge:{r:0,g:0,b:0},centerColor:s=void 0!==n.center?n.center:{r:1,g:1,b:1},blendMode:n.blendMode||"multiply"}))):(l.glassFactor=1,l.murkiness=1),a.reflection&&(l.reflection=e.addNode({type:"cubemap",applyTo:"reflect",coreId:a.reflection.getCoreId()})),a.lightmap&&(l.lightmap=e.addNode({type:"cubemap",applyTo:"light",coreId:a.lightmap.getCoreId()})),a.flags&&(l.flags={skybox:a.flags.flags.skybox,billboard:a.flags.flags.billboard,frontface:a.flags.flags.frontface,backfaces:a.flags.flags.backfaces,addBlend:a.flags.flags.addBlend},l.partiallyOpaque=!!l.flags.partiallyOpaque);var c=a.texture?a.texture.layers:[];Human.assets.textures.load(c,(function(){l.textures=new Array(c.length);for(var a=0,n=c.length;a<n;++a)c[a].compressedSrc?l.textureCompressionStats.compressed++:l.textureCompressionStats.uncompressed++,"alpha"!==c[a].applyTo&&"transparency"!==c[a].applyTo||(l.hasAlphaTexture=!0),l.textures[a]=e.addNode(c[a]);t.materials[r]=l,i(l)}))}},t.getTextureCompressionStats=function(){var e={compressed:0,uncompressed:0};for(var r in t.materials)t.materials.hasOwnProperty(r)&&(e.compressed+=t.materials[r].textureCompressionStats.compressed,e.uncompressed+=t.materials[r].textureCompressionStats.uncompressed);return e},t.destroyAsset=function(e){if(e){var r=t.materials[e];for(var a in r)r.hasOwnProperty(a)&&"function"==typeof r[a].destroy&&r[a].destroy();delete t.materials[e]}else t.reset()},t.reset=function(){for(var e in t.materials)t.materials.hasOwnProperty(e)&&t.destroyAsset(e)}}(),function(){"use strict";var e,t=Human.assets.morphs={};t.morphs={},t.init=function(){e=Human.renderer.getLibraryRoot().addNode({type:"library",data:"Morphs library"})},t.parseAsset=function(e,t,i){var n;n=17===new Uint32Array(t,0,1)[0]?function(e){for(var t,r={morphGeometry:{}},a=new Uint32Array(e,0,11),i=a[2],n=a[3],o=a[4],s=a[6],l=11*Uint32Array.BYTES_PER_ELEMENT+a[1],c=l+i,u=c+n,_=u+o+a[5],h=(r.morphGeometry.keys=Human.utils.atoj(e,l,i)).length,f=r.morphGeometry.targets=[],d=n/h,p=d/Float32Array.BYTES_PER_ELEMENT,m=o/h,g=m/Float32Array.BYTES_PER_ELEMENT,y=s/h,v=s/Float32Array.BYTES_PER_ELEMENT,S=0;S<h;S++)t={},n>0&&(t.positions=new Float32Array(e,c+S*d,p)),o>0&&(t.normals=new Float32Array(e,u+S*m,g)),s>0&&(t.uvs=new Float32Array(e,_+S*y,v)),f.push(t);return r}(t):function(e){var t,i,n={},o=new DataView(e),s=o.getUint32(4,!0),l=o.getUint32(8,!0),c=o.getUint32(12,!0),u=o.getUint32(20,!0),_=o.getUint32(24,!0),h=o.getUint16(32,!0),f=o.getUint8(34),d=new Array(f);for(i=0,t=36;i<f;i++,t+=5)d[i]={uvSize:o.getUint32(t,!0),uvDecodeSize:o.getUint8(t+4)};t=c+s,n.morphGeometry=Human.utils.atoj(e,t,l);var p,m=n.morphGeometry.keys.length,g=n.morphGeometry.targets=new Array(m);for(i=0;i<m;i++)g[i]={};n.positionTranslates=new Array(m),n.positionScales=new Array(m);var y=h/m,v=u/m,S=v/Uint16Array.BYTES_PER_ELEMENT,b=_/m,E=b/Int8Array.BYTES_PER_ELEMENT;if(t+=l,h>0)for(i=0;i<m;i++){p=g[i];var I=n.positionTranslates[i]=new Float32Array(e,t,3),x=n.positionScales[i]=new Float32Array(e,t+12,3);mat4.fromScaling(r,x),mat4.fromTranslation(a,I),p.positionDecodeMat=mat4.create(),mat4.multiply(p.positionDecodeMat,a,r),t+=y}if(u>0){for(i=0;i<m;i++)g[i].positions=new Uint16Array(e,t+i*v,S);t+=u}if(_>0)for(i=0;i<m;i++)g[i].normals=new Int8Array(e,t+i*b,E);return n}(t),i(Human.assets.morphs.createMorph(e,n))},t.findMorph=function(e){return t.morphs[e]||null},t.createMorph=function(r,a){var i=t.morphs[r];if(i)return Human.log.warn("Human.assets.morphs.createMorph","Morph already loaded: "+r),i;a.morphGeometry.type="morphGeometry";for(var n=e.addNode(a.morphGeometry),o=n.getTargets(),s={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,zmin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,zmax:Number.NEGATIVE_INFINITY},l=vec3.create(),c=Human.math.decompressPosition,u=0,_=o.length;u<_;++u)for(var h=o[u],f=h.positions,d=h.positionDecodeMat,p=0,m=f.length;p<m;p+=3)l[0]=f[p],l[1]=f[p+1],l[2]=f[p+2],d&&c(l,l,d),l[0]<s.xmin&&(s.xmin=l[0]),l[0]>s.xmax&&(s.xmax=l[0]),l[1]<s.ymin&&(s.ymin=l[1]),l[1]>s.ymax&&(s.ymax=l[1]),l[2]<s.zmin&&(s.zmin=l[2]),l[2]>s.zmax&&(s.zmax=l[2]);i={type:"morph",morphGeometry:n,boundary:s,center:[.5*(s.xmax+s.xmin),.5*(s.ymax+s.ymin),.5*(s.zmax+s.zmin)],positionTranslates:a.positionTranslates,positionScales:a.positionScales};var g=new Human.assets.morphs.Animation,y=a.morphGeometry.keys;g.addMorph(y[0],y[y.length-1],(function(e){i.morphGeometry.setFactor(e)})),g.calculateTimeFrame(),Human.timeline.addAnimation(r,g);var v=r.split("/")[0];return(Human.timeline.leafTimelines[v]||new Human.timeline.LeafTimeline(v)).addAnimation(r,g),t.morphs[r]=i,i},t.destroyAsset=function(e){if(e){var r=t.morphs[e];if(!r)return void Human.log.warn("Human.assets.morphs.destroyMorph","Morph not found: "+e);r.morphGeometry.destroy(),delete t.morphs[e]}else t.reset()},t.reset=function(){for(var e in t.morphs)t.morphs.hasOwnProperty(e)&&t.destroyAsset(e)};var r=mat4.create(),a=mat4.create()}(),function(){"use strict";Human.assets.morphs.Animation=function(e){e=e||{},this.type="morph-animation",this._loop=!1!==e.loop,this._morphList=[],this.timeline=e.timeline,this.firstTime=null,this.lastTime=null},Human.assets.morphs.Animation.prototype.addMorph=function(e,t,r){this._morphList.push({firstTime:e,lastTime:t,update:r})},Human.assets.morphs.Animation.prototype.calculateTimeFrame=function(){for(var e,t=1e6,r=-1e6,a=this._morphList,i=0,n=this._morphList.length;i<n;i++)(e=a[i]).firstTime<t&&(t=e.firstTime),e.lastTime>r&&(r=e.lastTime);this.firstTime=t,this.lastTime=r},Human.assets.morphs.Animation.prototype.update=function(e,t){for(var r,a,i=0,n=this._morphList.length;i<n;i++)r=this._morphList[i],this._loop?a=t===r.lastTime?t:r.firstTime+t%(r.lastTime-r.firstTime):(a<r.firstTime&&(a=r.firstTime),a>r.lastTime&&(a=r.lastTime)),r.update(a)},Human.assets.morphs.Animation.prototype.destroy=function(){this.destroyed=!0}}(),function(){"use strict";var e=Human.assets.lights={lightIds:{}};e.parseLibrary=function(t,r,a,i){var n=e.lightIds[t];if(n)return Human.log.warn("Human.assets.lights.parseLibrary","library already loaded"),void i();var o,s,l=r.lights;if(!l)return Human.log.error("Human.assets.lights.parseLibrary","'lights' section expected in lights library"),void i();n=e.lightIds[t]=[],Human.renderer.lights.clearEnabled();for(var c=0,u=l.length;c<u;c++)(o=l[c]).lightId?(o.lightId=s=t+"."+o.lightId,o.enabled=!0,Human.renderer.lights.addLight(o),n.push(s)):(Human.log.error("Human.assets.lights.load","'lightId' missing on light"),i());i&&i()},e.unloadLibrary=function(t){var r=e.lightIds[t];if(r){var a,i,n=Human.renderer.lights;for(a=0,i=r.length;a<i;a++)n.removeLight(r[a]);delete e.lightIds[t]}else Human.log.warn("Human.assets.lights.unloadLibrary","library not loaded")}}(),function(){"use strict";var e=Human.assets.tweens={};function t(e,t){return e&&t?t.indexOf(".")<0?e+"-"+t:t:null}e.parseLibrary=function(e,r,a,i){var n,o,s,l,c,u,_,h=r.tweens||{},f=[],d=e.split("/")[0];for(var p in Human.timeline.leafTimelines.hasOwnProperty(d)||new Human.timeline.LeafTimeline(d),h)if(h.hasOwnProperty(p)){if(!(n=h[p]).keys){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute missing: 'keys'");continue}if(!n.targets){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute missing: 'targets'");continue}if(n.keys.length<2||n.targets.length<2){Human.log.error("Human.timeline.tweenAnimationLoader","tween has insufficient keys or targets - minimum of two required");continue}if(n.keys.length!==n.targets.length){Human.log.error("Human.timeline.tweenAnimationLoader","tween has mismatching numbers of keys and targets");continue}if(n.options=Human.utils.applyIf(this.options,n.options||{}),!(o=n.type)){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute missing: 'type'");continue}if(l=(c=o.split(":"))[1],"lerp"===(s=c[0])&&(s="tween"),!s||!l){Human.log.error("Human.timeline.tweenAnimationLoader","Tween attribute invalid: 'type'");continue}switch(l){case"objectAttr":u=new Human.timeline.ObjectControl({modelId:d,objectId:t(d,n.objectId||n.targetId),objectIds:n.objectIds,id:p});break;case"objectXForm":u=new Human.timeline.ObjectTransformControl({modelId:d,objectId:t(d,n.objectId||n.targetId),initial:n.targets[0]});break;case"material":u=new Human.timeline.MaterialControl({modelId:d,materialId:t(d,n.materialId||n.targetId),attributes:n.targets[0]});break;case"texture":u=new Human.timeline.TextureControl({modelId:d,materialId:t(d,n.materialId||n.targetId),targetLayer:n.targetLayer});break;case"fresnel":u=new Human.timeline.FresnelControl({modelId:d,materialId:t(d,n.materialId),fresnelType:n.fresnelType});break;case"particleSystem":u=new Human.timeline.ParticleSystemControl({particleSystemId:n.particleSystemId});break;case"particleComponent":u=new Human.timeline.ParticleComponentControl({particleSystemId:n.particleSystemId,componentId:n.componentId});break;case"camera":u=new Human.timeline.CameraControl;break;default:Human.log.error("Human.timeline.tweenAnimationLoader","Unsupported tween type: "+o);continue}switch(s){case"tween":_=new Human.timeline.Tween({keys:n.keys,targets:n.targets,control:u});break;case"switch":_=new Human.timeline.Switch({keys:n.keys,targets:n.targets,control:u});break;default:Human.log.error("Human.timeline.tweenAnimationLoader","Unsupported tween type: "+o);continue}f.push(_)}if(f.length>0){var m=new Human.timeline.TweenAnimation({tweens:f});Human.timeline.addAnimation(e,m)}Human.timeline.leafTimelines[d].addAnimation(e,Human.timeline.animations[e]),i&&i()},e.unloadLibrary=function(e){var t=e.split("/")[0];Human.timeline.leafTimelines[t].unload("tweens")}}(),function(){"use strict";var e=Human.assets.reflections={},t={};e.reflections={},e.init=function(){Human.renderer.getLibraryRoot().addNode({type:"library",data:"Reflections library"})},e.parseLibrary=function(r,a,i,n){var o=t[r];if(o)return Human.log.warn("Human.assets.reflections.parseLibrary","library already loaded"),void n();t[r]=o=[];var s,l,c,u,_=r.split("/"),h=window.localBaseDirectory+"content/states/"+_[0]+"/reflections/"+_[1]+"/",f=Human.renderer.graph;for(var d in a)if(a.hasOwnProperty(d)){if((s=a[d]).type="reflect",s.blendMode=s.blendMode||"add",!(l=s.src)){Human.log.error("Human.assets.reflections.loader","Reflection property missing: src");continue}if(!Human.utils.isArray(l)){Human.log.error("Human.assets.reflections.loader","Reflection property should be array: src");continue}for(var p=0,m=l.length;p<m;p++)l[p]=h+l[p]+"?v="+Human.VERSION;c=r+"."+d,u={applyTo:s.applyTo||"reflect",node:f.insertNode(Human.renderer.getLibraryRoot(),s)},e.reflections[c]=u,"reflect"===u.applyTo?Human.renderer.getScene().createReflection(c,{src:s.src,intensity:s.intensity,space:s.space||"world"}):Human.renderer.getScene().createLightmap(c,{src:s.src,intensity:s.intensity,space:s.space||"world"}),o.push(c)}Human.renderer.compile(),n&&n()},e.unloadLibrary=function(r){var a=t[r];if(a){var i,n,o,s;for(i=0,n=a.length;i<n;i++)(s=e.reflections[o=a[i]]).node.destroy(),"reflect"===s.applyTo?Human.renderer.getScene().destroyReflection(o):Human.renderer.getScene().destroyLightmap(o);delete t[r]}else Human.log.warn("Human.assets.reflections.unloadLibrary","library not loaded")}}(),function(){"use strict";var e=Human.assets.audio={};e.parseLibrary=function(e,t,r,a){Human.media.audio.createLibrary(e,t),a&&a()},e.unloadLibrary=function(e){Human.media.audio.destroyLibrary(e)}}(),function(){"use strict";var e=Human.assets.video={};e.parseLibrary=function(e,t,r,a){Human.media.videos.createLibrary(e,t),a&&a()},e.unloadLibrary=function(e){Human.media.videos.destroyLibrary(e)}}(),function(){"use strict";var e=Human.bookmarks={};function t(e,t){return!e||!0===e[t]}function r(){var e=Human.modules.moduleLibs,t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}function a(){var e=[];if(Human.modules.numActiveModules>0){var t=Human.modules.activeModules;for(var r in t)t.hasOwnProperty(r)&&e.push(r)}return e}function i(e){if(null===e.pivot)return null;var t={};return 0!==e.pivot.x&&(t.pivot=t.pivot||{},t.pivot.x=e.pivot.x),0!==e.pivot.y&&(t.pivot=t.pivot||{},t.pivot.y=e.pivot.y),0!==e.pivot.z&&(t.pivot=t.pivot||{},t.pivot.z=e.pivot.z),0!==e.translate.x&&(t.translate=t.translate||{},t.translate.x=e.translate.x),0!==e.translate.y&&(t.translate=t.translate||{},t.translate.y=e.translate.y),0!==e.translate.z&&(t.translate=t.translate||{},t.translate.z=e.translate.z),1!==e.scale.x&&(t.scale=t.scale||{},t.scale.x=e.scale.x),1!==e.scale.y&&(t.scale=t.scale||{},t.scale.y=e.scale.y),1!==e.scale.z&&(t.scale=t.scale||{},t.scale.z=e.scale.z),0!==e.rotate.x&&(t.rotate=t.rotate||{},t.rotate.x=e.rotate.x),0!==e.rotate.y&&(t.rotate=t.rotate||{},t.rotate.y=e.rotate.y),0!==e.rotate.z&&(t.rotate=t.rotate||{},t.rotate.z=e.rotate.z),Object.keys(t).length>0?t:null}function n(e,t){var r=0,a=Human.timeline.rootTimelines[e];if(t.timeline)if(t.timeline.hasOwnProperty("scrub"))try{r=t.timeline.scrub.time}catch(o){r=0}else if(t.timeline.hasOwnProperty("play")){var i=t.timeline.play;try{r=Human.timeline.parsePlayInstruction(i).t}catch(o){r=0}}var n=a.mapGlobalTime(r).index;a._chapters=[a._chapters[n]],a.build()}function o(e,t,r){var a,i;if(a=function(e){var t,r,a,i,n,o={};for(t in Human.scene.objects)Human.scene.objects[t]&&!Human.scene.objects[t].anonymous&&(o[t]={shown:!1});for(t in e)if(e.hasOwnProperty(t)){a=e[t],r=l(r=Human.modules.convertBaseAnatomyObjectId(t));var s=Human.scene.objects[r];if(s&&(a.hasOwnProperty("enabled")&&(a.shown=a.enabled,delete a.enabled),a.hasOwnProperty("pickable")||(a.pickable=s.pickable),a.hasOwnProperty("backfaces")||(a.backfaces=s.backfaces),a.hasOwnProperty("opacity")||(a.opacity=s.opacity),a.glassFactor=s.glassFactor,a.murkiness=s.murkiness,o[r]=a),t.match("_ID[0-9]+$"))for(i=Human.scene.getLeaves(r),n=0;n<i.length;n++)Human.scene.objects[i[n]].anonymous&&(e[i[n]]?e[i[n]].shown=a.shown:e[i[n]]={shown:a.shown})}return o}(a=e.objects),Human.scene.setObjectProperties(a),(i=e.modes)&&(null!=i.highlight&&Human.rpc.call(null,"highlight.setEnabled",{enable:i.highlight}),Human.scene.anySelected()&&i.isolate?null!=i.isolate&&Human.rpc.call(null,"isolate.setEnabled",{enable:i.isolate}):null!=i.isolate&&Human.rpc.call(null,"isolate.setEnabled",{enable:!1}),null!=i.labels&&Human.rpc.call(null,"labels.setEnabled",{enable:i.labels}),null!=i.singlePick&&Human.rpc.call(null,"pick.single.setEnabled",{enable:i.singlePick}),null!=i.multiPick&&Human.rpc.call(null,"pick.multi.setEnabled",{enable:i.multiPick}),null!=i.xray&&Human.rpc.call(null,"xray.setEnabled",{enable:i.xray})),Human.renderer.camera.fly.flyTo(e.camera,(function(){})),Human.renderer.resumeCompilation(),Human.renderer.popPause(),t&&void 0!==t){var n=function(e){var t,r=[],a={},i=e.objects;for(t in i)if(i[t].shown||i[t].enabled){var n=Human.modules.convertBaseAnatomyObjectId(t);if(!a[n]){a[n]=!0;var o=Human.scene.objects[n];if(!o){if(a[n=Human.modules.convertBaseAnatomyObjectId(l(t))])continue;a[n]=!0,o=Human.scene.objects[n]}o&&o.isLeaf()&&r.push(o)}}return r}(e);Human.modules.load(t,n,["tweens","reflections","audio","videos","lights","skyBoxes","geometry","material","transform","morph"],(function(){!function(e){var t,r,a;for(r in e=e||{})e.hasOwnProperty(r)&&(t=Human.scene.objects[r],a=e[r].transform,t&&a&&t.setTransform(c(t,a)))}(e.objects),function(e){for(var t in Human.renderer.clip.reset(),e)if(e.hasOwnProperty(t)){var r=e[t];void 0!==r.state&&("clipping"!==r.state&&3!==r.state&&"visible"!==r.state&&4!==r.state||(r.enabled=!0),"number"==typeof r.clipId&&r.clipId--),Human.renderer.clip.setClip(e[t])}}(e.clips),function(e){e.timeline?e.timeline.scrub?Human.timeline.scrub(e.timeline.scrub):e.timeline.play&&Human.timeline.play(e.timeline.play):Human.timeline.scrub({time:0})}(e),Human.events.fire("bookmarks.restored",e),r&&r()}))}else r&&r()}function s(e,t){var r=Human.timeline.rootTimelines[t];r._chapters[0].info.displayName=e.title,r._chapters[0].info.description=e.description;var a=Human.modules.modules[t].displayName,i=Human.modules.modules[t].description,n=Human.utils.shallowClone(r._chapters[0].annotations);return r._chapters[0].annotations=e.annotations,Human.modules.modules[t].displayName=e.title,Human.modules.modules[t].description=e.description,Human.modules.modules[t].chapters[0].displayName=e.title,Human.modules.modules[t].chapters[0].description=e.description,{title:a,description:i,annotations:n}}function l(e){return e.replace(/_ID[0-9]+$/,"_ID")}function c(e,t){var r=e.pivot||{x:0,y:0,z:0},a=e.translate||{x:0,y:0,z:0},i=e.scale||{x:1,y:1,z:1},n=e.rotate||{x:0,y:0,z:0};return t.pivot=t.pivot||{},t.translate=t.translate||{},t.scale=t.scale||{},t.rotate=t.rotate||{},t.pivot.x=void 0===t.pivot.x?r.x:t.pivot.x,t.pivot.y=void 0===t.pivot.y?r.y:t.pivot.y,t.pivot.z=void 0===t.pivot.z?r.z:t.pivot.z,t.translate.x=void 0===t.translate.x?a.x:t.translate.x,t.translate.y=void 0===t.translate.y?a.y:t.translate.y,t.translate.z=void 0===t.translate.z?a.z:t.translate.z,t.scale.x=void 0===t.scale.x?i.x:t.scale.x,t.scale.y=void 0===t.scale.y?i.y:t.scale.y,t.scale.z=void 0===t.scale.z?i.z:t.scale.z,t.rotate.x=void 0===t.rotate.x?n.x:t.rotate.x,t.rotate.y=void 0===t.rotate.y?n.y:t.rotate.y,t.rotate.z=void 0===t.rotate.z?n.z:t.rotate.z,t}e.capture=function(e){var n={engineVersion:Human.VERSION};t(e,"modules")&&(n.modules={moduleLibs:r(),activeModules:a()}),t(e,"camera")&&(n.camera=Human.renderer.camera.getLookAt()),t(e,"clips")&&(n.clips=Human.renderer.clip.serialize()),t(e,"objects")&&(n.objects=function(){var e,t,r,a={},n=Human.scene,o=n.objects,s=n.enabledObjects;for(var l in o)o.hasOwnProperty(l)&&(r=null,0===(e=o[l]).objects.length&&s[l]&&((r=r||{}).enabled=!0,(t=i(e))&&(r.transform=t),r.opacity=e.opacity),r&&(a[l]=r));for(var c=0;c<Human.scene.rootObjects.length;c++)l=(e=Human.scene.rootObjects[c]).objectId,e.shown||(a[l]={enabled:e.shown,opacity:e.opacity});return Human.events.fire("bookmarks.captureObjectStates",{data:a}),a}()),t(e,"timeline")&&(n.timeline=Human.timeline.getBookmark()),t(e,"background")&&(n.background={colors:Human.renderer.bg.getBGColor()}),n.plugins={};var o,s=Human.plugins;for(var l in s)s.hasOwnProperty(l)&&(o=s[l]).writeBookmark&&o.writeBookmark(n);return Human.events.fire("bookmarks.capture",{bookmark:n}),n},e.restore=function(e,t){Human.events.fire("bookmarks.restoring"),Human.utils.isObject(e.modules)||function(e){e.modules={},e.modules.activeModules=[],e.modules.moduleLibs=[],Human.utils.isObject(e.objects)||(e.objects={});var t=function(e){var t,r=null;for(var a in e)if(e.hasOwnProperty(a)&&(t=a.match(/^(fe)?maleAdult/))){r=["production",t[0],t[0]+".json"].join("/");break}return r}(e.objects);t&&e.modules.activeModules.unshift(t)}(e);for(var r=e.modules.activeModules,a=r.length>1,i=[],l=0,c=r.length;l<c;l++)i[l]=Human.modules.convertBaseAnatomyModuleId(r[l]);Human.utils.filterInPlace(i,(function(e){return!(Human.modules.activeModules[e]||a&&Human.modules.isBaseModule(e))}));var u=i[0],_={camera:!0,graph:!0,annotations:!0,properties:!0,time:!0,hotspots:!0};if(e.theModuleId=u,Human.renderer.pushPause(),Human.renderer.pauseCompilation(),u)if(Human.modules.modules.hasOwnProperty(u)){var h=Human.modules.moduleData[u];Human.modules.create(u,h,(function(){n(u,e),s(e,u),Human.modules.activate(u,0,_,(function(){o(e,u,t)}))}))}else Human.modules.fetch(u,(function(){var r=Human.modules.moduleData[u];Human.modules.create(u,r,(function(){n(u,e),s(e,u),Human.modules.activate(u,0,_,(function(){o(e,u,t)}))}))}));else o(e,u,t)}}(),function(){"use strict";var e=Human.modules={},t=new Human.utils.IDPool;e.modules={},e.moduleData={},e.moduleLibs={},e.activeModules={},e.numActiveModules=0,e.history=[],e.fetch=function(t,r,a){Human.events.fire("modules.fetch.start",{moduleId:t}),Human.assets.server.getModuleDefinition(t,(function(a){a.moduleId=t,e.moduleData[t]=a,Human.events.fire("modules.fetch.finish",{moduleId:t,moduleData:a}),r&&r()}),(function(e){Human.log.info("Human.modules.activateModules","Failed to activate module: '"+t+"' - "+e),a&&a(e)}))},e.create=function(t,r,a){Human.renderer.disableRender(),r=Human.utils.deepClone(r),Human.events.fire("modules.create.start",{moduleId:t,moduleData:r}),e.modules[t]&&delete e.modules[t];var i=new e.Module(r);i.create((function(){e.modules[t]=i,Human.events.fire("modules.created",r),Human.events.fire("modules.create.finish",{moduleId:t,module:e.modules[t]}),a&&a()})),e.history.unshift(t),e.history.length>5&&e.history.pop()},e.activate=function(t,r,a,i){Human.events.fire("modules.activate.start",{moduleId:t,config:a}),Human.events.fire("modules.activating",{moduleId:t}),e.modules[t].activate(r,a,(function(){e.activeModules[t]=e.modules[t],e.numActiveModules++,Human.events.fire("modules.activated",{moduleId:t}),Human.events.fire("modules.activate.finish",{moduleId:t}),i&&i()}))},e.load=function(t,r,a,i){Human.events.fire("modules.load.start",{moduleId:t,graphNodes:r,assetTypes:a});var n=function(){Human.renderer.prepareFrame(),Human.events.fire("modules.load.finish",{moduleId:t,graphNodes:r,assetTypes:a}),i&&i()};a.includes("geometry")?function t(r,a,i,n){Human.unpackAssets.blocksWaiting>0||Human.unpackAssets.loading?setTimeout((function(){t(r,a,i,n)}),2):e.modules[r].load(a,i,n)}(t,r,a,n):e.modules[t].load(r,a,n)},e.unload=function(t,r,a,i){Human.events.fire("modules.unload.start",{moduleId:t,graphNodes:r,assetTypes:a}),e.modules[t].unload(r,a,(function(){Human.events.fire("modules.unload.finish",{moduleId:t,graphNodes:r,assetTypes:a}),i&&i()}))},e.deactivate=function(t,r,a){Human.events.fire("modules.deactivate.start",{moduleId:t,config:r}),e.modules[t].deactivate(r,(function(){delete e.activeModules[t],e.numActiveModules--,Human.events.fire("modules.deactivated",{moduleId:t}),Human.events.fire("modules.deactivate.finish",{moduleId:t}),a&&a()}))},e.destroy=function(r,a){Human.events.fire("modules.destory.start",{moduleId:r}),e.modules[r]?e.modules[r].destroy((function(){delete e.moduleData[r],delete e.modules[r],t.putId(r),Human.events.fire("modules.destroy.finish",{moduleId:r}),a&&a()})):Human.log.warn("Human.modules.destroyModule","Module does not exist, cannot be destoryed: + "+r)},e.isBase=function(e){var t=e.match(/^(femaleAdult|maleAdult|female_complete_anatomy_[0-9]+\.json|male_complete_anatomy_[0-9]+\.json)/);return t&&t[0]},e.isBaseModule=function(t){var r=t.split("/");return!!e.isBase(r[r.length-1])&&t},e.requiresBase=function(t){for(var r=!1,a=0;a<t.length&&!(r=e.isBase(t[a]));a++);return r};var r=e.MALE_STATE_ID="maleAdult_standard",a=e.FEMALE_STATE_ID="femaleAdult_standard",i={"production/maleAdult/maleAdult.json":"production/maleAdult/maleAdult_standard.json","production/femaleAdult/femaleAdult.json":"production/femaleAdult/femaleAdult_standard.json"};e.convertBaseAnatomyModuleId=function(e){return i[e]||e},e.convertBaseAnatomyStateId=function(e){return e.replace(/^femaleAdult$/,a).replace(/^maleAdult$/,r)},e.convertBaseAnatomyObjectId=function(t){if(e.isBase(t)){var r=t.split("-");t=[e.convertBaseAnatomyStateId(r[0]),r[1]].join("-"),/_ID$/.test(t)||(t+="_ID")}return t}}(),function(){"use strict";var e=Human.modules.Module=function(e){this.moduleId=e.moduleId,this.displayName=e.displayName||"",this.description=e.description||"",this.translations=e.translations||{},this.tags=e.tags||[],this.ui=e.ui||{},this.active=!1,this.timeActivated=-1,this.rootObjects=[],this.animation=e.animation||{},this.camera=e.camera,this.jumpTo=e.jumpTo,this.flyTo=e.flyTo;var t=e.modelIds||e.stateId;this.modelIds=t?Human.utils.isArray(t)?t:[t]:[],this.showObjects=e.showObjects,this.selectObjects=e.selectObjects,this.pickThroughObjects=e.pickThroughObjects,this.opacityObjects=e.opacityObjects,this.xray=e.xray,this.properties=e.properties,this.swapped=!1,this.swappedObjectId=null,this.background=e.background||null,this.customData=e.customData||{},this.cache=!1,this.chapters=e.chapters||null,this.sceneGraph=e.sceneGraph,this.particleSystems=e.customData&&e.customData.particleSystems?e.customData.particleSystems:[],this.assetLibraries=e.assetLibraries,this.hasAssetLights=this.assetLibraries.hasOwnProperty("lights")&&this.assetLibraries.lights.length>0,this.lights=e.lights,this.hasLights=this.hasAssetLights||!!this.lights,this.reflections=e.reflections||{},this.layers=e.layers||{},this.objectState=e.objects||{},this.clips=e.clips||{},this.modes=e.modes||{},this.colorRecipes=e.colorRecipes||{},this.loadedLibs={}};function t(e,t){var r,a;t=t||{showObjects:{},selectObjects:{},pickThroughObjects:{},colorRecipeObjects:{}};var i=e.showObjects||t.showObjects||{},n=e.selectObjects||t.selectObjects||{},o=e.pickThroughObjects||t.pickThroughObjects||{},s=e.opacityObjects||t.opacityObjects||{},l=e.colorRecipeObjects||t.colorRecipeObjects||{},c=e.synchronization||{};for(r in a="shown",i)i.hasOwnProperty(r)&&(c.hasOwnProperty(r)||(c[r]={}),c[r][a]=i[r]);for(r in a="selected",n)n.hasOwnProperty(r)&&(c.hasOwnProperty(r)||(c[r]={}),c[r][a]=n[r]);for(r in a="pickable",o)o.hasOwnProperty(r)&&(c.hasOwnProperty(r)||(c[r]={}),c[r][a]=!o[r]);for(r in a="opacity",s)c[r]||(c[r]={}),c[r][a]=s[r];for(var u in l)for(r in l[u])c[r]||(c[r]={}),c[r][u]=l[u][r];return c}function r(e,t,r,a,i,n,o){e[a]||(e[a]=!0,Human.assets.getAssetLibrary(t,r,a,i,n,o))}function a(e,t){e[t]&&(delete e[t],Human.assets.putAssetLibrary(t))}function i(e){return function(t){return e.indexOf(t)>-1}}e.prototype.create=function(e){var r,a,n,o,s=this;for(Human.scene.graph.buildGraph(s.sceneGraph,null,{}),r=0;r<s.sceneGraph.length;r++)s.rootObjects.push(Human.scene.objects[s.sceneGraph[r].objectId]);for(this.lights&&Human.renderer.lights.addLights(this.lights),r=0;r<s.chapters.length;r++)if((o=s.chapters[r]).lights)if(this.hasAssetLights){var l=o.lights.libraries;Human.utils.filterInPlace(l,i(this.assetLibraries.lights)),0===l.length&&l.push("default")}else o.lights.libraries=["default"];else o.lights={libraries:[],lights:[]},o.lights.libraries=s.hasAssetLights?Human.utils.deepClone(s.assetLibraries.lights):["default"];n=new Human.timeline.RootTimeline(s.moduleId);var c={showObjects:s.showObjects,pickThroughObjects:s.pickThroughObjects,selectObjects:s.selectObjects,opacityObjects:s.opacityObjects};for(r=0;r<s.chapters.length;r++)s.chapters[r].synchronization=t(s.chapters[r],c),s.chapters[r].hasOwnProperty("id")||(s.chapters[r].id=s.moduleId+"_"+r),a=new Human.timeline.BranchTimeline(s.chapters[r]),n.addChapter(a,{rebuild:!1});n.build(),s.rootTimeline=n,Human.particles.destroyAll(),Human.particles.parse(s.particleSystems,e)},e.prototype.activate=function(e,t,r){var a=this;if(a.timeActivated=Date.now(),a.active=!0,a.properties&&Human.properties.set(a.properties),a.colorRecipes)for(var i in Human.scene.colorRecipes.clearRecipes(),a.colorRecipes)Human.scene.colorRecipes.registerRecipe(i,a.colorRecipes[i]);!1!==e&&a.rootTimeline.activate(e,t,r)},e.prototype.load=function(e,t,a){var i=this,n=0;this.customData.tweens&&Human.assets.tweens.parseLibrary(this.customData.tweenId,this.customData.tweens);var o=function(e,t,r){var a,i=0;for(a in e)if(e.hasOwnProperty(a)&&t.indexOf(a)>=0)for(var n=e[a],o=0;o<n.length;o++)r[n[o]]||(i+=1);return i}(i.assetLibraries,t,i.loadedLibs);if(o>0){var s=function(){0==--o&&Human.scene.graph.attachAssetSetsToSubtree(e,[t],a)};if(i.assetLibraries.tweens&&t.indexOf("tweens")>=0)for(n=0;n<i.assetLibraries.tweens.length;n++)r(i.loadedLibs,"animation","animations",i.assetLibraries.tweens[n],"manifest",{},s);if(i.assetLibraries.reflections&&t.indexOf("reflections")>=0)for(n=0;n<i.assetLibraries.reflections.length;n++)r(i.loadedLibs,"reflection","reflections",i.assetLibraries.reflections[n],"outline",{},s);if(i.assetLibraries.lights&&i.assetLibraries.lights.length>0&&t.indexOf("lights")>=0)for(n=0;n<i.assetLibraries.lights.length;n++)r(i.loadedLibs,"light","lights",i.assetLibraries.lights[n],"outline",{},s)}else Human.scene.graph.attachAssetSetsToSubtree(e,[t],a)},e.prototype.unload=function(e,t,r){var i=this,n=0;if(i.assetLibraries.tweens&&t.indexOf("tweens")>=0)for(n=0;n<i.assetLibraries.tweens.length;n++)a(i.loadedLibs,i.assetLibraries.tweens[n]);if(i.assetLibraries.reflections&&t.indexOf("reflections")>=0)for(n=0;n<i.assetLibraries.reflections.length;n++)a(i.loadedLibs,i.assetLibraries.reflections[n]);if(i.assetLibraries.lights&&t.indexOf("lights")>=0)for(n=0;n<i.assetLibraries.lights.length;n++)a(i.loadedLibs,i.assetLibraries.lights[n]);Human.scene.graph.unloadSubtree(e,t,r)},e.prototype.deactivate=function(e,t){var r=this;r.timeActivated=-1,r.active=!1,r.rootTimeline.deactivate(e,t)},e.prototype.destroy=function(e){var t=this;Human.particles.destroyAll(),t.rootTimeline.destroy(),Human.scene.graph.destroySubtree(t.rootObjects),t=null,e&&e()}}(),function(){"use strict";Human.mobile={android:void 0!==window.HumanKitAndroid,iOS:void 0!==window.webkit,bundleid:void 0!==window.mobilebundleid?window.mobilebundleid:null}}(),function(){"use strict";var e=Human.workers={},t="";e.setPath=function(e){t=e},e.loadWorker=function(e){return new Worker(t+"/"+e)}}(),function(){"use strict";Human.plugins={},Human.addPlugin=function(e,t){Human.plugins[e]=t}}(),function(e){"use strict";function t(e,t,r){return t<=e&&e<=r}function r(e,t){return Math.floor(e/t)}var a=-1,i=-1;function n(e){var t=0;this.get=function(){return t>=e.length?a:Number(e[t])},this.offset=function(r){if((t+=r)<0)throw new Error("Seeking past start of the buffer");if(t>e.length)throw new Error("Seeking past EOF")},this.match=function(r){if(r.length>t+e.length)return!1;var a;for(a=0;a<r.length;a+=1)if(Number(e[t+a])!==r[a])return!1;return!0}}function o(e){var t=0;this.emit=function(r){var i,n=a;for(i=0;i<arguments.length;++i)n=Number(arguments[i]),e[t++]=n;return n}}function s(e){var r=0,a=function(){for(var r=[],a=0,i=e.length;a<e.length;){var n=e.charCodeAt(a);if(t(n,55296,57343))if(t(n,56320,57343))r.push(65533);else if(a===i-1)r.push(65533);else{var o=e.charCodeAt(a+1);t(o,56320,57343)?(a+=1,r.push(65536+((1023&n)<<10)+(1023&o))):r.push(65533)}else r.push(n);a+=1}return r}();this.offset=function(e){if((r+=e)<0)throw new Error("Seeking past start of the buffer");if(r>a.length)throw new Error("Seeking past EOF")},this.get=function(){return r>=a.length?i:a[r]}}function l(){var e="";this.string=function(){return e},this.emit=function(t){t<=65535?e+=String.fromCharCode(t):(t-=65536,e+=String.fromCharCode(55296+(t>>10&1023)),e+=String.fromCharCode(56320+(1023&t)))}}function c(e,t){if(e)throw new Error("EncodingError");return t||65533}function u(e){throw new Error("EncodingError")}function _(e){if(e=String(e).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(f,e))return f[e];throw new Error("EncodingError: Unknown encoding: "+e)}var h={},f={};function d(e,t){return(t||[])[e]||null}function p(e,t){var r=t.indexOf(e);return-1===r?null:r}[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"utf-8"}],heading:"The Encoding"},{encodings:[{labels:["cp864","ibm864"],name:"ibm864"},{labels:["cp866","ibm866"],name:"ibm866"},{labels:["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso_8859-2","l2","latin2"],name:"iso-8859-2"},{labels:["csisolatin3","iso-8859-3","iso_8859-3","iso-ir-109","l3","latin3"],name:"iso-8859-3"},{labels:["csisolatin4","iso-8859-4","iso_8859-4","iso-ir-110","l4","latin4"],name:"iso-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso_8859-5","iso-ir-144"],name:"iso-8859-5"},{labels:["arabic","csisolatinarabic","ecma-114","iso-8859-6","iso_8859-6","iso-ir-127"],name:"iso-8859-6"},{labels:["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso_8859-7","iso-ir-126"],name:"iso-8859-7"},{labels:["csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-i","iso-ir-138","iso_8859-8","visual"],name:"iso-8859-8"},{labels:["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","l6","latin6"],name:"iso-8859-10"},{labels:["iso-8859-13"],name:"iso-8859-13"},{labels:["iso-8859-14","iso8859-14"],name:"iso-8859-14"},{labels:["iso-8859-15","iso_8859-15"],name:"iso-8859-15"},{labels:["iso-8859-16"],name:"iso-8859-16"},{labels:["koi8-r","koi8_r"],name:"koi8-r"},{labels:["koi8-u"],name:"koi8-u"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["iso-8859-11","tis-620","windows-874"],name:"windows-874"},{labels:["windows-1250","x-cp1250"],name:"windows-1250"},{labels:["windows-1251","x-cp1251"],name:"windows-1251"},{labels:["ascii","ansi_x3.4-1968","csisolatin1","iso-8859-1","iso8859-1","iso_8859-1","l1","latin1","us-ascii","windows-1252"],name:"windows-1252"},{labels:["cp1253","windows-1253"],name:"windows-1253"},{labels:["csisolatin5","iso-8859-9","iso-ir-148","l5","latin5","windows-1254"],name:"windows-1254"},{labels:["cp1255","windows-1255"],name:"windows-1255"},{labels:["cp1256","windows-1256"],name:"windows-1256"},{labels:["windows-1257"],name:"windows-1257"},{labels:["cp1258","windows-1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["chinese","csgb2312","csiso58gb231280","gb2312","gbk","gb_2312","gb_2312-80","iso-ir-58","x-gbk"],name:"gbk"},{labels:["gb18030"],name:"gb18030"},{labels:["hz-gb-2312"],name:"hz-gb-2312"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"euc-jp"},{labels:["csiso2022jp","iso-2022-jp"],name:"iso-2022-jp"},{labels:["csshiftjis","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],name:"shift_jis"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],name:"euc-kr"},{labels:["csiso2022kr","iso-2022-kr"],name:"iso-2022-kr"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["utf-16","utf-16le"],name:"utf-16"},{labels:["utf-16be"],name:"utf-16be"}],heading:"Legacy utf-16 encodings"}].forEach((function(e){e.encodings.forEach((function(e){h[e.name]=e,e.labels.forEach((function(t){f[t]=e}))}))}));var m=e["encoding-indexes"]||{};function g(e){var r=e.fatal,n=0,o=0,s=0,l=0;this.decode=function(e){var u=e.get();if(u===a)return 0!==o?c(r):i;if(e.offset(1),0===o){if(t(u,0,127))return u;if(t(u,194,223))o=1,l=128,n=u-192;else if(t(u,224,239))o=2,l=2048,n=u-224;else{if(!t(u,240,244))return c(r);o=3,l=65536,n=u-240}return n*=Math.pow(64,o),null}if(!t(u,128,191))return n=0,o=0,s=0,l=0,e.offset(-1),c(r);if(s+=1,n+=(u-128)*Math.pow(64,o-s),s!==o)return null;var _=n,h=l;return n=0,o=0,s=0,l=0,t(_,h,1114111)&&!t(_,55296,57343)?_:c(r)}}function y(e){this.encode=function(e,n){var o,s,l=n.get();if(l===i)return a;if(n.offset(1),t(l,55296,57343))return u();if(t(l,0,127))return e.emit(l);t(l,128,2047)?(o=1,s=192):t(l,2048,65535)?(o=2,s=224):t(l,65536,1114111)&&(o=3,s=240);for(var c=e.emit(r(l,Math.pow(64,o))+s);o>0;){var _=r(l,Math.pow(64,o-1));c=e.emit(128+_%64),o-=1}return c}}function v(e,r){var n=r.fatal;this.decode=function(r){var o=r.get();if(o===a)return i;if(r.offset(1),t(o,0,127))return o;var s=e[o-128];return null===s?c(n):s}}function S(e,r){this.encode=function(r,n){var o=n.get();if(o===i)return a;if(n.offset(1),t(o,0,127))return r.emit(o);var s=p(o,e);return null===s&&u(),r.emit(s+128)}}function b(e,r){var n=r.fatal,o=0,s=0,l=0;this.decode=function(r){var u,_=r.get();if(_===a&&0===o&&0===s&&0===l)return i;if(_!==a||0===o&&0===s&&0===l||(o=0,s=0,l=0,c(n)),r.offset(1),0!==l)return u=null,t(_,48,57)&&(u=function(e){if(e>39419&&e<189e3||e>1237575)return null;var t,r=0,a=0,i=m.gb18030;for(t=0;t<i.length;++t){var n=i[t];if(!(n[0]<=e))break;r=n[0],a=n[1]}return a+e-r}(10*(126*(10*(o-129)+(s-48))+(l-129))+_-48)),o=0,s=0,l=0,null===u?(r.offset(-3),c(n)):u;if(0!==s)return t(_,129,254)?(l=_,null):(r.offset(-2),o=0,s=0,c(n));if(0!==o){if(t(_,48,57)&&e)return s=_,null;var h=o,f=null;o=0;var p=_<127?64:65;return(t(_,64,126)||t(_,128,254))&&(f=190*(h-129)+(_-p)),u=null===f?null:d(f,m.gbk),null===f&&r.offset(-1),null===u?c(n):u}return t(_,0,127)?_:128===_?8364:t(_,129,254)?(o=_,null):c(n)}}function E(e,n){this.encode=function(n,o){var s=o.get();if(s===i)return a;if(o.offset(1),t(s,0,127))return n.emit(s);var l=p(s,m.gbk);if(null!==l){var c=r(l,190)+129,_=l%190;return n.emit(c,_+(_<63?64:65))}if(null===l&&!e)return u();var h=r(r(r(l=function(e){var t,r=0,a=0,i=m.gb18030;for(t=0;t<i.length;++t){var n=i[t];if(!(n[1]<=e))break;r=n[1],a=n[0]}return a+e-r}(s),10),126),10),f=r(r(l-=10*h*126*10,10),126),d=r(l-=10*f*126,10);return n.emit(h+129,f+48,d+129,l-10*d+48)}}function I(e){var r=e.fatal,n=!1,o=0;this.decode=function(e){var s=e.get();if(s===a&&0===o)return i;if(s===a&&0!==o)return o=0,c(r);if(e.offset(1),126===o)return o=0,123===s?(n=!0,null):125===s?(n=!1,null):126===s?126:10===s?null:(e.offset(-1),c(r));if(0!==o){var l=o;o=0;var u=null;return t(s,33,126)&&(u=d(190*(l-1)+(s+63),m.gbk)),10===s&&(n=!1),null===u?c(r):u}return 126===s?(o=126,null):n?t(s,32,127)?(o=s,null):(10===s&&(n=!1),c(r)):t(s,0,127)?s:c(r)}}function x(e){var n=!1;this.encode=function(e,o){var s=o.get();if(s===i)return a;if(o.offset(1),t(s,0,127)&&n)return o.offset(-1),n=!1,e.emit(126,125);if(126===s)return e.emit(126,126);if(t(s,0,127))return e.emit(s);if(!n)return o.offset(-1),n=!0,e.emit(126,123);var l=p(s,m.gbk);if(null===l)return u();var c=r(l,190)+1,_=l%190-63;return t(c,33,126)&&t(_,33,126)?e.emit(c,_):u()}}function C(e){var r=e.fatal,n=0,o=null;this.decode=function(e){if(null!==o){var s=o;return o=null,s}var l=e.get();if(l===a&&0===n)return i;if(l===a&&0!==n)return n=0,c(r);if(e.offset(1),0!==n){var u=n,_=null;n=0;var h=l<127?64:98;if((t(l,64,126)||t(l,161,254))&&(_=157*(u-129)+(l-h)),1133===_)return o=772,202;if(1135===_)return o=780,202;if(1164===_)return o=772,234;if(1166===_)return o=780,234;var f=null===_?null:d(_,m.big5);return null===_&&e.offset(-1),null===f?c(r):f}return t(l,0,127)?l:t(l,129,254)?(n=l,null):c(r)}}function T(e){this.encode=function(e,n){var o=n.get();if(o===i)return a;if(n.offset(1),t(o,0,127))return e.emit(o);var s=p(o,m.big5);if(null===s)return u();var l=r(s,157)+129,c=s%157;return e.emit(l,c+(c<63?64:98))}}function N(e){var r=e.fatal,n=0,o=0;this.decode=function(e){var s,l,u=e.get();return u===a?0===n&&0===o?i:(n=0,o=0,c(r)):(e.offset(1),0!==o?(s=o,o=0,l=null,t(s,161,254)&&t(u,161,254)&&(l=d(94*(s-161)+u-161,m.jis0212)),t(u,161,254)||e.offset(-1),null===l?c(r):l):142===n&&t(u,161,223)?(n=0,65377+u-161):143===n&&t(u,161,254)?(n=0,o=u,null):0!==n?(s=n,n=0,l=null,t(s,161,254)&&t(u,161,254)&&(l=d(94*(s-161)+u-161,m.jis0208)),t(u,161,254)||e.offset(-1),null===l?c(r):l):t(u,0,127)?u:142===u||143===u||t(u,161,254)?(n=u,null):c(r))}}function A(e){this.encode=function(e,n){var o=n.get();if(o===i)return a;if(n.offset(1),t(o,0,127))return e.emit(o);if(165===o)return e.emit(92);if(8254===o)return e.emit(126);if(t(o,65377,65439))return e.emit(142,o-65377+161);var s=p(o,m.jis0208);if(null===s)return u();var l=r(s,94)+161;return e.emit(l,s%94+161)}}function D(e){var r=e.fatal,n=0,o=!1,s=0;this.decode=function(e){var l=e.get();switch(l!==a&&e.offset(1),n){default:case 0:return 27===l?(n=1,null):t(l,0,127)?l:l===a?i:c(r);case 1:return 36===l||40===l?(s=l,n=2,null):(l!==a&&e.offset(-1),n=0,c(r));case 2:var u=s;return s=0,36!==u||64!==l&&66!==l?36===u&&40===l?(n=3,null):40!==u||66!==l&&74!==l?40===u&&73===l?(n=6,null):(e.offset(l===a?-1:-2),n=0,c(r)):(n=0,null):(o=!1,n=4,null);case 3:return 68===l?(o=!0,n=4,null):(e.offset(l===a?-2:-3),n=0,c(r));case 4:return 10===l?(n=0,c(r,10)):27===l?(n=1,null):l===a?i:(s=l,n=5,null);case 5:if(n=4,l===a)return c(r);var _=null,h=94*(s-33)+l-33;return t(s,33,126)&&t(l,33,126)&&(_=d(h,!1===o?m.jis0208:m.jis0212)),null===_?c(r):_;case 6:return 27===l?(n=1,null):t(l,33,95)?65377+l-33:l===a?i:c(r)}}}function M(e){var n=0;this.encode=function(e,o){var s=o.get();if(s===i)return a;if(o.offset(1),(t(s,0,127)||165===s||8254===s)&&0!==n)return o.offset(-1),n=0,e.emit(27,40,66);if(t(s,0,127))return e.emit(s);if(165===s)return e.emit(92);if(8254===s)return e.emit(126);if(t(s,65377,65439)&&2!==n)return o.offset(-1),n=2,e.emit(27,40,73);if(t(s,65377,65439))return e.emit(s-65377-33);if(1!==n)return o.offset(-1),n=1,e.emit(27,36,66);var l=p(s,m.jis0208);if(null===l)return u();var c=r(l,94)+33;return e.emit(c,l%94+33)}}function P(e){var r=e.fatal,n=0;this.decode=function(e){var o=e.get();if(o===a&&0===n)return i;if(o===a&&0!==n)return n=0,c(r);if(e.offset(1),0!==n){var s=n;if(n=0,t(o,64,126)||t(o,128,252)){var l=d(188*(s-(s<160?129:193))+o-(o<127?64:65),m.jis0208);return null===l?c(r):l}return e.offset(-1),c(r)}return t(o,0,128)?o:t(o,161,223)?65377+o-161:t(o,129,159)||t(o,224,252)?(n=o,null):c(r)}}function w(e){this.encode=function(e,n){var o=n.get();if(o===i)return a;if(n.offset(1),t(o,0,128))return e.emit(o);if(165===o)return e.emit(92);if(8254===o)return e.emit(126);if(t(o,65377,65439))return e.emit(o-65377+161);var s=p(o,m.jis0208);if(null===s)return u();var l=r(s,188),c=s%188;return e.emit(l+(l<31?129:193),c+(c<63?64:65))}}function F(e){var r=e.fatal,n=0;this.decode=function(e){var o=e.get();if(o===a&&0===n)return i;if(o===a&&0!==n)return n=0,c(r);if(e.offset(1),0!==n){var s=n,l=null;if(n=0,t(s,129,198)){var u=178*(s-129);t(o,65,90)?l=u+o-65:t(o,97,122)?l=u+26+o-97:t(o,129,254)&&(l=u+26+26+o-129)}t(s,199,253)&&t(o,161,254)&&(l=12460+94*(s-199)+(o-161));var _=null===l?null:d(l,m["euc-kr"]);return null===l&&e.offset(-1),null===_?c(r):_}return t(o,0,127)?o:t(o,129,253)?(n=o,null):c(r)}}function R(e){this.encode=function(e,n){var o=n.get();if(o===i)return a;if(n.offset(1),t(o,0,127))return e.emit(o);var s,l,c=p(o,m["euc-kr"]);return null===c?u():c<12460?(s=r(c,178)+129,e.emit(s,(l=c%178)+(l<26?65:l<52?71:77))):(s=r(c-=12460,94)+199,e.emit(s,l=c%94+161))}}function L(e){var r=e.fatal,n=0,o=0;this.decode=function(e){var s=e.get();switch(s!==a&&e.offset(1),n){default:case 0:return 14===s?(n=4,null):15===s?null:27===s?(n=1,null):t(s,0,127)?s:s===a?i:c(r);case 1:return 36===s?(n=2,null):(s!==a&&e.offset(-1),n=0,c(r));case 2:return 41===s?(n=3,null):(e.offset(s===a?-1:-2),n=0,c(r));case 3:return 67===s?(n=0,null):(e.offset(s===a?-2:-3),n=0,c(r));case 4:return 10===s?(n=0,c(r,10)):14===s?null:15===s?(n=0,null):s===a?i:(o=s,n=5,null);case 5:if(n=4,s===a)return c(r);var l=null;return t(o,33,70)&&t(s,33,126)?l=d(178*(o-1)+26+26+s-1,m["euc-kr"]):t(o,71,126)&&t(s,33,126)&&(l=d(12460+94*(o-71)+(s-33),m["euc-kr"])),null!==l?l:c(r)}}}function O(e){var n=!1,o=0;this.encode=function(e,s){var l=s.get();if(l===i)return a;if(n||(n=!0,e.emit(27,36,41,67)),s.offset(1),t(l,0,127)&&0!==o)return s.offset(-1),o=0,e.emit(15);if(t(l,0,127))return e.emit(l);if(1!==o)return s.offset(-1),o=1,e.emit(14);var c,_,h=p(l,m["euc-kr"]);return null===h?u():h<12460?(_=h%178-26-26+1,t(c=r(h,178)+1,33,70)&&t(_,33,126)?e.emit(c,_):u()):(_=(h-=12460)%94+33,t(c=r(h,94)+71,71,126)&&t(_,33,126)?e.emit(c,_):u())}}function H(e,r){var n=r.fatal,o=null,s=null;this.decode=function(r){var l,u=r.get();if(u===a&&null===o&&null===s)return i;if(u===a&&(null!==o||null!==s))return c(n);if(r.offset(1),null===o)return o=u,null;if(l=e?(o<<8)+u:(u<<8)+o,o=null,null!==s){var _=s;return s=null,t(l,56320,57343)?65536+1024*(_-55296)+(l-56320):(r.offset(-2),c(n))}return t(l,55296,56319)?(s=l,null):t(l,56320,57343)?c(n):l}}function J(e,n){this.encode=function(n,o){function s(t){var r=t>>8,a=255&t;return e?n.emit(r,a):n.emit(a,r)}var l=o.get();if(l===i)return a;if(o.offset(1),t(l,55296,57343)&&u(),l<=65535)return s(l);var c=(l-65536)%1024+56320;return s(r(l-65536,1024)+55296),s(c)}}h["utf-8"].getEncoder=function(e){return new y(e)},h["utf-8"].getDecoder=function(e){return new g(e)},["ibm864","ibm866","iso-8859-2","iso-8859-3","iso-8859-4","iso-8859-5","iso-8859-6","iso-8859-7","iso-8859-8","iso-8859-10","iso-8859-13","iso-8859-14","iso-8859-15","iso-8859-16","koi8-r","koi8-u","macintosh","windows-874","windows-1250","windows-1251","windows-1252","windows-1253","windows-1254","windows-1255","windows-1256","windows-1257","windows-1258","x-mac-cyrillic"].forEach((function(e){var t=h[e],r=m[e];t.getDecoder=function(e){return new v(r,e)},t.getEncoder=function(e){return new S(r,e)}})),h.gbk.getEncoder=function(e){return new E(!1,e)},h.gbk.getDecoder=function(e){return new b(!1,e)},h.gb18030.getEncoder=function(e){return new E(!0,e)},h.gb18030.getDecoder=function(e){return new b(!0,e)},h["hz-gb-2312"].getEncoder=function(e){return new x(e)},h["hz-gb-2312"].getDecoder=function(e){return new I(e)},h.big5.getEncoder=function(e){return new T(e)},h.big5.getDecoder=function(e){return new C(e)},h["euc-jp"].getEncoder=function(e){return new A(e)},h["euc-jp"].getDecoder=function(e){return new N(e)},h["iso-2022-jp"].getEncoder=function(e){return new M(e)},h["iso-2022-jp"].getDecoder=function(e){return new D(e)},h.shift_jis.getEncoder=function(e){return new w(e)},h.shift_jis.getDecoder=function(e){return new P(e)},h["euc-kr"].getEncoder=function(e){return new R(e)},h["euc-kr"].getDecoder=function(e){return new F(e)},h["iso-2022-kr"].getEncoder=function(e){return new O(e)},h["iso-2022-kr"].getDecoder=function(e){return new L(e)},h["utf-16"].getEncoder=function(e){return new J(!1,e)},h["utf-16"].getDecoder=function(e){return new H(!1,e)},h["utf-16be"].getEncoder=function(e){return new J(!0,e)},h["utf-16be"].getDecoder=function(e){return new H(!0,e)};var B="utf-8";function U(t,r){return this&&this!==e?(t=t?String(t):B,r=Object(r),this._encoding=_(t),this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(r.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this):new U(t,r)}function k(t,r){return this&&this!==e?(t=t?String(t):B,r=Object(r),this._encoding=_(t),this._streaming=!1,this._decoder=null,this._options={fatal:Boolean(r.fatal)},Object.defineProperty?Object.defineProperty(this,"encoding",{get:function(){return this._encoding.name}}):this.encoding=this._encoding.name,this):new k(t,r)}U.prototype={encode:function(e,t){e=e?String(e):"",t=Object(t),this._streaming||(this._encoder=this._encoding.getEncoder(this._options)),this._streaming=Boolean(t.stream);for(var r=[],n=new o(r),l=new s(e);l.get()!==i;)this._encoder.encode(n,l);if(!this._streaming){var c;do{c=this._encoder.encode(n,l)}while(c!==a);this._encoder=null}return new Uint8Array(r)}},k.prototype={decode:function(e,t){if(e&&!("buffer"in e&&"byteOffset"in e&&"byteLength"in e))throw new TypeError("Expected ArrayBufferView");e||(e=new Uint8Array(0)),t=Object(t),this._streaming||(this._decoder=this._encoding.getDecoder(this._options)),this._streaming=Boolean(t.stream);var r=new n(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));if(_(function(e,t){return t.match([255,254])?(t.offset(2),"utf-16"):t.match([254,255])?(t.offset(2),"utf-16be"):t.match([239,187,191])?(t.offset(3),"utf-8"):e}(this._encoding.name,r))!==this._encoding)throw new Error("BOM mismatch");for(var o,s=new l;r.get()!==a;)null!==(o=this._decoder.decode(r))&&o!==i&&s.emit(o);if(!this._streaming){do{null!==(o=this._decoder.decode(r))&&o!==i&&s.emit(o)}while(o!==i);this._decoder=null}return s.string()}},e.TextEncoder=e.TextEncoder||U,e.TextDecoder=e.TextDecoder||k}(this),function(){"use strict";window.HumanAPI=function e(t){var r=this;"string"==typeof t&&(t={iframeId:t}),t.onReady=function(){r._ready=!0;for(var e=0,t=r._readyCallbacks.length;t>e;e++)r._readyCallbacks[e](),r._readyCallbacks.length=0},r._rpc=new e.WindowRPCClient(t),r._ready=!1,r._readyCallbacks=[]},HumanAPI.prototype.send=function(e,t,r){return"function"==typeof t&&(r=t,t={}),"function"==typeof r&&(r=r.bind(this)),this._rpc.call(e,t||{},r),this},HumanAPI.prototype.on=function(e,t){return"function"==typeof t&&(t=t.bind(this)),"human.ready"===e?(this._ready?t():this._readyCallbacks.push(t),this):(this._rpc.call("apiEvents.on",e,t,!1),this)},HumanAPI.prototype.once=function(e,t){return"function"==typeof t&&(t=t.bind(this)),"human.ready"===e?(this._ready?t():this._readyCallbacks.push(t),this):(this._rpc.call("apiEvents.once",e,t,!0),this)}}(),function(){"use strict";HumanAPI.Map=function(e,t){this.items=e||[];var r=(t||0)+1;this.addItem=function(){var e;if(2===arguments.length){var t=arguments[0];if(this.items[t])throw"ID clash: '"+t+"'";return this.items[t]=e=arguments[1],t}for(;;){e=arguments[0];var a=r++;if(!this.items[a])return this.items[a]=e,a}},this.removeItem=function(e){delete this.items[e]}}}(),function(){"use strict";HumanAPI.WindowRPCClient=function(e){if(!e.iframeId)throw"config expected: iframeId";if(this._iframe=document.getElementById(e.iframeId),!this._iframe)throw"iframe not found: '"+e.iframeId+"'";if(!this._iframe.contentWindow)throw"element is not an iframe: '"+e.iframeId+"'";this.destroyed=!1,this._handleMap=new HumanAPI.Map({},Date.now()),this._subs={},this._ready=!1,this._messageBuffer=[],this._messageBufferConnected=[],this._connect(e.onUnsupported,e.onConnected,e.onReady)},HumanAPI.WindowRPCClient.prototype._connect=function(e,t,r){var a=null,i=this,n=function(){o(),a=setInterval((function(){return!i.destroyed&&i._iframe&&i._iframe.contentWindow?void i._iframe.contentWindow.postMessage(JSON.stringify({action:"connect"}),"*"):void o()}),100)},o=function(){a&&(clearInterval(a),a=null)};window.addEventListener("message",(function(a){var n=a.data;switch(n){case"unsupported":"function"==typeof e&&e(a.data);break;default:var s;try{s=JSON.parse(n)}catch(u){return}if(s.message)switch(s.message){case"connected":i._connected=!0,i._sendQueuedMessages(!0),"function"==typeof t&&t();break;case"status":switch(s.status){case"ready":i._ready=!0,o(),i._sendQueuedMessages(),"function"==typeof r&&r()}}if(s.results||s.response){var l=s.results||s.response;for(var c in l)l.hasOwnProperty(c)&&i._subs[c]&&i.set(c,l[c])}}}),!1),i._iframe.addEventListener("load",n),i._iframe.addEventListener("unload",o),n()},HumanAPI.WindowRPCClient.prototype._sendQueuedMessages=function(e){for(var t=e?this._messageBufferConnected:this._messageBuffer;t.length>0;){var r=t.pop();this._send(r,r.ok,r.once)}},HumanAPI.WindowRPCClient.prototype.call=function(e,t,r,a){var i={call:e,params:t,ok:r,once:a},n=t.connected?this._messageBufferConnected:this._messageBuffer;this._ready||this._connected&&t.connected?this._send(i,r,a):n.unshift(i)},HumanAPI.WindowRPCClient.prototype._send=function(e,t,r){if(t){var a=this,i=this._on((function(e){(void 0===r||!0===r)&&a._off(i),t.call(a,e)}));e.id=i,this._sendMessage(e)}else this._sendMessage(e)},HumanAPI.WindowRPCClient.prototype._sendMessage=function(e){this._onSend&&this._onSend(e),this.destroyed||this._iframe.contentWindow.postMessage(JSON.stringify(e),"*")},HumanAPI.WindowRPCClient.prototype.set=function(e,t){var r=this._subs[e];r&&r.call(this,t)},HumanAPI.WindowRPCClient.prototype._on=function(e){var t=this._handleMap.addItem();return this._subs[t]=e,t},HumanAPI.WindowRPCClient.prototype._off=function(e){delete this._subs[e],this._handleMap.removeItem(e)},HumanAPI.WindowRPCClient.prototype.destroy=function(){this.destroyed=!0}}(),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).immer={})}(this,(function(e){function t(e){for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function r(e){return!!e&&!!e[G]}function a(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);return!t||t===Object.prototype}(e)||Array.isArray(e)||!!e[j]||!!e.constructor[j]||c(e)||u(e))}function i(e,t,r){void 0===r&&(r=!1),0===n(e)?(r?Object.keys:X)(e).forEach((function(r){return t(r,e[r],e)})):e.forEach((function(r,a){return t(a,r,e)}))}function n(e){var t=e[G];return t?t.t>3?t.t-4:t.t:Array.isArray(e)?1:c(e)?2:u(e)?3:0}function o(e,t){return 2===n(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function s(e,t){return 2===n(e)?e.get(t):e[t]}function l(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function c(e){return B&&e instanceof Map}function u(e){return U&&e instanceof Set}function _(e){return e.i||e.u}function h(e,r){if(void 0===r&&(r=!1),Array.isArray(e))return e.slice();var a=Object.create(Object.getPrototypeOf(e));return i(e,(function(i){if(i!==G){var n=Object.getOwnPropertyDescriptor(e,i),o=n.value;n.get&&(r||t(1),o=n.get.call(e)),n.enumerable?a[i]=o:Object.defineProperty(a,i,{value:o,writable:!0,configurable:!0})}})),a}function f(e,t){r(e)||p(e)||!a(e)||(n(e)>1&&(e.set=e.add=e.clear=e.delete=d),Object.freeze(e),t&&i(e,(function(e,t){return f(t,!0)}),!0))}function d(){t(2)}function p(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function m(e){var r=Y[e];return r||t(19,e),r}function g(e,t){Y[e]=t}function y(){return H}function v(e,t){t&&(m("Patches"),e.o=[],e.v=[],e.s=t)}function S(e){b(e),e.p.forEach(I),e.p=null}function b(e){e===H&&(H=e.h)}function E(e){return H={p:[],h:H,l:e,_:!0,m:0}}function I(e){var t=e[G];0===t.t||1===t.t?t.j():t.O=!0}function x(e,r){r.m=r.p.length;var i=r.p[0],n=void 0!==e&&e!==i;return r.l.S||m("ES5").P(r,e,n),n?(i[G].M&&(S(r),t(4)),a(e)&&(e=C(r,e),r.h||N(r,e)),r.o&&m("Patches").g(i[G],e,r.o,r.v)):e=C(r,i,[]),S(r),r.o&&r.s(r.o,r.v),e!==V?e:void 0}function C(e,t,r){if(p(t))return t;var a=t[G];if(!a)return i(t,(function(i,n){return T(e,a,t,i,n,r)}),!0),t;if(a.A!==e)return t;if(!a.M)return N(e,a.u,!0),a.u;if(!a.R){a.R=!0,a.A.m--;var n=4===a.t||5===a.t?a.i=h(a.k,!0):a.i;i(n,(function(t,i){return T(e,a,n,t,i,r)})),N(e,n,!1),r&&e.o&&m("Patches").F(a,r,e.o,e.v)}return a.i}function T(e,t,i,c,u,_){if(r(u)){var h=C(e,u,_&&t&&3!==t.t&&!o(t.D,c)?_.concat(c):void 0);if(d=c,p=h,2===(m=n(f=i))?f.set(d,p):3===m?(f.delete(d),f.add(p)):f[d]=p,!r(h))return;e._=!1}var f,d,p,m;if((!t||!l(u,s(t.u,c)))&&a(u)){if(!e.l.J&&e.m<1)return;C(e,u),t&&t.A.h||N(e,u)}}function N(e,t,r){void 0===r&&(r=!1),e.l.J&&e._&&f(t,r)}function A(e,t){var r=e[G],a=Reflect.getOwnPropertyDescriptor(r?_(r):e,t);return a&&a.value}function D(e){if(!e.M){if(e.M=!0,0===e.t||1===e.t){var t=e.i=h(e.u);i(e.p,(function(e,r){t[e]=r})),e.p=void 0}e.h&&D(e.h)}}function M(e){e.i||(e.i=h(e.u))}function P(e,t,r){var a=c(t)?m("MapSet").K(t,r):u(t)?m("MapSet").N(t,r):e.S?function(e,t){var r=Array.isArray(e),a={t:r?1:0,A:t?t.A:y(),M:!1,R:!1,D:{},h:t,u:e,k:null,p:{},i:null,j:null,$:!1},i=a,n=W;r&&(i=[a],n=q);var o=Proxy.revocable(i,n),s=o.revoke,l=o.proxy;return a.k=l,a.j=s,l}(t,r):m("ES5").C(t,r);return(r?r.A:y()).p.push(a),a}function w(e,t){e.S?D(t):m("ES5").I(t)}function F(){function e(e,t){var r=e[G];if(r&&!r.W){r.W=!0;var a=e[t];return r.W=!1,a}return e[t]}function n(e){e.M||(e.M=!0,e.h&&n(e.h))}function s(e){e.i||(e.i=c(e.u))}function c(e){var t=e&&e[G];if(t){t.W=!0;var r=h(t.k,!0);return t.W=!1,r}return h(e)}function u(e){for(var t=e.length-1;t>=0;t--){var r=e[t][G];if(!r.M)switch(r.t){case 5:d(r)&&n(r);break;case 4:f(r)&&n(r)}}}function f(e){for(var t=e.u,r=e.k,a=Object.keys(r),i=a.length-1;i>=0;i--){var n=a[i],s=t[n];if(void 0===s&&!o(t,n))return!0;var c=r[n],u=c&&c[G];if(u?u.u!==s:!l(c,s))return!0}return a.length!==Object.keys(t).length}function d(e){var t=e.k;if(t.length!==e.u.length)return!0;var r=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!r||r.get)}function p(e){e.O&&t(3,JSON.stringify(_(e)))}var m={};g("ES5",{C:function(t,r){var o=Array.isArray(t),u=c(t);i(u,(function(r){!function(t,r,i){var o=m[r];o?o.enumerable=i:m[r]=o={enumerable:i,get:function(){return function(t,r){p(t);var i=e(_(t),r);return t.W?i:i===e(t.u,r)&&a(i)?(s(t),t.i[r]=P(t.A.l,i,t)):i}(this[G],r)},set:function(t){!function(t,r,a){if(p(t),t.D[r]=!0,!t.M){if(l(a,e(_(t),r)))return;n(t),s(t)}t.i[r]=a}(this[G],r,t)}},Object.defineProperty(t,r,o)}(u,r,o||function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return!(!r||!r.enumerable)}(t,r))}));var h={t:o?5:4,A:r?r.A:y(),M:!1,W:!1,R:!1,D:{},h:r,u:t,k:u,i:null,O:!1,$:!1};return Object.defineProperty(u,G,{value:h,writable:!0}),u},I:n,P:function(e,t,a){e.p.forEach((function(e){e[G].W=!0})),a?r(t)&&t[G].A===e&&u(e.p):(e.o&&function e(t){if(t&&"object"==typeof t){var r=t[G];if(r){var a=r.u,s=r.k,l=r.D,c=r.t;if(4===c)i(s,(function(t){t!==G&&(void 0!==a[t]||o(a,t)?l[t]||e(s[t]):(l[t]=!0,n(r)))})),i(a,(function(e){void 0!==s[e]||o(s,e)||(l[e]=!1,n(r))}));else if(5===c){if(d(r)&&(n(r),l.length=!0),s.length<a.length)for(var u=s.length;u<a.length;u++)l[u]=!1;else for(var _=a.length;_<s.length;_++)l[_]=!0;for(var h=Math.min(s.length,a.length),f=0;f<h;f++)void 0===l[f]&&e(s[f])}}}}(e.p[0]),u(e.p))}})}function R(){function e(t){if(!t||"object"!=typeof t)return t;if(Array.isArray(t))return t.map(e);if(c(t))return new Map(Array.from(t.entries()).map((function(t){return[t[0],e(t[1])]})));if(u(t))return new Set(Array.from(t).map(e));var r=Object.create(Object.getPrototypeOf(t));for(var a in t)r[a]=e(t[a]);return r}function a(t){return r(t)?e(t):t}var l="add";g("Patches",{X:function(r,a){return a.forEach((function(a){for(var i=a.path,o=a.op,c=r,u=0;u<i.length-1;u++)"object"!=typeof(c=s(c,i[u]))&&t(15,i.join("/"));var _=n(c),h=e(a.value),f=i[i.length-1];switch(o){case"replace":switch(_){case 2:return c.set(f,h);case 3:t(16);default:return c[f]=h}case l:switch(_){case 1:return c.splice(f,0,h);case 2:return c.set(f,h);case 3:return c.add(h);default:return c[f]=h}case"remove":switch(_){case 1:return c.splice(f,1);case 2:return c.delete(f);case 3:return c.delete(a.value);default:return delete c[f]}default:t(17,o)}})),r},F:function(e,t,r,n){switch(e.t){case 0:case 4:case 2:return function(e,t,r,n){var c=e.u,u=e.i;i(e.D,(function(e,i){var _=s(c,e),h=s(u,e),f=i?o(c,e)?"replace":l:"remove";if(_!==h||"replace"!==f){var d=t.concat(e);r.push("remove"===f?{op:f,path:d}:{op:f,path:d,value:h}),n.push(f===l?{op:"remove",path:d}:"remove"===f?{op:l,path:d,value:a(_)}:{op:"replace",path:d,value:a(_)})}}))}(e,t,r,n);case 5:case 1:return function(e,t,r,i){var n=e.u,o=e.D,s=e.i;if(s.length<n.length){var c=[s,n];n=c[0],s=c[1];var u=[i,r];r=u[0],i=u[1]}for(var _=s.length-n.length,h=0;n[h]===s[h]&&h<n.length;)++h;for(var f=n.length;f>h&&n[f-1]===s[f+_-1];)--f;for(var d=h;d<f;++d)if(o[d]&&s[d]!==n[d]){var p=t.concat([d]);r.push({op:"replace",path:p,value:a(s[d])}),i.push({op:"replace",path:p,value:a(n[d])})}for(var m=r.length,g=f+_-1;g>=f;--g){var y=t.concat([g]);r[m+g-f]={op:l,path:y,value:a(s[g])},i.push({op:"remove",path:y})}}(e,t,r,n);case 3:return function(e,t,r,a){var i=e.u,n=e.i,o=0;i.forEach((function(e){if(!n.has(e)){var i=t.concat([o]);r.push({op:"remove",path:i,value:e}),a.unshift({op:l,path:i,value:e})}o++})),o=0,n.forEach((function(e){if(!i.has(e)){var n=t.concat([o]);r.push({op:l,path:n,value:e}),a.unshift({op:"remove",path:n,value:e})}o++}))}(e,t,r,n)}},g:function(e,t,r,a){r.push({op:"replace",path:[],value:t}),a.push({op:"replace",path:[],value:e.u})}})}function L(){function e(e,t){function r(){this.constructor=e}o(e,t),e.prototype=(r.prototype=t.prototype,new r)}function r(e){e.i||(e.D=new Map,e.i=new Map(e.u))}function i(e){e.i||(e.i=new Set,e.u.forEach((function(t){if(a(t)){var r=P(e.A.l,t,e);e.p.set(t,r),e.i.add(r)}else e.i.add(t)})))}function n(e){e.O&&t(3,JSON.stringify(_(e)))}var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},s=function(){function t(e,t){return this[G]={t:2,h:t,A:t?t.A:y(),M:!1,R:!1,i:void 0,D:void 0,u:e,k:this,$:!1,O:!1},this}e(t,Map);var i=t.prototype;return Object.defineProperty(i,"size",{get:function(){return _(this[G]).size}}),i.has=function(e){return _(this[G]).has(e)},i.set=function(e,t){var a=this[G];return n(a),_(a).get(e)!==t&&(r(a),w(a.A.l,a),a.D.set(e,!0),a.i.set(e,t),a.D.set(e,!0)),this},i.delete=function(e){if(!this.has(e))return!1;var t=this[G];return n(t),r(t),w(t.A.l,t),t.D.set(e,!1),t.i.delete(e),!0},i.clear=function(){var e=this[G];return n(e),r(e),w(e.A.l,e),e.D=new Map,e.i.clear()},i.forEach=function(e,t){var r=this;_(this[G]).forEach((function(a,i){e.call(t,r.get(i),i,r)}))},i.get=function(e){var t=this[G];n(t);var i=_(t).get(e);if(t.R||!a(i))return i;if(i!==t.u.get(e))return i;var o=P(t.A.l,i,t);return r(t),t.i.set(e,o),o},i.keys=function(){return _(this[G]).keys()},i.values=function(){var e,t=this,r=this.keys();return(e={})[z]=function(){return t.values()},e.next=function(){var e=r.next();return e.done?e:{done:!1,value:t.get(e.value)}},e},i.entries=function(){var e,t=this,r=this.keys();return(e={})[z]=function(){return t.entries()},e.next=function(){var e=r.next();if(e.done)return e;var a=t.get(e.value);return{done:!1,value:[e.value,a]}},e},i[z]=function(){return this.entries()},t}(),l=function(){function t(e,t){return this[G]={t:3,h:t,A:t?t.A:y(),M:!1,R:!1,i:void 0,u:e,k:this,p:new Map,O:!1,$:!1},this}e(t,Set);var r=t.prototype;return Object.defineProperty(r,"size",{get:function(){return _(this[G]).size}}),r.has=function(e){var t=this[G];return n(t),t.i?!!t.i.has(e)||!(!t.p.has(e)||!t.i.has(t.p.get(e))):t.u.has(e)},r.add=function(e){var t=this[G];return n(t),this.has(e)||(i(t),w(t.A.l,t),t.i.add(e)),this},r.delete=function(e){if(!this.has(e))return!1;var t=this[G];return n(t),i(t),w(t.A.l,t),t.i.delete(e)||!!t.p.has(e)&&t.i.delete(t.p.get(e))},r.clear=function(){var e=this[G];return n(e),i(e),w(e.A.l,e),e.i.clear()},r.values=function(){var e=this[G];return n(e),i(e),e.i.values()},r.entries=function(){var e=this[G];return n(e),i(e),e.i.entries()},r.keys=function(){return this.values()},r[z]=function(){return this.values()},r.forEach=function(e,t){for(var r=this.values(),a=r.next();!a.done;)e.call(t,a.value,a.value,this),a=r.next()},t}();g("MapSet",{K:function(e,t){return new s(e,t)},N:function(e,t){return new l(e,t)}})}var O,H,J="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),B="undefined"!=typeof Map,U="undefined"!=typeof Set,k="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,V=J?Symbol("immer-nothing"):((O={})["immer-nothing"]=!0,O),j=J?Symbol("immer-draftable"):"__$immer_draftable",G=J?Symbol("immer-state"):"__$immer_state",z="undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator",X="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,Y={},W={get:function(e,t){if(t===G)return e;var r=e.p;if(!e.M&&o(r,t))return r[t];var i=_(e)[t];if(e.R||!a(i))return i;if(e.M){if(i!==A(e.u,t))return i;r=e.i}return r[t]=P(e.A.l,i,e)},has:function(e,t){return t in _(e)},ownKeys:function(e){return Reflect.ownKeys(_(e))},set:function(e,t,r){if(!e.M){var a=A(e.u,t);if(r?l(a,r)||r===e.p[t]:l(a,r)&&t in e.u)return!0;M(e),D(e)}return e.D[t]=!0,e.i[t]=r,!0},deleteProperty:function(e,t){return void 0!==A(e.u,t)||t in e.u?(e.D[t]=!1,M(e),D(e)):e.D[t]&&delete e.D[t],e.i&&delete e.i[t],!0},getOwnPropertyDescriptor:function(e,t){var r=_(e),a=Reflect.getOwnPropertyDescriptor(r,t);return a&&(a.writable=!0,a.configurable=1!==e.t||"length"!==t),a},defineProperty:function(){t(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.u)},setPrototypeOf:function(){t(12)}},q={};i(W,(function(e,t){q[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),q.deleteProperty=function(e,t){return W.deleteProperty.call(this,e[0],t)},q.set=function(e,t,r){return W.set.call(this,e[0],t,r,e[0])};var Q=function(){function e(e){this.S=k,this.J=!1,"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),this.produce=this.produce.bind(this),this.produceWithPatches=this.produceWithPatches.bind(this)}var i=e.prototype;return i.produce=function(e,r,i){if("function"==typeof e&&"function"!=typeof r){var n=r;r=e;var o=this;return function(e){var t=this;void 0===e&&(e=n);for(var a=arguments.length,i=Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];return o.produce(e,(function(e){var a;return(a=r).call.apply(a,[t,e].concat(i))}))}}var s;if("function"!=typeof r&&t(6),void 0!==i&&"function"!=typeof i&&t(7),a(e)){var l=E(this),c=P(this,e,void 0),u=!0;try{s=r(c),u=!1}finally{u?S(l):b(l)}return"undefined"!=typeof Promise&&s instanceof Promise?s.then((function(e){return v(l,i),x(e,l)}),(function(e){throw S(l),e})):(v(l,i),x(s,l))}if((s=r(e))!==V)return void 0===s&&(s=e),this.J&&f(s,!0),s},i.produceWithPatches=function(e,t){var r,a,i=this;return"function"==typeof e?function(t){for(var r=arguments.length,a=Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];return i.produceWithPatches(t,(function(t){return e.apply(void 0,[t].concat(a))}))}:[this.produce(e,t,(function(e,t){r=e,a=t})),r,a]},i.createDraft=function(e){a(e)||t(8);var r=E(this),i=P(this,e,void 0);return i[G].$=!0,b(r),i},i.finishDraft=function(e,t){var r=(e&&e[G]).A;return v(r,t),x(void 0,r)},i.setAutoFreeze=function(e){this.J=e},i.setUseProxies=function(e){k||t(20),this.S=e},i.applyPatches=function(e,t){var a;for(a=t.length-1;a>=0;a--){var i=t[a];if(0===i.path.length&&"replace"===i.op){e=i.value;break}}var n=m("Patches").X;return r(e)?n(e,t):this.produce(e,(function(e){return n(e,t.slice(a+1))}))},e}(),K=new Q,Z=K.produce,$=K.produceWithPatches.bind(K),ee=K.setAutoFreeze.bind(K),te=K.setUseProxies.bind(K),re=K.applyPatches.bind(K),ae=K.createDraft.bind(K),ie=K.finishDraft.bind(K);e.Immer=Q,e.applyPatches=re,e.castDraft=function(e){return e},e.castImmutable=function(e){return e},e.createDraft=ae,e.default=Z,e.enableAllPlugins=function(){F(),L(),R()},e.enableES5=F,e.enableMapSet=L,e.enablePatches=R,e.finishDraft=ie,e.immerable=j,e.isDraft=r,e.isDraftable=a,e.nothing=V,e.original=function(e){if(e&&e[G])return e[G].u},e.produce=Z,e.produceWithPatches=$,e.setAutoFreeze=ee,e.setUseProxies=te,Object.defineProperty(e,"__esModule",{value:!0})}));var gapi=window.gapi=window.gapi||{};gapi._bs=(new Date).getTime(),(function(){var n,aa="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},ba=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")},ca=ba(this),da=function(e,t){if(t)e:{var r=ca;e=e.split(".");for(var a=0;a<e.length-1;a++){var i=e[a];if(!(i in r))break e;r=r[i]}(t=t(a=r[e=e[e.length-1]]))!=a&&null!=t&&aa(r,e,{configurable:!0,writable:!0,value:t})}},ha=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}};da("Symbol",(function(e){if(e)return e;var t=function(e,t){this.ca=e,aa(this,"description",{configurable:!0,writable:!0,value:t})};t.prototype.toString=function(){return this.ca};var r=0,a=function(e){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new t("jscomp_symbol_"+(e||"")+"_"+r++,e)};return a})),da("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<t.length;r++){var a=ca[t[r]];"function"==typeof a&&"function"!=typeof a.prototype[e]&&aa(a.prototype,e,{configurable:!0,writable:!0,value:function(){return ia(ha(this))}})}return e}));var ia=function(e){return(e={next:e})[Symbol.iterator]=function(){return this},e},ja=function(e,t){e instanceof String&&(e+="");var r=0,a=!1,i={next:function(){if(!a&&r<e.length){var i=r++;return{value:t(i,e[i]),done:!1}}return a=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i};da("Array.prototype.keys",(function(e){return e||function(){return ja(this,(function(e){return e}))}}));var p=this||self,ka=function(e){var t=typeof e;return"object"!=t?t:e?Array.isArray(e)?"array":t:"null"},la=function(e){var t=ka(e);return"array"==t||"object"==t&&"number"==typeof e.length},ma=function(e){var t=typeof e;return"object"==t&&null!=e||"function"==t},na=function(e,t,r){return e.call.apply(e.bind,arguments)},oa=function(e,t,r){if(!e)throw Error();if(2<arguments.length){var a=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,a),e.apply(t,r)}}return function(){return e.apply(t,arguments)}},pa=function(e,t,r){return(pa=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?na:oa).apply(null,arguments)},qa=function(e,t){function r(){}r.prototype=t.prototype,e.pa=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.B=function(e,r,a){for(var i=Array(arguments.length-2),n=2;n<arguments.length;n++)i[n-2]=arguments[n];return t.prototype[r].apply(e,i)}},ra=function(e){return e},sa=function(e){var t=null,r=p.trustedTypes;if(!r||!r.createPolicy)return t;try{t=r.createPolicy(e,{createHTML:ra,createScript:ra,createScriptURL:ra})}catch(a){p.console&&p.console.error(a.message)}return t},ta;function r(e){if(Error.captureStackTrace)Error.captureStackTrace(this,r);else{var t=Error().stack;t&&(this.stack=t)}e&&(this.message=String(e))}qa(r,Error),r.prototype.name="CustomError";var ua=function(e,t){for(var a="",i=(e=e.split("%s")).length-1,n=0;n<i;n++)a+=e[n]+(n<t.length?t[n]:"%s");r.call(this,a+e[i])};qa(ua,r),ua.prototype.name="AssertionError";var va=function(e,t,r,a){var i="Assertion failed";if(r){i+=": "+r;var n=a}else e&&(i+=": "+e,n=t);throw new ua(""+i,n||[])},wa=function(e,t,r){return e||va("",null,t,Array.prototype.slice.call(arguments,2)),e},xa=function(e,t){throw new ua("Failure"+(e?": "+e:""),Array.prototype.slice.call(arguments,1))},ya=function(e,t,r){"string"!=typeof e&&va("Expected string but got %s: %s.",[ka(e),e],t,Array.prototype.slice.call(arguments,2))},za=Array.prototype.forEach?function(e,t){wa(null!=e.length),Array.prototype.forEach.call(e,t,void 0)}:function(e,t){for(var r=e.length,a="string"==typeof e?e.split(""):e,i=0;i<r;i++)i in a&&t.call(void 0,a[i],i,e)};function Aa(e){var t=e.length;if(0<t){for(var r=Array(t),a=0;a<t;a++)r[a]=e[a];return r}return[]}var Da=function(e,t){e:{try{var r=e&&e.ownerDocument,a=r&&(r.defaultView||r.parentWindow);if((a=a||p).Element&&a.Location){var i=a;break e}}catch(o){}i=null}if(i&&void 0!==i[t]&&(!e||!(e instanceof i[t])&&(e instanceof i.Location||e instanceof i.Element))){if(ma(e))try{var n=e.constructor.displayName||e.constructor.name||Object.prototype.toString.call(e)}catch(o){n="<object could not be stringified>"}else n=void 0===e?"undefined":null===e?"null":typeof e;xa("Argument is not a %s (or a non-Element, non-Location mock); got: %s",t,n)}return e},Ea=/&/g,Fa=/</g,Ga=/>/g,Ha=/"/g,Ia=/'/g,Ja=/\x00/g,Ka=/[\x00&<>"']/,w;e:{var La=p.navigator;if(La){var Ma=La.userAgent;if(Ma){w=Ma;break e}}w=""}var Na=function(e,t){for(var r in e)t.call(void 0,e[r],r,e)},Oa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),Pa=function(e,t){for(var r,a,i=1;i<arguments.length;i++){for(r in a=arguments[i])e[r]=a[r];for(var n=0;n<Oa.length;n++)r=Oa[n],Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}},Qa,x=function(e,t){this.S=e===Ra&&t||"",this.da=Sa};x.prototype.F=!0,x.prototype.D=function(){return this.S},x.prototype.toString=function(){return"Const{"+this.S+"}"};var Ta=function(e){return e instanceof x&&e.constructor===x&&e.da===Sa?e.S:(xa("expected object of type Const, got '"+e+"'"),"type_error:Const")},Sa={},Ra={},y=function(e,t){this.P=t===Ua?e:""};y.prototype.F=!0,y.prototype.D=function(){return this.P.toString()},y.prototype.toString=function(){return this.P.toString()};var Va=function(e){return e instanceof y&&e.constructor===y?e.P:(xa("expected object of type SafeUrl, got '"+e+"' of type "+ka(e)),"type_error:SafeUrl")},Wa=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i,Xa=function(e){return e instanceof y?e:(e="object"==typeof e&&e.F?e.D():String(e),wa(Wa.test(e),"%s does not match the safe URL pattern",e)||(e="about:invalid#zClosurez"),new y(e,Ua))},Ua={},B=function(e,t,r){this.O=r===Ya?e:""};B.prototype.F=!0,B.prototype.D=function(){return this.O.toString()},B.prototype.toString=function(){return this.O.toString()};var Za=function(e){return e instanceof B&&e.constructor===B?e.O:(xa("expected object of type SafeHtml, got '"+e+"' of type "+ka(e)),"type_error:SafeHtml")},Ya={},$a=new B(p.trustedTypes&&p.trustedTypes.emptyHTML||"",0,Ya),ab={MATH:!0,SCRIPT:!0,STYLE:!0,SVG:!0,TEMPLATE:!0},bb=(b=!1,function(){return b||(c=function(){if("undefined"==typeof document)return!1;var e=document.createElement("div"),t=document.createElement("div");return t.appendChild(document.createElement("div")),e.appendChild(t),!!e.firstChild&&(t=e.firstChild.firstChild,e.innerHTML=Za($a),!t.parentElement)}(),b=!0),c}),c,b,cb=function(e){return Ka.test(e)&&(-1!=e.indexOf("&")&&(e=e.replace(Ea,"&amp;")),-1!=e.indexOf("<")&&(e=e.replace(Fa,"&lt;")),-1!=e.indexOf(">")&&(e=e.replace(Ga,"&gt;")),-1!=e.indexOf('"')&&(e=e.replace(Ha,"&quot;")),-1!=e.indexOf("'")&&(e=e.replace(Ia,"&#39;")),-1!=e.indexOf("\0")&&(e=e.replace(Ja,"&#0;"))),e},db=-1!=w.indexOf("Opera"),eb=-1!=w.indexOf("Trident")||-1!=w.indexOf("MSIE"),fb=-1!=w.indexOf("Edge"),gb=!(-1==w.indexOf("Gecko")||-1!=w.toLowerCase().indexOf("webkit")&&-1==w.indexOf("Edge")||-1!=w.indexOf("Trident")||-1!=w.indexOf("MSIE")||-1!=w.indexOf("Edge")),hb=-1!=w.toLowerCase().indexOf("webkit")&&-1==w.indexOf("Edge"),ib=function(){var e=p.document;return e?e.documentMode:void 0},jb,a;e:{var kb="",lb=(a=w,gb?/rv:([^\);]+)(\)|;)/.exec(a):fb?/Edge\/([\d\.]+)/.exec(a):eb?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):hb?/WebKit\/(\S+)/.exec(a):db?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(lb&&(kb=lb?lb[1]:""),eb){var mb=ib();if(null!=mb&&mb>parseFloat(kb)){jb=String(mb);break e}}jb=kb}var nb=jb,ob;if(p.document&&eb){var pb=ib();ob=pb||parseInt(nb,10)||void 0}else ob=void 0;var qb=ob,rb;(rb=!eb)||(rb=9<=Number(qb));var sb=rb,ub=function(e,t){Na(t,(function(t,r){t&&"object"==typeof t&&t.F&&(t=t.D()),"style"==r?e.style.cssText=t:"class"==r?e.className=t:"for"==r?e.htmlFor=t:tb.hasOwnProperty(r)?e.setAttribute(tb[r],t):0==r.lastIndexOf("aria-",0)||0==r.lastIndexOf("data-",0)?e.setAttribute(r,t):e[r]=t}))},tb={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"},vb=function(e,t,r,a){function i(r){r&&t.appendChild("string"==typeof r?e.createTextNode(r):r)}for(;a<r.length;a++){var n=r[a];if(!la(n)||ma(n)&&0<n.nodeType)i(n);else{e:{if(n&&"number"==typeof n.length){if(ma(n)){var o="function"==typeof n.item||"string"==typeof n.item;break e}if("function"==typeof n){o="function"==typeof n.item;break e}}o=!1}za(o?Aa(n):n,i)}}},wb=function(e,t){return t=String(t),"application/xhtml+xml"===e.contentType&&(t=t.toLowerCase()),e.createElement(t)},xb=function(e){return wa(e,"Node cannot be null or undefined."),9==e.nodeType?e:e.ownerDocument||e.document},yb=function(e){this.C=e||p.document||document};n=yb.prototype,n.getElementsByTagName=function(e,t){return(t||this.C).getElementsByTagName(String(e))},n.ga=function(e,t,r){var a=this.C,i=arguments,n=String(i[0]),o=i[1];if(!sb&&o&&(o.name||o.type)){if(n=["<",n],o.name&&n.push(' name="',cb(o.name),'"'),o.type){n.push(' type="',cb(o.type),'"');var s={};Pa(s,o),delete s.type,o=s}n.push(">"),n=n.join("")}return n=wb(a,n),o&&("string"==typeof o?n.className=o:Array.isArray(o)?n.className=o.join(" "):ub(n,o)),2<i.length&&vb(a,n,i,2),n},n.createElement=function(e){return wb(this.C,e)},n.createTextNode=function(e){return this.C.createTextNode(String(e))},n.appendChild=function(e,t){wa(null!=e&&null!=t,"goog.dom.appendChild expects non-null arguments"),e.appendChild(t)},n.append=function(e,t){vb(xb(e),e,arguments,1)},n.canHaveChildren=function(e){if(1!=e.nodeType)return!1;switch(e.tagName){case"APPLET":case"AREA":case"BASE":case"BR":case"COL":case"COMMAND":case"EMBED":case"FRAME":case"HR":case"IMG":case"INPUT":case"IFRAME":case"ISINDEX":case"KEYGEN":case"LINK":case"NOFRAMES":case"NOSCRIPT":case"META":case"OBJECT":case"PARAM":case"SCRIPT":case"SOURCE":case"STYLE":case"TRACK":case"WBR":return!1}return!0},n.removeNode=function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null},n.contains=function(e,t){if(!e||!t)return!1;if(e.contains&&1==t.nodeType)return e==t||e.contains(t);if(void 0!==e.compareDocumentPosition)return e==t||!!(16&e.compareDocumentPosition(t));for(;t&&e!=t;)t=t.parentNode;return t==e};var C=window,D=document,zb=C.location,Ab=function(){},Bb=/\[native code\]/,E=function(e,t,r){return e[t]=e[t]||r},Cb=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1},Db=function(e){e=e.sort();for(var t=[],r=void 0,a=0;a<e.length;a++){var i=e[a];i!=r&&t.push(i),r=i}return t},Eb=/&/g,Fb=/</g,Gb=/>/g,Hb=/"/g,Ib=/'/g,Jb=function(e){return String(e).replace(Eb,"&amp;").replace(Fb,"&lt;").replace(Gb,"&gt;").replace(Hb,"&quot;").replace(Ib,"&#39;")},F=function(){var e;if((e=Object.create)&&Bb.test(e))e=e(null);else for(var t in e={})e[t]=void 0;return e},G=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},Kb=function(e){if(Bb.test(Object.keys))return Object.keys(e);var t,r=[];for(t in e)G(e,t)&&r.push(t);return r},H=function(e,t){for(var r in e=e||{})G(e,r)&&(t[r]=e[r])},Lb=function(e){return function(){C.setTimeout(e,0)}},I=function(e,t){if(!e)throw Error(t||"")},J=E(C,"gapi",{}),K=function(e,t,r){var a=new RegExp("([#].*&|[#])"+t+"=([^&#]*)","g");if(t=new RegExp("([?#].*&|[?#])"+t+"=([^&#]*)","g"),e=e&&(a.exec(e)||t.exec(e)))try{r=decodeURIComponent(e[2])}catch(i){}return r},Mb=new RegExp(/^/.source+/([a-zA-Z][-+.a-zA-Z0-9]*:)?/.source+/(\/\/[^\/?#]*)?/.source+/([^?#]*)?/.source+/(\?([^#]*))?/.source+/(#((#|[^#])*))?/.source+/$/.source),Nb=/[\ud800-\udbff][\udc00-\udfff]|[^!-~]/g,Ob=new RegExp(/(%([^0-9a-fA-F%]|[0-9a-fA-F]([^0-9a-fA-F%])?)?)*/.source+/%($|[^0-9a-fA-F]|[0-9a-fA-F]($|[^0-9a-fA-F]))/.source,"g"),Pb=/%([a-f]|[0-9a-fA-F][a-f])/g,Qb=/^(https?|ftp|file|chrome-extension):$/i,Rb=function(e){e=(e=(e=String(e)).replace(Nb,(function(e){try{return encodeURIComponent(e)}catch(t){return encodeURIComponent(e.replace(/^[^%]+$/g,""))}})).replace(Ob,(function(e){return e.replace(/%/g,"%25")})).replace(Pb,(function(e){return e.toUpperCase()}))).match(Mb)||[];var t=F(),r=function(e){return e.replace(/\\/g,"%5C").replace(/\^/g,"%5E").replace(/`/g,"%60").replace(/\{/g,"%7B").replace(/\|/g,"%7C").replace(/\}/g,"%7D")},a=!!(e[1]||"").match(Qb);return t.B=r((e[1]||"")+(e[2]||"")+(e[3]||(e[2]&&a?"/":""))),a=function(e){return r(e.replace(/\?/g,"%3F").replace(/#/g,"%23"))},t.query=e[5]?[a(e[5])]:[],t.i=e[7]?[a(e[7])]:[],t},Sb=function(e){return e.B+(0<e.query.length?"?"+e.query.join("&"):"")+(0<e.i.length?"#"+e.i.join("&"):"")},Tb=function(e,t){var r=[];if(e)for(var a in e)if(G(e,a)&&null!=e[a]){var i=t?t(e[a]):e[a];r.push(encodeURIComponent(a)+"="+encodeURIComponent(i))}return r},Ub=function(e,t,r,a){return(e=Rb(e)).query.push.apply(e.query,Tb(t,a)),e.i.push.apply(e.i,Tb(r,a)),Sb(e)},Vb=new RegExp(/\/?\??#?/.source+"("+/[\/?#]/i.source+"|"+/[\uD800-\uDBFF]/i.source+"|"+/%[c-f][0-9a-f](%[89ab][0-9a-f]){0,2}(%[89ab]?)?/i.source+"|"+/%[0-9a-f]?/i.source+")$","i"),Wb=function(e,t){var r=Rb(t);t=r.B,r.query.length&&(t+="?"+r.query.join("")),r.i.length&&(t+="#"+r.i.join(""));var a="";2e3<t.length&&(a=t,t=(t=t.substr(0,2e3)).replace(Vb,""),a=a.substr(t.length));var i=e.createElement("div");if(e=e.createElement("a"),t=(r=Rb(t)).B,r.query.length&&(t+="?"+r.query.join("")),r.i.length&&(t+="#"+r.i.join("")),t=new y(t,Ua),Da(e,"HTMLAnchorElement"),t=t instanceof y?t:Xa(t),e.href=Va(t),i.appendChild(e),t=i.innerHTML,r=new x(Ra,"Assignment to self."),ya(Ta(r),"must provide justification"),wa(!/^[\s\xa0]*$/.test(Ta(r)),"must provide non-empty justification"),void 0===Qa&&(Qa=sa("gapi#html")),t=(r=Qa)?r.createHTML(t):t,t=new B(t,null,Ya),i.tagName&&ab[i.tagName.toUpperCase()])throw Error("goog.dom.safe.setInnerHtml cannot be used to set content of "+i.tagName+".");if(bb())for(;i.lastChild;)i.removeChild(i.lastChild);return i.innerHTML=Za(t),t=String(i.firstChild.href),i.parentNode&&i.parentNode.removeChild(i),a=(r=Rb(t+a)).B,r.query.length&&(a+="?"+r.query.join("")),r.i.length&&(a+="#"+r.i.join("")),a},Xb=/^https?:\/\/[^\/%\\?#\s]+\/[^\s]*$/i,Yb,Zb=function(e,t,r,a){C[r+"EventListener"]?C[r+"EventListener"](e,t,!1):C[a+"tachEvent"]&&C[a+"tachEvent"]("on"+e,t)},$b=function(){var e=D.readyState;return"complete"===e||"interactive"===e&&-1==navigator.userAgent.indexOf("MSIE")},cc=function(e){var t=ac;if(!$b())try{t()}catch(c){}bc(e)},bc=function(e){if($b())e();else{var t=!1,r=function(){if(!t)return t=!0,e.apply(this,arguments)};C.addEventListener?(C.addEventListener("load",r,!1),C.addEventListener("DOMContentLoaded",r,!1)):C.attachEvent&&(C.attachEvent("onreadystatechange",(function(){$b()&&r.apply(this,arguments)})),C.attachEvent("onload",r))}},dc=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},ec={button:!0,div:!0,span:!0},L;L=E(C,"___jsl",F()),E(L,"I",0),E(L,"hel",10);var fc=function(e){return L.dpo?L.h:K(e,"jsh",L.h)},gc=function(e){var t=E(L,"sws",[]);t.push.apply(t,e)},hc=function(e){return E(L,"watt",F())[e]},ic=function(e){var t=E(L,"PQ",[]);L.PQ=[];var r=t.length;if(0===r)e();else for(var a=0,i=function(){++a===r&&e()},n=0;n<r;n++)t[n](i)},jc=function(e){return E(E(L,"H",F()),e,F())},kc=E(L,"perf",F()),lc=E(kc,"g",F()),mc=E(kc,"i",F());E(kc,"r",[]),F(),F();var nc=function(e,t,r){var a=kc.r;"function"==typeof a?a(e,t,r):a.push([e,t,r])},M=function(e,t,r){lc[e]=!t&&lc[e]||r||(new Date).getTime(),nc(e)},pc=function(e,t,r){t&&0<t.length&&(t=oc(t),r&&0<r.length&&(t+="___"+oc(r)),28<t.length&&(t=t.substr(0,28)+(t.length-28)),r=t,t=E(mc,"_p",F()),E(t,r,F())[e]=(new Date).getTime(),nc(e,"_p",r))},oc=function(e){return e.join("__").replace(/\./g,"_").replace(/\-/g,"_").replace(/,/g,"_")},qc=F(),rc=[],N=function(e){throw Error("Bad hint"+(e?": "+e:""))};rc.push(["jsl",function(e){for(var t in e)if(G(e,t)){var r=e[t];"object"==typeof r?L[t]=E(L,t,[]).concat(r):E(L,t,r)}(t=e.u)&&((e=E(L,"us",[])).push(t),(t=/^https:(.*)$/.exec(t))&&e.push("http:"+t[1]))}]);var sc=/^(\/[a-zA-Z0-9_\-]+)+$/,tc=[/\/amp\//,/\/amp$/,/^\/amp$/],uc=/^[a-zA-Z0-9\-_\.,!]+$/,vc=/^gapi\.loaded_[0-9]+$/,wc=/^[a-zA-Z0-9,._-]+$/,Ac=function(e,t,r,a){var i=e.split(";"),n=i.shift(),o=qc[n],s=null;return o?s=o(i,t,r,a):N("no hint processor for: "+n),s||N("failed to generate load url"),r=(t=s).match(xc),(a=t.match(yc))&&1===a.length&&zc.test(t)&&r&&1===r.length||N("failed sanity: "+e),s},Dc=function(e,t,r,a){e=Bc(e),vc.test(r)||N("invalid_callback"),t=Cc(t),a=a&&a.length?Cc(a):null;var i=function(e){return encodeURIComponent(e).replace(/%2C/g,",")};return[encodeURIComponent(e.pathPrefix).replace(/%2C/g,",").replace(/%2F/g,"/"),"/k=",i(e.version),"/m=",i(t),a?"/exm="+i(a):"","/rt=j/sv=1/d=1/ed=1",e.U?"/am="+i(e.U):"",e.$?"/rs="+i(e.$):"",e.ba?"/t="+i(e.ba):"","/cb=",i(r)].join("")},Bc=function(e){"/"!==e.charAt(0)&&N("relative path");for(var t=e.substring(1).split("/"),r=[];t.length;){if((e=t.shift()).length&&0!=e.indexOf(".")){if(0<e.indexOf("=")){t.unshift(e);break}}else N("empty/relative directory");r.push(e)}e={};for(var a=0,i=t.length;a<i;++a){var n=t[a].split("="),o=decodeURIComponent(n[0]),s=decodeURIComponent(n[1]);2==n.length&&o&&s&&(e[o]=e[o]||s)}for(t="/"+r.join("/"),sc.test(t)||N("invalid_prefix"),r=0,a=tc.length;r<a;++r)tc[r].test(t)&&N("invalid_prefix");return{pathPrefix:t,version:r=Ec(e,"k",!0),U:a=Ec(e,"am"),$:i=Ec(e,"rs"),ba:e=Ec(e,"t")}},Cc=function(e){for(var t=[],r=0,a=e.length;r<a;++r){var i=e[r].replace(/\./g,"_").replace(/-/g,"_");wc.test(i)&&t.push(i)}return t.join(",")},Ec=function(e,t,r){if(!(e=e[t])&&r&&N("missing: "+t),e){if(uc.test(e))return e;N("invalid: "+t)}return null},zc=/^https?:\/\/[a-z0-9_.-]+\.google(rs)?\.com(:\d+)?\/[a-zA-Z0-9_.,!=\-\/]+$/,yc=/\/cb=/g,xc=/\/\//g,Fc=function(){var e=fc(zb.href);if(!e)throw Error("Bad hint");return e};qc.m=function(e,t,r,a){return(e=e[0])||N("missing_hint"),"https://apis.google.com"+Dc(e,t,r,a)};var Gc=decodeURI("%73cript"),Hc=/^[-+_0-9\/A-Za-z]+={0,2}$/,Ic=function(e,t){for(var r=[],a=0;a<e.length;++a){var i=e[a];i&&0>Cb.call(t,i)&&r.push(i)}return r},Jc=function(){var e=L.nonce;return void 0!==e?e&&e===String(e)&&e.match(Hc)?e:L.nonce=null:D.querySelector&&(e=D.querySelector("script[nonce]"))?(e=e.nonce||e.getAttribute("nonce")||"",L.nonce=e&&e===String(e)&&e.match(Hc)?e:null):null},Mc=function(e){if("loading"!=D.readyState)Kc(e);else{var t=Jc(),r="";null!==t&&(r=' nonce="'+t+'"'),e="<"+Gc+' src="'+encodeURI(e)+'"'+r+"></"+Gc+">",D.write(Lc?Lc.createHTML(e):e)}},Kc=function(e){var t=D.createElement(Gc);t.setAttribute("src",Lc?Lc.createScriptURL(e):e),null!==(e=Jc())&&t.setAttribute("nonce",e),t.async="true",(e=D.getElementsByTagName(Gc)[0])?e.parentNode.insertBefore(t,e):(D.head||D.body||D.documentElement).appendChild(t)},Nc=function(e,t){var r=t&&t._c;if(r)for(var a=0;a<rc.length;a++){var i=rc[a][0],n=rc[a][1];n&&G(r,i)&&n(r[i],e,t)}},Pc=function(e,t,r){Oc((function(){var r=t===fc(zb.href)?E(J,"_",F()):F();r=E(jc(t),"_",r),e(r)}),r)},Rc=function(e,t){var r=t||{};"function"==typeof t&&((r={}).callback=t),Nc(e,r),t=e?e.split(":"):[];var a=r.h||Fc(),i=E(L,"ah",F());if(i["::"]&&t.length){e=[];for(var n=null;n=t.shift();){var o=n.split(".");o=i[n]||i[o[1]&&"ns:"+o[0]||""]||a;var s=e.length&&e[e.length-1]||null,l=s;s&&s.hint==o||e.push(l={hint:o,features:[]}),l.features.push(n)}var c=e.length;if(1<c){var u=r.callback;u&&(r.callback=function(){0==--c&&u()})}for(;t=e.shift();)Qc(t.features,r,t.hint)}else Qc(t||[],r,a)},Qc=function(e,t,r){e=Db(e)||[];var a=t.callback,i=t.config,n=t.timeout,o=t.ontimeout,s=t.onerror,l=void 0;"function"==typeof s&&(l=s);var c=null,u=!1;if(n&&!o||!n&&o)throw"Timeout requires both the timeout parameter and ontimeout parameter to be set";s=E(jc(r),"r",[]).sort();var _=E(jc(r),"L",[]).sort(),h=[].concat(s),f=function(e,t){if(u)return 0;C.clearTimeout(c),_.push.apply(_,d);var a=((J||{}).config||{}).update;if(a?a(i):i&&E(L,"cu",[]).push(i),t){pc("me0",e,h);try{Pc(t,r,l)}finally{pc("me1",e,h)}}return 1};0<n&&(c=C.setTimeout((function(){u=!0,o()}),n));var d=Ic(e,_);if(d.length){d=Ic(e,s);var p=E(L,"CP",[]),m=p.length;if(p[m]=function(e){if(!e)return 0;pc("ml1",d,h);var t=function(t){p[m]=null,f(d,e)&&ic((function(){a&&a(),t()}))},r=function(){var e=p[m+1];e&&e()};0<m&&p[m-1]?p[m]=function(){t(r)}:t(r)},d.length){var g="loaded_"+L.I++;J[g]=function(e){p[m](e),J[g]=null},e=Ac(r,d,"gapi."+g,s),s.push.apply(s,d),pc("ml0",d,h),t.sync||C.___gapisync?Mc(e):Kc(e)}else p[m](Ab)}else f(d)&&a&&a()},Lc=sa("gapi#gapi"),Oc=function(e,t){if(L.hee&&0<L.hel)try{return e()}catch(c){t&&t(c),L.hel--,Rc("debug_error",(function(){try{window.___jsl.hefn(c)}catch(t){throw c}}))}else try{return e()}catch(c){throw t&&t(c),c}};J.load=function(e,t){return Oc((function(){return Rc(e,t)}))};var Sc=function(e){var t=window.___jsl=window.___jsl||{};return t[e]=t[e]||[],t[e]},Tc=function(e){var t=window.___jsl=window.___jsl||{};return t.cfg=!e&&t.cfg||{},t.cfg},Uc=function(e){return"object"==typeof e&&/\[native code\]/.test(e.push)},O=function(e,t,r){if(t&&"object"==typeof t)for(var a in t)!Object.prototype.hasOwnProperty.call(t,a)||r&&"___goc"===a&&void 0===t[a]||(e[a]&&t[a]&&"object"==typeof e[a]&&"object"==typeof t[a]&&!Uc(e[a])&&!Uc(t[a])?O(e[a],t[a]):t[a]&&"object"==typeof t[a]?(e[a]=Uc(t[a])?[]:{},O(e[a],t[a])):e[a]=t[a])},Vc=function(e){if(e&&!/^\s+$/.test(e)){for(;0==e.charCodeAt(e.length-1);)e=e.substring(0,e.length-1);try{var t=window.JSON.parse(e)}catch(c){}if("object"==typeof t)return t;try{t=new Function("return ("+e+"\n)")()}catch(c){}if("object"==typeof t)return t;try{t=new Function("return ({"+e+"\n})")()}catch(c){}return"object"==typeof t?t:{}}},Wc=function(e,t){var r={___goc:void 0};e.length&&e[e.length-1]&&Object.hasOwnProperty.call(e[e.length-1],"___goc")&&void 0===e[e.length-1].___goc&&(r=e.pop()),O(r,t),e.push(r)},Xc=function(e){Tc(!0);var t=window.___gcfg,r=Sc("cu"),a=window.___gu;t&&t!==a&&(Wc(r,t),window.___gu=t),t=Sc("cu");var i=document.scripts||document.getElementsByTagName("script")||[];a=[];var n=[];n.push.apply(n,Sc("us"));for(var o=0;o<i.length;++o)for(var s=i[o],l=0;l<n.length;++l)s.src&&0==s.src.indexOf(n[l])&&a.push(s);for(0==a.length&&0<i.length&&i[i.length-1].src&&a.push(i[i.length-1]),i=0;i<a.length;++i)a[i].getAttribute("gapi_processed")||(a[i].setAttribute("gapi_processed",!0),n=(n=a[i])?3==(o=n.nodeType)||4==o?n.nodeValue:n.textContent||"":void 0,(n=Vc(n))&&t.push(n));for(e&&Wc(r,e),e=0,t=(a=Sc("cd")).length;e<t;++e)O(Tc(),a[e],!0);for(e=0,t=(a=Sc("ci")).length;e<t;++e)O(Tc(),a[e],!0);for(e=0,t=r.length;e<t;++e)O(Tc(),r[e],!0)},Q=function(e){var t=Tc();if(!e)return t;for(var r=0,a=(e=e.split("/")).length;t&&"object"==typeof t&&r<a;++r)t=t[e[r]];return r===e.length&&void 0!==t?t:void 0},Yc=function(e,t){var r;if("string"==typeof e){for(var a=r={},i=0,n=(e=e.split("/")).length;i<n-1;++i)a=a[e[i]]={};a[e[i]]=t}else r=e;Xc(r)},Zc=function(){var e=window.__GOOGLEAPIS;e&&(e.googleapis&&!e["googleapis.config"]&&(e["googleapis.config"]=e.googleapis),E(L,"ci",[]).push(e),window.__GOOGLEAPIS=void 0)},$c={callback:1,clientid:1,cookiepolicy:1,openidrealm:-1,includegrantedscopes:-1,requestvisibleactions:1,scope:1},ad=!1,bd=F(),cd=function(){if(!ad){for(var e=document.getElementsByTagName("meta"),t=0;t<e.length;++t){var r=e[t].name.toLowerCase();if(0==r.lastIndexOf("google-signin-",0)){r=r.substring(14);var a=e[t].content;$c[r]&&a&&(bd[r]=a)}}if(window.self!==window.top)for(var i in e=document.location.toString(),$c)0<$c[i]&&(t=K(e,i,""))&&(bd[i]=t);ad=!0}return i=F(),H(bd,i),i},dd=function(e){return!!(e.clientid&&e.scope&&e.callback)},ed=window.console,fd=function(e){ed&&ed.log&&ed.log(e)},gd=function(){return!!L.oa},hd=function(){},R=E(L,"rw",F()),id=function(e){for(var t in R)e(R[t])},jd=function(e,t){(e=R[e])&&e.state<t&&(e.state=t)},S=function(e){var t=window.___jsl=window.___jsl||{};if(t.cfg=t.cfg||{},t=t.cfg,!e)return t;for(var r=0,a=(e=e.split("/")).length;t&&"object"==typeof t&&r<a;++r)t=t[e[r]];return r===e.length&&void 0!==t?t:void 0},kd=/^https?:\/\/(?:\w|[\-\.])+\.google\.(?:\w|[\-:\.])+(?:\/[^\?#]*)?\/u\/(\d)\//,ld=/^https?:\/\/(?:\w|[\-\.])+\.google\.(?:\w|[\-:\.])+(?:\/[^\?#]*)?\/b\/(\d{10,21})\//,md=function(e){var t=S("googleapis.config/sessionIndex");if("string"==typeof t&&254<t.length&&(t=null),null==t&&(t=window.__X_GOOG_AUTHUSER),"string"==typeof t&&254<t.length&&(t=null),null==t){var r=window.google;r&&(t=r.authuser)}return"string"==typeof t&&254<t.length&&(t=null),null==t&&(e=e||window.location.href,null==(t=K(e,"authuser")||null)&&(t=(t=e.match(kd))?t[1]:null)),null==t?null:(254<(t=String(t)).length&&(t=null),t)},nd=function(e){var t=S("googleapis.config/sessionDelegate");return"string"==typeof t&&21<t.length&&(t=null),null==t&&(t=(e=(e||window.location.href).match(ld))?e[1]:null),null==t?null:(21<(t=String(t)).length&&(t=null),t)},od,T,U=void 0,V=function(e){try{return p.JSON.parse.call(p.JSON,e)}catch(b){return!1}},W=function(e){return Object.prototype.toString.call(e)},pd=W(0),qd=W(new Date(0)),rd=W(!0),sd=W(""),td=W({}),ud=W([]),X=function(e,t){if(t)for(var r=0,a=t.length;r<a;++r)if(e===t[r])throw new TypeError("Converting circular structure to JSON");if("undefined"!=(a=typeof e)){(r=Array.prototype.slice.call(t||[],0))[r.length]=e,t=[];var i=W(e);if(null!=e&&"function"==typeof e.toJSON&&(Object.prototype.hasOwnProperty.call(e,"toJSON")||(i!==ud||e.constructor!==Array&&e.constructor!==Object)&&(i!==td||e.constructor!==Array&&e.constructor!==Object)&&i!==sd&&i!==pd&&i!==rd&&i!==qd))return X(e.toJSON.call(e),r);if(null==e)t[t.length]="null";else if(i===pd)e=Number(e),isNaN(e)||isNaN(e-e)?e="null":-0===e&&0>1/e&&(e="-0"),t[t.length]=String(e);else if(i===rd)t[t.length]=String(!!Number(e));else{if(i===qd)return X(e.toISOString.call(e),r);if(i===ud&&W(e.length)===pd){t[t.length]="[";var n=0;for(a=Number(e.length)>>0;n<a;++n)n&&(t[t.length]=","),t[t.length]=X(e[n],r)||"null";t[t.length]="]"}else if(i==sd&&W(e.length)===pd){for(t[t.length]='"',n=0,r=Number(e.length)>>0;n<r;++n)a=String.prototype.charAt.call(e,n),i=String.prototype.charCodeAt.call(e,n),t[t.length]="\b"===a?"\\b":"\f"===a?"\\f":"\n"===a?"\\n":"\r"===a?"\\r":"\t"===a?"\\t":"\\"===a||'"'===a?"\\"+a:31>=i?"\\u"+(i+65536).toString(16).substr(1):32<=i&&65535>=i?a:"";t[t.length]='"'}else{if("object"!==a)return;for(n in t[t.length]="{",a=0,e)Object.prototype.hasOwnProperty.call(e,n)&&void 0!==(i=X(e[n],r))&&(a++&&(t[t.length]=","),t[t.length]=X(n),t[t.length]=":",t[t.length]=i);t[t.length]="}"}}return t.join("")}},vd=/[\0-\x07\x0b\x0e-\x1f]/,wd=/^([^"]*"([^\\"]|\\.)*")*[^"]*"([^"\\]|\\.)*[\0-\x1f]/,xd=/^([^"]*"([^\\"]|\\.)*")*[^"]*"([^"\\]|\\.)*\\[^\\\/"bfnrtu]/,yd=/^([^"]*"([^\\"]|\\.)*")*[^"]*"([^"\\]|\\.)*\\u([0-9a-fA-F]{0,3}[^0-9a-fA-F])/,zd=/"([^\0-\x1f\\"]|\\[\\\/"bfnrt]|\\u[0-9a-fA-F]{4})*"/g,Ad=/-?(0|[1-9][0-9]*)(\.[0-9]+)?([eE][-+]?[0-9]+)?/g,Bd=/[ \t\n\r]+/g,Cd=/[^"]:/,Dd=/""/g,Ed=/true|false|null/g,Fd=/00/,Gd=/[\{]([^0\}]|0[^:])/,Hd=/(^|\[)[,:]|[,:](\]|\}|[,:]|$)/,Id=/[^\[,:][\[\{]/,Jd=/^(\{|\}|\[|\]|,|:|0)+/,Kd=/\u2028/g,Ld=/\u2029/g,Md=function(a){if(a=String(a),vd.test(a)||wd.test(a)||xd.test(a)||yd.test(a))return!1;var b=a.replace(zd,'""');if(b=b.replace(Ad,"0"),b=b.replace(Bd,""),Cd.test(b))return!1;if(b=b.replace(Dd,"0"),b=b.replace(Ed,"0"),Fd.test(b)||Gd.test(b)||Hd.test(b)||Id.test(b)||!b||(b=b.replace(Jd,"")))return!1;a=a.replace(Kd,"\\u2028").replace(Ld,"\\u2029"),b=void 0;try{b=U?[V(a)]:eval("(function (var_args) {\n  return Array.prototype.slice.call(arguments, 0);\n})(\n"+a+"\n)")}catch(c){return!1}return!(!b||1!==b.length)&&b[0]},Nd=function(){var e=((p.document||{}).scripts||[]).length;if((void 0===od||void 0===U||T!==e)&&-1!==T){od=U=!1,T=-1;try{try{U=!!p.JSON&&'{"a":[3,true,"1970-01-01T00:00:00.000Z"]}'===p.JSON.stringify.call(p.JSON,{a:[3,!0,new Date(0)],c:function(){}})&&!0===V("true")&&3===V('[{"a":3}]')[0].a}catch(b){}od=U&&!V("[00]")&&!V('""')&&!V('"\\0"')&&!V('"\\v"')}finally{T=e}}},Od=function(e){return-1!==T&&(Nd(),(od?V:Md)(e))},Pd=function(e){if(-1!==T)return Nd(),U?p.JSON.stringify.call(p.JSON,e):X(e)},Qd=!Date.prototype.toISOString||"function"!=typeof Date.prototype.toISOString||"1970-01-01T00:00:00.000Z"!==new Date(0).toISOString(),Rd=function(){var e=Date.prototype.getUTCFullYear.call(this);return[0>e?"-"+String(1e6-e).substr(1):9999>=e?String(1e4+e).substr(1):"+"+String(1e6+e).substr(1),"-",String(101+Date.prototype.getUTCMonth.call(this)).substr(1),"-",String(100+Date.prototype.getUTCDate.call(this)).substr(1),"T",String(100+Date.prototype.getUTCHours.call(this)).substr(1),":",String(100+Date.prototype.getUTCMinutes.call(this)).substr(1),":",String(100+Date.prototype.getUTCSeconds.call(this)).substr(1),".",String(1e3+Date.prototype.getUTCMilliseconds.call(this)).substr(1),"Z"].join("")};Date.prototype.toISOString=Qd?Rd:Date.prototype.toISOString;var Sd=function(){this.l=-1},Td=function(){this.l=64,this.g=[],this.L=[],this.ea=[],this.H=[],this.H[0]=128;for(var e=1;e<this.l;++e)this.H[e]=0;this.J=this.v=0,this.reset()};qa(Td,Sd),Td.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.g[4]=3285377520,this.J=this.v=0};var Ud=function(e,t,r){r||(r=0);var a=e.ea;if("string"==typeof t)for(var i=0;16>i;i++)a[i]=t.charCodeAt(r)<<24|t.charCodeAt(r+1)<<16|t.charCodeAt(r+2)<<8|t.charCodeAt(r+3),r+=4;else for(i=0;16>i;i++)a[i]=t[r]<<24|t[r+1]<<16|t[r+2]<<8|t[r+3],r+=4;for(i=16;80>i;i++){var n=a[i-3]^a[i-8]^a[i-14]^a[i-16];a[i]=4294967295&(n<<1|n>>>31)}t=e.g[0],r=e.g[1];var o=e.g[2],s=e.g[3],l=e.g[4];for(i=0;80>i;i++){if(40>i)if(20>i){n=s^r&(o^s);var c=1518500249}else n=r^o^s,c=1859775393;else 60>i?(n=r&o|s&(r|o),c=2400959708):(n=r^o^s,c=3395469782);n=(t<<5|t>>>27)+n+l+c+a[i]&4294967295,l=s,s=o,o=4294967295&(r<<30|r>>>2),r=t,t=n}e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+r&4294967295,e.g[2]=e.g[2]+o&4294967295,e.g[3]=e.g[3]+s&4294967295,e.g[4]=e.g[4]+l&4294967295};Td.prototype.update=function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var r=t-this.l,a=0,i=this.L,n=this.v;a<t;){if(0==n)for(;a<=r;)Ud(this,e,a),a+=this.l;if("string"==typeof e){for(;a<t;)if(i[n]=e.charCodeAt(a),++a,++n==this.l){Ud(this,i),n=0;break}}else for(;a<t;)if(i[n]=e[a],++a,++n==this.l){Ud(this,i),n=0;break}}this.v=n,this.J+=t}},Td.prototype.digest=function(){var e=[],t=8*this.J;this.update(this.H,56>this.v?56-this.v:this.l-(this.v-56));for(var r=this.l-1;56<=r;r--)this.L[r]=255&t,t/=256;for(Ud(this,this.L),r=t=0;5>r;r++)for(var a=24;0<=a;a-=8)e[t]=this.g[r]>>a&255,++t;return e};var Vd=function(){this.R=new Td};Vd.prototype.reset=function(){this.R.reset()};var Wd=C.crypto,Xd=!1,Yd=0,Zd=0,$d=1,ae=0,be="",ce=function(e){var t=(e=e||C.event).screenX+e.clientX<<16;t+=e.screenY+e.clientY,t*=(new Date).getTime()%1e6,$d=$d*t%ae,0<Yd&&++Zd==Yd&&Zb("mousemove",ce,"remove","de")},de=function(e){for(var t=new Vd,r=[],a=0,i=(e=unescape(encodeURIComponent(e))).length;a<i;++a)r.push(e.charCodeAt(a));for(t.R.update(r),t=t.R.digest(),e="",r=0;r<t.length;r++)e+="0123456789ABCDEF".charAt(Math.floor(t[r]/16))+"0123456789ABCDEF".charAt(t[r]%16);return e};Xd=!!Wd&&"function"==typeof Wd.getRandomValues,Xd||(ae=1e6*(screen.width*screen.width+screen.height),be=de(D.cookie+"|"+D.location+"|"+(new Date).getTime()+"|"+Math.random()),Yd=S("random/maxObserveMousemove")||0,0!=Yd&&Zb("mousemove",ce,"add","at"));var ee=function(){var e=L.onl;if(!e){e=F(),L.onl=e;var t=F();e.e=function(e){var r=t[e];r&&(delete t[e],r())},e.a=function(e,r){t[e]=r},e.r=function(e){delete t[e]}}return e},fe=function(e,t){return"function"==typeof(t=t.onload)?(ee().a(e,t),t):null},ge=function(e){return I(/^\w+$/.test(e),"Unsupported id - "+e),'onload="window.___jsl.onl.e(&#34;'+e+'&#34;)"'},he=function(e){ee().r(e)},ie={allowtransparency:"true",frameborder:"0",hspace:"0",marginheight:"0",marginwidth:"0",scrolling:"no",style:"",tabindex:"0",vspace:"0",width:"100%"},je={allowtransparency:!0,onload:!0},ke=0,le=function(e){I(!e||Xb.test(e),"Illegal url for new iframe - "+e)},me=function(e,t,r,a,i){le(r.src);var n,o=fe(a,r),s=o?ge(a):"";try{document.all&&(n=e.createElement('<iframe frameborder="'+Jb(String(r.frameborder))+'" scrolling="'+Jb(String(r.scrolling))+'" '+s+' name="'+Jb(String(r.name))+'"/>'))}catch(c){}finally{n||(n=(e?new yb(xb(e)):ta||(ta=new yb)).ga("IFRAME"),o&&(n.onload=function(){n.onload=null,o.call(this)},he(a)))}for(var l in n.setAttribute("ng-non-bindable",""),r)e=r[l],"style"===l&&"object"==typeof e?H(e,n.style):je[l]||n.setAttribute(l,String(e));return(l=i&&i.beforeNode||null)||i&&i.dontclear||dc(t),t.insertBefore(n,l),n=l?l.previousSibling:t.lastChild,r.allowtransparency&&(n.allowTransparency=!0),n},ne=/^:[\w]+$/,oe=/:([a-zA-Z_]+):/g,pe=function(){var e=md()||"0",t=nd(),r=md(void 0)||e,a=nd(void 0),i="";r&&(i+="u/"+encodeURIComponent(String(r))+"/"),a&&(i+="b/"+encodeURIComponent(String(a))+"/"),r=i||null,(i=(a=!1===S("isLoggedIn"))?"_/im/":"")&&(r="");var n=S("iframes/:socialhost:"),o=S("iframes/:im_socialhost:");return Yb={socialhost:n,ctx_socialhost:a?o:n,session_index:e,session_delegate:t,session_prefix:r,im_prefix:i}},qe=function(e,t){return pe()[t]||""},re=function(e){return function(t,r){return e?pe()[r]||e[r]||"":pe()[r]||""}},se=function(e){var t;return e.match(/^https?%3A/i)&&(t=decodeURIComponent(e)),Wb(document,t||e)},te=function(e){e=e||"canonical";for(var t=document.getElementsByTagName("link"),r=0,a=t.length;r<a;r++){var i=t[r],n=i.getAttribute("rel");if(n&&n.toLowerCase()==e&&(i=i.getAttribute("href"))&&(i=se(i))&&null!=i.match(/^https?:\/\/[\w\-_\.]+/i))return i}return window.location.href},ue={se:"0"},ve={post:!0},we={style:"position:absolute;top:-10000px;width:450px;margin:0px;border-style:none"},xe="onPlusOne _ready _close _open _resizeMe _renderstart oncircled drefresh erefresh".split(" "),ye=E(L,"WI",F()),ze=function(e,t,r){var a,i={},n=a=e;for(var o in"plus"==e&&t.action&&(a=e+"_"+t.action,n=e+"/"+t.action),(a=Q("iframes/"+a+"/url"))||(a=":im_socialhost:/:session_prefix::im_prefix:_/widget/render/"+n+"?usegapi=1"),ue)i[o]=o+"/"+(t[o]||ue[o])+"/";if(i=Wb(D,a.replace(oe,re(i))),o="iframes/"+e+"/params/",H(t,n={}),(a=Q("lang")||Q("gwidget/lang"))&&(n.hl=a),ve[e]||(n.origin=window.location.origin||window.location.protocol+"//"+window.location.host),n.exp=Q(o+"exp"),o=Q(o+"location"))for(a=0;a<o.length;a++){var s=o[a];n[s]=C.location[s]}switch(e){case"plus":case"follow":a=t.action?void 0:"publisher",o=(o="string"==typeof(o=n.href)?o:void 0)?se(o):te(a),n.url=o,delete n.href;break;case"plusone":o=(o=t.href)?se(o):te(),n.url=o,o=t.db,a=Q(),null==o&&a&&null==(o=a.db)&&(o=a.gwidget&&a.gwidget.db),n.db=o||void 0,o=t.ecp,a=Q(),null==o&&a&&null==(o=a.ecp)&&(o=a.gwidget&&a.gwidget.ecp),n.ecp=o||void 0,delete n.href;break;case"signin":n.url=te()}for(var l in L.ILI&&(n.iloader="1"),delete n["data-onload"],delete n.rd,ue)n[l]&&delete n[l];for(var c in n.gsrc=Q("iframes/:source:"),void 0!==(l=Q("inline/css"))&&0<r&&l>=r&&(n.ic="1"),l=/^#|^fr-/,r={},n)G(n,c)&&l.test(c)&&(r[c.replace(l,"")]=n[c],delete n[c]);for(var u in c="q"==Q("iframes/"+e+"/params/si")?n:r,l=cd())!G(l,u)||G(n,u)||G(r,u)||(c[u]=l[u]);for(var _ in u=[].concat(xe),(c=Q("iframes/"+e+"/methods"))&&"object"==typeof c&&Bb.test(c.push)&&(u=u.concat(c)),t)G(t,_)&&/^on/.test(_)&&("plus"!=e||"onconnect"!=_)&&(u.push(_),delete n[_]);return delete n.callback,r._methods=u.join(","),Ub(i,n,r)},Ae=["style","data-gapiscan"],Ce=function(e){for(var t=F(),r=0!=e.nodeName.toLowerCase().indexOf("g:"),a=0,i=e.attributes.length;a<i;a++){var n=e.attributes[a],o=n.name,s=n.value;0<=Cb.call(Ae,o)||r&&0!=o.indexOf("data-")||"null"===s||"specified"in n&&!n.specified||(r&&(o=o.substr(5)),t[o.toLowerCase()]=s)}return(r=Be((e=e.style)&&e.height))&&(t.height=String(r)),(e=Be(e&&e.width))&&(t.width=String(e)),t},Be=function(e){var t=void 0;return"number"==typeof e?t=e:"string"==typeof e&&(t=parseInt(e,10)),t},Ee=function(){var e=L.drw;id((function(t){if(e!==t.id&&4!=t.state&&"share"!=t.type){var r=t.id,a=t.type,i=t.url;t=t.userParams;var n=D.getElementById(r);if(n){var o=ze(a,t,0);o?(n=n.parentNode,i.replace(/#.*/,"").replace(/(\?|&)ic=1/,"")!==o.replace(/#.*/,"").replace(/(\?|&)ic=1/,"")&&(t.dontclear=!0,t.rd=!0,t.ri=!0,t.type=a,De(n,t),(a=R[n.lastChild.id])&&(a.oid=r),jd(r,4))):delete R[r]}else delete R[r]}}))},Fe,Ge,Y,He,Ie,Je=/(?:^|\s)g-((\S)*)(?:$|\s)/,Ke={plusone:!0,autocomplete:!0,profile:!0,signin:!0,signin2:!0};Fe=E(L,"SW",F()),Ge=E(L,"SA",F()),Y=E(L,"SM",F()),He=E(L,"FW",[]),Ie=null;var Me=function(e,t){Le(void 0,!1,e,t)},Le=function(e,t,r,a){M("ps0",!0),r=("string"==typeof r?document.getElementById(r):r)||D;var i=D.documentMode;if(r.querySelectorAll&&(!i||8<i)){i=a?[a]:Kb(Fe).concat(Kb(Ge)).concat(Kb(Y));for(var n=[],o=0;o<i.length;o++){var s=i[o];n.push(".g-"+s,"g\\:"+s)}i=r.querySelectorAll(n.join(","))}else i=r.getElementsByTagName("*");for(r=F(),n=0;n<i.length;n++){var l=o=i[n];s=a;var c=l.nodeName.toLowerCase(),u=void 0;if(l.getAttribute("data-gapiscan"))s=null;else{var _=c.indexOf("g:");0==_?u=c.substr(2):(_=(_=String(l.className||l.getAttribute("class")))&&Je.exec(_))&&(u=_[1]),s=!u||!(Fe[u]||Ge[u]||Y[u])||s&&u!==s?null:u}s&&(Ke[s]||0==o.nodeName.toLowerCase().indexOf("g:")||0!=Kb(Ce(o)).length)&&(o.setAttribute("data-gapiscan",!0),E(r,s,[]).push(o))}if(t)for(var h in r)for(t=r[h],a=0;a<t.length;a++)t[a].setAttribute("data-onload",!0);for(var f in r)He.push(f);if(M("ps1",!0),(h=He.join(":"))||e)try{J.load(h,e)}catch(p){return void fd(p)}if(Ne(Ie||{}))for(var d in r){for(f=0,t=(e=r[d]).length;f<t;f++)e[f].removeAttribute("data-gapiscan");Oe(d)}else{for(d in a=[],r)for(f=0,t=(e=r[d]).length;f<t;f++)Pe(d,i=e[f],Ce(i),a,t);Qe(h,a)}},Re=function(e){var t=E(J,e,{});t.go||(t.go=function(t){return Me(t,e)},t.render=function(t,r){return(r=r||{}).type=e,De(t,r)})},Se=function(e){Fe[e]=!0},Te=function(e){Ge[e]=!0},Ue=function(e){Y[e]=!0},Oe=function(e,t){var r=hc(e);t&&r?(r(t),(r=t.iframeNode)&&r.setAttribute("data-gapiattached",!0)):J.load(e,(function(){var r=hc(e),a=t&&t.iframeNode,i=t&&t.userParams;a&&r?(r(t),a.setAttribute("data-gapiattached",!0)):(r=J[e].go)("signin2"==e?a:a&&a.parentNode,i)}))},Ne=function(){return!1},Qe=function(){},Pe=function(e,t,r,a,i,n,o){switch(Ve(t,e,n)){case 0:e=Y[e]?e+"_annotation":e,(a={}).iframeNode=t,a.userParams=r,Oe(e,a);break;case 1:if(t.parentNode){for(var s in r)if((n=G(r,s))&&(n=!(!(n=r[s])||"object"!=typeof n||n.toString&&n.toString!==Object.prototype.toString&&n.toString!==Array.prototype.toString)),n)try{r[s]=Pd(r[s])}catch(g){delete r[s]}if(n=!0,r.dontclear&&(n=!1),delete r.dontclear,hd(),s=ze(e,r,i),(i=o||{}).allowPost=1,i.attributes=we,i.dontclear=!n,(o={}).userParams=r,o.url=s,o.type=e,r.rd)var l=t;else l=document.createElement("div"),t.setAttribute("data-gapistub",!0),l.style.cssText="position:absolute;width:450px;left:-10000px;",t.parentNode.insertBefore(l,t);o.siteElement=l,l.id||(t=l,E(ye,e,0),n="___"+e+"_"+ye[e]++,t.id=n),(t=F())[">type"]=e,H(r,t),n=s,r=l,t=(s=i||{}).attributes||{},I(!(s.allowPost||s.forcePost)||!t.onload,"onload is not supported by post iframe (allowPost or forcePost)"),i=t=n,ne.test(t)&&(i=S("iframes/"+i.substring(1)+"/url"),I(!!i,"Unknown iframe url config for - "+t)),n=Wb(D,i.replace(oe,qe)),t=r.ownerDocument||D,i=s;var c=0;do{l=i.id||["I",ke++,"_",(new Date).getTime()].join("")}while(t.getElementById(l)&&5>++c);I(5>c,"Error creating iframe id"),i=l,l=s,c={};var u={};t.documentMode&&9>t.documentMode&&(c.hostiemode=t.documentMode),H(l.queryParams||{},c),H(l.fragmentParams||{},u);var _=l.pfname,h=F();S("iframes/dropLegacyIdParam")||(h.id=i),h._gfid=i,h.parent=t.location.protocol+"//"+t.location.host;var f=K(t.location.href,"parent");if(!(_=_||"")&&f&&(f=K(t.location.href,"_gfid","")||K(t.location.href,"id",""),_=K(t.location.href,"pfname",""),_=f?_+"/"+f:""),_||(f=Od(K(t.location.href,"jcp","")))&&"object"==typeof f&&(_=(_=f.id)?f.pfname+"/"+_:""),h.pfname=_,l.connectWithJsonParam&&((f={}).jcp=Pd(h),h=f),!(f=K(n,"rpctoken")||c.rpctoken||u.rpctoken)){if(!(f=l.rpctoken)){f=String;var d=(_=Math).round;if(Xd){var p=new C.Uint32Array(1);Wd.getRandomValues(p),p=Number("0."+p[0])}else p=$d,p+=parseInt(be.substr(0,20),16),be=de(be),p/=ae+Math.pow(16,20);f=f(d.call(_,1e8*p))}h.rpctoken=f}if(l.rpctoken=f,H(h,l.connectWithQueryParams?c:u),f=t.location.href,h=F(),(_=K(f,"_bsh",L.bsh))&&(h._bsh=_),(f=fc(f))&&(h.jsh=f),H(h,l.hintInFragment?u:c),c=Ub(n,c,u,l.paramsSerializer),n=s,u=F(),H(ie,u),H(n.attributes,u),u.name=u.id=i,u.src=c,s.eurl=c,n=!!(s=(l=s)||{}).allowPost,s.forcePost||n&&2e3<c.length){if(n=Rb(c),u.src="",l.dropDataPostorigin||(u["data-postorigin"]=c),s=me(t,r,u,i),-1!=navigator.userAgent.indexOf("WebKit")){var m=s.contentWindow.document;m.open(),c=m.createElement("div"),(u={}).name=h=i+"_inner",u.src="",u.style="display:none",me(t,c,u,h,l)}for(c=(l=n.query[0])?l.split("&"):[],l=[],u=0;u<c.length;u++)h=c[u].split("=",2),l.push([decodeURIComponent(h[0]),decodeURIComponent(h[1])]);for(n.query=[],c=Sb(n),I(Xb.test(c),"Invalid URL: "+c),(n=t.createElement("form")).method="POST",n.target=i,n.style.display="none",i=c instanceof y?c:Xa(c),Da(n,"HTMLFormElement").action=Va(i),i=0;i<l.length;i++)(c=t.createElement("input")).type="hidden",c.name=l[i][0],c.value=l[i][1],n.appendChild(c);r.appendChild(n),n.submit(),n.parentNode.removeChild(n),m&&m.close(),m=s}else m=me(t,r,u,i,l);o.iframeNode=m,o.id=m.getAttribute("id"),m=o.id,(r=F()).id=m,r.userParams=o.userParams,r.url=o.url,r.type=o.type,r.state=1,R[m]=r,m=o}else m=null;m&&((o=m.id)&&a.push(o),Oe(e,m))}},Ve=function(e,t,r){if(e&&1===e.nodeType&&t){if(r)return 1;if(Y[t]){if(ec[e.nodeName.toLowerCase()])return(e=e.innerHTML)&&e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")?0:1}else{if(Ge[t])return 0;if(Fe[t])return 1}}return null},De=function(e,t){var r=t.type;delete t.type;var a=("string"==typeof e?document.getElementById(e):e)||void 0;if(a){for(var i in e={},t)G(t,i)&&(e[i.toLowerCase()]=t[i]);e.rd=1,(t=!!e.ri)&&delete e.ri,Pe(r,a,e,i=[],0,t,void 0),Qe(r,i)}else fd("string"=="gapi."+r+".render: missing element "+typeof e?e:"")};E(J,"platform",{}).go=Me,Ne=function(e){for(var t=["_c","jsl","h"],r=0;r<t.length&&e;r++)e=e[t[r]];return t=fc(zb.href),!e||0!=e.indexOf("n;")&&0!=t.indexOf("n;")&&e!==t},Qe=function(e,t){We(e,t)};var ac=function(e){Le(e,!0)},Xe=function(e,t){t=t||[];for(var r=0;r<t.length;++r)e(t[r]);for(e=0;e<t.length;e++)Re(t[e])};rc.push(["platform",function(e,t,r){if(Ie=r,t&&He.push(t),Xe(Se,e),Xe(Te,r._c.annotation),Xe(Ue,r._c.bimodal),Zc(),Xc(),"explicit"!=Q("parsetags")){if(gc(e),dd(cd())&&!Q("disableRealtimeCallback")&&hd(),r&&(e=r.callback)){var a=Lb(e);delete r.callback}cc((function(){ac(a)}))}}]),J._pl=!0;var Ye=function(e){if(e=(e=R[e])?e.oid:void 0){var t=D.getElementById(e);t&&t.parentNode.removeChild(t),delete R[e],Ye(e)}},Ze=/^\{h:'/,$e=/^!_/,af="",We=function(e,t){function r(){Zb("message",a,"remove","de")}function a(a){var n=a.data,o=a.origin;if(bf(n,t)){var s=i;i=!1,s&&M("rqe"),cf(e,(function(){s&&M("rqd"),r();for(var e=E(L,"RPMQ",[]),t=0;t<e.length;t++)e[t]({data:n,origin:o})}))}}if(0!==t.length){af=K(zb.href,"pfname","");var i=!0;Zb("message",a,"add","at"),Rc(e,r)}},bf=function(e,t){if(e=String(e),Ze.test(e))return!0;var r=!1;if($e.test(e)&&(r=!0,e=e.substr(2)),!/^\{/.test(e))return!1;var a=Od(e);if(!a)return!1;if(e=a.f,a.s&&e&&-1!=Cb.call(t,e)){if(("_renderstart"===a.s||a.s===af+"/"+e+"::_renderstart")&&(a=a.a&&a.a[r?0:1],t=D.getElementById(e),jd(e,2),a&&t&&a.width&&a.height)){e:{if(r=t.parentNode,e=a||{},gd()){var i=t.id;if(i){if(1===(a=(a=R[i])?a.state:void 0)||4===a)break e;Ye(i)}}(a=r.nextSibling)&&a.getAttribute&&a.getAttribute("data-gapistub")&&(r.parentNode.removeChild(a),r.style.cssText=""),a=e.width;var n=e.height,o=r.style;o.textIndent="0",o.margin="0",o.padding="0",o.background="transparent",o.borderStyle="none",o.cssFloat="none",o.styleFloat="none",o.lineHeight="normal",o.fontSize="1px",o.verticalAlign="baseline",(r=r.style).display="inline-block",(o=t.style).position="static",o.left="0",o.top="0",o.visibility="visible",a&&(r.width=o.width=a+"px"),n&&(r.height=o.height=n+"px"),e.verticalAlign&&(r.verticalAlign=e.verticalAlign),i&&jd(i,3)}t["data-csi-wdt"]=(new Date).getTime()}return!0}return!1},cf=function(e,t){Rc(e,t)},df=function(e,t){this.N=e,e=t||{},this.ha=Number(e.maxAge)||0,this.W=e.domain,this.Y=e.path,this.ia=!!e.secure};df.prototype.read=function(){for(var e=this.N+"=",t=document.cookie.split(/;\s*/),r=0;r<t.length;++r){var a=t[r];if(0==a.indexOf(e))return a.substr(e.length)}},df.prototype.write=function(e,t){if(!ef.test(this.N))throw"Invalid cookie name";if(!ff.test(e))throw"Invalid cookie value";if(e=this.N+"="+e,this.W&&(e+=";domain="+this.W),this.Y&&(e+=";path="+this.Y),0<=(t="number"==typeof t?t:this.ha)){var r=new Date;r.setSeconds(r.getSeconds()+t),e+=";expires="+r.toUTCString()}return this.ia&&(e+=";secure"),document.cookie=e,!0},df.prototype.clear=function(){this.write("",0)};var ff=/^[-+/_=.:|%&a-zA-Z0-9@]*$/,ef=/^[A-Z_][A-Z0-9_]{0,63}$/;df.iterate=function(e){for(var t=document.cookie.split(/;\s*/),r=0;r<t.length;++r){var a=t[r].split("=");e(a.shift(),a.join("="))}};var gf=function(e){this.G=e};gf.prototype.read=function(){if(Z.hasOwnProperty(this.G))return Z[this.G]},gf.prototype.write=function(e){return Z[this.G]=e,!0},gf.prototype.clear=function(){delete Z[this.G]};var Z={};gf.iterate=function(e){for(var t in Z)Z.hasOwnProperty(t)&&e(t,Z[t])};var hf="https:"===window.location.protocol,jf=hf||"http:"===window.location.protocol?df:gf,kf=function(e){var t=e.substr(1),r="",a=window.location.hostname;if(""!==t){if(r=parseInt(t,10),isNaN(r))return null;if((t=a.split(".")).length<r-1)return null;t.length==r-1&&(a="."+a)}else a="";return{j:"S"==e.charAt(0),domain:a,o:r}},lf=function(){var e,t=null;return jf.iterate((function(r,a){0===r.indexOf("G_AUTHUSER_")&&(r=kf(r.substring(11)),!e||r.j&&!e.j||r.j==e.j&&r.o>e.o)&&(e=r,t=a)})),{fa:e,K:t}};function mf(e){if(0!==e.indexOf("GCSC"))return null;var t={X:!1};if(!(e=e.substr(4)))return t;var r=e.charAt(0),a=(e=e.substr(1)).lastIndexOf("_");if(-1==a)return t;var i=kf(e.substr(a+1));return null==i||"_"!==(e=e.substring(0,a)).charAt(0)||!(a="E"===r&&i.j)&&("U"!==r||i.j)||a&&!hf?t:{X:!0,j:a,la:e.substr(1),domain:i.domain,o:i.o}}var nf=function(e){return e&&(e=e.split("="))[1]?e[1].split("|"):[]},of=function(e){return{clientId:(e=e.split(":"))[0].split("=")[1],ka:nf(e[1]),na:nf(e[2]),ma:nf(e[3])}},pf=function(){var e,t=lf(),r=t.fa;if(null!==(t=t.K)&&(jf.iterate((function(t,a){(t=mf(t))&&t.X&&t.j==r.j&&t.o==r.o&&(e=a)})),e)){var a=of(e),i=a&&a.ka[Number(t)];if(a=a&&a.clientId,i)return{K:t,ja:i,clientId:a}}return null},rf=function(){this.V=qf};n=rf.prototype,n.aa=function(){this.M||(this.A=0,this.M=!0,this.Z())},n.Z=function(){this.M&&(this.A=this.V()?this.T:Math.min(2*(this.A||this.T),120),window.setTimeout(pa(this.Z,this),1e3*this.A))},n.A=0,n.T=2,n.V=null,n.M=!1;for(var sf=0;64>sf;++sf);var tf=null;gd=function(){return L.oa=!0},hd=function(){L.oa=!0;var e=pf();(e=e&&e.K)&&Yc("googleapis.config/sessionIndex",e),tf||(tf=E(L,"ss",new rf)),(e=tf).aa&&e.aa()};var qf=function(){var e=pf(),t=e&&e.ja||null,r=e&&e.clientId;return Rc("auth",{callback:function(){var e=C.gapi.auth,a={client_id:r,session_state:t};e.checkSessionState(a,(function(t){var r=a.session_state,i=Q("isLoggedIn");(i=i!=(t=!Q("debug/forceIm")&&(r&&t||!r&&!t)))&&(Yc("isLoggedIn",t),hd(),Ee(),t||((t=e.signOut)?t():(t=e.setToken)&&t(null))),t=cd();var n=Q("savedUserState");n=n!=(r=e._guss(t.cookiepolicy))&&void 0!==n,Yc("savedUserState",r),(i||n)&&dd(t)&&!Q("disableRealtimeCallback")&&e._pimf(t,!0)}))}}),!0};M("bs0",!0,window.gapi._bs),M("bs1",!0),delete window.gapi._bs}).call(this),gapi.load("",{callback:window.gapi_onload,_c:{jsl:{ci:{deviceType:"desktop","oauth-flow":{authUrl:"https://accounts.google.com/o/oauth2/auth",proxyUrl:"https://accounts.google.com/o/oauth2/postmessageRelay",disableOpt:!0,idpIframeUrl:"https://accounts.google.com/o/oauth2/iframe",usegapi:!1},debug:{reportExceptionRate:.05,forceIm:!1,rethrowException:!1,host:"https://apis.google.com"},enableMultilogin:!0,"googleapis.config":{auth:{useFirstPartyAuthV2:!0}},isPlusUser:!1,inline:{css:1},disableRealtimeCallback:!1,drive_share:{skipInitCommand:!0},csi:{rate:.01},client:{cors:!1},isLoggedIn:!0,signInDeprecation:{rate:0},include_granted_scopes:!0,llang:"en",iframes:{youtube:{params:{location:["search","hash"]},url:":socialhost:/:session_prefix:_/widget/render/youtube?usegapi=1",methods:["scroll","openwindow"]},ytsubscribe:{url:"https://www.youtube.com/subscribe_embed?usegapi=1"},plus_circle:{params:{url:""},url:":socialhost:/:session_prefix::se:_/widget/plus/circle?usegapi=1"},plus_share:{params:{url:""},url:":socialhost:/:session_prefix::se:_/+1/sharebutton?plusShare=true&usegapi=1"},rbr_s:{params:{url:""},url:":socialhost:/:session_prefix::se:_/widget/render/recobarsimplescroller"},":source:":"3p",playemm:{url:"https://play.google.com/work/embedded/search?usegapi=1&usegapi=1"},savetoandroidpay:{url:"https://pay.google.com/gp/v/widget/save"},blogger:{params:{location:["search","hash"]},url:":socialhost:/:session_prefix:_/widget/render/blogger?usegapi=1",methods:["scroll","openwindow"]},evwidget:{params:{url:""},url:":socialhost:/:session_prefix:_/events/widget?usegapi=1"},partnersbadge:{url:"https://www.gstatic.com/partners/badge/templates/badge.html?usegapi=1"},dataconnector:{url:"https://dataconnector.corp.google.com/:session_prefix:ui/widgetview?usegapi=1"},surveyoptin:{url:"https://www.google.com/shopping/customerreviews/optin?usegapi=1"},":socialhost:":"https://apis.google.com",shortlists:{url:""},hangout:{url:"https://talkgadget.google.com/:session_prefix:talkgadget/_/widget"},plus_followers:{params:{url:""},url:":socialhost:/_/im/_/widget/render/plus/followers?usegapi=1"},post:{params:{url:""},url:":socialhost:/:session_prefix::im_prefix:_/widget/render/post?usegapi=1"},":gplus_url:":"https://plus.google.com",signin:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/signin?usegapi=1",methods:["onauth"]},rbr_i:{params:{url:""},url:":socialhost:/:session_prefix::se:_/widget/render/recobarinvitation"},share:{url:":socialhost:/:session_prefix::im_prefix:_/widget/render/share?usegapi=1"},plusone:{params:{count:"",size:"",url:""},url:":socialhost:/:session_prefix::se:_/+1/fastbutton?usegapi=1"},comments:{params:{location:["search","hash"]},url:":socialhost:/:session_prefix:_/widget/render/comments?usegapi=1",methods:["scroll","openwindow"]},":im_socialhost:":"https://plus.googleapis.com",backdrop:{url:"https://clients3.google.com/cast/chromecast/home/widget/backdrop?usegapi=1"},visibility:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/visibility?usegapi=1"},autocomplete:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/autocomplete"},additnow:{url:"https://apis.google.com/marketplace/button?usegapi=1",methods:["launchurl"]},":signuphost:":"https://plus.google.com",ratingbadge:{url:"https://www.google.com/shopping/customerreviews/badge?usegapi=1"},appcirclepicker:{url:":socialhost:/:session_prefix:_/widget/render/appcirclepicker"},follow:{url:":socialhost:/:session_prefix:_/widget/render/follow?usegapi=1"},community:{url:":ctx_socialhost:/:session_prefix::im_prefix:_/widget/render/community?usegapi=1"},sharetoclassroom:{url:"https://classroom.google.com/sharewidget?usegapi=1"},ytshare:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/ytshare?usegapi=1"},plus:{url:":socialhost:/:session_prefix:_/widget/render/badge?usegapi=1"},family_creation:{params:{url:""},url:"https://families.google.com/webcreation?usegapi=1&usegapi=1"},commentcount:{url:":socialhost:/:session_prefix:_/widget/render/commentcount?usegapi=1"},configurator:{url:":socialhost:/:session_prefix:_/plusbuttonconfigurator?usegapi=1"},zoomableimage:{url:"https://ssl.gstatic.com/microscope/embed/"},appfinder:{url:"https://workspace.google.com/:session_prefix:marketplace/appfinder?usegapi=1"},savetowallet:{url:"https://pay.google.com/gp/v/widget/save"},person:{url:":socialhost:/:session_prefix:_/widget/render/person?usegapi=1"},savetodrive:{url:"https://drive.google.com/savetodrivebutton?usegapi=1",methods:["save"]},page:{url:":socialhost:/:session_prefix:_/widget/render/page?usegapi=1"},card:{url:":socialhost:/:session_prefix:_/hovercard/card"}}},h:"m;/_/scs/apps-static/_/js/k=oz.gapi.en.RrjSsKk8Szw.O/am=AQ/d=1/ct=zgms/rs=AGLTcCPwd_oodKkRT_hYRO1I-9xRcQV4oQ/m=__features__",u:"https://apis.google.com/js/platform.js",hee:!0,fp:"4f1fdca05837fff2aeba6f468b1106b3cee46dcd",dpo:!1},platform:["additnow","backdrop","blogger","comments","commentcount","community","donation","family_creation","follow","hangout","health","page","partnersbadge","person","playemm","playreview","plus","plusone","post","ratingbadge","savetoandroidpay","savetodrive","savetowallet","sharetoclassroom","shortlists","signin2","surveyoptin","visibility","youtube","ytsubscribe","zoomableimage"],fp:"4f1fdca05837fff2aeba6f468b1106b3cee46dcd",annotation:["interactivepost","recobar","signin2","autocomplete","profile"],bimodal:["signin","share"]}});