(function(){"use strict";window.HumanAPI=function t(e){var n=this;"string"==typeof e&&(e={iframeId:e}),e.onReady=function(){n._ready=!0;for(var i=0,s=n._readyCallbacks.length;s>i;i++)n._readyCallbacks[i](),n._readyCallbacks.length=0},n._rpc=new t.WindowRPCClient(e),n._ready=!1,n._readyCallbacks=[]},HumanAPI.prototype.send=function(t,e,n){return"function"==typeof e&&(n=e,e={}),"function"==typeof n&&(n=n.bind(this)),this._rpc.call(t,e||{},n),this},HumanAPI.prototype.on=function(t,e){return"function"==typeof e&&(e=e.bind(this)),"human.ready"===t?(this._ready?e():this._readyCallbacks.push(e),this):(this._rpc.call("apiEvents.on",t,e,!1),this)},HumanAPI.prototype.once=function(t,e){return"function"==typeof e&&(e=e.bind(this)),"human.ready"===t?(this._ready?e():this._readyCallbacks.push(e),this):(this._rpc.call("apiEvents.once",t,e,!0),this)}})(),function(){"use strict";HumanAPI.Map=function(t,e){this.items=t||[];var i=(e||0)+1;this.addItem=function(){var s;if(2===arguments.length){var o=arguments[0];if(this.items[o])throw"ID clash: '"+o+"'";return this.items[o]=s=arguments[1],o}for(;;){s=arguments[0];var r=i++;if(!this.items[r])return this.items[r]=s,r}},this.removeItem=function(s){delete this.items[s]}}}(),function(){"use strict";HumanAPI.WindowRPCClient=function(t){if(!t.iframeId)throw"config expected: iframeId";if(this._iframe=document.getElementById(t.iframeId),!this._iframe)throw"iframe not found: '"+t.iframeId+"'";if(!this._iframe.contentWindow)throw"element is not an iframe: '"+t.iframeId+"'";this.destroyed=!1,this._handleMap=new HumanAPI.Map({},Date.now()),this._subs={},this._ready=!1,this._messageBuffer=[],this._messageBufferConnected=[],this._connect(t.onUnsupported,t.onConnected,t.onReady)},HumanAPI.WindowRPCClient.prototype._connect=function(t,e,n){var i=null,s=this,r=function(){d(),i=setInterval(function(){return!s.destroyed&&s._iframe&&s._iframe.contentWindow?void s._iframe.contentWindow.postMessage(JSON.stringify({action:"connect"}),"*"):void d()},100)},d=function(){i&&(clearInterval(i),i=null)};window.addEventListener("message",function(c){var h=c.data;if("unsupported"===h)"function"==typeof t&&t(c.data);else{var a;try{a=JSON.parse(h)}catch{return}if(a.message)switch(a.message){case"connected":s._connected=!0,s._sendQueuedMessages(!0),"function"==typeof e&&e();break;case"status":"ready"===a.status&&(s._ready=!0,d(),s._sendQueuedMessages(),"function"==typeof n&&n())}if(a.results||a.response){var f=a.results||a.response;for(var u in f)f.hasOwnProperty(u)&&s._subs[u]&&s.set(u,f[u])}}},!1),s._iframe.addEventListener("load",r),s._iframe.addEventListener("unload",d),r()},HumanAPI.WindowRPCClient.prototype._sendQueuedMessages=function(t){for(var e=t?this._messageBufferConnected:this._messageBuffer;e.length>0;){var n=e.pop();this._send(n,n.ok,n.once)}},HumanAPI.WindowRPCClient.prototype.call=function(t,e,n,i){var s={call:t,params:e,ok:n,once:i},o=e.connected?this._messageBufferConnected:this._messageBuffer;this._ready||this._connected&&e.connected?this._send(s,n,i):o.unshift(s)},HumanAPI.WindowRPCClient.prototype._send=function(t,e,n){if(e){var i=this,s=this._on(function(o){(void 0===n||!0===n)&&i._off(s),e.call(i,o)});t.id=s,this._sendMessage(t)}else this._sendMessage(t)},HumanAPI.WindowRPCClient.prototype._sendMessage=function(t){this._onSend&&this._onSend(t),this.destroyed||this._iframe.contentWindow.postMessage(JSON.stringify(t),"*")},HumanAPI.WindowRPCClient.prototype.set=function(t,e){var n=this._subs[t];n&&n.call(this,e)},HumanAPI.WindowRPCClient.prototype._on=function(t){var e=this._handleMap.addItem();return this._subs[e]=t,e},HumanAPI.WindowRPCClient.prototype._off=function(t){delete this._subs[t],this._handleMap.removeItem(t)},HumanAPI.WindowRPCClient.prototype.destroy=function(){this.destroyed=!0}}();